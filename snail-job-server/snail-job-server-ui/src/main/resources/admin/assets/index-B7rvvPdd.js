import{c as Ge,d as Le,a as ze,N as Ne,b as qe}from"./search-form.vue_vue_type_script_setup_true_lang-D7hHwQXT.js";import{d as We,_ as Ye,a as Ze}from"./download-B8kLvDP_.js";import{_ as Qe}from"./delete-alert-C8iwsugF.js";import{d as J,r as C,o as h,c as N,h as a,$ as t,a4 as re,aE as Xe,aa as X,aF as ea,aG as aa,aH as ta,Z as oe,a0 as _e,L as Je,q as Q,b as le,w as l,f as e,g as y,t as j,ai as De,aI as H,a9 as Pe,D as Ie,p as ge,z as la,A as oa,a as ra,a1 as Re,aJ as Ee,a3 as xe,e as be,x as na,aK as $e,C as Oe,s as Ve,ab as sa,E as ua,H as pa,B as G,F as Ae,I as ia,l as da,ac as Z,aC as Me,aL as ma,aM as ca,aA as ga,aN as Ke,aO as Be,Y as ve,u as ba,ag as fa,ah as te,aj as we,ak as va}from"./index--PhRNylI.js";import{a as _a,b as ya,c as Ta,d as Ce,e as ka,g as ja}from"./job-Tsw2tz69.js";import{_ as ha,u as Sa,a as Na}from"./table-DvozQPKE.js";import{_ as xa}from"./status-switch.vue_vue_type_script_setup_true_lang-DMX4IkJr.js";import{u as wa}from"./auth-CqD89xZX.js";import{_ as Fe}from"./select-group.vue_vue_type_script_setup_true_lang-CNpCk88a.js";import{_ as He,a as Da}from"./route-key.vue_vue_type_script_setup_true_lang-1zj4qELf.js";import{_ as fe,a as Ia}from"./code-mirror.vue_vue_type_script_setup_true_lang-BxhWNz7f.js";import{_ as Ua}from"./cron-input.vue_vue_type_style_index_0_lang-CaeUqGwF.js";import{a as Ra,_ as $a,d as Oa,c as Va,b as Ca}from"./Grid-C8sbif0M.js";import{_ as Ja}from"./detail-drawer-CS6ssopv.js";import{_ as Pa,a as Ea}from"./DescriptionsItem-BzmwSMF7.js";import"./Progress-B_nFqYUL.js";import"./group-Rd_jp_gh.js";const Aa=J({name:"TriggerType",__name:"trigger-type",emits:["update:value"],setup(x,{emit:k}){const u=k,T=C(),i=c=>{u("update:value",c)};return(c,d)=>{const f=X;return h(),N(f,{value:T.value,"onUpdate:value":[d[0]||(d[0]=n=>T.value=n),i],placeholder:a(t)("common.triggerType.form"),options:a(re)(a(Xe))},null,8,["value","placeholder","options"])}}}),Ma=J({name:"BlockStrategy",__name:"block-strategy",emits:["update:value"],setup(x,{emit:k}){const u=C(),T=k,i=c=>{T("update:value",c)};return(c,d)=>{const f=X;return h(),N(f,{value:u.value,"onUpdate:value":[d[0]||(d[0]=n=>u.value=n),i],placeholder:a(t)("common.blockStrategy.form"),options:a(re)(a(ea))},null,8,["value","placeholder","options"])}}}),Ka=J({name:"TriggerStrategy",__name:"executor-type",emits:["update:value"],setup(x,{emit:k}){const u=C(),T=k,i=c=>{T("update:value",c)};return(c,d)=>{const f=X;return h(),N(f,{value:u.value,"onUpdate:value":[d[0]||(d[0]=n=>u.value=n),i],placeholder:a(t)("common.executorType.form"),options:a(re)(a(aa))},null,8,["value","placeholder","options"])}}}),Ba=J({name:"TaskType",__name:"task-type",emits:["update:value"],setup(x,{emit:k}){const u=k,T=C(),i=c=>{u("update:value",c)};return(c,d)=>{const f=X;return h(),N(f,{value:T.value,"onUpdate:value":[d[0]||(d[0]=n=>T.value=n),i],placeholder:a(t)("common.routeKey.routeForm"),options:a(re)(a(ta))},null,8,["value","placeholder","options"])}}}),Fa=J({name:"JobTriggerInterval",__name:"job-trigger-interval",props:oe({triggerType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const k=_e(x,"modelValue"),u=x,T=Je(),i=C(u.triggerType===2?Number(k.value):60),c=C(u.triggerType===3?k.value:"* * * * * ?");return Q(i,d=>{u.triggerType===2&&(k.value=`${d}`)},{immediate:!0}),Q(c,d=>{u.triggerType===3&&(k.value=d)},{immediate:!0}),Q(()=>u.triggerType,d=>{d===2?k.value=`${i.value}`:d===3?k.value=c.value:k.value="*"},{immediate:!0}),(d,f)=>{const n=H,_=He,V=Pe,P=Ie;return h(),le("div",null,[d.triggerType===2?(h(),N(V,{key:0},{default:l(()=>[e(n,{value:i.value,"onUpdate:value":f[0]||(f[0]=v=>i.value=v),placeholder:d.$t("page.jobTask.form.triggerInterval")},null,8,["value","placeholder"]),e(_,null,{default:l(()=>[y(j(d.$t("common.second")),1)]),_:1})]),_:1})):d.triggerType===3?(h(),N(a(Ua),{key:1,modelValue:c.value,"onUpdate:modelValue":f[1]||(f[1]=v=>c.value=v),placeholder:d.$t("page.jobTask.form.triggerInterval_CRON"),lang:a(T).locale},null,8,["modelValue","placeholder","lang"])):d.triggerType===99?(h(),N(P,{key:2,disabled:""})):De("",!0)])}}}),Ha={class:"w-full w-full flex-col items-start gap-12px pt-5px"},Ga={class:"flex"},La=J({name:"JobTaskOperateDrawer",__name:"job-task-operate-drawer",props:oe({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:oe(["submitted"],["update:visible"]),setup(x,{emit:k}){const u=x,T=k,i=C(0),c=_e(x,"visible"),d=ge({args:[{arg:""}]}),f=C(0),n=C(null),{formRef:_,validate:V,restoreValidation:P}=la(),{defaultRequiredRule:v}=oa(),E=ra(()=>({add:t("page.jobTask.addJobTask"),edit:t("page.jobTask.editJobTask")})[u.operateType]),s=ge(L());function L(){return{groupName:void 0,jobName:"",argsStr:"",argsType:1,jobStatus:1,routeKey:4,executorType:1,triggerType:2,executorInfo:void 0,triggerInterval:"60",blockStrategy:1,executorTimeout:60,maxRetryTimes:3,retryInterval:1,taskType:1,parallelNum:1,description:""}}const ye={groupName:v,jobName:v,argsType:v,jobStatus:v,routeKey:v,executorType:v,executorInfo:v,triggerType:v,triggerInterval:v,blockStrategy:v,executorTimeout:v,maxRetryTimes:v,retryInterval:v,taskType:v,parallelNum:v},U=C([]),S=ge(ne());function ne(){return{method:"POST",url:"",headers:{},body:"",mediaType:"application/json",timeout:60}}const $=[{label:"Http 执行器",value:"snailJobHttpExecutor"},{label:"CMD 执行器",value:"snailJobCMDJobExecutor"},{label:"PowerShell 执行器",value:"snailJobPowerShellJobExecutor"},{label:"Shell 执行器",value:"snailJobShellJobExecutor"}],O=ge(se());function se(){return{method:"LOCAL_SCRIPT",scriptParams:"",charset:""}}function Te(){if(u.operateType==="add"){Object.assign(s,L()),i.value=0,U.value=[],Object.assign(S,ne()),Object.assign(O,se());return}if(u.operateType==="edit"&&u.rowData){if(Object.assign(s,u.rowData),s.taskType===3&&s.argsStr&&Object.assign(d,{args:JSON.parse(s.argsStr).map(p=>({arg:p}))}),s.taskType===5&&s.argsStr){const p=JSON.parse(s.argsStr);f.value=p.shardNum,s.argsStr=p.argsStr}$.map(p=>p.value).includes(s.executorInfo)&&(i.value=1,s.executorInfo==="snailJobHttpExecutor"?(Object.assign(S,JSON.parse(s.argsStr)),S.headers&&(U.value=Object.keys(S.headers).map(p=>({key:p,value:S.headers[p]})))):Object.assign(O,JSON.parse(s.argsStr)))}}function ue(){c.value=!1}async function pe(){var B,ce,r;await V();const{id:p,groupName:o,jobName:D,argsType:g,jobStatus:z,routeKey:A,executorType:w,executorInfo:ee,triggerType:q,triggerInterval:ie,blockStrategy:M,executorTimeout:de,maxRetryTimes:me,retryInterval:K,taskType:ae,parallelNum:W,description:Y}=s;let R=ae===5?JSON.stringify({shardNum:f.value,argsStr:s.argsStr}):s.argsStr;if(i.value===1&&(await((B=n.value)==null?void 0:B.validate()),s.executorInfo==="snailJobHttpExecutor"?(U.value.forEach(I=>{S.headers[I.key]=I.value}),R=JSON.stringify(S)):R=JSON.stringify(O)),u.operateType==="add"){const{error:I}=await _a({groupName:o,jobName:D,argsStr:R,argsType:g,jobStatus:z,routeKey:A,executorType:w,executorInfo:ee,triggerType:q,triggerInterval:ie,blockStrategy:M,executorTimeout:de,maxRetryTimes:me,retryInterval:K,taskType:ae,parallelNum:W,description:Y});if(I)return;(ce=window.$message)==null||ce.success(t("common.addSuccess"))}if(u.operateType==="edit"){const{error:I}=await ya({id:p,groupName:o,jobName:D,argsStr:R,argsType:g,jobStatus:z,routeKey:A,executorType:w,executorInfo:ee,triggerType:q,triggerInterval:ie,blockStrategy:M,executorTimeout:de,maxRetryTimes:me,retryInterval:K,taskType:ae,parallelNum:W,description:Y});if(I)return;(r=window.$message)==null||r.success(t("common.updateSuccess"))}ue(),T("submitted")}function ke(){if(s.taskType===3&&d.args){const p=d.args.map(o=>o.arg.trim()).filter(o=>!!o);s.argsStr=p.length>0?JSON.stringify(p):""}return s.argsStr}const je=p=>{d.args.splice(p,1)},he=()=>{d.args.push({arg:""})};Q(c,()=>{var p;c.value&&(Te(),P(),(p=n.value)==null||p.restoreValidation())}),Q(d,()=>{c.value&&s.taskType===3&&ke()}),Q(()=>s.taskType,p=>{u.operateType==="add"&&c.value&&(p!==3&&(d.args=[]),p!==5&&(f.value=1),s.argsStr="")});function Se(){if(i.value===0){s.executorInfo="";return}s.executorInfo="snailJobHttpExecutor"}const m=[{label:"GET",value:"get"},{label:"POST",value:"post"},{label:"PUT",value:"put"},{label:"DELETE",value:"delete"}],b=[{label:"需下载脚本",value:"DOWNLOAD"},{label:"脚本代码",value:"SCRIPT_CODE"},{label:"使用本地脚本",value:"LOCAL_SCRIPT"}];return(p,o)=>{const D=Ie,g=ua,z=Fe,A=Ra,w=pa,ee=$a,q=X,ie=Le,M=G,de=Ge,me=Ae,K=Pe,ae=Ia,W=He,Y=ia,R=Oa,B=Va,ce=Aa;return h(),N(sa,{modelValue:c.value,"onUpdate:modelValue":o[30]||(o[30]=r=>c.value=r),title:E.value,"min-size":480,onHandleSubmit:pe},{footer:l(()=>[e(w,{size:16},{default:l(()=>[e(M,{onClick:ue},{default:l(()=>[y(j(a(t)("common.cancel")),1)]),_:1}),e(M,{type:"primary",onClick:pe},{default:l(()=>[y(j(a(t)("common.save")),1)]),_:1})]),_:1})]),default:l(()=>[e(Y,{ref_key:"formRef",ref:_,model:s,rules:ye},{default:l(()=>[e(g,{label:a(t)("page.jobTask.jobName"),path:"jobName"},{default:l(()=>[e(D,{value:s.jobName,"onUpdate:value":o[0]||(o[0]=r=>s.jobName=r),maxlength:64,"show-count":"",placeholder:a(t)("page.jobTask.form.jobName")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{label:a(t)("page.jobTask.groupName"),path:"groupName"},{default:l(()=>[e(z,{value:s.groupName,"onUpdate:value":o[1]||(o[1]=r=>s.groupName=r),disabled:u.operateType==="edit"},null,8,["value","disabled"])]),_:1},8,["label"]),e(g,{label:a(t)("page.jobTask.jobStatus"),path:"jobStatus"},{default:l(()=>[e(ee,{value:s.jobStatus,"onUpdate:value":o[2]||(o[2]=r=>s.jobStatus=r),name:"jobStatus"},{default:l(()=>[e(w,null,{default:l(()=>[(h(!0),le(xe,null,Re(a(Ee),r=>(h(),N(A,{key:r.value,value:r.value,label:a(t)(r.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),e(g,{label:a(t)("page.jobTask.taskType"),path:"taskType"},{default:l(()=>[e(Ba,{value:s.taskType,"onUpdate:value":o[3]||(o[3]=r=>s.taskType=r),placeholder:a(t)("page.jobTask.form.taskType")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{label:a(t)("page.jobTask.executorType"),path:"executorType"},{default:l(()=>[e(Ka,{value:s.executorType,"onUpdate:value":o[4]||(o[4]=r=>s.executorType=r)},null,8,["value"])]),_:1},8,["label"]),e(g,{label:a(t)("page.jobTask.executorInfo"),path:"executorInfo"},{default:l(()=>[be("div",Ha,[e(ee,{value:i.value,"onUpdate:value":o[5]||(o[5]=r=>i.value=r),onChange:Se},{default:l(()=>[e(A,{value:0},{default:l(()=>o[31]||(o[31]=[y("自定义执行器")])),_:1}),e(A,{value:1},{default:l(()=>o[32]||(o[32]=[y("内置执行器")])),_:1})]),_:1},8,["value"]),i.value===0?(h(),N(D,{key:0,value:s.executorInfo,"onUpdate:value":o[6]||(o[6]=r=>s.executorInfo=r),placeholder:a(t)("page.jobTask.form.executorInfo")},null,8,["value","placeholder"])):(h(),N(q,{key:1,value:s.executorInfo,"onUpdate:value":o[7]||(o[7]=r=>s.executorInfo=r),options:$,placeholder:"请选择内置执行器"},null,8,["value"]))])]),_:1},8,["label"]),s.taskType===5?(h(),N(g,{key:0,label:a(t)("page.jobTask.shardNum")},{default:l(()=>[e(a(H),{value:f.value,"onUpdate:value":o[8]||(o[8]=r=>f.value=r),min:1,placeholder:a(t)("page.jobTask.form.shardNum")},null,8,["value","placeholder"])]),_:1},8,["label"])):De("",!0),e(g,{label:a(t)("page.jobTask.argsStr"),path:"argsStr","show-label":i.value===0,"show-feedback":i.value===0,rule:s.taskType===3?a(v):void 0},{default:l(()=>[i.value===0?(h(),le(xe,{key:0},[s.taskType===3?(h(),N(me,{key:0,class:"flex-col"},{default:l(()=>[(h(!0),le(xe,null,Re(d.args,(r,I)=>(h(),N(g,{key:I,label:`分片参数 ${I+1}`,path:`args[${I}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${a(t)("page.jobTask.form.argsStr")} ${I+1}`,trigger:["input","blur"],validator(){return!!r.arg}}},{default:l(()=>[e(fe,{modelValue:r.arg,"onUpdate:modelValue":Ue=>r.arg=Ue,lang:"json",placeholder:a(t)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),e(M,{class:"ml-12px",type:"error",dashed:"",onClick:Ue=>je(I)},{default:l(()=>[e(ie,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),e(M,{block:"",dashed:"","attr-type":"button",onClick:he},{default:l(()=>[e(de,{class:"text-icon"})]),_:1})]),_:1})):(h(),N(fe,{key:1,modelValue:s.argsStr,"onUpdate:modelValue":o[9]||(o[9]=r=>s.argsStr=r),lang:"json",placeholder:a(t)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))],64)):s.executorInfo==="snailJobHttpExecutor"?(h(),N(Y,{key:1,ref_key:"customformRef",ref:n,class:"w-full",model:S},{default:l(()=>[e(g,{label:"请求参数",rule:a(v),path:"url"},{default:l(()=>[e(K,null,{default:l(()=>[e(q,{value:S.method,"onUpdate:value":o[10]||(o[10]=r=>S.method=r),class:"http-method",options:m},null,8,["value"]),e(D,{value:S.url,"onUpdate:value":o[11]||(o[11]=r=>S.url=r),placeholder:"请输入请求地址",class:"w-full"},null,8,["value"])]),_:1})]),_:1},8,["rule"]),e(g,{label:"Media Type"},{default:l(()=>[e(D,{value:S.mediaType,"onUpdate:value":o[12]||(o[12]=r=>S.mediaType=r),placeholder:"请输入 Media Type"},null,8,["value"])]),_:1}),o[34]||(o[34]=be("div",{class:"n-form-item-label"},"Header 参数",-1)),e(ae,{value:U.value,"onUpdate:value":o[15]||(o[15]=r=>U.value=r),class:na(U.value.length?void 0:"mb-24px"),"item-style":"margin-bottom: 0;","on-create":()=>({key:"",value:""})},{default:l(({index:r})=>[be("div",Ga,[e(g,{"ignore-path-change":"","show-label":!1,path:`headers[${r}].key`,rule:{required:!0,message:"请输入键",trigger:["input","blur"],validator:()=>a($e)(U.value[r].key)}},{default:l(()=>[e(D,{value:U.value[r].key,"onUpdate:value":I=>U.value[r].key=I,placeholder:"Key",onKeydown:o[13]||(o[13]=Oe(Ve(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"]),o[33]||(o[33]=be("div",{class:"mx-8px h-34px text-center line-height-34px"},"=",-1)),e(g,{"ignore-path-change":"","show-label":!1,path:`headers[${r}].value`,rule:{required:!0,message:"请输入值",trigger:["input","blur"],validator:()=>a($e)(U.value[r].value)}},{default:l(()=>[e(D,{value:U.value[r].value,"onUpdate:value":I=>U.value[r].value=I,placeholder:"Value",onKeydown:o[14]||(o[14]=Oe(Ve(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"])])]),_:1},8,["value","class"]),e(g,{label:"Body 参数"},{default:l(()=>[e(fe,{modelValue:S.body,"onUpdate:modelValue":o[16]||(o[16]=r=>S.body=r),lang:"json",placeholder:"请输入 Body 参数"},null,8,["modelValue"])]),_:1}),e(g,{label:"接口超时时间"},{default:l(()=>[e(K,null,{default:l(()=>[e(a(H),{value:S.timeout,"onUpdate:value":o[17]||(o[17]=r=>S.timeout=r),class:"w-full",min:1,max:99999999,placeholder:a(t)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(W,null,{default:l(()=>[y(j(a(t)("common.second")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):(h(),N(Y,{key:2,ref_key:"customformRef",ref:n,class:"w-full",model:O},{default:l(()=>[e(g,{label:"脚本类型"},{default:l(()=>[e(q,{value:O.method,"onUpdate:value":o[18]||(o[18]=r=>O.method=r),options:b},null,8,["value"])]),_:1}),e(g,{label:"脚本参数"},{default:l(()=>[e(fe,{modelValue:O.scriptParams,"onUpdate:modelValue":o[19]||(o[19]=r=>O.scriptParams=r),lang:"json",placeholder:"请输入脚本参数"},null,8,["modelValue"])]),_:1}),e(g,{label:"编码格式"},{default:l(()=>[e(D,{value:O.charset,"onUpdate:value":o[20]||(o[20]=r=>O.charset=r),placeholder:"请输入编码格式"},null,8,["value"])]),_:1})]),_:1},8,["model"]))]),_:1},8,["label","show-label","show-feedback","rule"]),e(B,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(R,null,{default:l(()=>[e(g,{label:a(t)("page.jobTask.routeKey"),path:"routeKey"},{default:l(()=>[e(Da,{value:s.routeKey,"onUpdate:value":o[21]||(o[21]=r=>s.routeKey=r),"task-type":s.taskType},null,8,["value","task-type"])]),_:1},8,["label"])]),_:1}),e(R,null,{default:l(()=>[e(g,{label:a(t)("page.jobTask.blockStrategy"),path:"blockStrategy"},{default:l(()=>[e(Ma,{value:s.blockStrategy,"onUpdate:value":o[22]||(o[22]=r=>s.blockStrategy=r)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(B,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(R,null,{default:l(()=>[e(g,{label:a(t)("page.jobTask.triggerType"),path:"triggerType"},{default:l(()=>[e(ce,{value:s.triggerType,"onUpdate:value":o[23]||(o[23]=r=>s.triggerType=r),placeholder:a(t)("page.jobTask.form.triggerType")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e(R,null,{default:l(()=>[e(g,{label:a(t)("page.jobTask.triggerInterval"),path:"triggerInterval"},{default:l(()=>[e(Fa,{modelValue:s.triggerInterval,"onUpdate:modelValue":o[24]||(o[24]=r=>s.triggerInterval=r),"trigger-type":s.triggerType},null,8,["modelValue","trigger-type"])]),_:1},8,["label"])]),_:1})]),_:1}),e(B,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(R,null,{default:l(()=>[e(g,{label:a(t)("page.jobTask.executorTimeout"),path:"executorTimeout"},{default:l(()=>[e(K,null,{default:l(()=>[e(a(H),{value:s.executorTimeout,"onUpdate:value":o[25]||(o[25]=r=>s.executorTimeout=r),min:1,max:99999999,placeholder:a(t)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(W,null,{default:l(()=>[y(j(a(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),e(R,null,{default:l(()=>[e(g,{label:a(t)("page.jobTask.maxRetryTimes"),path:"maxRetryTimes"},{default:l(()=>[e(a(H),{value:s.maxRetryTimes,"onUpdate:value":o[26]||(o[26]=r=>s.maxRetryTimes=r),min:0,max:999,placeholder:a(t)("page.jobTask.form.maxRetryTimes"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),e(B,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(R,null,{default:l(()=>[e(g,{label:a(t)("page.jobTask.retryInterval"),path:"retryInterval"},{default:l(()=>[e(K,null,{default:l(()=>[e(a(H),{value:s.retryInterval,"onUpdate:value":o[27]||(o[27]=r=>s.retryInterval=r),min:1,max:99999999,placeholder:a(t)("page.jobTask.form.retryInterval"),clearable:""},null,8,["value","placeholder"]),e(W,null,{default:l(()=>[y(j(a(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),e(R,null,{default:l(()=>[s.taskType!==1&&s.taskType!==2?(h(),N(g,{key:0,label:a(t)("page.jobTask.parallelNum"),path:"parallelNum"},{default:l(()=>[e(a(H),{value:s.parallelNum,"onUpdate:value":o[28]||(o[28]=r=>s.parallelNum=r),min:1,max:999,placeholder:a(t)("page.jobTask.form.parallelNum"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):De("",!0)]),_:1})]),_:1}),e(g,{label:a(t)("page.jobTask.description"),path:"description"},{default:l(()=>[e(D,{value:s.description,"onUpdate:value":o[29]||(o[29]=r=>s.description=r),type:"textarea",placeholder:a(t)("page.jobTask.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),za=da(La,[["__scopeId","data-v-4e513fda"]]),qa=J({name:"JobTaskSearch",__name:"job-task-search",props:{model:{required:!0},modelModifiers:{}},emits:oe(["reset","search"],["update:model"]),setup(x,{emit:k}){const u=k,T=_e(x,"model");function i(){u("reset")}function c(){u("search")}return(d,f)=>{const n=ha,_=Ie,V=X,P=ze;return h(),N(P,{model:T.value,onSearch:c,onReset:i},{default:l(()=>[e(n,{span:"24 s:12 m:6",label:a(t)("page.jobTask.groupName"),path:"groupName",class:"pr-24px"},{default:l(()=>[e(Fe,{value:T.value.groupName,"onUpdate:value":f[0]||(f[0]=v=>T.value.groupName=v),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(n,{span:"24 s:12 m:6",label:a(t)("page.jobTask.jobName"),path:"jobName",class:"pr-24px"},{default:l(()=>[e(_,{value:T.value.jobName,"onUpdate:value":f[1]||(f[1]=v=>T.value.jobName=v),placeholder:a(t)("page.jobTask.form.jobName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(n,{span:"24 s:12 m:6",label:a(t)("page.jobTask.jobStatus"),path:"jobStatus",class:"pr-24px"},{default:l(()=>[e(V,{value:T.value.jobStatus,"onUpdate:value":f[2]||(f[2]=v=>T.value.jobStatus=v),placeholder:a(t)("page.jobTask.form.jobStatus"),options:a(re)(a(Ee)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Wa=J({name:"JobTaskDetailDrawer",__name:"job-task-detail-drawer",props:oe({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(x){const k=_e(x,"visible");return(u,T)=>{const i=Pa,c=ve,d=Ea,f=Ja;return h(),N(f,{modelValue:k.value,"onUpdate:modelValue":T[0]||(T[0]=n=>k.value=n),title:a(t)("page.jobTask.detail"),width:["50%","90%"]},{default:l(()=>[e(d,{"label-placement":"top",bordered:"",column:2},{default:l(()=>[e(i,{label:a(t)("page.jobTask.groupName")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.groupName),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.jobName")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.jobName),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.taskType")},{default:l(()=>{var n;return[e(c,{type:a(Z)((n=u.rowData)==null?void 0:n.taskType)},{default:l(()=>{var _;return[y(j(a(t)(a(Me)[(_=u.rowData)==null?void 0:_.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.argsStr")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.argsStr),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.nextTriggerAt")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.nextTriggerAt),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.jobStatus")},{default:l(()=>{var n;return[e(c,{type:a(Z)((n=u.rowData)==null?void 0:n.jobStatus)},{default:l(()=>{var _;return[y(j(a(t)(a(ma)[(_=u.rowData)==null?void 0:_.jobStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.routeKey")},{default:l(()=>{var n;return[e(c,{type:a(Z)((n=u.rowData)==null?void 0:n.routeKey)},{default:l(()=>{var _;return[y(j(a(t)(a(ca)[(_=u.rowData)==null?void 0:_.routeKey])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.executorType")},{default:l(()=>{var n;return[e(c,{type:a(Z)((n=u.rowData)==null?void 0:n.executorType)},{default:l(()=>{var _;return[y(j(a(t)(a(ga)[(_=u.rowData)==null?void 0:_.executorType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.executorInfo")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.executorInfo),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.triggerType")},{default:l(()=>{var n;return[e(c,{type:a(Z)((n=u.rowData)==null?void 0:n.triggerType)},{default:l(()=>{var _;return[y(j(a(t)(a(Ke)[(_=u.rowData)==null?void 0:_.triggerType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.triggerInterval")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.triggerInterval),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.blockStrategy")},{default:l(()=>{var n;return[e(c,{type:a(Z)((n=u.rowData)==null?void 0:n.blockStrategy)},{default:l(()=>{var _;return[y(j(a(t)(a(Be)[(_=u.rowData)==null?void 0:_.blockStrategy])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.executorTimeout")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.executorTimeout),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.maxRetryTimes")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.maxRetryTimes),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.retryInterval")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.retryInterval),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.parallelNum")},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.parallelNum),1)]}),_:1},8,["label"]),e(i,{label:a(t)("page.jobTask.description"),span:2},{default:l(()=>{var n;return[y(j((n=u.rowData)==null?void 0:n.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Ya={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function F(x){return typeof x=="function"||Object.prototype.toString.call(x)==="[object Object]"&&!va(x)}const gt=J({name:"job_task",__name:"index",setup(x){const{hasAuth:k}=wa(),u=Je(),{routerPushByKey:T}=ba(),i=C(),{bool:c,setTrue:d}=fa(!1),{columnChecks:f,columns:n,data:_,getData:V,loading:P,mobilePagination:v,searchParams:E,resetSearchParams:s}=Sa({apiFn:Ta,apiParams:{page:1,size:10,groupName:null,jobName:null,jobStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:t("common.index"),align:"center",width:48},{key:"jobName",title:t("page.jobTask.jobName"),align:"center",width:140,fixed:"left",render:m=>{async function b(){i.value=m,d()}return e(G,{text:!0,tag:"a",type:"primary",onClick:b,class:"ws-normal"},{default:()=>[`${m.jobName}`]})}},{key:"groupName",title:t("page.jobTask.groupName"),align:"left",width:180},{key:"nextTriggerAt",title:t("page.jobTask.nextTriggerAt"),align:"center",width:120},{key:"jobStatus",title:t("page.jobTask.jobStatus"),align:"center",width:60,render:m=>{const b=async(p,o)=>{var g;const{error:D}=await ja({id:m.id,jobStatus:p});D||(m.jobStatus=p,(g=window.$message)==null||g.success(t("common.updateSuccess"))),o(!D)};return e(xa,{value:m.jobStatus,"onUpdate:value":p=>m.jobStatus=p,onSubmitted:b},null)}},{key:"taskType",title:t("page.jobTask.taskType"),align:"center",width:120,render:m=>{if(m.taskType===null)return null;const b={1:"info",2:"success",3:"error",4:"primary",5:"warning"},p=t(Me[m.taskType]);return e(ve,{type:b[m.taskType]},F(p)?p:{default:()=>[p]})}},{key:"triggerType",title:t("page.jobTask.triggerType"),align:"center",width:120,render:m=>{if(m.triggerType===null)return null;const b={2:"info",3:"success",99:"error"},p=t(Ke[m.triggerType]);return e(ve,{type:b[m.triggerType]},F(p)?p:{default:()=>[p]})}},{key:"triggerInterval",title:t("page.jobTask.triggerInterval"),align:"center",width:80},{key:"blockStrategy",title:t("page.jobTask.blockStrategy"),align:"center",width:80,render:m=>{if(m.blockStrategy===null)return null;const b={1:"info",2:"success",3:"error",4:"warning"},p=t(Be[m.blockStrategy]);return e(ve,{type:b[m.blockStrategy]},F(p)?p:{default:()=>[p]})}},{key:"executorTimeout",title:t("page.jobTask.executorTimeout"),align:"center",width:80},{key:"updateDt",title:t("page.jobTask.updateDt"),align:"center",width:120},{key:"operate",title:t("common.operate"),align:"center",width:180,fixed:"right",render:m=>{let b,p;return e("div",{class:"flex-center gap-8px"},[e(Ne,{onPositiveClick:()=>ke(m.id)},{default:()=>t("common.confirmExecute"),trigger:()=>{let o;return e(G,{type:"error",text:!0,ghost:!0,size:"small"},F(o=t("common.execute"))?o:{default:()=>[o]})}}),e(we,{vertical:!0},null),e(G,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>je(m.id)},F(b=t("common.batchList"))?b:{default:()=>[b]}),e(we,{vertical:!0},null),e(G,{type:"warning",ghost:!0,text:!0,size:"small",onClick:()=>pe(m.id)},F(p=t("common.edit"))?p:{default:()=>[p]}),e(we,{vertical:!0},null),e(Ne,{onPositiveClick:()=>Te(m.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let o;return e(G,{type:"error",text:!0,ghost:!0,size:"small"},F(o=t("common.delete"))?o:{default:()=>[o]})}})])}}]}),{drawerVisible:L,operateType:ye,editingData:U,handleAdd:S,handleEdit:ne,checkedRowKeys:$,onDeleted:O,onBatchDeleted:se}=Na(_,V);async function Te(m){const{error:b}=await Ce([m]);b||O()}async function ue(){const{error:m}=await Ce($.value);m||se()}function pe(m){ne(m)}async function ke(m){var p,o;const{error:b}=await ka(m);b?(p=window.$message)==null||p.error(t("common.executeFailed")):(o=window.$message)==null||o.success(t("common.executeSuccess"))}function je(m){const b=_.value.find(p=>p.id===m);T("job_batch",{state:{jobId:m,jobName:b.jobName}})}function he(){return{jobIds:$.value,groupName:E.groupName,jobName:E.jobName,jobStatus:E.jobStatus}}function Se(){We("/job/export",he(),t("page.jobTask.title"))}return(m,b)=>{const p=Qe,o=Ye,D=Ze,g=qe,z=Ca,A=Ae;return h(),le("div",Ya,[e(qa,{model:a(E),"onUpdate:model":b[0]||(b[0]=w=>te(E)?E.value=w:null),onReset:a(s),onSearch:a(V)},null,8,["model","onReset","onSearch"]),e(p),e(A,{title:a(t)("page.jobTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":l(()=>[e(g,{columns:a(f),"onUpdate:columns":b[1]||(b[1]=w=>te(f)?f.value=w:null),loading:a(P),"disabled-delete":a($).length===0,"show-delete":a(k)("R_ADMIN"),onAdd:a(S),onDelete:ue,onRefresh:a(V)},{addAfter:l(()=>[e(o,{action:"/job/import",accept:"application/json",onRefresh:a(V)},null,8,["onRefresh"]),e(a(Ne),{onPositiveClick:Se},{trigger:l(()=>[e(a(G),{size:"small",ghost:"",type:"primary",disabled:a($).length===0&&a(k)("R_USER")},{icon:l(()=>[e(D,{class:"text-icon"})]),default:l(()=>[y(" "+j(a(t)("common.export")),1)]),_:1},8,["disabled"])]),default:l(()=>[y(j(a($).length===0?a(t)("common.exportAll"):a(t)("common.exportPar",{num:a($).length})),1)]),_:1})]),_:1},8,["columns","loading","disabled-delete","show-delete","onAdd","onRefresh"])]),default:l(()=>[e(z,{"checked-row-keys":a($),"onUpdate:checkedRowKeys":b[2]||(b[2]=w=>te($)?$.value=w:null),columns:a(n),data:a(_),"flex-height":!a(u).isMobile,"scroll-x":2e3,loading:a(P),remote:"","row-key":w=>w.id,pagination:a(v),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(za,{visible:a(L),"onUpdate:visible":b[3]||(b[3]=w=>te(L)?L.value=w:null),"operate-type":a(ye),"row-data":a(U),onSubmitted:a(V)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(Wa,{visible:a(c),"onUpdate:visible":b[4]||(b[4]=w=>te(c)?c.value=w:null),"row-data":i.value},null,8,["visible","row-data"])])}}});export{gt as default};
