import{d as F,r as S,ak as U,bM as ee,dj as te,o as d,b as N,e as k,aM as Y,Z as le,a0 as ne,bz as ae,q as oe,bZ as se,c as h,w as o,f as t,g as v,h as g,au as j,t as V,X as ie,cx as X,B as Z,bL as q,ai as $,F as re,at as ce,a8 as ue,_ as de,bo as _e,bp as me,a3 as J,l as ge}from"./index-D11HRvLC.js";import{_ as fe,a as pe}from"./CollapseItem-C4NYsEPz.js";const he={scrollbarProps:Object,items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},ve=F({name:"VirtualList",props:he,setup(i){const l=S(null),f=S(null);function m(){const{value:a}=l;a&&a.sync()}function _(a){var s;m(),(s=i.onScroll)===null||s===void 0||s.call(i,a)}function x(a){var s;m(),(s=i.onResize)===null||s===void 0||s.call(i,a)}function z(a){var s;(s=i.onWheel)===null||s===void 0||s.call(i,a)}function r(a,s){var b,T;typeof a=="number"?(b=f.value)===null||b===void 0||b.scrollTo(a,s??0):(T=f.value)===null||T===void 0||T.scrollTo(a)}function w(){var a;return(a=f.value)===null||a===void 0?void 0:a.listElRef}function I(){var a;return(a=f.value)===null||a===void 0?void 0:a.itemsElRef}return{scrollTo:r,scrollbarInstRef:l,virtualListInstRef:f,getScrollContainer:w,getScrollContent:I,handleScroll:_,handleResize:x,handleWheel:z}},render(){return U(te,Object.assign({},this.scrollbarProps,{ref:"scrollbarInstRef",container:this.getScrollContainer,content:this.getScrollContent}),{default:()=>U(ee,{ref:"virtualListInstRef",showScrollbar:!1,items:this.items,itemSize:this.itemSize,itemResizable:this.itemResizable,itemsStyle:this.itemsStyle,visibleItemsTag:this.visibleItemsTag,visibleItemsProps:this.visibleItemsProps,ignoreItemResize:this.ignoreItemResize,keyField:this.keyField,defaultScrollKey:this.defaultScrollKey,defaultScrollIndex:this.defaultScrollIndex,paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,onScroll:this.handleScroll,onResize:this.handleResize,onWheel:this.handleWheel},{default:({item:i,index:l})=>{var f,m;return(m=(f=this.$slots).default)===null||m===void 0?void 0:m.call(f,{item:i,index:l})}})})}}),be={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ye=k("path",{fill:"currentColor","fill-rule":"evenodd",d:"M2.93 11.2c.072-4.96 4.146-8.95 9.149-8.95a9.158 9.158 0 0 1 7.814 4.357a.75.75 0 0 1-1.277.786a7.658 7.658 0 0 0-6.537-3.643c-4.185 0-7.575 3.328-7.648 7.448l.4-.397a.75.75 0 0 1 1.057 1.065l-1.68 1.666a.75.75 0 0 1-1.056 0l-1.68-1.666A.75.75 0 1 1 2.528 10.8zm16.856-.733a.75.75 0 0 1 1.055 0l1.686 1.666a.75.75 0 1 1-1.054 1.067l-.41-.405c-.07 4.965-4.161 8.955-9.18 8.955a9.197 9.197 0 0 1-7.842-4.356a.75.75 0 1 1 1.277-.788a7.697 7.697 0 0 0 6.565 3.644c4.206 0 7.61-3.333 7.68-7.453l-.408.403a.75.75 0 1 1-1.055-1.067z","clip-rule":"evenodd"},null,-1),ke=[ye];function Se(i,l){return d(),N("svg",be,[...ke])}const xe={name:"solar-refresh-outline",render:Se},we={class:"inline-block",viewBox:"0 0 16 16",width:"1em",height:"1em"},Ie=k("path",{fill:"currentColor","fill-rule":"evenodd",d:"M7.706.29c-.222.072-.35.2-.412.409c-.035.117-.041.389-.041 1.809c0 1.881-.002 1.857.19 2.049c.257.256.857.256 1.114 0c.192-.192.19-.168.19-2.049c0-1.82-.003-1.852-.151-2.028C8.472.333 8.339.284 8.04.276a1.705 1.705 0 0 0-.334.014M2.753 2.266c-.158.072-.391.3-.472.462a.605.605 0 0 0-.012.525c.074.165 2.398 2.497 2.581 2.59c.259.133.525.068.793-.194c.264-.258.334-.538.2-.799c-.093-.183-2.425-2.507-2.59-2.581a.638.638 0 0 0-.5-.003m10.1.016c-.123.057-.333.254-1.335 1.259c-.921.923-1.202 1.221-1.247 1.319a.617.617 0 0 0 .001.518c.07.15.3.386.455.467c.157.082.39.081.553-.002c.167-.086 2.477-2.396 2.563-2.563a.648.648 0 0 0 .003-.551a1.26 1.26 0 0 0-.454-.446a.569.569 0 0 0-.539-.001M.699 7.292c-.295.093-.441.328-.441.707c.001.387.145.619.44.707c.118.035.381.041 1.81.041c1.489 0 1.688-.005 1.81-.045a.602.602 0 0 0 .384-.384c.086-.265.043-.641-.094-.827a.723.723 0 0 0-.191-.148l-.137-.076l-1.733-.006c-1.395-.004-1.756.002-1.848.031m11.046-.014a.757.757 0 0 0-.353.214c-.137.185-.18.561-.094.826c.058.18.204.326.384.384c.122.04.321.045 1.81.045c1.429 0 1.692-.006 1.81-.041c.295-.088.439-.32.44-.707c0-.385-.147-.616-.452-.708c-.103-.031-.426-.037-1.794-.035c-.918.002-1.706.012-1.751.022m-6.892 3.004c-.123.057-.333.254-1.335 1.259c-.921.923-1.202 1.221-1.247 1.319a.617.617 0 0 0 .001.518c.07.15.3.386.455.467c.157.082.39.081.553-.002c.167-.086 2.477-2.396 2.563-2.563a.648.648 0 0 0 .003-.551a1.26 1.26 0 0 0-.454-.446a.569.569 0 0 0-.539-.001m5.9-.016c-.158.072-.391.3-.472.462a.605.605 0 0 0-.012.525c.074.165 2.398 2.497 2.581 2.59c.259.133.525.068.793-.194c.264-.258.334-.538.2-.799c-.093-.183-2.425-2.507-2.59-2.581a.638.638 0 0 0-.5-.003m-3.008 1.011a.768.768 0 0 0-.353.215c-.138.186-.139.199-.139 1.997c0 1.432.006 1.695.041 1.813c.088.295.321.439.706.439c.385 0 .618-.144.706-.439c.062-.212.061-3.427-.002-3.612a.528.528 0 0 0-.284-.344c-.11-.06-.174-.075-.363-.082a1.537 1.537 0 0 0-.312.013"},null,-1),$e=[Ie];function ze(i,l){return d(),N("svg",we,[...$e])}const Te={name:"nonicons-loading16",render:ze},Ne={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},De=k("path",{fill:"currentColor",d:"m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"},null,-1),Be=[De];function Ce(i,l){return d(),N("svg",Ne,[...Be])}const Re={name:"material-symbols-check-circle",render:Ce};function Le(i,l){return Y({url:"/job/log/list",method:"get",params:i,signal:l==null?void 0:l.signal})}function je(i){return Y({url:"/retry-task-log/message/list",method:"get",params:i})}const Me={class:"flex-center"},Ve={class:"ml-6px"},qe={class:"flex-center gap-8px"},Fe={key:0,class:"h-full flex-center"},Oe={class:"flex items-center"},Ae={class:"flex-center gap-8px"},Ee={key:0,class:"h-full flex-center"},Pe=F({name:"LogDrawer",__name:"log-drawer",props:le({title:{default:void 0},drawer:{type:Boolean,default:!0},type:{default:"job"},taskData:{default:void 0},modelValue:{default:()=>[]}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(i){const l=i,f=ne(i,"show"),m=S(1),_=S([]),x=S();let z=new AbortController;const r=S(!0);let w="0",I=0;const a=()=>{r.value=!0,clearTimeout(x.value),x.value=void 0},s=()=>{r.value||z.abort(),a(),w="0",I=0,_.value=[]};async function b(){let n=null,e;if(l.type==="job"){const c=l.taskData,{data:u,error:y}=await Le({taskBatchId:c.taskBatchId,jobId:c.jobId,taskId:c.id,startId:w,fromIndex:I,size:50},z);n=u,e=y}if(l.type==="retry"){const c=l.taskData,{data:u,error:y}=await je({groupName:c.groupName,uniqueId:c.uniqueId,startId:w,fromIndex:I,size:50});n=u,e=y}!e&&n?(r.value=n.finished||m.value===0,w=n.nextStartId,I=n.fromIndex,n.message&&(_.value.push(...n.message),_.value.sort((c,u)=>Number.parseInt(c.time_stamp,10)-Number.parseInt(u.time_stamp,10))),!r.value&&m.value!==0&&(clearTimeout(x.value),x.value=setTimeout(b,m.value*1e3))):(e==null?void 0:e.code)!=="ERR_CANCELED"&&s()}ae(()=>{s()}),oe(()=>f.value,async n=>{n&&l.modelValue&&(_.value=[...l.modelValue]),(n||!l.drawer)&&l.type&&l.taskData&&(r.value=!1,z=new AbortController,await b()),!n&&l.drawer&&s()},{immediate:!0});function T(n){var L,p,A,E,P,W,H,K;const e=new Date(Number.parseInt(n==null?void 0:n.toString(),10)),c=e.getFullYear(),u=(e.getMonth()+1).toString().length===1?`0${e.getMonth()+1}`:(e.getMonth()+1).toString(),y=((L=e.getDate())==null?void 0:L.toString().length)===1?`0${e.getDate()}`:(p=e.getDate())==null?void 0:p.toString(),C=((A=e.getHours())==null?void 0:A.toString().length)===1?`0${e.getHours()}`:(E=e.getHours())==null?void 0:E.toString(),R=((P=e.getMinutes())==null?void 0:P.toString().length)===1?`0${e.getMinutes()}`:(W=e.getMinutes())==null?void 0:W.toString(),M=((H=e.getSeconds())==null?void 0:H.toString().length)===1?`0${e.getSeconds()}`:(K=e.getSeconds())==null?void 0:K.toString();return`${c}-${u}-${y} ${C}:${R}:${M}.${e.getMilliseconds()}`}const G=se();function Q(){let n;l.type==="job"&&(n={type:l.type,taskBatchId:l.taskData.taskBatchId,jobId:l.taskData.jobId,taskId:l.taskData.id}),l.type==="retry"&&(n={type:l.type,groupName:l.taskData.groupName,uniqueId:l.taskData.uniqueId});const e=G.resolve({path:"/log",query:n});window.open(e.href)}const D=async n=>{if(n===-1){r.value&&(r.value=!1,await b());return}if(m.value=n,n===0){a();return}r.value=!1,await b()},B=S([{label:"Off",key:0},{label:"Auto(1s)",key:1},{label:"5s",key:5},{label:"10s",key:10},{label:"30s",key:30},{label:"1m",key:60},{label:"5m",key:300}]),O=F({setup(){if(r.value&&_.value.length===0)return()=>t(q,{class:"h-full flex-center",size:"huge"},null);const n=e=>{if(!e)return t(J,null,null);const c=e.match(/^.+/m);if(!c)return t(J,null,null);const u=e.replace(/^.+(\n|$)/m,"");return t(pe,null,{default:()=>[t(fe,{title:c[0],name:"1"},{default:()=>[`${u}`]})]})};return()=>t("code",{class:"snail-log"},[t(ve,{class:"virtual-list",itemSize:65,items:_.value},{default:({item:e})=>t("pre",null,[t("span",{class:"log-hljs-time inline-block"},[T(e.time_stamp)]),t("span",{class:`log-hljs-level-${e.level} ml-12px mr-12px inline-block`},[`${e.level}`]),t("span",{class:"log-hljs-thread mr-12px inline-block"},[`[${e.host}:${e.port}]`]),t("span",{class:"log-hljs-thread mr-12px inline-block"},[`[${e.thread}]`]),t("span",{class:"log-hljs-location"},[`${e.location}: 
`]),v(" -"),t("span",{class:"pl-6px"},[`${e.message}`]),n(e.throwable),t(ce,null,null)])})])}});return(n,e)=>{const c=Re,u=ue,y=Te,C=xe,R=de,M=_e,L=me;return n.drawer?(d(),h(L,{key:0,show:f.value,"onUpdate:show":e[1]||(e[1]=p=>f.value=p),width:"100%","display-directive":"if","auto-focus":!1},{default:o(()=>[t(M,{closable:""},{header:o(()=>[k("div",Me,[r.value?(d(),h(u,{key:0},{trigger:o(()=>[t(c,{class:"text-20px color-success"})]),default:o(()=>[v(" 日志加载完成 ")]),_:1})):(d(),h(u,{key:1},{trigger:o(()=>[t(g(j),{size:"small"},{icon:o(()=>[t(y)]),_:1})]),default:o(()=>[v(" 日志正在加载 ")]),_:1})),k("span",Ve,V(n.title),1),t(ie,{icon:"hugeicons:share-01","tooltip-content":"在新标签页打开",class:"ml-6px",onClick:Q}),t(g(X),{trigger:"hover",options:B.value,width:"trigger",onSelect:D},{default:o(()=>[t(u,{placement:"right"},{trigger:o(()=>[t(g(Z),{dashed:"",class:"ml-3px w-136px",onClick:e[0]||(e[0]=p=>D(-1))},{icon:o(()=>[k("div",qe,[t(C,{class:"text-18px"}),v(" "+V(B.value.filter(p=>p.key===m.value)[0].label)+" ",1),t(R,{icon:"material-symbols:expand-more-rounded"})])]),_:1})]),default:o(()=>[v(" 自动刷新频率 ")]),_:1})]),_:1},8,["options"])])]),default:o(()=>[_.value.length===0?(d(),N("div",Fe,[_.value.length===0&&r.value?(d(),h(g(q),{key:0})):$("",!0),_.value.length===0&&!r.value?(d(),h(g(j),{key:1})):$("",!0)])):$("",!0),t(g(O))]),_:1})]),_:1},8,["show"])):(d(),h(g(re),{key:1,bordered:!1,title:n.title,size:"small",class:"h-full sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[k("div",Oe,[t(g(X),{trigger:"hover",options:B.value,width:"trigger",onSelect:D},{default:o(()=>[t(u,{placement:"right"},{trigger:o(()=>[t(g(Z),{dashed:"",class:"ml-3px w-136px",onClick:e[2]||(e[2]=p=>D(-1))},{icon:o(()=>[k("div",Ae,[t(C,{class:"text-18px"}),v(" "+V(B.value.filter(p=>p.key===m.value)[0].label)+" ",1),t(R,{icon:"material-symbols:expand-more-rounded"})])]),_:1})]),default:o(()=>[v(" 自动刷新频率 ")]),_:1})]),_:1},8,["options"]),r.value?(d(),h(u,{key:0},{trigger:o(()=>[t(c,{class:"text-20px color-success"})]),default:o(()=>[v(" 日志加载完成 ")]),_:1})):(d(),h(u,{key:1},{trigger:o(()=>[t(g(j),{size:"small"},{icon:o(()=>[t(y)]),_:1})]),default:o(()=>[v(" 日志正在加载 ")]),_:1}))])]),default:o(()=>[_.value.length===0?(d(),N("div",Ee,[_.value.length===0&&r.value?(d(),h(g(q),{key:0})):$("",!0),_.value.length===0&&!r.value?(d(),h(g(j),{key:1})):$("",!0)])):$("",!0),t(g(O))]),_:1},8,["title"]))}}}),Ke=ge(Pe,[["__scopeId","data-v-674dd414"]]);export{Ke as _,xe as a,Re as b,Te as c,je as f};
