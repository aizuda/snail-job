import{a as F,N as A,b as K}from"./search-form.vue_vue_type_script_setup_true_lang-B9DCSIZj.js";import{aM as S,d as T,Z as U,a0 as $,o as R,c as q,w as n,f as t,h as e,$ as a,a4 as E,bh as G,D as H,aa as Y,g as y,t as f,ac as D,bi as z,bg as B,Y as I,aw as Z,av as J,l as Q,L as X,r as ee,ag as ae,aA as te,B as x,b as le,ah as w,aj as oe,F as ne}from"./index-D11HRvLC.js";import{_ as re,u as se,a as ue}from"./table-oGN68_Ra.js";import{_ as ie}from"./select-group.vue_vue_type_script_setup_true_lang-BV1AXeAr.js";import{_ as pe}from"./select-scene.vue_vue_type_script_setup_true_lang-UmFWq9QR.js";import{_ as de}from"./datetime-range.vue_vue_type_script_setup_true_lang-bHhHNs5l.js";import{_ as me}from"./detail-drawer-B0WyCEXR.js";import{_ as ce}from"./log-drawer-Dqe3cuCl.js";import{_ as ge,a as ye}from"./DescriptionsItem-QSQ4JSXU.js";import{b as fe}from"./Grid-BEQeOJ6_.js";import"./group-DBuDE6uz.js";import"./CollapseItem-C4NYsEPz.js";function _e(d){return S({url:"/retry-task-log/list",method:"get",params:d})}function be(d){return S({url:`/retry-task-log/${d}`,method:"get"})}function ve(d){return S({url:`/retry-task-log/${d}`,method:"delete"})}function he(d){return S({url:"/retry-task-log/ids",method:"delete",data:d})}const Ne=T({name:"RetryLogSearch",__name:"retry-log-search",props:{model:{required:!0},modelModifiers:{}},emits:U(["reset","search"],["update:model"]),setup(d,{emit:b}){const p=b,r=$(d,"model");function m(){p("reset")}function v(){p("search")}return(k,i)=>{const c=re,g=H,h=Y,l=F;return R(),q(l,{model:r.value,onSearch:v,onReset:m},{default:n(()=>[t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t(ie,{value:r.value.groupName,"onUpdate:value":i[0]||(i[0]=s=>r.value.groupName=s),clearable:""},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.sceneName"),path:"sceneName",class:"pr-24px"},{default:n(()=>[t(pe,{value:r.value.sceneName,"onUpdate:value":i[1]||(i[1]=s=>r.value.sceneName=s),"group-name":r.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.UniqueId"),path:"UniqueId",class:"pr-24px"},{default:n(()=>[t(g,{value:r.value.uniqueId,"onUpdate:value":i[2]||(i[2]=s=>r.value.uniqueId=s),placeholder:e(a)("page.retryLog.form.UniqueId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:n(()=>[t(g,{value:r.value.idempotentId,"onUpdate:value":i[3]||(i[3]=s=>r.value.idempotentId=s),placeholder:e(a)("page.retryLog.form.idempotentId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.bizNo"),path:"bizNo",class:"pr-24px"},{default:n(()=>[t(g,{value:r.value.bizNo,"onUpdate:value":i[4]||(i[4]=s=>r.value.bizNo=s),placeholder:e(a)("page.retryLog.form.bizNo"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.retryStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:n(()=>[t(h,{value:r.value.retryStatus,"onUpdate:value":i[5]||(i[5]=s=>r.value.retryStatus=s),placeholder:e(a)("page.retryTask.form.retryStatus"),options:e(E)(e(G)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(c,{span:"24 s:24 m:15 l:12 xl:9",label:e(a)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:n(()=>[t(de,{value:r.value.datetimeRange,"onUpdate:value":i[6]||(i[6]=s=>r.value.datetimeRange=s)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ke=T({name:"SceneDetailDrawer",__name:"retry-log-detail-drawer",props:U({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const b=$(d,"visible");return(p,r)=>{const m=ge,v=I,k=ye,i=Z,c=ce,g=J,h=me;return R(),q(h,{modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=l=>b.value=l),title:e(a)("page.retryLog.detail"),width:["50%","90%"]},{default:n(()=>[t(g,{type:"segment",animated:""},{default:n(()=>[t(i,{name:0,tab:e(a)("page.log.info")},{default:n(()=>[t(k,{"label-placement":"top",bordered:"",column:2},{default:n(()=>[t(m,{label:e(a)("page.retryLog.UniqueId"),span:2},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.uniqueId),1)]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryLog.groupName"),span:2},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.groupName),1)]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryLog.sceneName"),span:2},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.sceneName),1)]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryLog.retryStatus"),span:1},{default:n(()=>{var l;return[t(v,{type:e(D)((l=p.rowData)==null?void 0:l.retryStatus)},{default:n(()=>{var s;return[y(f(e(a)(e(z)[(s=p.rowData)==null?void 0:s.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryLog.taskType"),span:1},{default:n(()=>{var l;return[t(v,{type:e(D)((l=p.rowData)==null?void 0:l.taskType)},{default:n(()=>{var s;return[y(f(e(a)(e(B)[(s=p.rowData)==null?void 0:s.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryLog.bizNo"),span:2},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.bizNo),1)]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryLog.idempotentId"),span:2},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.idempotentId),1)]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryTask.executorName"),span:2},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.executorName),1)]}),_:1},8,["label"]),t(m,{label:e(a)("page.retryTask.argsStr"),span:2},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.argsStr),1)]}),_:1},8,["label"]),t(m,{label:e(a)("common.createDt")},{default:n(()=>{var l;return[y(f((l=p.rowData)==null?void 0:l.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),t(i,{name:1,tab:e(a)("page.log.title"),"display-directive":"if"},{default:n(()=>[t(c,{drawer:!1,type:"retry","task-data":p.rowData},null,8,["task-data"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),we=Q(ke,[["__scopeId","data-v-606d4d2f"]]),De={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function L(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!oe(d)}const We=T({name:"retry_log",__name:"index",setup(d){const b=X(),p=ee(),{bool:r,setTrue:m}=ae(!1),v=history.state.retryStatus,{columns:k,columnChecks:i,data:c,getData:g,loading:h,mobilePagination:l,searchParams:s,resetSearchParams:P}=se({apiFn:_e,apiParams:{page:1,size:10,uniqueId:null,groupName:null,sceneName:null,idempotentId:null,bizNo:null,retryStatus:null,datetimeRange:te()},searchParams:{retryStatus:v},columns:()=>[{type:"selection",align:"center",width:48,disabled:u=>u.retryStatus!==1},{key:"id",title:a("common.index"),align:"center",width:64},{key:"uniqueId",title:a("page.retryLog.UniqueId"),align:"left",minWidth:120,render:u=>{async function o(){await O(u),m()}return t(x,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[u.uniqueId]})}},{key:"groupName",title:a("page.retryLog.groupName"),align:"left",minWidth:120},{key:"sceneName",title:a("page.retryLog.sceneName"),align:"left",minWidth:120},{key:"retryStatus",title:a("page.retryLog.retryStatus"),align:"left",minWidth:120,render:u=>{if(u.retryStatus===null)return null;const o=a(z[u.retryStatus]);return t(I,{type:D(u.retryStatus)},L(o)?o:{default:()=>[o]})}},{key:"taskType",title:a("page.retryLog.taskType"),align:"left",minWidth:120,render:u=>{if(u.taskType===null)return null;const o=a(B[u.taskType]);return t(I,{type:D(u.taskType)},L(o)?o:{default:()=>[o]})}},{key:"idempotentId",title:a("page.retryLog.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:a("page.retryLog.bizNo"),align:"left",minWidth:120},{key:"createDt",title:a("page.retryLog.createDt"),align:"left",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",width:130,render:u=>t("div",{class:"flex-center gap-8px"},[u.retryStatus===1?t(A,{onPositiveClick:()=>C(u.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let o;return t(x,{type:"error",text:!0,ghost:!0,size:"small"},L(o=a("common.delete"))?o:{default:()=>[o]})}}):""])}]}),{checkedRowKeys:N}=ue(c,g);async function W(){var o;const{error:u}=await he(N.value);u||((o=window.$message)==null||o.success(a("common.deleteSuccess")),g())}async function C(u){var o;await ve(u),(o=window.$message)==null||o.success(a("common.deleteSuccess")),g()}async function O(u){const o=await be(u.id);p.value=o.data||null}return(u,o)=>{const V=K,M=fe,j=ne;return R(),le("div",De,[t(Ne,{model:e(s),"onUpdate:model":o[0]||(o[0]=_=>w(s)?s.value=_:null),onReset:e(P),onSearch:e(g)},null,8,["model","onReset","onSearch"]),t(j,{title:e(a)("page.retryLog.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":n(()=>[t(V,{columns:e(i),"onUpdate:columns":o[1]||(o[1]=_=>w(i)?i.value=_:null),"disabled-delete":e(N).length===0,loading:e(h),"show-add":!1,onDelete:W,onRefresh:e(g)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:n(()=>[t(M,{"checked-row-keys":e(N),"onUpdate:checkedRowKeys":o[2]||(o[2]=_=>w(N)?N.value=_:null),columns:e(k),data:e(c),"flex-height":!e(b).isMobile,"scroll-x":962,loading:e(h),remote:"","row-key":_=>_.id,pagination:e(l),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),t(we,{visible:e(r),"onUpdate:visible":o[3]||(o[3]=_=>w(r)?r.value=_:null),"row-data":p.value},null,8,["visible","row-data"])])}}});export{We as default};
