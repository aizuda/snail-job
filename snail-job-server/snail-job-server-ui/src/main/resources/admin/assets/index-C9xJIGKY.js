import{a as R,b as $,c as A}from"./log-drawer-DBbAafJ2.js";import{d as E,k as z,r as s,i as U,by as W,o as d,c as f,w as o,e as h,f as a,x as q,g as p,t as L,h as M,_ as O,B as j,a8 as F,cx as G,au as H,l as J}from"./index-FUIa4-vU.js";import{u as K,_ as P}from"./workflow.vue_vue_type_style_index_0_lang-CF26VK47.js";import{g as Q}from"./workflow-C9G6jvXp.js";import"./CollapseItem-BMMOxk7k.js";import"./job-task-list-table.vue_vue_type_script_setup_true_lang-DIIvOixm.js";import"./table-DGi3nvCm.js";import"./Grid-C3gcBClN.js";import"./job-CSfapI8R.js";import"./detail-drawer-bwrDwggh.js";import"./DescriptionsItem-C7R9mygj.js";import"./code-mirror.vue_vue_type_script_setup_true_lang-BdCwZFpp.js";import"./cron-input.vue_vue_type_style_index_0_lang-DuGGiwSJ.js";import"./group-BxDj9-KV.js";const X={class:"flex-center"},Y={class:"flex-center gap-8px"},Z=E({name:"workflow_form_batch",__name:"index",setup(ee){const i=K(),B=z(),v=s(!1),g=String(B.query.id),u=s({}),l=s(0),_=s(),y=new AbortController,t=s(!0),k=()=>{t.value=!0,y.abort(),clearTimeout(_.value),_.value=void 0},x=()=>{t.value||y.abort(),k(),u.value={},i.clear()},c=async()=>{v.value=!0;const{data:n,error:e}=await Q(g);e?(e==null?void 0:e.code)!=="ERR_CANCELED"&&x():(u.value=n,t.value=!(n.workflowBatchStatus&&[1,2].includes(n.workflowBatchStatus))||l.value===0,!t.value&&l.value!==0&&(clearTimeout(_.value),_.value=setTimeout(c,l.value*1e3))),v.value=!1},b=async n=>{if(n===-1){t.value&&(t.value=!1,await c());return}if(l.value=n,n===0){k();return}t.value=!1,await c()};U(()=>{i.clear(),i.setType(2),i.setId(g),c()}),W(()=>{x()});const w=s([{label:"Auto(off)",key:0},{label:"1s",key:1},{label:"5s",key:5},{label:"10s",key:10},{label:"30s",key:30},{label:"1m",key:60},{label:"5m",key:300}]);return(n,e)=>{const S=R,N=O,C=j,m=F,T=G,V=$,D=A,I=H;return d(),f(M(P),{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=r=>u.value=r),spinning:!1,disabled:"",onRefresh:e[2]||(e[2]=r=>c())},{buttons:o(()=>[h("div",X,[a(T,{trigger:"hover",width:"trigger",options:w.value,onSelect:b},{default:o(()=>[a(m,{placement:"left"},{trigger:o(()=>[a(C,{dashed:"",class:q(["w-136px",t.value?"mr-16px":"mr-42px"]),onClick:e[0]||(e[0]=r=>b(-1))},{icon:o(()=>[h("div",Y,[a(S,{class:"text-18px"}),p(" "+L(w.value.filter(r=>r.key===l.value)[0].label)+" ",1),a(N,{icon:"material-symbols:expand-more-rounded"})])]),_:1},8,["class"])]),default:o(()=>[p(" 自动刷新频率 ")]),_:1})]),_:1},8,["options"]),t.value?(d(),f(m,{key:0,placement:"top"},{trigger:o(()=>[a(V,{class:"text-26px color-success"})]),default:o(()=>[p(" 流程批次加载完成 ")]),_:1})):(d(),f(m,{key:1},{trigger:o(()=>[a(I,{size:"small"},{icon:o(()=>[a(D)]),_:1})]),default:o(()=>[p(" 流程批次正在加载 ")]),_:1}))])]),_:1},8,["modelValue"])}}}),fe=J(Z,[["__scopeId","data-v-dfdd102d"]]);export{fe as default};
