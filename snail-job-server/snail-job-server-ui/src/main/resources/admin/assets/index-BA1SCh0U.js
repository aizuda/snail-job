import{a as R,b as $,c as A}from"./log-drawer-DaEZFcwz.js";import{d as E,k as z,r as a,i as U,bx as W,o as d,c as f,w as o,e as B,f as s,x as q,g as _,t as L,h as M,_ as O,B as j,a8 as F,cx as G,au as H,l as J}from"./index--PhRNylI.js";import{u as K,_ as P}from"./workflow.vue_vue_type_style_index_0_lang-CSNo0yjz.js";import{g as Q}from"./workflow-CnYlkeoT.js";import"./CollapseItem-BccPzD5x.js";import"./job-task-list-table.vue_vue_type_script_setup_true_lang-CiYHLygb.js";import"./table-DvozQPKE.js";import"./Grid-C8sbif0M.js";import"./job-Tsw2tz69.js";import"./detail-drawer-CS6ssopv.js";import"./DescriptionsItem-BzmwSMF7.js";import"./code-mirror.vue_vue_type_script_setup_true_lang-BxhWNz7f.js";import"./cron-input.vue_vue_type_style_index_0_lang-CaeUqGwF.js";import"./group-Rd_jp_gh.js";const X={class:"flex-center"},Y={class:"flex-center gap-8px"},Z=E({name:"workflow_form_batch",__name:"index",setup(ee){const c=K(),S=z(),v=a(!1),g=String(S.query.id),u=a({}),l=a(0),p=a(),x=new AbortController,t=a(!0),k=()=>{t.value=!0,x.abort(),clearTimeout(p.value),p.value=void 0},y=()=>{t.value||x.abort(),k(),u.value={},c.clear()},r=async()=>{v.value=!0;const{data:n,error:e}=await Q(g);e?(e==null?void 0:e.code)!=="ERR_CANCELED"&&y():(u.value=n,t.value=!(n.workflowBatchStatus&&[1,2].includes(n.workflowBatchStatus))||l.value===0,!t.value&&l.value!==0&&(clearTimeout(p.value),p.value=setTimeout(r,l.value*1e3))),v.value=!1},b=async n=>{if(n===-1){t.value&&(t.value=!1,await r());return}if(l.value=n,n===0){k();return}t.value=!1,await r()};U(()=>{c.clear(),c.setType(2),c.setId(g),r()}),W(()=>{y()});const w=a([{label:"Auto(off)",key:0},{label:"1s",key:1},{label:"5s",key:5},{label:"10s",key:10},{label:"30s",key:30},{label:"1m",key:60},{label:"5m",key:300}]);return(n,e)=>{const h=R,N=O,C=j,m=F,T=G,V=$,D=A,I=H;return d(),f(M(P),{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value=i),spinning:!1,disabled:"",onRefresh:e[2]||(e[2]=i=>r())},{buttons:o(()=>[B("div",X,[s(T,{trigger:"hover",width:"trigger",options:w.value,onSelect:b},{default:o(()=>[s(m,{placement:"left"},{trigger:o(()=>[s(C,{dashed:"",class:q(["w-136px",t.value?"mr-16px":"mr-42px"]),onClick:e[0]||(e[0]=i=>b(-1))},{icon:o(()=>[B("div",Y,[s(h,{class:"text-18px"}),_(" "+L(w.value.filter(i=>i.key===l.value)[0].label)+" ",1),s(N,{icon:"material-symbols:expand-more-rounded"})])]),_:1},8,["class"])]),default:o(()=>[e[3]||(e[3]=_(" 自动刷新频率 "))]),_:1})]),_:1},8,["options"]),t.value?(d(),f(m,{key:0,placement:"top"},{trigger:o(()=>[s(V,{class:"text-26px color-success"})]),default:o(()=>[e[4]||(e[4]=_(" 流程批次加载完成 "))]),_:1})):(d(),f(m,{key:1},{trigger:o(()=>[s(I,{size:"small"},{icon:o(()=>[s(D)]),_:1})]),default:o(()=>[e[5]||(e[5]=_(" 流程批次正在加载 "))]),_:1}))])]),_:1},8,["modelValue"])}}}),fe=J(Z,[["__scopeId","data-v-dfdd102d"]]);export{fe as default};
