import{a as Z,N as J,b as Q}from"./search-form.vue_vue_type_script_setup_true_lang-BvcIdR82.js";import{aR as T,bl as X,o as R,b as I,e as ee,d as x,Z as B,a0 as z,c as C,w as o,f as l,h as a,$ as t,g as c,t as p,ac as U,bm as V,Y as q,ab as ae,L as te,r as le,ag as ne,aB as re,B as v,aj as oe,i as se,ah as w,ak as ie,F as de}from"./index-Dw6v9XEN.js";import{g as ue}from"./group-CoHVo80F.js";import{_ as me,u as ce,a as pe}from"./table-h4IGR_Mx.js";import{_ as ge}from"./select-group.vue_vue_type_script_setup_true_lang-Cliw46hj.js";import{_ as fe}from"./select-scene.vue_vue_type_script_setup_true_lang-DuGvtH6T.js";import{_ as _e}from"./datetime-range.vue_vue_type_script_setup_true_lang-CPeFGIuC.js";import{_ as ye,a as be}from"./DescriptionsItem-Fk5NYKQV.js";import{b as he}from"./Grid-oISpgLl0.js";function ke(s){return T({url:"/retry-dead-letter/list",method:"get",params:s})}function Ne(s,g){return T({url:`/retry-dead-letter/${s}?groupName=${g}`,method:"get"})}function $(s){return T({url:"/retry-dead-letter/batch/rollback",method:"post",data:s})}function S(s){return T({url:"/retry-dead-letter/batch",method:"delete",data:s})}const De={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ve=ee("path",{fill:"currentColor",d:"M20.93 14A7 7 0 0 1 14 20H5.5v-2H14a5 5 0 1 0 0-10H6.914l2.5 2.5L8 11.914L3.086 7L8 2.086L9.414 3.5L6.914 6H14a7 7 0 0 1 7 7v1z"},null,-1),we=[ve];function Te(s,g){return R(),I("svg",De,[...we])}const Re=X({name:"tdesign-rollback",render:Te}),Le=x({name:"RetryDeadLetterSearch",__name:"dead-letter-search",props:{model:{required:!0},modelModifiers:{}},emits:B(["reset","search"],["update:model"]),setup(s,{emit:g}){const i=g,d=z(s,"model");function u(){i("reset")}function D(){i("search")}return(h,m)=>{const e=me,y=Z;return R(),C(y,{"btn-span":"24 m:9 xl:3",model:d.value,onSearch:D,onReset:u},{default:o(()=>[l(e,{span:"24 s:12 m:6",label:a(t)("page.retryLog.groupName"),path:"groupName",class:"pr-24px"},{default:o(()=>[l(ge,{value:d.value.groupName,"onUpdate:value":m[0]||(m[0]=b=>d.value.groupName=b),clearable:""},null,8,["value"])]),_:1},8,["label"]),l(e,{span:"24 s:12 m:6",label:a(t)("page.retryLog.sceneName"),path:"sceneName",class:"pr-24px"},{default:o(()=>[l(fe,{value:d.value.sceneName,"onUpdate:value":m[1]||(m[1]=b=>d.value.sceneName=b),"group-name":d.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),l(e,{span:"24 s:12 m:15 l:12 xl:9",label:a(t)("page.common.createTime"),path:"datetimeRange"},{default:o(()=>[l(_e,{value:d.value.datetimeRange,"onUpdate:value":m[2]||(m[2]=b=>d.value.datetimeRange=b)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),xe=x({name:"RetryDeadLetterDetailDrawer",__name:"retry-letter-detail-drawer",props:B({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(s){const g=z(s,"visible");return(i,d)=>{const u=ye,D=q,h=be,m=ae;return R(),C(m,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=e=>g.value=e),title:a(t)("page.retryDeadLetter.detail")},{default:o(()=>[l(h,{"label-placement":"top",bordered:"",column:3},{default:o(()=>[l(u,{label:a(t)("page.retryTask.uniqueId"),span:3},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.uniqueId),1)]}),_:1},8,["label"]),l(u,{label:a(t)("page.retryTask.groupName"),span:3},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.groupName),1)]}),_:1},8,["label"]),l(u,{label:a(t)("page.retryTask.sceneName"),span:3},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.sceneName),1)]}),_:1},8,["label"]),l(u,{label:a(t)("page.retryTask.taskType"),span:1},{default:o(()=>{var e;return[l(D,{type:a(U)((e=i.rowData)==null?void 0:e.taskType)},{default:o(()=>{var y;return[c(p(a(t)(a(V)[(y=i.rowData)==null?void 0:y.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),l(u,{label:a(t)("page.retryTask.bizNo"),span:2},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.bizNo),1)]}),_:1},8,["label"]),l(u,{label:a(t)("page.retryTask.idempotentId"),span:3},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.idempotentId),1)]}),_:1},8,["label"]),l(u,{label:a(t)("page.retryTask.executorName"),span:3},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.executorName),1)]}),_:1},8,["label"]),l(u,{label:a(t)("page.retryTask.argsStr"),span:3},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.argsStr),1)]}),_:1},8,["label"]),l(u,{label:a(t)("common.createDt"),span:3},{default:o(()=>{var e;return[c(p((e=i.rowData)==null?void 0:e.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),$e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function L(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!ie(s)}const Me=x({name:"retry_dead-letter",__name:"index",setup(s){const g=te(),i=le(),{bool:d,setTrue:u}=ne(!1),{columns:D,columnChecks:h,data:m,getData:e,loading:y,mobilePagination:b,searchParams:k,resetSearchParams:A}=ce({apiFn:ke,apiParams:{page:1,size:10,groupName:null,sceneName:null,datetimeRange:re()},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:t("common.index"),align:"center",width:64},{key:"uniqueId",title:t("page.retryDeadLetter.uniqueId"),align:"left",minWidth:120,render:r=>{async function n(){await j(r),u()}return l(v,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[r.uniqueId]})}},{key:"groupName",title:t("page.retryDeadLetter.groupName"),align:"left",minWidth:120},{key:"sceneName",title:t("page.retryDeadLetter.sceneName"),align:"left",minWidth:120},{key:"idempotentId",title:t("page.retryDeadLetter.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:t("page.retryDeadLetter.bizNo"),align:"left",minWidth:120},{key:"taskType",title:t("page.retryDeadLetter.taskType"),align:"left",minWidth:120,render:r=>{if(r.taskType===null)return null;const n=t(V[r.taskType]);return l(q,{type:U(r.taskType)},L(n)?n:{default:()=>[n]})}},{key:"createDt",title:t("page.retryDeadLetter.createDt"),align:"left",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:r=>{let n;return l("div",{class:"flex-center gap-8px"},[l(v,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>F(r)},L(n=t("common.rollback"))?n:{default:()=>[n]}),l(oe,{vertical:!0},null),l(J,{onPositiveClick:()=>H(r)},{default:()=>t("common.confirmDelete"),trigger:()=>{let _;return l(v,{type:"error",text:!0,ghost:!0,size:"small"},L(_=t("common.delete"))?_:{default:()=>[_]})}})])}}]}),{handleAdd:M,checkedRowKeys:N,onDeleted:P,onBatchDeleted:W}=pe(m,e);async function O(){const{error:r}=await S({ids:N.value,groupName:k.groupName});r||r||W()}async function G(){var n;const{error:r}=await $({ids:N.value,groupName:k.groupName});r||((n=window.$message)==null||n.success(t("common.rollbackSuccess")),e())}async function H(r){const{error:n}=await S({ids:[r.id],groupName:r.groupName});n||P()}async function j(r){const n=await Ne(r.id,r.groupName);i.value=n.data||null}async function F(r){var _;const{error:n}=await $({ids:[r.id],groupName:r.groupName});n||((_=window.$message)==null||_.success(t("common.rollbackSuccess")),e())}return se(async()=>{const{error:r,data:n}=await ue();!r&&n.length>0&&(k.groupName=n[0],e())}),(r,n)=>{const _=Re,K=Q,E=he,Y=de;return R(),I("div",$e,[l(Le,{model:a(k),"onUpdate:model":n[0]||(n[0]=f=>w(k)?k.value=f:null),onReset:a(A),onSearch:a(e)},null,8,["model","onReset","onSearch"]),l(Y,{title:a(t)("page.retryDeadLetter.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":o(()=>[l(K,{columns:a(h),"onUpdate:columns":n[1]||(n[1]=f=>w(h)?h.value=f:null),"disabled-delete":a(N).length===0,loading:a(y),"show-add":!1,onAdd:a(M),onDelete:O,onRefresh:a(e)},{addAfter:o(()=>[l(a(v),{size:"small",ghost:"",type:"primary",onClick:G},{icon:o(()=>[l(_,{class:"text-icon"})]),default:o(()=>[c(" "+p(a(t)("common.batchRollback")),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:o(()=>[l(E,{"checked-row-keys":a(N),"onUpdate:checkedRowKeys":n[2]||(n[2]=f=>w(N)?N.value=f:null),columns:a(D),data:a(m),"flex-height":!a(g).isMobile,"scroll-x":962,loading:a(y),remote:"","row-key":f=>f.id,pagination:a(b),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),l(xe,{visible:a(d),"onUpdate:visible":n[3]||(n[3]=f=>w(d)?d.value=f:null),"row-data":i.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Me as default};
