import{a as V,b as G,u as H,c as Q,N as P,d as X}from"./search-form.vue_vue_type_script_setup_true_lang-xYfW9G7N.js";import{d as J,_ as Y,a as Z}from"./download-ip38Mwxm.js";import{d as A,Q as ee,R as oe,o as U,c as te,w as r,f as a,h as o,$ as t,X as ae,aN as le,s as ne,a6 as re,c2 as se,C as ie,u as ce,b as ue,ae as R,B as _,g as T,t as W,aR as me,a9 as pe,P as de,U as fe,av as $,dy as we,O as ge,ag as ke}from"./index-D3rICic-.js";import{c as he,d as _e,e as ye,g as xe}from"./workflow-DX1Amij-.js";import{_ as ve}from"./status-switch.vue_vue_type_script_setup_true_lang-DuU56cot.js";import{u as Ne}from"./auth-C5d9H5Pz.js";import{_ as be}from"./select-group.vue_vue_type_script_setup_true_lang-Bk3YnuuX.js";import{_ as Se}from"./Grid-CRDcRyPk.js";import"./Progress-BRSG0yYs.js";import"./group-frwXGSCG.js";const Re=A({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:ee(["reset","search"],["update:model"]),setup(g,{emit:y}){const d=y,c=oe(g,"model");function N(){d("reset")}function b(){d("search")}return(x,s)=>{const i=V,v=ne,S=re,m=G;return U(),te(m,{model:c.value,onSearch:b,onReset:N},{default:r(()=>[a(i,{span:"24 s:12 m:6",label:o(t)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[a(be,{value:c.value.groupName,"onUpdate:value":s[0]||(s[0]=f=>c.value.groupName=f),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(i,{span:"24 s:12 m:6",label:o(t)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:r(()=>[a(v,{value:c.value.workflowName,"onUpdate:value":s[1]||(s[1]=f=>c.value.workflowName=f),placeholder:o(t)("page.workflow.form.workflowName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(i,{span:"24 s:12 m:6",label:o(t)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:r(()=>[a(S,{value:c.value.workflowStatus,"onUpdate:value":s[2]||(s[2]=f=>c.value.workflowStatus=f),placeholder:o(t)("page.workflow.form.workflowStatus"),options:o(ae)(o(le)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Te={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function D(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!ke(g)}const Ie=A({name:"workflow_task",__name:"index",setup(g){const{hasAuth:y}=Ne(),d=se(),c=ie(),{routerPushByKey:N}=ce(),{columns:b,columnChecks:x,data:s,getData:i,loading:v,mobilePagination:S,searchParams:m,resetSearchParams:f}=H({apiFn:he,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:t("common.index"),align:"center",width:120},{key:"workflowName",title:t("page.workflow.workflowName"),align:"left",minWidth:120,render:e=>{function l(){O(e.id)}return a(_,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[e.workflowName]})}},{key:"groupName",title:t("page.workflow.groupName"),align:"left",minWidth:120},{key:"nextTriggerAt",title:t("page.workflow.nextTriggerAt"),align:"left",minWidth:120},{key:"workflowStatus",title:t("page.workflow.workflowStatus"),align:"left",minWidth:120,render:e=>{const l=async(n,h)=>{var k;const{error:u}=await xe(e.id);u||(e.workflowStatus=n,(k=window.$message)==null||k.success(t("common.updateSuccess"))),h()};return a(ve,{value:e.workflowStatus,"onUpdate:value":n=>e.workflowStatus=n,onFetch:l},null)}},{key:"triggerType",title:t("page.workflow.triggerType"),align:"left",minWidth:120,render:e=>{if(!e.triggerType)return null;const l=t(me[e.triggerType]);return a(de,{type:pe(e.triggerType)},D(l)?l:{default:()=>[l]})}},{key:"triggerInterval",title:t("page.workflow.triggerInterval"),align:"left",minWidth:120},{key:"executorTimeout",title:t("page.workflow.executorTimeout"),align:"left",minWidth:120},{key:"updateDt",title:t("page.workflow.updateDt"),align:"left",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",fixed:"right",width:200,render:e=>{let l;const n=[{label:t("common.execute"),key:"execute",click:()=>M(e.id)},{type:"divider",key:"d1"},{label:t("common.copy"),key:"copy",click:()=>j(e.id)},{type:"divider",key:"d2"},{label:t("common.batchList"),key:"batchList",click:()=>K(e.id)}];function h(u){n.filter(k=>k.key===u)[0].click()}return a("div",{class:"flex-center gap-8px"},[a(_,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>z(e.id)},D(l=t("common.edit"))?l:{default:()=>[l]}),y("R_ADMIN")?a(fe,null,[a($,{vertical:!0},null),a(P,{onPositiveClick:()=>F(e.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let u;return a(_,{text:!0,type:"error",ghost:!0,size:"small"},D(u=t("common.delete"))?u:{default:()=>[u]})}})]):"",a($,{vertical:!0},null),a(we,{trigger:"click","show-arrow":!1,options:n,size:"small","on-select":h},{default:()=>a(_,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[T("更多")]})})])}}]}),{checkedRowKeys:p,onBatchDeleted:C}=Q(s,i);async function B(){C()}async function F(e){var n;const{error:l}=await _e(e);l||((n=window.$message)==null||n.success(t("common.deleteSuccess")),i())}function z(e){d.push({path:"/workflow/form/edit",query:{id:e}})}function I(){d.push({path:"/workflow/form/add"})}function O(e){d.push({path:"/workflow/form/detail",query:{id:e}})}function j(e){d.push({path:"/workflow/form/copy",query:{id:e}})}async function M(e){var n;const{error:l}=await ye(e);l||((n=window.$message)==null||n.success(t("common.executeSuccess")),i())}function q(){return{workflowIds:p.value,groupName:m.groupName,workflowName:m.workflowName,workflowStatus:m.workflowStatus}}function E(){J("/workflow/export",q(),t("page.workflow.title"))}function K(e){const l=s.value.find(n=>n.id===e);N("workflow_batch",{state:{workflowId:e,workflowName:l.workflowName}})}return(e,l)=>{const n=Y,h=Z,u=X,k=Se,L=ge;return U(),ue("div",Te,[a(Re,{model:o(m),"onUpdate:model":l[0]||(l[0]=w=>R(m)?m.value=w:null),onReset:o(f),onSearch:o(i)},null,8,["model","onReset","onSearch"]),a(L,{title:o(t)("page.workflow.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":r(()=>[a(u,{columns:o(x),"onUpdate:columns":l[1]||(l[1]=w=>R(x)?x.value=w:null),"disabled-delete":o(p).length===0,loading:o(v),"show-delete":!1,onAdd:I,onDelete:B,onRefresh:o(i)},{addAfter:r(()=>[a(n,{action:"/workflow/import",accept:"application/json",onRefresh:o(i)},null,8,["onRefresh"]),a(o(P),{onPositiveClick:E},{trigger:r(()=>[a(o(_),{size:"small",ghost:"",type:"primary",disabled:o(p).length===0&&o(y)("R_USER")},{icon:r(()=>[a(h,{class:"text-icon"})]),default:r(()=>[T(" "+W(o(t)("common.export")),1)]),_:1},8,["disabled"])]),default:r(()=>[T(W(o(p).length===0?o(t)("common.exportAll"):o(t)("common.exportPar",{num:o(p).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onRefresh"])]),default:r(()=>[a(k,{"checked-row-keys":o(p),"onUpdate:checkedRowKeys":l[2]||(l[2]=w=>R(p)?p.value=w:null),columns:o(b),data:o(s),"flex-height":!o(c).isMobile,"scroll-x":1300,loading:o(v),remote:"","row-key":w=>w.id,pagination:o(S),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{Ie as default};
