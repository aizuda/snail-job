import{_ as de,a as ge,N as X,b as ce}from"./search-form.vue_vue_type_script_setup_true_lang-WqEuOXXe.js";import{d as me,_ as fe,a as _e}from"./download-CgzKF_XR.js";import{_ as be}from"./delete-alert-BUikOQm-.js";import{d as W,Z as L,a0 as Q,z as ve,A as he,a as Se,$ as t,r as oe,p as Ce,q as ye,o as x,c as $,w as a,f as o,g as C,t as y,h as e,b as K,a1 as ee,a2 as te,a3 as Y,a4 as ae,a5 as Ne,a6 as we,a7 as ke,D as ne,E as De,H as Ge,B as V,a8 as Me,a9 as Re,aa as le,I as xe,ab as re,ac as z,ad as Pe,ae as ue,af as ie,Y as Z,L as Te,ag as Ue,ah as I,ai as $e,aj as Oe,F as Ae,ak as Ie}from"./index-BxI_8ir5.js";import{f as Ve,a as Fe,b as je,c as Be,d as Ee,e as ze}from"./group-BXqOqznU.js";import{_ as Le,u as We,a as qe}from"./table-KwvlieBb.js";import{_ as He}from"./status-switch.vue_vue_type_script_setup_true_lang-Fx9Kb65D.js";import{u as Je}from"./auth-Boy8-DM_.js";import{_ as Ke,a as Ye,b as Ze}from"./Grid-D6if5aLa.js";import{_ as Qe,a as Xe}from"./CollapseItem-CUobLCgj.js";import{_ as eo,a as oo}from"./DescriptionsItem-D5s6FkGL.js";import"./Progress-DmE4Kd5d.js";const to=W({name:"GroupOperateDrawer",__name:"group-operate-drawer",props:L({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:L(["submitted"],["update:visible"]),setup(N,{emit:b}){const i=N,f=b,d=Q(N,"visible"),{formRef:G,validate:U,restoreValidation:v}=ve(),{defaultRequiredRule:l}=he(),g=Se(()=>({add:t("page.groupConfig.addGroupConfig"),edit:t("page.groupConfig.editGroupConfig")})[i.operateType]),P=oe([]),p=Ce(h());function h(){return{groupName:"",token:"SJ_Wyz3dmsdbDOkDujOTSSoBjGQP1BMsVnj",groupStatus:1,description:"",idGeneratorMode:2,initScene:1,groupPartition:0}}const q={groupName:[{required:!0,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:t("page.groupConfig.form.groupNameRule")}],token:[l],groupStatus:[l],idGeneratorMode:[l],initScene:[l],groupPartition:[l]};function O(){if(i.operateType==="add"){Object.assign(p,h());return}i.operateType==="edit"&&i.rowData&&Object.assign(p,i.rowData)}function F(){d.value=!1}async function j(){var D,u;if(await U(),i.operateType==="add"){const{groupName:S,token:c,groupStatus:w,description:r,idGeneratorMode:n,initScene:m,groupPartition:k}=p,{error:R}=await Ve({groupName:S,token:c,groupStatus:w,description:r,idGeneratorMode:n,initScene:m,groupPartition:k});if(R)return;(D=window.$message)==null||D.success(t("common.addSuccess"))}else{const{groupName:S,token:c,groupStatus:w,description:r,idGeneratorMode:n,initScene:m,groupPartition:k}=p,{error:R}=await Fe({groupName:S,token:c,groupStatus:w,description:r,idGeneratorMode:n,initScene:m,groupPartition:k});if(R)return;(u=window.$message)==null||u.success(t("common.updateSuccess"))}F(),f("submitted")}function H(){p.token=J(32)}function J(D){const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let S="SJ_";for(let c=0;c<D;c+=1){const w=Math.floor(Math.random()*u.length);S+=u.substring(w,w+1)}return S}const M=async()=>{const{data:D}=await je();P.value=D.map(u=>String(u))};return ye(d,()=>{d.value&&(M(),O(),v())}),(D,u)=>{const S=ne,c=De,w=Ye,r=Ge,n=Ke,m=de,k=V,R=Me,A=Re,T=Qe,B=le,_=Xe,pe=xe,se=re;return x(),$(se,{modelValue:d.value,"onUpdate:modelValue":u[7]||(u[7]=s=>d.value=s),title:g.value,onSubmitted:j},{footer:a(()=>[o(r,{size:16},{default:a(()=>[o(k,{onClick:F},{default:a(()=>[C(y(e(t)("common.cancel")),1)]),_:1}),o(k,{type:"primary",onClick:j},{default:a(()=>[C(y(e(t)("common.save")),1)]),_:1})]),_:1})]),default:a(()=>[o(pe,{ref_key:"formRef",ref:G,model:p,rules:q},{default:a(()=>[o(_,{"default-expanded-names":["1","2"]},{default:a(()=>[o(T,{title:e(t)("page.groupConfig.commonConfig"),name:"1"},{default:a(()=>[o(c,{label:e(t)("page.groupConfig.groupName"),path:"groupName"},{default:a(()=>[o(S,{value:p.groupName,"onUpdate:value":u[0]||(u[0]=s=>p.groupName=s),maxlength:64,"show-count":"",placeholder:e(t)("page.groupConfig.form.groupName"),disabled:i.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),o(c,{label:e(t)("page.groupConfig.groupStatus"),path:"groupStatus"},{default:a(()=>[o(n,{value:p.groupStatus,"onUpdate:value":u[1]||(u[1]=s=>p.groupStatus=s),name:"groupStatus"},{default:a(()=>[o(r,null,{default:a(()=>[(x(!0),K(Y,null,ee(e(te),s=>(x(),$(w,{key:s.value,value:s.value,label:e(t)(s.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(c,{label:e(t)("page.groupConfig.token"),path:"token"},{default:a(()=>[o(A,null,{default:a(()=>[o(S,{value:p.token,"onUpdate:value":u[2]||(u[2]=s=>p.token=s),maxlength:64,placeholder:e(t)("page.groupConfig.form.token"),disabled:i.operateType==="edit"},null,8,["value","placeholder","disabled"]),o(R,{trigger:"hover"},{trigger:a(()=>[o(k,{type:"default",ghost:"",disabled:i.operateType==="edit",onClick:H},{default:a(()=>[o(m,{class:"text-icon"})]),_:1},8,["disabled"])]),default:a(()=>[C(" "+y(e(t)("page.groupConfig.generateToken")),1)]),_:1})]),_:1})]),_:1},8,["label"]),o(c,{label:e(t)("page.groupConfig.description"),path:"description"},{default:a(()=>[o(S,{value:p.description,"onUpdate:value":u[3]||(u[3]=s=>p.description=s),type:"textarea",maxlength:256,"show-count":"",placeholder:e(t)("page.groupConfig.form.description"),clearable:"",round:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),o(T,{title:e(t)("page.groupConfig.retryConfig"),name:"2"},{default:a(()=>[o(c,{label:e(t)("page.groupConfig.idGeneratorMode"),path:"idGeneratorMode"},{default:a(()=>[o(B,{value:p.idGeneratorMode,"onUpdate:value":u[4]||(u[4]=s=>p.idGeneratorMode=s),placeholder:e(t)("page.groupConfig.form.idGeneratorMode"),options:e(ae)(e(Ne))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),o(c,{label:e(t)("page.groupConfig.initScene"),path:"initScene"},{default:a(()=>[o(n,{value:p.initScene,"onUpdate:value":u[5]||(u[5]=s=>p.initScene=s),name:"initScene"},{default:a(()=>[o(r,null,{default:a(()=>[(x(!0),K(Y,null,ee(e(we),s=>(x(),$(w,{key:s.value,value:s.value,label:e(t)(s.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(c,{label:e(t)("page.groupConfig.groupPartition"),path:"groupPartition"},{default:a(()=>[o(B,{value:p.groupPartition,"onUpdate:value":u[6]||(u[6]=s=>p.groupPartition=s),placeholder:e(t)("page.groupConfig.form.groupPartition"),options:e(ke)(P.value)},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ao=W({name:"GroupDetailDrawer",__name:"group-detail-drawer",props:L({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(N){const b=Q(N,"visible");return(i,f)=>{const d=eo,G=Z,U=oo,v=re;return x(),$(v,{modelValue:b.value,"onUpdate:modelValue":f[0]||(f[0]=l=>b.value=l),title:e(t)("page.groupConfig.detail")},{default:a(()=>[o(U,{"label-placement":"top",bordered:"",column:2},{default:a(()=>[o(d,{label:e(t)("page.groupConfig.groupName"),span:2},{default:a(()=>{var l;return[C(y((l=i.rowData)==null?void 0:l.groupName),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.token"),span:2},{default:a(()=>{var l;return[C(y((l=i.rowData)==null?void 0:l.token),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.groupStatus"),span:1},{default:a(()=>{var l;return[o(G,{type:e(z)((l=i.rowData)==null?void 0:l.groupStatus)},{default:a(()=>{var g;return[C(y(e(t)(e(Pe)[(g=i.rowData)==null?void 0:g.groupStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.idGeneratorMode"),span:1},{default:a(()=>{var l;return[o(G,{type:e(z)((l=i.rowData)==null?void 0:l.idGeneratorMode)},{default:a(()=>{var g;return[C(y(e(t)(e(ue)[(g=i.rowData)==null?void 0:g.idGeneratorMode])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.groupPartition"),span:1},{default:a(()=>{var l;return[C(y((l=i.rowData)==null?void 0:l.groupPartition),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.initScene"),span:1},{default:a(()=>{var l;return[o(G,{type:e(z)((l=i.rowData)==null?void 0:l.initScene)},{default:a(()=>{var g;return[C(y(e(t)(e(ie)[(g=i.rowData)==null?void 0:g.initScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.description"),span:2},{default:a(()=>{var l;return[C(y((l=i.rowData)==null?void 0:l.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),no=W({name:"GroupSearch",__name:"group-search",props:{model:{required:!0},modelModifiers:{}},emits:L(["reset","search"],["update:model"]),setup(N,{emit:b}){const i=b,f=Q(N,"model");function d(){i("reset")}function G(){i("search")}return(U,v)=>{const l=ne,g=Le,P=le,p=ge;return x(),$(p,{model:f.value,onSearch:G,onReset:d},{default:a(()=>[o(g,{span:"24 s:12 m:6",label:e(t)("page.groupConfig.groupName"),path:"groupName",class:"pr-24px"},{default:a(()=>[o(l,{value:f.value.groupName,"onUpdate:value":v[0]||(v[0]=h=>f.value.groupName=h),placeholder:e(t)("page.groupConfig.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(g,{span:"24 s:12 m:6",label:e(t)("page.groupConfig.groupStatus"),path:"groupStatus",class:"pr-24px"},{default:a(()=>[o(P,{value:f.value.groupStatus,"onUpdate:value":v[1]||(v[1]=h=>f.value.groupStatus=h),placeholder:e(t)("page.groupConfig.form.groupStatus"),options:e(ae)(e(te)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),lo={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function E(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Ie(N)}const ho=W({name:"group",__name:"index",setup(N){const{hasAuth:b}=Je(),i=Te(),f=oe(),{bool:d,setTrue:G}=Ue(!1),{columns:U,columnChecks:v,data:l,getData:g,loading:P,mobilePagination:p,searchParams:h,resetSearchParams:q}=We({apiFn:Be,apiParams:{page:1,size:10,groupName:null,groupStatus:null},columns:()=>[{key:"id",title:t("common.index"),align:"center",width:64},{key:"groupName",title:t("page.groupConfig.groupName"),align:"left",minWidth:260,render:r=>{function n(){f.value=r||null,G()}return o(V,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[r.groupName]})}},{key:"groupStatus",title:t("page.groupConfig.groupStatus"),align:"center",width:80,render:r=>{const n=async(m,k)=>{var T;const R=r.groupStatus===1?0:1,{error:A}=await ze({groupName:r.groupName,groupStatus:R});A||(r.groupStatus=m,(T=window.$message)==null||T.success(t("common.updateSuccess"))),k()};return o(He,{value:r.groupStatus,"onUpdate:value":m=>r.groupStatus=m,onFetch:n,disabled:b("R_USER")},null)}},{key:"idGeneratorMode",title:t("page.groupConfig.idGeneratorMode"),align:"center",width:120,render:r=>{if(r.idGeneratorMode===null)return null;const n=t(ue[r.idGeneratorMode]);return o(Z,{type:"primary"},E(n)?n:{default:()=>[n]})}},{key:"groupPartition",title:t("page.groupConfig.groupPartition"),align:"center",minWidth:60},{key:"initScene",title:t("page.groupConfig.initScene"),align:"center",minWidth:80,render:r=>{if(r.groupStatus===null)return null;const n=t(ie[r.initScene]);return o(Z,{type:z(r.initScene)},E(n)?n:{default:()=>[n]})}},{key:"updateDt",title:t("page.groupConfig.updateDt"),align:"left",width:130},{key:"description",title:t("page.groupConfig.description"),align:"left",width:130},{key:"operate",title:t("common.operate"),align:"center",width:130,render:r=>{let n;return b("R_USER")?o(Y,null,null):o("div",{class:"flex-center gap-8px"},[o(V,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>u(r.id)},E(n=t("common.edit"))?n:{default:()=>[n]}),o(Oe,{vertical:!0},null),o(X,{onPositiveClick:()=>S(r.groupName)},{default:()=>t("common.confirmDelete"),trigger:()=>{let m;return o(V,{type:"error",text:!0,ghost:!0,size:"small"},E(m=t("common.delete"))?m:{default:()=>[m]})}})])}}]}),{drawerVisible:O,operateType:F,editingData:j,handleAdd:H,handleEdit:J,checkedRowKeys:M,onDeleted:D}=qe(l,g);function u(r){J(r)}async function S(r){const{error:n}=await Ee(r);n||D()}function c(){return{groupName:h.groupName,groupStatus:h.groupStatus,groupIds:M.value}}function w(){me("/group/export",c(),t("page.groupConfig.title"))}return(r,n)=>{const m=be,k=fe,R=_e,A=ce,T=Ze,B=Ae;return x(),K("div",lo,[o(no,{model:e(h),"onUpdate:model":n[0]||(n[0]=_=>I(h)?h.value=_:null),onReset:e(q),onSearch:e(g)},null,8,["model","onReset","onSearch"]),o(m),o(B,{title:e(t)("page.groupConfig.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[o(A,{columns:e(v),"onUpdate:columns":n[1]||(n[1]=_=>I(v)?v.value=_:null),loading:e(P),"show-add":e(b)("R_ADMIN"),"show-delete":!1,onAdd:e(H),onRefresh:e(g)},{addAfter:a(()=>[e(b)("R_ADMIN")?(x(),$(k,{key:0,action:"/group/import",accept:"application/json",onRefresh:e(g)},null,8,["onRefresh"])):$e("",!0),o(e(X),{onPositiveClick:w},{trigger:a(()=>[o(e(V),{size:"small",ghost:"",type:"primary",disabled:e(M).length===0&&e(b)("R_USER")},{icon:a(()=>[o(R,{class:"text-icon"})]),default:a(()=>[C(" "+y(e(t)("common.export")),1)]),_:1},8,["disabled"])]),default:a(()=>[C(y(e(M).length===0?e(t)("common.exportAll"):e(t)("common.exportPar",{num:e(M).length})),1)]),_:1})]),_:1},8,["columns","loading","show-add","onAdd","onRefresh"])]),default:a(()=>[o(T,{"checked-row-keys":e(M),"onUpdate:checkedRowKeys":n[2]||(n[2]=_=>I(M)?M.value=_:null),columns:e(U),data:e(l),"flex-height":!e(i).isMobile,"scroll-x":962,loading:e(P),remote:"","row-key":_=>_.id,pagination:e(p),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(to,{visible:e(O),"onUpdate:visible":n[3]||(n[3]=_=>I(O)?O.value=_:null),"operate-type":e(F),"row-data":e(j),onSubmitted:e(g)},null,8,["visible","operate-type","row-data","onSubmitted"]),o(ao,{visible:e(d),"onUpdate:visible":n[4]||(n[4]=_=>I(d)?d.value=_:null),"row-data":f.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{ho as default};
