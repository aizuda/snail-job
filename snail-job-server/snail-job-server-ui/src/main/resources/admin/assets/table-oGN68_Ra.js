import{d as G,j as R,k as V}from"./Grid-BEQeOJ6_.js";import{d as A,r as S,ak as j,dU as $,E as N,dY as U,dZ as Y,d_ as H,ag as M,p as K,a as T,ap as W,L as q,$ as E,q as X,ar as Z,d$ as J}from"./index-D11HRvLC.js";const Q=Object.assign(Object.assign({},R),U),ne=A({__GRID_ITEM__:!0,name:"FormItemGridItem",alias:["FormItemGi"],props:Q,setup(){const a=S(null);return{formItemInstRef:a,validate:(...n)=>{const{value:l}=a;if(l)return l.validate(...n)},restoreValidation:()=>{const{value:n}=a;n&&n.restoreValidation()}}},render(){return j(G,$(this.$.vnode.props||{},V),{default:()=>{const a=$(this.$props,Y);return j(N,Object.assign({ref:"formItemInstRef"},a),this.$slots)}})}});function ee(a){const{loading:p,startLoading:h,endLoading:n}=H(),{bool:l,setBool:f}=M(),{apiFn:w,apiParams:d,transformer:v,immediate:g=!0,getColumnChecks:C,getColumns:I}=a,s=K({...d}),P=S(a.columns()),b=S([]),k=S(C(a.columns())),y=T(()=>I(P.value,k.value));function x(){P.value=a.columns();const i=new Map(k.value.map(r=>[r.key,r.checked])),m=C(P.value);k.value=m.map(r=>({...r,checked:i.get(r.key)??r.checked}))}async function _(){var e;h();const i=D(s),m=await w(i),r=v(m);b.value=r.data,f(r.data.length===0),await((e=a.onFetched)==null?void 0:e.call(a,r)),n()}function D(i){const m={};return Object.entries(i).forEach(([r,e])=>{e!=null&&(m[r]=e)}),m}function o(i){Object.assign(s,i)}function O(){Object.assign(s,d)}return g&&(a.searchParams&&o(a.searchParams),_()),{loading:p,empty:l,data:b,columns:y,columnChecks:k,reloadColumns:x,getData:_,searchParams:s,updateSearchParams:o,resetSearchParams:O}}function oe(a){const p=W(),h=q(),n=T(()=>h.isMobile),{apiFn:l,apiParams:f,immediate:w,showTotal:d}=a,v="__selection__",g="__expand__",{loading:C,empty:I,data:s,columns:P,columnChecks:b,reloadColumns:k,getData:y,searchParams:x,updateSearchParams:_,resetSearchParams:D}=ee({apiFn:l,apiParams:f,searchParams:a.searchParams,columns:a.columns,transformer:e=>{const{data:u=[],page:t=1,size:z=10,total:c=0}=e.data||{};return{data:u.map((B,L)=>({...B,index:(t-1)*z+L+1})),pageNum:t,pageSize:z,total:c}},getColumnChecks:e=>{const u=[];return e.forEach(t=>{F(t)?u.push({key:t.key,title:t.title,checked:!0}):t.type==="selection"?u.push({key:v,title:E("common.check"),checked:!0}):t.type==="expand"&&u.push({key:g,title:E("common.expandColumn"),checked:!0})}),u},getColumns:(e,u)=>{const t=new Map;return e.forEach(c=>{F(c)?t.set(c.key,c):c.type==="selection"?t.set(v,c):c.type==="expand"&&t.set(g,c)}),u.filter(c=>c.checked).map(c=>t.get(c.key))},onFetched:async e=>{const{pageNum:u,pageSize:t,total:z}=e;i({page:u,pageSize:t,itemCount:z})},immediate:w}),o=K({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{o.page=e,_({page:e,size:o.pageSize}),y()},onUpdatePageSize:async e=>{o.pageSize=e,o.page=1,_({page:o.page,size:e}),y()},...d?{prefix:e=>E("datatable.itemCount",{total:e.itemCount})}:{}}),O=T(()=>({...o,pageSlot:n.value?3:9,prefix:!n.value&&d?o.prefix:void 0}));function i(e){Object.assign(o,e)}async function m(e=1){i({page:e}),_({page:e,size:o.pageSize}),await y()}return p.run(()=>{X(()=>h.locale,()=>{k()})}),Z(()=>{p.stop()}),{loading:C,empty:I,data:s,columns:P,columnChecks:b,reloadColumns:k,pagination:o,mobilePagination:O,updatePagination:i,getData:y,getDataByPage:m,searchParams:x,updateSearchParams:_,resetSearchParams:()=>{D(),y()}}}function re(a,p){const{bool:h,setTrue:n,setFalse:l}=M(),f=S("add");function w(){f.value="add",n()}const d=S(null);function v(s){f.value="edit";const P=a.value.find(b=>b.id===s)||null;d.value=J(P),n()}const g=S([]);async function C(){var s;(s=window.$message)==null||s.success(E("common.deleteSuccess")),g.value=[],await p()}async function I(){var s;(s=window.$message)==null||s.success(E("common.deleteSuccess")),await p()}return{drawerVisible:h,openDrawer:n,closeDrawer:l,operateType:f,handleAdd:w,editingData:d,handleEdit:v,checkedRowKeys:g,onBatchDeleted:C,onDeleted:I}}function F(a){return!!a.key}export{ne as _,re as a,oe as u};
