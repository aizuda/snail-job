import{a as H,b as Z,N as B}from"./search-form-CMclOkIC.js";import{aP as w,d as O,a0 as C,a1 as U,c as z,o as V,w as s,f as e,h as a,$ as t,D as J,ad as Q,ae as X,bk as Y,at as ee,au as ae,g as f,t as _,Z as $,aa as S,bl as W,b7 as M,b6 as te,l as re,K as le,r as ne,af as se,b4 as oe,b as ue,ag as x,F as ie,B as I,a7 as pe,_ as de,bm as me,ah as P,a3 as ce,ai as fe}from"./index-DWIswSJW.js";import{_ as _e,u as ge,a as ye}from"./table-DmJtAhNa.js";import{_ as be}from"./select-group.vue_vue_type_script_setup_true_lang-Cc_BUi-m.js";import{_ as ke}from"./select-scene.vue_vue_type_script_setup_true_lang-C3SrHZ8N.js";import{_ as he}from"./datetime-range.vue_vue_type_script_setup_true_lang-CnsJMC2l.js";import{_ as ve}from"./detail-drawer-BKXWqHWo.js";import{_ as De}from"./log-drawer-BB9PXuVe.js";import{_ as Te,a as Se}from"./DescriptionsItem-BBDEmqXH.js";import{b as we}from"./Grid-DoBPPIj4.js";import"./CollapseItem-B1LBWEg9.js";import"./group-pdx_vdG9.js";import"./retry-scene-COE-JO_s.js";import"./DatePicker-w4tH0WBc.js";function Ne(p){return w({url:"/retry-task/list",method:"get",params:p})}function Re(p){return w({url:`/retry-task/${p}`,method:"get"})}function xe(p){return w({url:`/retry-task/${p}`,method:"delete"})}function $e(p){return w({url:"/retry-task/ids",method:"delete",data:p})}function Ie(p){return w({url:`/retry-task/stop/${p}`,method:"post"})}const Oe=O({name:"RetryLogSearch",__name:"retry-task-search",props:{model:{required:!0},modelModifiers:{}},emits:C(["reset","search"],["update:model"]),setup(p,{emit:v}){const u=v,i=U(p,"model");function d(){u("reset")}function h(){u("search")}return(N,m)=>{const g=_e,b=J,D=Q,r=H;return V(),z(r,{"btn-span":"24 s:12 m:9 l:12 xl:18",model:i.value,onSearch:h,onReset:d},{default:s(()=>[e(g,{span:"24 s:12 m:6",label:a(t)("page.retryTask.groupName"),path:"groupName",class:"pr-24px"},{default:s(()=>[e(be,{value:i.value.groupName,"onUpdate:value":m[0]||(m[0]=l=>i.value.groupName=l),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(g,{span:"24 s:12 m:6",label:a(t)("page.retryTask.sceneName"),path:"sceneName",class:"pr-24px"},{default:s(()=>[e(ke,{value:i.value.sceneName,"onUpdate:value":m[1]||(m[1]=l=>i.value.sceneName=l),"group-name":i.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),e(g,{span:"24 s:12 m:6",label:a(t)("page.retryTask.retryId"),path:"bizNo",class:"pr-24px"},{default:s(()=>[e(b,{value:i.value.retryId,"onUpdate:value":m[2]||(m[2]=l=>i.value.retryId=l),placeholder:a(t)("page.retryTask.form.retryId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{span:"24 s:12 m:6",label:a(t)("page.retry.retryStatus"),path:"retryStatus",class:"pr-24px"},{default:s(()=>[e(D,{value:i.value.taskStatus,"onUpdate:value":m[3]||(m[3]=l=>i.value.taskStatus=l),placeholder:a(t)("page.retry.form.retryStatus"),options:a(X)(a(Y)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(g,{span:"24 s:24 m:14 l:12 xl:6",label:a(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:s(()=>[e(he,{value:i.value.datetimeRange,"onUpdate:value":m[4]||(m[4]=l=>i.value.datetimeRange=l)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Ve=O({name:"SceneDetailDrawer",__name:"retry-task-detail-drawer",props:C({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(p){const v=U(p,"visible");return(u,i)=>{const d=Se,h=$,N=Te,m=ae,g=De,b=ee,D=ve;return V(),z(D,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=r=>v.value=r),title:a(t)("page.retryTask.detail"),width:["50%","90%"]},{default:s(()=>[e(b,{type:"segment",animated:""},{default:s(()=>[e(m,{name:0,tab:a(t)("page.log.info")},{default:s(()=>[e(N,{"label-placement":"top",bordered:"",column:2},{default:s(()=>[e(d,{label:a(t)("page.retryTask.groupName"),span:2},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.groupName),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.retryTask.sceneName"),span:2},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.sceneName),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.retryTask.taskStatus"),span:1},{default:s(()=>{var r;return[e(h,{type:a(S)((r=u.rowData)==null?void 0:r.taskStatus)},{default:s(()=>{var l;return[f(_(a(t)(a(W)[(l=u.rowData)==null?void 0:l.taskStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(d,{label:a(t)("page.retryTask.taskType"),span:1},{default:s(()=>{var r;return[e(h,{type:a(S)((r=u.rowData)==null?void 0:r.taskType)},{default:s(()=>{var l;return[f(_(a(t)(a(M)[(l=u.rowData)==null?void 0:l.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(d,{label:a(t)("page.retry.retryCount"),span:1},{default:s(()=>{var r,l;return[f(_((l=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:l.retryCount),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.retry.retryStatus"),span:1},{default:s(()=>{var r,l;return[e(h,{type:a(S)((l=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:l.retryStatus)},{default:s(()=>{var R,k;return[f(_(a(t)(a(te)[(k=(R=u.rowData)==null?void 0:R.responseVO)==null?void 0:k.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(d,{label:a(t)("page.retry.bizNo"),span:2},{default:s(()=>{var r,l;return[f(_((l=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:l.bizNo),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.retry.idempotentId"),span:2},{default:s(()=>{var r,l;return[f(_((l=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:l.idempotentId),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.retry.executorName"),span:2},{default:s(()=>{var r,l;return[f(_((l=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:l.executorName),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.retry.argsStr"),span:2},{default:s(()=>{var r,l;return[f(_((l=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:l.argsStr),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.retry.serializerName"),span:2},{default:s(()=>{var r,l;return[f(_((l=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:l.serializerName),1)]}),_:1},8,["label"]),e(d,{label:a(t)("common.createDt")},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.createDt),1)]}),_:1},8,["label"]),e(d,{label:a(t)("common.updateDt")},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.updateDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),e(m,{name:1,tab:a(t)("page.log.title"),"display-directive":"if"},{default:s(()=>[e(g,{drawer:!1,type:"retry","task-data":u.rowData},null,8,["task-data"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Be=re(Ve,[["__scopeId","data-v-e60b4fcc"]]),Pe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function T(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!fe(p)}const Ze=O({name:"retry_task",__name:"index",setup(p){const v=le(),u=ne(),{bool:i,setTrue:d}=se(!1),h=history.state.retryId,{columns:N,columnChecks:m,data:g,getData:b,loading:D,mobilePagination:r,searchParams:l,resetSearchParams:R}=ge({apiFn:Ne,apiParams:{page:1,size:10,groupName:null,sceneName:null,taskStatus:null,datetimeRange:oe()},searchParams:{retryId:h},columns:()=>[{type:"selection",align:"center",width:48,disabled:n=>n.taskStatus===1},{key:"id",align:"center",width:120,fixed:"left",title:()=>e("div",{class:"flex-center"},[e("span",null,[t("page.jobBatch.jobTask.id")]),e(pe,{trigger:"hover"},{trigger:()=>e("span",{class:"mb-2px ml-5px text-16px"},[e(de,{icon:"ant-design:info-circle-outlined"},null)]),default:()=>e("span",null,[t("common.idDetailTip")])})]),render:n=>{async function o(){await q(n),d()}return e(I,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[n.id]})}},{key:"groupName",title:t("page.retryTask.groupName"),align:"center",minWidth:120},{key:"sceneName",title:t("page.retryTask.sceneName"),align:"center",minWidth:120},{key:"retryId",title:t("page.retryTask.retryId"),align:"center",minWidth:120},{key:"taskType",title:t("page.retryTask.taskType"),align:"center",minWidth:80,render:n=>{if(n.taskType===null)return null;const o=t(M[n.taskType]);return e($,{type:S(n.taskType)},T(o)?o:{default:()=>[o]})}},{key:"taskStatus",title:t("page.retryTask.taskStatus"),align:"center",minWidth:80,render:n=>{if(n.taskStatus===null)return null;const o={1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"},c=t(W[n.taskStatus]);return e($,{type:o[n.taskStatus]},T(c)?c:{default:()=>[c]})}},{key:"operationReason",title:t("page.retryTask.operationReason"),align:"center",width:240,render:n=>{if(n.operationReason===null)return null;const o=t(me[n.operationReason]);return e($,{type:S(n.operationReason)},T(o)?o:{default:()=>[o]})}},{key:"createDt",title:t("page.retryTask.createDt"),align:"center",minWidth:120},{key:"updateDt",title:t("page.retryTask.updateDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:80,render:n=>e("div",{class:"flex-center gap-8px"},[n.taskStatus===1||n.taskStatus===2?e(ce,null,[e(P,{vertical:!0},null),e(B,{onPositiveClick:()=>A(n.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let c;return e(I,{type:"error",text:!0,ghost:!0,size:"small"},T(c=t("common.stop"))?c:{default:()=>[c]})}}),e(P,{vertical:!0},null)]):null,n.taskStatus!==1&&n.taskStatus!==2?e(B,{onPositiveClick:()=>K(n.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let c;return e(I,{type:"error",text:!0,ghost:!0,size:"small"},T(c=t("common.delete"))?c:{default:()=>[c]})}}):""])}]}),{checkedRowKeys:k,onDeleted:j,onBatchDeleted:F}=ye(g,b);async function L(){const{error:n}=await $e(k.value);n||F()}async function K(n){const{error:o}=await xe(n);o||j()}async function q(n){const o=await Re(n.id);u.value=o.data||null}async function A(n){var c;const{error:o}=await Ie(n);o||((c=window.$message)==null||c.success(t("common.operateSuccess")),b())}return(n,o)=>{const c=Z,E=we,G=ie;return V(),ue("div",Pe,[e(Oe,{model:a(l),"onUpdate:model":o[0]||(o[0]=y=>x(l)?l.value=y:null),onReset:a(R),onSearch:a(b)},null,8,["model","onReset","onSearch"]),e(G,{title:a(t)("page.retryTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[e(c,{columns:a(m),"onUpdate:columns":o[1]||(o[1]=y=>x(m)?m.value=y:null),"disabled-delete":a(k).length===0,loading:a(D),"show-add":!1,onDelete:L,onRefresh:a(b)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:s(()=>[e(E,{"checked-row-keys":a(k),"onUpdate:checkedRowKeys":o[2]||(o[2]=y=>x(k)?k.value=y:null),columns:a(N),data:a(g),"flex-height":!a(v).isMobile,"scroll-x":962,loading:a(D),remote:"","row-key":y=>y.id,pagination:a(r),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(Be,{visible:a(i),"onUpdate:visible":o[3]||(o[3]=y=>x(i)?i.value=y:null),"row-data":u.value},null,8,["visible","row-data"])])}}});export{Ze as default};
