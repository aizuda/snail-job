import{a as H,b as Z,N as V}from"./search-form-CGyqgbAn.js";import{aP as w,d as B,a0 as C,a1 as U,c as z,o as O,w as s,f as e,h as t,$ as a,D as J,ad as Q,ae as X,bz as Y,at as ee,au as te,g as f,t as _,Z as $,aa as S,bA as W,bo as M,bn as ae,l as re,L as ne,r as le,af as se,bl as oe,b as ue,ag as x,G as ie,B as I,a7 as pe,_ as de,bB as me,ah as P,a3 as ce,ai as fe}from"./index-D6me0eLt.js";import{_ as _e,u as ge,a as ye}from"./table-C2ZMKOSd.js";import{_ as be}from"./select-group.vue_vue_type_script_setup_true_lang-tjhrOmkT.js";import{_ as ke}from"./select-scene.vue_vue_type_script_setup_true_lang-DP__QgP2.js";import{_ as he}from"./datetime-range.vue_vue_type_script_setup_true_lang--8uo3sed.js";import{_ as ve}from"./detail-drawer-BemdpbEz.js";import{_ as De}from"./log-drawer-DBWTp2Gx.js";import{_ as Te,a as Se}from"./DescriptionsItem-BJgLK6X4.js";import{b as we}from"./Grid-CfmYRQfD.js";import"./CollapseItem-CBhFOVhp.js";import"./group-CBB4DW2_.js";import"./retry-scene-DzdxNMPn.js";function Ne(p){return w({url:"/retry-task/list",method:"get",params:p})}function Re(p){return w({url:`/retry-task/${p}`,method:"get"})}function xe(p){return w({url:`/retry-task/${p}`,method:"delete"})}function $e(p){return w({url:"/retry-task/ids",method:"delete",data:p})}function Ie(p){return w({url:`/retry-task/stop/${p}`,method:"post"})}const Be=B({name:"RetryLogSearch",__name:"retry-task-search",props:{model:{required:!0},modelModifiers:{}},emits:C(["reset","search"],["update:model"]),setup(p,{emit:v}){const u=v,i=U(p,"model");function m(){u("reset")}function h(){u("search")}return(N,d)=>{const g=_e,b=J,D=Q,r=H;return O(),z(r,{"btn-span":"24 s:12 m:9 l:12 xl:18",model:i.value,onSearch:h,onReset:m},{default:s(()=>[e(g,{span:"24 s:12 m:6",label:t(a)("page.retryTask.groupName"),path:"groupName",class:"pr-24px"},{default:s(()=>[e(be,{value:i.value.groupName,"onUpdate:value":d[0]||(d[0]=n=>i.value.groupName=n),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(g,{span:"24 s:12 m:6",label:t(a)("page.retryTask.sceneName"),path:"sceneName",class:"pr-24px"},{default:s(()=>[e(ke,{value:i.value.sceneName,"onUpdate:value":d[1]||(d[1]=n=>i.value.sceneName=n),"group-name":i.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),e(g,{span:"24 s:12 m:6",label:t(a)("page.retryTask.retryId"),path:"bizNo",class:"pr-24px"},{default:s(()=>[e(b,{value:i.value.retryId,"onUpdate:value":d[2]||(d[2]=n=>i.value.retryId=n),placeholder:t(a)("page.retryTask.form.retryId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(g,{span:"24 s:12 m:6",label:t(a)("page.retry.retryStatus"),path:"retryStatus",class:"pr-24px"},{default:s(()=>[e(D,{value:i.value.taskStatus,"onUpdate:value":d[3]||(d[3]=n=>i.value.taskStatus=n),placeholder:t(a)("page.retry.form.retryStatus"),options:t(X)(t(Y)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(g,{span:"24 s:24 m:14 l:12 xl:6",label:t(a)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:s(()=>[e(he,{value:i.value.datetimeRange,"onUpdate:value":d[4]||(d[4]=n=>i.value.datetimeRange=n)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Oe=B({name:"SceneDetailDrawer",__name:"retry-task-detail-drawer",props:C({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(p){const v=U(p,"visible");return(u,i)=>{const m=Se,h=$,N=Te,d=te,g=De,b=ee,D=ve;return O(),z(D,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=r=>v.value=r),title:t(a)("page.retryTask.detail"),width:["50%","90%"]},{default:s(()=>[e(b,{type:"segment",animated:""},{default:s(()=>[e(d,{name:0,tab:t(a)("page.log.info")},{default:s(()=>[e(N,{"label-placement":"top",bordered:"",column:2},{default:s(()=>[e(m,{label:t(a)("page.retryTask.groupName"),span:2},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.groupName),1)]}),_:1},8,["label"]),e(m,{label:t(a)("page.retryTask.sceneName"),span:2},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.sceneName),1)]}),_:1},8,["label"]),e(m,{label:t(a)("page.retryTask.taskStatus"),span:1},{default:s(()=>{var r;return[e(h,{type:t(S)((r=u.rowData)==null?void 0:r.taskStatus)},{default:s(()=>{var n;return[f(_(t(a)(t(W)[(n=u.rowData)==null?void 0:n.taskStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(m,{label:t(a)("page.retryTask.taskType"),span:1},{default:s(()=>{var r;return[e(h,{type:t(S)((r=u.rowData)==null?void 0:r.taskType)},{default:s(()=>{var n;return[f(_(t(a)(t(M)[(n=u.rowData)==null?void 0:n.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(m,{label:t(a)("page.retry.retryCount"),span:1},{default:s(()=>{var r,n;return[f(_((n=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:n.retryCount),1)]}),_:1},8,["label"]),e(m,{label:t(a)("page.retry.retryStatus"),span:1},{default:s(()=>{var r,n;return[e(h,{type:t(S)((n=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:n.retryStatus)},{default:s(()=>{var R,k;return[f(_(t(a)(t(ae)[(k=(R=u.rowData)==null?void 0:R.responseVO)==null?void 0:k.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(m,{label:t(a)("page.retry.bizNo"),span:2},{default:s(()=>{var r,n;return[f(_((n=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:n.bizNo),1)]}),_:1},8,["label"]),e(m,{label:t(a)("page.retry.idempotentId"),span:2},{default:s(()=>{var r,n;return[f(_((n=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:n.idempotentId),1)]}),_:1},8,["label"]),e(m,{label:t(a)("page.retry.executorName"),span:2},{default:s(()=>{var r,n;return[f(_((n=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:n.executorName),1)]}),_:1},8,["label"]),e(m,{label:t(a)("page.retry.argsStr"),span:2},{default:s(()=>{var r,n;return[f(_((n=(r=u.rowData)==null?void 0:r.responseVO)==null?void 0:n.argsStr),1)]}),_:1},8,["label"]),e(m,{label:t(a)("common.createDt")},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.createDt),1)]}),_:1},8,["label"]),e(m,{label:t(a)("common.updateDt")},{default:s(()=>{var r;return[f(_((r=u.rowData)==null?void 0:r.updateDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),e(d,{name:1,tab:t(a)("page.log.title"),"display-directive":"if"},{default:s(()=>[e(g,{drawer:!1,type:"retry","task-data":u.rowData},null,8,["task-data"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Ve=re(Oe,[["__scopeId","data-v-193d8fb3"]]),Pe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function T(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!fe(p)}const He=B({name:"retry_task",__name:"index",setup(p){const v=ne(),u=le(),{bool:i,setTrue:m}=se(!1),h=history.state.retryId,{columns:N,columnChecks:d,data:g,getData:b,loading:D,mobilePagination:r,searchParams:n,resetSearchParams:R}=ge({apiFn:Ne,apiParams:{page:1,size:10,groupName:null,sceneName:null,taskStatus:null,datetimeRange:oe()},searchParams:{retryId:h},columns:()=>[{type:"selection",align:"center",width:48,disabled:l=>l.taskStatus===1},{key:"id",align:"center",width:120,fixed:"left",title:()=>e("div",{class:"flex-center"},[e("span",null,[a("page.jobBatch.jobTask.id")]),e(pe,{trigger:"hover"},{trigger:()=>e("span",{class:"mb-2px ml-5px text-16px"},[e(de,{icon:"ant-design:info-circle-outlined"},null)]),default:()=>e("span",null,[a("common.idDetailTip")])})]),render:l=>{async function o(){await A(l),m()}return e(I,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[l.id]})}},{key:"groupName",title:a("page.retryTask.groupName"),align:"center",minWidth:120},{key:"sceneName",title:a("page.retryTask.sceneName"),align:"center",minWidth:120},{key:"retryId",title:a("page.retryTask.retryId"),align:"center",minWidth:120},{key:"taskType",title:a("page.retryTask.taskType"),align:"center",minWidth:80,render:l=>{if(l.taskType===null)return null;const o=a(M[l.taskType]);return e($,{type:S(l.taskType)},T(o)?o:{default:()=>[o]})}},{key:"taskStatus",title:a("page.retryTask.taskStatus"),align:"center",minWidth:80,render:l=>{if(l.taskStatus===null)return null;const o={1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"},c=a(W[l.taskStatus]);return e($,{type:o[l.taskStatus]},T(c)?c:{default:()=>[c]})}},{key:"operationReason",title:a("page.retryTask.operationReason"),align:"center",width:240,render:l=>{if(l.operationReason===null)return null;const o=a(me[l.operationReason]);return e($,{type:S(l.operationReason)},T(o)?o:{default:()=>[o]})}},{key:"createDt",title:a("page.retryTask.createDt"),align:"center",minWidth:120},{key:"updateDt",title:a("page.retryTask.updateDt"),align:"center",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",width:80,render:l=>e("div",{class:"flex-center gap-8px"},[l.taskStatus===1||l.taskStatus===2?e(ce,null,[e(P,{vertical:!0},null),e(V,{onPositiveClick:()=>G(l.id)},{default:()=>a("common.confirmStop"),trigger:()=>{let c;return e(I,{type:"error",text:!0,ghost:!0,size:"small"},T(c=a("common.stop"))?c:{default:()=>[c]})}}),e(P,{vertical:!0},null)]):null,l.taskStatus!==1&&l.taskStatus!==2?e(V,{onPositiveClick:()=>q(l.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let c;return e(I,{type:"error",text:!0,ghost:!0,size:"small"},T(c=a("common.delete"))?c:{default:()=>[c]})}}):""])}]}),{checkedRowKeys:k,onDeleted:j,onBatchDeleted:L}=ye(g,b);async function F(){const{error:l}=await $e(k.value);l||L()}async function q(l){const{error:o}=await xe(l);o||j()}async function A(l){const o=await Re(l.id);u.value=o.data||null}async function G(l){var c;const{error:o}=await Ie(l);o||((c=window.$message)==null||c.success(a("common.operateSuccess")),b())}return(l,o)=>{const c=Z,K=we,E=ie;return O(),ue("div",Pe,[e(Be,{model:t(n),"onUpdate:model":o[0]||(o[0]=y=>x(n)?n.value=y:null),onReset:t(R),onSearch:t(b)},null,8,["model","onReset","onSearch"]),e(E,{title:t(a)("page.retryTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[e(c,{columns:t(d),"onUpdate:columns":o[1]||(o[1]=y=>x(d)?d.value=y:null),"disabled-delete":t(k).length===0,loading:t(D),"show-add":!1,onDelete:F,onRefresh:t(b)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:s(()=>[e(K,{"checked-row-keys":t(k),"onUpdate:checkedRowKeys":o[2]||(o[2]=y=>x(k)?k.value=y:null),columns:t(N),data:t(g),"flex-height":!t(v).isMobile,"scroll-x":962,loading:t(D),remote:"","row-key":y=>y.id,pagination:t(r),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(Ve,{visible:t(i),"onUpdate:visible":o[3]||(o[3]=y=>x(i)?i.value=y:null),"row-data":u.value},null,8,["visible","row-data"])])}}});export{He as default};
