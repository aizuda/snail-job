import{a as te,N as j,b as oe}from"./search-form.vue_vue_type_script_setup_true_lang-CdPsT23q.js";import{d as ae,_ as le,a as ne}from"./download-DDN0upP4.js";import{_ as re}from"./delete-alert-BJeM-2kQ.js";import{d as z,Z as M,a0 as L,o as O,c as V,w as r,f as e,h as t,$ as a,a5 as se,aL as ie,D as ue,ab as ce,p as pe,q as me,g as W,t as F,d4 as fe,d6 as de,E as we,I as ge,B as b,H as _e,aN as ke,l as he,c0 as ye,L as ve,u as xe,r as be,ah as Ne,b as Se,ai as U,aQ as Ce,ad as De,Y as Te,ak as q,aS as We,F as Re,al as $e}from"./index-BlU6DPnP.js";import{n as Ue,o as Be,p as E,q as Ie}from"./workflow-D85MYEv3.js";import{_ as Pe,u as Ae,a as Me}from"./table-u42G8C7W.js";import{_ as Fe}from"./status-switch.vue_vue_type_script_setup_true_lang-BylxuLhJ.js";import{u as ze}from"./auth-Dhm2lx2o.js";import{_ as Oe}from"./select-group.vue_vue_type_script_setup_true_lang-B2TEKDRR.js";import{_ as je}from"./dynamic-input.vue_vue_type_script_setup_true_lang-DwXVKZT0.js";import{b as qe}from"./Grid-Cpsk88_v.js";import"./Progress-C5rNsouW.js";import"./group-XM1tp95e.js";import"./DynamicInput-DvfAGTT6.js";const Ee=z({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:M(["reset","search"],["update:model"]),setup(g,{emit:N}){const c=N,p=L(g,"model");function _(){c("reset")}function u(){c("search")}return(v,d)=>{const h=Pe,x=ue,n=ce,s=te;return O(),V(s,{model:p.value,onSearch:u,onReset:_},{default:r(()=>[e(h,{span:"24 s:12 m:6",label:t(a)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[e(Oe,{value:p.value.groupName,"onUpdate:value":d[0]||(d[0]=i=>p.value.groupName=i),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:t(a)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:r(()=>[e(x,{value:p.value.workflowName,"onUpdate:value":d[1]||(d[1]=i=>p.value.workflowName=i),placeholder:t(a)("page.workflow.form.workflowName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:t(a)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:r(()=>[e(n,{value:p.value.workflowStatus,"onUpdate:value":d[2]||(d[2]=i=>p.value.workflowStatus=i),placeholder:t(a)("page.workflow.form.workflowStatus"),options:t(se)(t(ie)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Le=z({name:"WorkflowTriggerModal",__name:"workflow-trigger-modal",props:M({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:M(["submitted"],["update:visible"]),setup(g,{emit:N}){const c=g,p=N,_=L(g,"visible"),u=pe(v());function v(){var n;return{workflowId:(n=c.rowData)==null?void 0:n.id,tmpWfContext:"",wfContexts:[]}}function d(){const n=c.rowData;if(!n){Object.assign(u,v());return}(n==null?void 0:n.wfContext)&&(u.wfContexts=fe(n==null?void 0:n.wfContext)||[])}function h(){_.value=!1}me(_,()=>{_.value&&d()});async function x(){var i,S;const n=JSON.stringify(de(u.wfContexts)||{}),{error:s}=await Ue({workflowId:(i=c.rowData)==null?void 0:i.id,tmpWfContext:n});s||((S=window.$message)==null||S.success(a("common.executeSuccess")),h(),p("submitted"))}return(n,s)=>{const i=je,S=we,y=ge,R=b,m=_e,I=ke;return O(),V(I,{show:_.value,"onUpdate:show":s[1]||(s[1]=C=>_.value=C),class:"max-w-90% w-600px",preset:"card",title:"执行工作流",bordered:!1},{footer:r(()=>[e(m,{justify:"end",size:16},{default:r(()=>[e(R,{onClick:h},{default:r(()=>[W(F(t(a)("common.cancel")),1)]),_:1}),e(R,{type:"primary",onClick:x},{default:r(()=>s[2]||(s[2]=[W("执行")])),_:1})]),_:1})]),default:r(()=>[e(y,{model:u},{default:r(()=>{var C;return[e(S,{path:"wfContexts",label:"工作流上下文","show-feedback":!((C=u.wfContexts)!=null&&C.length)},{default:r(()=>[e(i,{value:u.wfContexts,"onUpdate:value":s[0]||(s[0]=P=>u.wfContexts=P),path:"wfContexts"},null,8,["value"])]),_:1},8,["show-feedback"])]}),_:1},8,["model"])]),_:1},8,["show"])}}}),Ve=he(Le,[["__scopeId","data-v-6d715661"]]),Ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!$e(g)}const st=z({name:"workflow_task",__name:"index",setup(g){const{hasAuth:N}=ze(),c=ye(),p=ve(),{routerPushByKey:_}=xe(),u=be(),{bool:v,setTrue:d}=Ne(!1),{columns:h,columnChecks:x,data:n,getData:s,loading:i,mobilePagination:S,searchParams:y,resetSearchParams:R}=Ae({apiFn:Be,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:a("common.index"),align:"center",width:120},{key:"workflowName",title:a("page.workflow.workflowName"),align:"left",minWidth:120,render:o=>{function l(){J(o.id)}return e(b,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[o.workflowName]})}},{key:"groupName",title:a("page.workflow.groupName"),align:"left",minWidth:120},{key:"nextTriggerAt",title:a("page.workflow.nextTriggerAt"),align:"left",minWidth:120},{key:"workflowStatus",title:a("page.workflow.workflowStatus"),align:"left",minWidth:120,render:o=>{const l=async(f,D)=>{var w;const{error:T}=await Ie(o.id);T||(o.workflowStatus=f,(w=window.$message)==null||w.success(a("common.updateSuccess"))),D(!T)};return e(Fe,{value:o.workflowStatus,"onUpdate:value":f=>o.workflowStatus=f,onSubmitted:l},null)}},{key:"triggerType",title:a("page.workflow.triggerType"),align:"left",minWidth:120,render:o=>{if(!o.triggerType)return null;const l=a(Ce[o.triggerType]);return e(Te,{type:De(o.triggerType)},B(l)?l:{default:()=>[l]})}},{key:"triggerInterval",title:a("page.workflow.triggerInterval"),align:"left",minWidth:120},{key:"executorTimeout",title:a("page.workflow.executorTimeout"),align:"left",minWidth:120},{key:"updateDt",title:a("page.workflow.updateDt"),align:"left",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",fixed:"right",width:200,render:o=>{let l,f;const D=[{label:a("common.copy"),key:"copy",click:()=>Q(o.id)},{type:"divider",key:"d2"},{label:a("common.batchList"),key:"batchList",click:()=>ee(o.id)},{type:"divider",key:"d2"},{type:"render",key:"delete",render:()=>e("div",{class:"flex-center"},[e(j,{onPositiveClick:()=>K(o.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let w;return e(b,{quaternary:!0,size:"small"},B(w=a("common.delete"))?w:{default:()=>[w]})}})])}],T=w=>{const $=D.filter(A=>A.key===w)[0].click;$&&$()};return e("div",{class:"flex-center gap-8px"},[e(b,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>G(o.id)},B(l=a("common.edit"))?l:{default:()=>[l]}),e(q,{vertical:!0},null),e(b,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>Y(o)},B(f=a("common.execute"))?f:{default:()=>[f]}),e(q,{vertical:!0},null),e(We,{trigger:"click","show-arrow":!1,options:D,size:"small","on-select":T},{default:()=>e(b,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[W("更多")]})})])}}]}),{checkedRowKeys:m,onBatchDeleted:I,onDeleted:C}=Me(n,s);async function P(){const{error:o}=await E(m.value);o||I()}async function K(o){const{error:l}=await E([o]);l||C()}function G(o){c.push({path:"/workflow/form/edit",query:{id:o}})}function H(){c.push({path:"/workflow/form/add"})}function J(o){c.push({path:"/workflow/form/detail",query:{id:o}})}function Q(o){c.push({path:"/workflow/form/copy",query:{id:o}})}async function Y(o){u.value=o,d()}function Z(){return{workflowIds:m.value,groupName:y.groupName,workflowName:y.workflowName,workflowStatus:y.workflowStatus}}function X(){ae("/workflow/export",Z(),a("page.workflow.title"))}function ee(o){const l=n.value.find(f=>f.id===o);_("workflow_batch",{state:{workflowId:o,workflowName:l.workflowName}})}return(o,l)=>{const f=re,D=le,T=ne,w=oe,$=qe,A=Re;return O(),Se("div",Ke,[e(Ee,{model:t(y),"onUpdate:model":l[0]||(l[0]=k=>U(y)?y.value=k:null),onReset:t(R),onSearch:t(s)},null,8,["model","onReset","onSearch"]),e(f),e(A,{title:t(a)("page.workflow.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":r(()=>[e(w,{columns:t(x),"onUpdate:columns":l[1]||(l[1]=k=>U(x)?x.value=k:null),"disabled-delete":t(m).length===0,loading:t(i),"show-delete":t(N)("R_ADMIN"),onAdd:H,onDelete:P,onRefresh:t(s)},{addAfter:r(()=>[e(D,{action:"/workflow/import",accept:"application/json",onRefresh:t(s)},null,8,["onRefresh"]),e(t(j),{onPositiveClick:X},{trigger:r(()=>[e(t(b),{size:"small",ghost:"",type:"primary",disabled:t(m).length===0&&t(N)("R_USER")},{icon:r(()=>[e(T,{class:"text-icon"})]),default:r(()=>[W(" "+F(t(a)("common.export")),1)]),_:1},8,["disabled"])]),default:r(()=>[W(F(t(m).length===0?t(a)("common.exportAll"):t(a)("common.exportPar",{num:t(m).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-delete","onRefresh"])]),default:r(()=>[e($,{"checked-row-keys":t(m),"onUpdate:checkedRowKeys":l[2]||(l[2]=k=>U(m)?m.value=k:null),columns:t(h),data:t(n),"flex-height":!t(p).isMobile,"scroll-x":1300,loading:t(i),remote:"","row-key":k=>k.id,pagination:t(S),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(Ve,{visible:t(v),"onUpdate:visible":l[3]||(l[3]=k=>U(v)?v.value=k:null),"row-data":u.value},null,8,["visible","row-data"])])}}});export{st as default};
