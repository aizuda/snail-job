import{_ as de,a as ce,N as X,b as ge}from"./search-form.vue_vue_type_script_setup_true_lang-COAGZUvR.js";import{d as me,_ as _e,a as fe}from"./download-BT7sMEry.js";import{_ as be}from"./delete-alert-ZqadWz1U.js";import{d as j,Z as B,a0 as Z,a1 as ve,z as he,A as Se,a as ye,$ as o,r as te,p as Ce,q as we,o as w,c as G,w as a,f as t,g as N,t as R,h as e,b as J,a2 as ee,a3 as oe,a4 as K,a5 as Ne,D as ae,E as ke,H as De,B as V,a6 as xe,a7 as Re,I as $e,a8 as ne,a9 as Y,aa as Te,ab as le,Y as re,ac as Ue,ad as Ge,L as Me,ae as Pe,af as O,ag as Ae,ah as Oe,F as Ve,ai as Ie}from"./index-BHXExu3l.js";import{f as Fe,a as Be,b as je,c as Ee,d as ze,e as Le}from"./group-DJY3eSqv.js";import{_ as qe,u as We,a as He}from"./table-CRwvR2hs.js";import{_ as Je}from"./status-switch.vue_vue_type_script_setup_true_lang-D49r-Opf.js";import{u as Ke}from"./auth-Co56ehRE.js";import{_ as Ye}from"./round-content-copy-Des0-6a4.js";import{_ as Ze,a as Qe,b as Xe}from"./Grid-2b54xPVx.js";import{_ as et,a as tt}from"./CollapseItem-OABG4pAT.js";import{_ as ot,a as at}from"./DescriptionsItem-Csiqv9T3.js";import"./Progress-CVf5ngyV.js";const nt=j({name:"GroupOperateDrawer",__name:"group-operate-drawer",props:B({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:B(["submitted"],["update:visible"]),setup(S,{emit:v}){const s=S,m=v,c=Z(S,"visible"),{copy:T,isSupported:M}=ve(),{formRef:h,validate:u,restoreValidation:g}=he(),{defaultRequiredRule:k}=Se(),A=ye(()=>({add:o("page.groupConfig.addGroupConfig"),edit:o("page.groupConfig.editGroupConfig")})[s.operateType]),y=te([]),p=Ce(P());function P(){return{groupName:"",token:"SJ_Wyz3dmsdbDOkDujOTSSoBjGQP1BMsVnj",groupStatus:1,description:"",idGeneratorMode:2,initScene:1,groupPartition:0}}const E={groupName:[{required:!0,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:o("page.groupConfig.form.groupNameRule")}],token:[k],groupStatus:[k],idGeneratorMode:[k],initScene:[k],groupPartition:[k]};function z(){if(s.operateType==="add"){Object.assign(p,P());return}s.operateType==="edit"&&s.rowData&&Object.assign(p,s.rowData)}function I(){c.value=!1}async function F(){var _,r;if(await u(),s.operateType==="add"){const{groupName:l,token:n,groupStatus:d,description:C,idGeneratorMode:D,initScene:x,groupPartition:f}=p,{error:U}=await Fe({groupName:l,token:n,groupStatus:d,description:C,idGeneratorMode:D,initScene:x,groupPartition:f});if(U)return;(_=window.$message)==null||_.success(o("common.addSuccess"))}else{const{groupName:l,token:n,groupStatus:d,description:C,idGeneratorMode:D,initScene:x,groupPartition:f}=p,{error:U}=await Be({groupName:l,token:n,groupStatus:d,description:C,idGeneratorMode:D,initScene:x,groupPartition:f});if(U)return;(r=window.$message)==null||r.success(o("common.updateSuccess"))}I(),m("submitted")}function $(){p.token=L(32)}function L(_){const r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let l="SJ_";for(let n=0;n<_;n+=1){const d=Math.floor(Math.random()*r.length);l+=r.substring(d,d+1)}return l}const q=async()=>{const{data:_}=await je();y.value=_.map(r=>String(r))};we(c,()=>{c.value&&(q(),z(),g())});async function W(_){var r,l;if(!M){(r=window.$message)==null||r.error("您的浏览器不支持 Clipboard API");return}_&&(await T(_),(l=window.$message)==null||l.success("复制成功"))}return(_,r)=>{const l=ae,n=ke,d=Qe,C=De,D=Ze,x=Ye,f=V,U=xe,b=de,ue=Re,Q=et,se=tt,ie=$e,pe=ne;return w(),G(pe,{modelValue:c.value,"onUpdate:modelValue":r[6]||(r[6]=i=>c.value=i),title:A.value,onSubmitted:F},{footer:a(()=>[t(C,{size:16},{default:a(()=>[t(f,{onClick:I},{default:a(()=>[N(R(e(o)("common.cancel")),1)]),_:1}),t(f,{type:"primary",onClick:F},{default:a(()=>[N(R(e(o)("common.save")),1)]),_:1})]),_:1})]),default:a(()=>[t(ie,{ref_key:"formRef",ref:h,model:p,rules:E},{default:a(()=>[t(se,{"default-expanded-names":["1","2"]},{default:a(()=>[t(Q,{title:e(o)("page.groupConfig.commonConfig"),name:"1"},{default:a(()=>[t(n,{label:e(o)("page.groupConfig.groupName"),path:"groupName"},{default:a(()=>[t(l,{value:p.groupName,"onUpdate:value":r[0]||(r[0]=i=>p.groupName=i),maxlength:64,"show-count":"",placeholder:e(o)("page.groupConfig.form.groupName"),disabled:s.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),t(n,{label:e(o)("page.groupConfig.groupStatus"),path:"groupStatus"},{default:a(()=>[t(D,{value:p.groupStatus,"onUpdate:value":r[1]||(r[1]=i=>p.groupStatus=i),name:"groupStatus"},{default:a(()=>[t(C,null,{default:a(()=>[(w(!0),J(K,null,ee(e(oe),i=>(w(),G(d,{key:i.value,value:i.value,label:e(o)(i.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(n,{label:e(o)("page.groupConfig.token"),path:"token"},{default:a(()=>[t(ue,null,{default:a(()=>[t(l,{value:p.token,"onUpdate:value":r[2]||(r[2]=i=>p.token=i),maxlength:64,placeholder:e(o)("page.groupConfig.form.token"),disabled:s.operateType==="edit"},null,8,["value","placeholder","disabled"]),s.operateType==="edit"?(w(),G(U,{key:0,trigger:"hover"},{trigger:a(()=>[t(f,{type:"default",ghost:"",onClick:r[3]||(r[3]=i=>W(p.token))},{default:a(()=>[t(x,{class:"text-icon"})]),_:1})]),default:a(()=>[r[7]||(r[7]=N(" 复制 "))]),_:1})):(w(),G(U,{key:1,trigger:"hover"},{trigger:a(()=>[t(f,{type:"default",ghost:"",onClick:$},{default:a(()=>[t(b,{class:"text-icon"})]),_:1})]),default:a(()=>[N(" "+R(e(o)("page.groupConfig.generateToken")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),t(n,{label:e(o)("page.groupConfig.description"),path:"description"},{default:a(()=>[t(l,{value:p.description,"onUpdate:value":r[4]||(r[4]=i=>p.description=i),type:"textarea",maxlength:256,"show-count":"",placeholder:e(o)("page.groupConfig.form.description"),clearable:"",round:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),t(Q,{title:e(o)("page.groupConfig.retryConfig"),name:"2"},{default:a(()=>[t(n,{label:e(o)("page.groupConfig.initScene"),path:"initScene"},{default:a(()=>[t(D,{value:p.initScene,"onUpdate:value":r[5]||(r[5]=i=>p.initScene=i),name:"initScene"},{default:a(()=>[t(C,null,{default:a(()=>[(w(!0),J(K,null,ee(e(Ne),i=>(w(),G(d,{key:i.value,value:i.value,label:e(o)(i.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),lt=j({name:"GroupDetailDrawer",__name:"group-detail-drawer",props:B({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const v=Z(S,"visible");return(s,m)=>{const c=ot,T=re,M=at,h=ne;return w(),G(h,{modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=u=>v.value=u),title:e(o)("page.groupConfig.detail")},{default:a(()=>[t(M,{"label-placement":"top",bordered:"",column:1},{default:a(()=>[t(c,{label:e(o)("page.groupConfig.groupName"),span:1},{default:a(()=>{var u;return[N(R((u=s.rowData)==null?void 0:u.groupName),1)]}),_:1},8,["label"]),t(c,{label:e(o)("page.groupConfig.token"),span:1},{default:a(()=>{var u;return[N(R((u=s.rowData)==null?void 0:u.token),1)]}),_:1},8,["label"]),t(c,{label:e(o)("page.groupConfig.groupStatus"),span:1},{default:a(()=>{var u;return[t(T,{type:e(Y)((u=s.rowData)==null?void 0:u.groupStatus)},{default:a(()=>{var g;return[N(R(e(o)(e(Te)[(g=s.rowData)==null?void 0:g.groupStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(c,{label:e(o)("page.groupConfig.initScene"),span:1},{default:a(()=>{var u;return[t(T,{type:e(Y)((u=s.rowData)==null?void 0:u.initScene)},{default:a(()=>{var g;return[N(R(e(o)(e(le)[(g=s.rowData)==null?void 0:g.initScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(c,{label:e(o)("page.groupConfig.description"),span:1},{default:a(()=>{var u;return[N(R((u=s.rowData)==null?void 0:u.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),rt=j({name:"GroupSearch",__name:"group-search",props:{model:{required:!0},modelModifiers:{}},emits:B(["reset","search"],["update:model"]),setup(S,{emit:v}){const s=v,m=Z(S,"model");function c(){s("reset")}function T(){s("search")}return(M,h)=>{const u=ae,g=qe,k=Ge,A=ce;return w(),G(A,{model:m.value,onSearch:T,onReset:c},{default:a(()=>[t(g,{span:"24 s:12 m:6",label:e(o)("page.groupConfig.groupName"),path:"groupName",class:"pr-24px"},{default:a(()=>[t(u,{value:m.value.groupName,"onUpdate:value":h[0]||(h[0]=y=>m.value.groupName=y),placeholder:e(o)("page.groupConfig.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(g,{span:"24 s:12 m:6",label:e(o)("page.groupConfig.groupStatus"),path:"groupStatus",class:"pr-24px"},{default:a(()=>[t(k,{value:m.value.groupStatus,"onUpdate:value":h[1]||(h[1]=y=>m.value.groupStatus=y),placeholder:e(o)("page.groupConfig.form.groupStatus"),options:e(Ue)(e(oe)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ut={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function H(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!Ie(S)}const yt=j({name:"group",__name:"index",setup(S){const{hasAuth:v}=Ke(),s=Me(),m=te(),{bool:c,setTrue:T}=Pe(!1),{columns:M,columnChecks:h,data:u,getData:g,loading:k,mobilePagination:A,searchParams:y,resetSearchParams:p}=We({apiFn:Ee,apiParams:{page:1,size:10,groupName:null,groupStatus:null},columns:()=>[{key:"id",title:o("common.index"),align:"center",width:64},{key:"groupName",title:o("page.groupConfig.groupName"),align:"center",minWidth:100,render:l=>{function n(){m.value=l||null,T()}return t(V,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[l.groupName]})}},{key:"groupStatus",title:o("page.groupConfig.groupStatus"),align:"center",width:120,render:l=>{const n=async(d,C)=>{var f;const D=l.groupStatus===1?0:1,{error:x}=await Le({groupName:l.groupName,groupStatus:D});x||(l.groupStatus=d,(f=window.$message)==null||f.success(o("common.updateSuccess"))),C(!x)};return t(Je,{value:l.groupStatus,"onUpdate:value":d=>l.groupStatus=d,onSubmitted:n,disabled:v("R_USER")},null)}},{key:"initScene",title:o("page.groupConfig.initScene"),align:"center",minWidth:120,render:l=>{if(l.groupStatus===null)return null;const n=o(le[l.initScene]);return t(re,{type:Y(l.initScene)},H(n)?n:{default:()=>[n]})}},{key:"updateDt",title:o("page.groupConfig.updateDt"),align:"center",width:120},{key:"description",title:o("page.groupConfig.description"),align:"center",width:250},{key:"operate",title:o("common.operate"),align:"center",width:120,render:l=>{let n;return v("R_USER")?t(K,null,null):t("div",{class:"flex-center gap-8px"},[t(V,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>q(l.id)},H(n=o("common.edit"))?n:{default:()=>[n]}),t(Oe,{vertical:!0},null),t(X,{onPositiveClick:()=>W(l.groupName)},{default:()=>o("common.confirmDelete"),trigger:()=>{let d;return t(V,{type:"error",text:!0,ghost:!0,size:"small"},H(d=o("common.delete"))?d:{default:()=>[d]})}})])}}]}),{drawerVisible:P,operateType:E,editingData:z,handleAdd:I,handleEdit:F,checkedRowKeys:$,onDeleted:L}=He(u,g);function q(l){F(l)}async function W(l){const{error:n}=await ze(l);n||L()}function _(){return{groupName:y.groupName,groupStatus:y.groupStatus,groupIds:$.value}}function r(){me("/group/export",_(),o("page.groupConfig.title"))}return(l,n)=>{const d=be,C=_e,D=fe,x=ge,f=Xe,U=Ve;return w(),J("div",ut,[t(rt,{model:e(y),"onUpdate:model":n[0]||(n[0]=b=>O(y)?y.value=b:null),onReset:e(p),onSearch:e(g)},null,8,["model","onReset","onSearch"]),t(d),t(U,{title:e(o)("page.groupConfig.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[t(x,{columns:e(h),"onUpdate:columns":n[1]||(n[1]=b=>O(h)?h.value=b:null),loading:e(k),"show-add":e(v)("R_ADMIN"),"show-delete":!1,onAdd:e(I),onRefresh:e(g)},{addAfter:a(()=>[e(v)("R_ADMIN")?(w(),G(C,{key:0,action:"/group/import",accept:"application/json",onRefresh:e(g)},null,8,["onRefresh"])):Ae("",!0),t(e(X),{onPositiveClick:r},{trigger:a(()=>[t(e(V),{size:"small",ghost:"",type:"primary",disabled:e($).length===0&&e(v)("R_USER")},{icon:a(()=>[t(D,{class:"text-icon"})]),default:a(()=>[N(" "+R(e(o)("common.export")),1)]),_:1},8,["disabled"])]),default:a(()=>[N(R(e($).length===0?e(o)("common.exportAll"):e(o)("common.exportPar",{num:e($).length})),1)]),_:1})]),_:1},8,["columns","loading","show-add","onAdd","onRefresh"])]),default:a(()=>[t(f,{"checked-row-keys":e($),"onUpdate:checkedRowKeys":n[2]||(n[2]=b=>O($)?$.value=b:null),columns:e(M),data:e(u),"flex-height":!e(s).isMobile,"scroll-x":962,loading:e(k),remote:"","row-key":b=>b.id,pagination:e(A),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(nt,{visible:e(P),"onUpdate:visible":n[3]||(n[3]=b=>O(P)?P.value=b:null),"operate-type":e(E),"row-data":e(z),onSubmitted:e(g)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(lt,{visible:e(c),"onUpdate:visible":n[4]||(n[4]=b=>O(c)?c.value=b:null),"row-data":m.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{yt as default};
