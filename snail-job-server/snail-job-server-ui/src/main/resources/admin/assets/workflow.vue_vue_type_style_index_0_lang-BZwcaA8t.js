import{b8 as se,bt as le,d as P,b9 as lt,cA as at,r as k,a as oe,i as Ne,bB as xt,am as J,cB as $t,q as W,aq as re,bd as He,bs as K,cC as St,cD as Vt,by as Bt,cE as Ct,cF as Tt,b3 as Dt,c0 as Ke,bc as st,cG as Lt,cH as Ut,bz as Rt,bf as Mt,cI as It,O as jt,bL as Et,ct as zt,cJ as At,aV as ne,o as p,b as D,e as g,cu as _e,v as ce,a4 as Q,a2 as ae,x as be,s as de,l as pe,cK as Ht,cL as Yt,c as M,w as l,g as V,t as S,f as n,D as qe,B as ie,cM as Ce,h as v,cN as Ot,cO as Xe,ab as Te,E as De,H as Le,I as Ue,cP as Re,cQ as Me,$ as U,cR as it,cS as dt,Z as qt,a0 as Xt,cT as rt,cU as Wt,aj as T,aw as Pt,aM as ke,Y as Ve,cV as G,cW as Qe,cX as et,cY as tt,av as ut,ax as Ft,G as We,cZ as Gt,ak as ct,_ as Ie,a9 as xe,c_ as Jt,c$ as pt,d0 as Zt,d1 as Ye,d2 as Kt,aQ as Qt,aR as mt,d3 as eo,d4 as to,aH as oo,d5 as no,aK as lo}from"./index-Dlhm-fK8.js";import{H as ao,j as so,e as io,_ as ro,g as ft}from"./job-task-list-table.vue_vue_type_script_setup_true_lang-BA4EgQea.js";import{j as uo,k as co,l as po,m as mo}from"./workflow-hI8_w2jc.js";import{h as fo,i as vo}from"./job-DaTjC9FR.js";import{_ as je,a as Ee,h as ho,d as go,c as bo}from"./Grid-3R-51InK.js";import{_ as $e}from"./detail-drawer-CZtUR7gy.js";import{_ as we,a as ye}from"./DescriptionsItem-g_tZg_fN.js";import{_ as _o}from"./log-drawer-DUe5um4t.js";import{_ as vt}from"./dynamic-input.vue_vue_type_script_setup_true_lang-DrSeVbM9.js";import{_ as wo,s as yo,j as ko,o as No}from"./code-mirror.vue_vue_type_script_setup_true_lang-CVcHTA2j.js";import{_ as xo}from"./cron-input.vue_vue_type_style_index_0_lang-DJqzXQwn.js";import{f as $o}from"./notify-CzjhdH-_.js";import{g as So}from"./group-CP2HSNrU.js";function Vo(e){return typeof e=="string"?document.querySelector(e):typeof e=="function"?e():e}function Bo(e){return e instanceof HTMLElement?e.scrollTop:window.scrollY}function Co(e){return e instanceof HTMLElement?e.getBoundingClientRect():{top:0,bottom:window.innerHeight}}const To=se("affix",[le("affixed",{position:"fixed"},[le("absolute-positioned",{position:"absolute"})])]),Do={listenTo:[String,Object,Function],top:Number,bottom:Number,triggerTop:Number,triggerBottom:Number,position:{type:String,default:"fixed"},offsetTop:{type:Number,validator:()=>!0,default:void 0},offsetBottom:{type:Number,validator:()=>!0,default:void 0},target:{type:Function,validator:()=>!0,default:void 0}},Lo=P({name:"Affix",props:Do,setup(e){const{mergedClsPrefixRef:a}=lt(e);at("-affix",To,a);let i=null;const f=k(!1),s=k(!1),t=k(null),o=k(null),b=oe(()=>s.value||f.value),u=oe(()=>{var B,y;return(y=(B=e.triggerTop)!==null&&B!==void 0?B:e.offsetTop)!==null&&y!==void 0?y:e.top}),r=oe(()=>{var B,y;return(y=(B=e.top)!==null&&B!==void 0?B:e.triggerTop)!==null&&y!==void 0?y:e.offsetTop}),d=oe(()=>{var B,y;return(y=(B=e.bottom)!==null&&B!==void 0?B:e.triggerBottom)!==null&&y!==void 0?y:e.offsetBottom}),c=oe(()=>{var B,y;return(y=(B=e.triggerBottom)!==null&&B!==void 0?B:e.offsetBottom)!==null&&y!==void 0?y:e.bottom}),x=k(null),_=()=>{const{target:B,listenTo:y}=e;B?i=B():y?i=Vo(y):i=document,i&&(i.addEventListener("scroll",m),m())};function m(){$t(E)}function E(){const{value:B}=x;if(!i||!B)return;const y=Bo(i);if(b.value){o.value!==null&&y<o.value&&(f.value=!1,o.value=null),t.value!==null&&y>t.value&&(s.value=!1,t.value=null);return}const C=Co(i),I=B.getBoundingClientRect(),R=I.top-C.top,Y=C.bottom-I.bottom,h=u.value,$=c.value;h!==void 0&&R<=h?(f.value=!0,o.value=y-(h-R)):(f.value=!1,o.value=null),$!==void 0&&Y<=$?(s.value=!0,t.value=y+$-Y):(s.value=!1,t.value=null)}return Ne(()=>{_()}),xt(()=>{i&&i.removeEventListener("scroll",m)}),{selfRef:x,affixed:b,mergedClsPrefix:a,mergedstyle:oe(()=>{const B={};return f.value&&u.value!==void 0&&r.value!==void 0&&(B.top=`${r.value}px`),s.value&&c.value!==void 0&&d.value!==void 0&&(B.bottom=`${d.value}px`),B})}},render(){const{mergedClsPrefix:e}=this;return J("div",{ref:"selfRef",class:[`${e}-affix`,{[`${e}-affix--affixed`]:this.affixed,[`${e}-affix--absolute-positioned`]:this.position==="absolute"}],style:this.mergedstyle},this.$slots)}}),ot=P({name:"SlotMachineNumber",props:{clsPrefix:{type:String,required:!0},value:{type:[Number,String],required:!0},oldOriginalNumber:{type:Number,default:void 0},newOriginalNumber:{type:Number,default:void 0}},setup(e){const a=k(null),i=k(e.value),f=k(e.value),s=k("up"),t=k(!1),o=oe(()=>t.value?`${e.clsPrefix}-base-slot-machine-current-number--${s.value}-scroll`:null),b=oe(()=>t.value?`${e.clsPrefix}-base-slot-machine-old-number--${s.value}-scroll`:null);W(He(e,"value"),(d,c)=>{i.value=c,f.value=d,re(u)});function u(){const d=e.newOriginalNumber,c=e.oldOriginalNumber;c===void 0||d===void 0||(d>c?r("up"):c>d&&r("down"))}function r(d){s.value=d,t.value=!1,re(()=>{var c;(c=a.value)===null||c===void 0||c.offsetWidth,t.value=!0})}return()=>{const{clsPrefix:d}=e;return J("span",{ref:a,class:`${d}-base-slot-machine-number`},i.value!==null?J("span",{class:[`${d}-base-slot-machine-old-number ${d}-base-slot-machine-old-number--top`,b.value]},i.value):null,J("span",{class:[`${d}-base-slot-machine-current-number`,o.value]},J("span",{ref:"numberWrapper",class:[`${d}-base-slot-machine-current-number__inner`,typeof e.value!="number"&&`${d}-base-slot-machine-current-number__inner--not-number`]},f.value)),i.value!==null?J("span",{class:[`${d}-base-slot-machine-old-number ${d}-base-slot-machine-old-number--bottom`,b.value]},i.value):null)}}}),{cubicBezierEaseOut:ge}=St;function Uo({duration:e=".2s"}={}){return[K("&.fade-up-width-expand-transition-leave-active",{transition:`
 opacity ${e} ${ge},
 max-width ${e} ${ge},
 transform ${e} ${ge}
 `}),K("&.fade-up-width-expand-transition-enter-active",{transition:`
 opacity ${e} ${ge},
 max-width ${e} ${ge},
 transform ${e} ${ge}
 `}),K("&.fade-up-width-expand-transition-enter-to",{opacity:1,transform:"translateX(0) translateY(0)"}),K("&.fade-up-width-expand-transition-enter-from",{maxWidth:"0 !important",opacity:0,transform:"translateY(60%)"}),K("&.fade-up-width-expand-transition-leave-from",{opacity:1,transform:"translateY(0)"}),K("&.fade-up-width-expand-transition-leave-to",{maxWidth:"0 !important",opacity:0,transform:"translateY(60%)"})]}const Ro=K([K("@keyframes n-base-slot-machine-fade-up-in",`
 from {
 transform: translateY(60%);
 opacity: 0;
 }
 to {
 transform: translateY(0);
 opacity: 1;
 }
 `),K("@keyframes n-base-slot-machine-fade-down-in",`
 from {
 transform: translateY(-60%);
 opacity: 0;
 }
 to {
 transform: translateY(0);
 opacity: 1;
 }
 `),K("@keyframes n-base-slot-machine-fade-up-out",`
 from {
 transform: translateY(0%);
 opacity: 1;
 }
 to {
 transform: translateY(-60%);
 opacity: 0;
 }
 `),K("@keyframes n-base-slot-machine-fade-down-out",`
 from {
 transform: translateY(0%);
 opacity: 1;
 }
 to {
 transform: translateY(60%);
 opacity: 0;
 }
 `),se("base-slot-machine",`
 overflow: hidden;
 white-space: nowrap;
 display: inline-block;
 height: 18px;
 line-height: 18px;
 `,[se("base-slot-machine-number",`
 display: inline-block;
 position: relative;
 height: 18px;
 width: .6em;
 max-width: .6em;
 `,[Uo({duration:".2s"}),Vt({duration:".2s",delay:"0s"}),se("base-slot-machine-old-number",`
 display: inline-block;
 opacity: 0;
 position: absolute;
 left: 0;
 right: 0;
 `,[le("top",{transform:"translateY(-100%)"}),le("bottom",{transform:"translateY(100%)"}),le("down-scroll",{animation:"n-base-slot-machine-fade-down-out .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1}),le("up-scroll",{animation:"n-base-slot-machine-fade-up-out .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1})]),se("base-slot-machine-current-number",`
 display: inline-block;
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 1;
 transform: translateY(0);
 width: .6em;
 `,[le("down-scroll",{animation:"n-base-slot-machine-fade-down-in .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1}),le("up-scroll",{animation:"n-base-slot-machine-fade-up-in .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1}),Bt("inner",`
 display: inline-block;
 position: absolute;
 right: 0;
 top: 0;
 width: .6em;
 `,[le("not-number",`
 right: unset;
 left: 0;
 `)])])])])]),Mo=P({name:"BaseSlotMachine",props:{clsPrefix:{type:String,required:!0},value:{type:[Number,String],default:0},max:{type:Number,default:void 0},appeared:{type:Boolean,required:!0}},setup(e){at("-base-slot-machine",Ro,He(e,"clsPrefix"));const a=k(),i=k(),f=oe(()=>{if(typeof e.value=="string")return[];if(e.value<1)return[0];const s=[];let t=e.value;for(e.max!==void 0&&(t=Math.min(e.max,t));t>=1;)s.push(t%10),t/=10,t=Math.floor(t);return s.reverse(),s});return W(He(e,"value"),(s,t)=>{typeof s=="string"?(i.value=void 0,a.value=void 0):typeof t=="string"?(i.value=s,a.value=void 0):(i.value=s,a.value=t)}),()=>{const{value:s,clsPrefix:t}=e;return typeof s=="number"?J("span",{class:`${t}-base-slot-machine`},J(Tt,{name:"fade-up-width-expand-transition",tag:"span"},{default:()=>f.value.map((o,b)=>J(ot,{clsPrefix:t,key:f.value.length-b-1,oldOriginalNumber:a.value,newOriginalNumber:i.value,value:o}))}),J(Ct,{key:"+",width:!0},{default:()=>e.max!==void 0&&e.max<s?J(ot,{clsPrefix:t,value:"+"}):null})):J("span",{class:`${t}-base-slot-machine`},s)}}});function Io(e){const{errorColor:a,infoColor:i,successColor:f,warningColor:s,fontFamily:t}=e;return{color:a,colorInfo:i,colorSuccess:f,colorError:a,colorWarning:s,fontSize:"12px",fontFamily:t}}const jo={name:"Badge",common:Dt,self:Io},Eo=K([K("@keyframes badge-wave-spread",{from:{boxShadow:"0 0 0.5px 0px var(--n-ripple-color)",opacity:.6},to:{boxShadow:"0 0 0.5px 4.5px var(--n-ripple-color)",opacity:0}}),se("badge",`
 display: inline-flex;
 position: relative;
 vertical-align: middle;
 font-family: var(--n-font-family);
 `,[le("as-is",[se("badge-sup",{position:"static",transform:"translateX(0)"},[Ke({transformOrigin:"left bottom",originalTransform:"translateX(0)"})])]),le("dot",[se("badge-sup",`
 height: 8px;
 width: 8px;
 padding: 0;
 min-width: 8px;
 left: 100%;
 bottom: calc(100% - 4px);
 `,[K("::before","border-radius: 4px;")])]),se("badge-sup",`
 background: var(--n-color);
 transition:
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 color: #FFF;
 position: absolute;
 height: 18px;
 line-height: 18px;
 border-radius: 9px;
 padding: 0 6px;
 text-align: center;
 font-size: var(--n-font-size);
 transform: translateX(-50%);
 left: 100%;
 bottom: calc(100% - 9px);
 font-variant-numeric: tabular-nums;
 z-index: 1;
 display: flex;
 align-items: center;
 `,[Ke({transformOrigin:"left bottom",originalTransform:"translateX(-50%)"}),se("base-wave",{zIndex:1,animationDuration:"2s",animationIterationCount:"infinite",animationDelay:"1s",animationTimingFunction:"var(--n-ripple-bezier)",animationName:"badge-wave-spread"}),K("&::before",`
 opacity: 0;
 transform: scale(1);
 border-radius: 9px;
 content: "";
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 `)])])]),zo=Object.assign(Object.assign({},st.props),{value:[String,Number],max:Number,dot:Boolean,type:{type:String,default:"default"},show:{type:Boolean,default:!0},showZero:Boolean,processing:Boolean,color:String,offset:Array}),ze=P({name:"Badge",props:zo,setup(e,{slots:a}){const{mergedClsPrefixRef:i,inlineThemeDisabled:f,mergedRtlRef:s}=lt(e),t=st("Badge","-badge",Eo,jo,e,i),o=k(!1),b=()=>{o.value=!0},u=()=>{o.value=!1},r=oe(()=>e.show&&(e.dot||e.value!==void 0&&!(!e.showZero&&Number(e.value)<=0)||!Lt(a.value)));Ne(()=>{r.value&&(o.value=!0)});const d=Ut("Badge",s,i),c=oe(()=>{const{type:m,color:E}=e,{common:{cubicBezierEaseInOut:B,cubicBezierEaseOut:y},self:{[Rt("color",m)]:C,fontFamily:I,fontSize:R}}=t.value;return{"--n-font-size":R,"--n-font-family":I,"--n-color":E||C,"--n-ripple-color":E||C,"--n-bezier":B,"--n-ripple-bezier":y}}),x=f?Mt("badge",oe(()=>{let m="";const{type:E,color:B}=e;return E&&(m+=E[0]),B&&(m+=It(B)),m}),c,e):void 0,_=oe(()=>{const{offset:m}=e;if(!m)return;const[E,B]=m,y=typeof E=="number"?`${E}px`:E,C=typeof B=="number"?`${B}px`:B;return{transform:`translate(calc(${d!=null&&d.value?"50%":"-50%"} + ${y}), ${C})`}});return{rtlEnabled:d,mergedClsPrefix:i,appeared:o,showBadge:r,handleAfterEnter:b,handleAfterLeave:u,cssVars:f?void 0:c,themeClass:x==null?void 0:x.themeClass,onRender:x==null?void 0:x.onRender,offsetStyle:_}},render(){var e;const{mergedClsPrefix:a,onRender:i,themeClass:f,$slots:s}=this;i==null||i();const t=(e=s.default)===null||e===void 0?void 0:e.call(s);return J("div",{class:[`${a}-badge`,this.rtlEnabled&&`${a}-badge--rtl`,f,{[`${a}-badge--dot`]:this.dot,[`${a}-badge--as-is`]:!t}],style:this.cssVars},t,J(jt,{name:"fade-in-scale-up-transition",onAfterEnter:this.handleAfterEnter,onAfterLeave:this.handleAfterLeave},{default:()=>this.showBadge?J("sup",{class:`${a}-badge-sup`,title:Et(this.value),style:this.offsetStyle},zt(s.value,()=>[this.dot?null:J(Mo,{clsPrefix:a,appeared:this.appeared,max:this.max,value:this.value})]),this.processing?J(At,{clsPrefix:a}):null):null}))}}),Ao={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Ho(e,a){return p(),D("svg",Ao,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8"},null,-1),g("path",{fill:"currentColor",d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8Z"},null,-1)]))}const ht=ne({name:"ant-design-plus-outlined",render:Ho}),Yo={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Oo(e,a){return p(),D("svg",Yo,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8"},null,-1)]))}const qo=ne({name:"ant-design-minus-outlined",render:Oo}),nt={y:{t:"top",m:"marginTop",b:"bottom"},x:{l:"left",m:"marginLeft",r:"right"}};function Xo(e){e.forEach((a,i)=>{document.documentElement.addEventListener(i,a)})}function Wo(e){e.forEach((a,i)=>{document.documentElement.removeEventListener(i,a)})}const Po={name:"vue-drag-resize",emits:["clicked","dragging","dragstop","resizing","resizestop","activated","deactivated"],props:{stickSize:{type:Number,default:8},parentScaleX:{type:Number,default:1},parentScaleY:{type:Number,default:1},isActive:{type:Boolean,default:!1},preventActiveBehavior:{type:Boolean,default:!1},isDraggable:{type:Boolean,default:!0},isResizable:{type:Boolean,default:!0},aspectRatio:{type:Boolean,default:!1},parentLimitation:{type:Boolean,default:!1},snapToGrid:{type:Boolean,default:!1},gridX:{type:Number,default:50,validator(e){return e>=0}},gridY:{type:Number,default:50,validator(e){return e>=0}},parentW:{type:Number,default:0,validator(e){return e>=0}},parentH:{type:Number,default:0,validator(e){return e>=0}},w:{type:[String,Number],default:200,validator(e){return typeof e=="string"?e==="auto":e>=0}},h:{type:[String,Number],default:200,validator(e){return typeof e=="string"?e==="auto":e>=0}},minw:{type:Number,default:50,validator(e){return e>=0}},minh:{type:Number,default:50,validator(e){return e>=0}},x:{type:Number,default:0,validator(e){return typeof e=="number"}},y:{type:Number,default:0,validator(e){return typeof e=="number"}},z:{type:[String,Number],default:"auto",validator(e){return typeof e=="string"?e==="auto":e>=0}},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},sticks:{type:Array,default(){return["tl","tm","tr","mr","br","bm","bl","ml"]}},axis:{type:String,default:"both",validator(e){return["x","y","both","none"].indexOf(e)!==-1}},contentClass:{type:String,required:!1,default:""}},data(){return{fixAspectRatio:null,active:null,zIndex:null,parentWidth:null,parentHeight:null,left:null,top:null,right:null,bottom:null,minHeight:null}},beforeCreate(){this.stickDrag=!1,this.bodyDrag=!1,this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}},this.currentStick=null},mounted(){this.parentElement=this.$el.parentNode,this.parentWidth=this.parentW?this.parentW:this.parentElement.clientWidth,this.parentHeight=this.parentH?this.parentH:this.parentElement.clientHeight,this.left=this.x,this.top=this.y,this.right=this.parentWidth-(this.w==="auto"?this.$refs.container.scrollWidth:this.w)-this.left,this.bottom=this.parentHeight-(this.h==="auto"?this.$refs.container.scrollHeight:this.h)-this.top,this.domEvents=new Map([["mousemove",this.move],["mouseup",this.up],["mouseleave",this.up],["mousedown",this.deselect],["touchmove",this.move],["touchend",this.up],["touchcancel",this.up],["touchstart",this.up]]),Xo(this.domEvents),this.dragHandle&&[...this.$el.querySelectorAll(this.dragHandle)].forEach(e=>{e.setAttribute("data-drag-handle",this._uid)}),this.dragCancel&&[...this.$el.querySelectorAll(this.dragCancel)].forEach(e=>{e.setAttribute("data-drag-cancel",this._uid)})},beforeDestroy(){Wo(this.domEvents)},methods:{deselect(){this.preventActiveBehavior||(this.active=!1)},move(e){if(!this.stickDrag&&!this.bodyDrag)return;e.stopPropagation();const a=typeof e.pageX<"u"?e.pageX:e.touches[0].pageX,i=typeof e.pageY<"u"?e.pageY:e.touches[0].pageY,{dimensionsBeforeMove:f}=this,s={x:(f.pointerX-a)/this.parentScaleX,y:(f.pointerY-i)/this.parentScaleY};if(this.stickDrag&&this.stickMove(s),this.bodyDrag){if(this.axis==="x")s.y=0;else if(this.axis==="y")s.x=0;else if(this.axis==="none")return;this.bodyMove(s)}},up(e){this.stickDrag?this.stickUp(e):this.bodyDrag&&this.bodyUp(e)},bodyDown(e){const{target:a,button:i}=e;if(this.preventActiveBehavior||(this.active=!0),i&&i!==0||(this.$emit("clicked",e),!this.active)||this.dragHandle&&a.getAttribute("data-drag-handle")!==this._uid.toString()||this.dragCancel&&a.getAttribute("data-drag-cancel")===this._uid.toString())return;typeof e.stopPropagation<"u"&&e.stopPropagation(),typeof e.preventDefault<"u"&&e.preventDefault(),this.isDraggable&&(this.bodyDrag=!0);const f=typeof e.pageX<"u"?e.pageX:e.touches[0].pageX,s=typeof e.pageY<"u"?e.pageY:e.touches[0].pageY;this.saveDimensionsBeforeMove({pointerX:f,pointerY:s}),this.parentLimitation&&(this.limits=this.calcDragLimitation())},bodyMove(e){const{dimensionsBeforeMove:a,parentWidth:i,parentHeight:f,gridX:s,gridY:t,width:o,height:b}=this;let u=a.top-e.y,r=a.bottom+e.y,d=a.left-e.x,c=a.right+e.x;if(this.snapToGrid){let x=!0,_=!0,m=u-Math.floor(u/t)*t,E=f-r-Math.floor((f-r)/t)*t,B=d-Math.floor(d/s)*s,y=i-c-Math.floor((i-c)/s)*s;m>t/2&&(m-=t),E>t/2&&(E-=t),B>s/2&&(B-=s),y>s/2&&(y-=s),Math.abs(E)<Math.abs(m)&&(x=!1),Math.abs(y)<Math.abs(B)&&(_=!1),u-=x?m:E,r=f-b-u,d-=_?B:y,c=i-o-d}({newLeft:this.left,newRight:this.right,newTop:this.top,newBottom:this.bottom}=this.rectCorrectionByLimit({newLeft:d,newRight:c,newTop:u,newBottom:r})),this.$emit("dragging",this.rect)},bodyUp(){this.bodyDrag=!1,this.$emit("dragging",this.rect),this.$emit("dragstop",this.rect),this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}}},stickDown(e,a,i=!1){if((!this.isResizable||!this.active)&&!i)return;this.stickDrag=!0;const f=typeof a.pageX<"u"?a.pageX:a.touches[0].pageX,s=typeof a.pageY<"u"?a.pageY:a.touches[0].pageY;this.saveDimensionsBeforeMove({pointerX:f,pointerY:s}),this.currentStick=e,this.limits=this.calcResizeLimits()},saveDimensionsBeforeMove({pointerX:e,pointerY:a}){this.dimensionsBeforeMove.pointerX=e,this.dimensionsBeforeMove.pointerY=a,this.dimensionsBeforeMove.left=this.left,this.dimensionsBeforeMove.right=this.right,this.dimensionsBeforeMove.top=this.top,this.dimensionsBeforeMove.bottom=this.bottom,this.dimensionsBeforeMove.width=this.width,this.dimensionsBeforeMove.height=this.height,this.aspectFactor=this.width/this.height},stickMove(e){const{currentStick:a,dimensionsBeforeMove:i,gridY:f,gridX:s,snapToGrid:t,parentHeight:o,parentWidth:b}=this;let u=i.top,r=i.bottom,d=i.left,c=i.right;switch(a[0]){case"b":r=i.bottom+e.y,t&&(r=o-Math.round((o-r)/f)*f);break;case"t":u=i.top-e.y,t&&(u=Math.round(u/f)*f);break}switch(a[1]){case"r":c=i.right+e.x,t&&(c=b-Math.round((b-c)/s)*s);break;case"l":d=i.left-e.x,t&&(d=Math.round(d/s)*s);break}({newLeft:d,newRight:c,newTop:u,newBottom:r}=this.rectCorrectionByLimit({newLeft:d,newRight:c,newTop:u,newBottom:r})),this.aspectRatio&&({newLeft:d,newRight:c,newTop:u,newBottom:r}=this.rectCorrectionByAspectRatio({newLeft:d,newRight:c,newTop:u,newBottom:r})),this.left=d,this.right=c,this.top=u,this.bottom=r,this.$emit("resizing",this.rect)},stickUp(){this.stickDrag=!1,this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}},this.$emit("resizing",this.rect),this.$emit("resizestop",this.rect)},calcDragLimitation(){const{parentWidth:e,parentHeight:a}=this;return{left:{min:0,max:e-this.width},right:{min:0,max:e-this.width},top:{min:0,max:a-this.height},bottom:{min:0,max:a-this.height}}},calcResizeLimits(){const{aspectFactor:e,width:a,height:i,bottom:f,top:s,left:t,right:o}=this;let{minh:b,minw:u}=this;const r=this.parentLimitation?0:null;this.aspectRatio&&(u/b>e?b=u/e:u=e*b);const d={left:{min:r,max:t+(a-u)},right:{min:r,max:o+(a-u)},top:{min:r,max:s+(i-b)},bottom:{min:r,max:f+(i-b)}};if(this.aspectRatio){const c={left:{min:t-Math.min(s,f)*e*2,max:t+(i-b)/2*e*2},right:{min:o-Math.min(s,f)*e*2,max:o+(i-b)/2*e*2},top:{min:s-Math.min(t,o)/e*2,max:s+(a-u)/2/e*2},bottom:{min:f-Math.min(t,o)/e*2,max:f+(a-u)/2/e*2}};this.currentStick[0]==="m"?(d.left={min:Math.max(d.left.min,c.left.min),max:Math.min(d.left.max,c.left.max)},d.right={min:Math.max(d.right.min,c.right.min),max:Math.min(d.right.max,c.right.max)}):this.currentStick[1]==="m"&&(d.top={min:Math.max(d.top.min,c.top.min),max:Math.min(d.top.max,c.top.max)},d.bottom={min:Math.max(d.bottom.min,c.bottom.min),max:Math.min(d.bottom.max,c.bottom.max)})}return d},sideCorrectionByLimit(e,a){let i=a;return e.min!==null&&a<e.min?i=e.min:e.max!==null&&e.max<a&&(i=e.max),i},rectCorrectionByLimit(e){const{limits:a}=this;let{newRight:i,newLeft:f,newBottom:s,newTop:t}=e;return f=this.sideCorrectionByLimit(a.left,f),i=this.sideCorrectionByLimit(a.right,i),t=this.sideCorrectionByLimit(a.top,t),s=this.sideCorrectionByLimit(a.bottom,s),{newLeft:f,newRight:i,newTop:t,newBottom:s}},rectCorrectionByAspectRatio(e){let{newLeft:a,newRight:i,newTop:f,newBottom:s}=e;const{parentWidth:t,parentHeight:o,currentStick:b,aspectFactor:u,dimensionsBeforeMove:r}=this;let d=t-a-i,c=o-f-s;if(b[1]==="m"){const x=c-r.height;a-=x*u/2,i-=x*u/2}else if(b[0]==="m"){const x=d-r.width;f-=x/u/2,s-=x/u/2}else d/c>u?(d=u*c,b[1]==="l"?a=t-i-d:i=t-a-d):(c=d/u,b[0]==="t"?f=o-s-c:s=o-f-c);return{newLeft:a,newRight:i,newTop:f,newBottom:s}}},computed:{positionStyle(){return{top:this.top+"px",left:this.left+"px",zIndex:this.zIndex}},sizeStyle(){return{width:this.w=="auto"?"auto":this.width+"px",height:this.h=="auto"?"auto":this.height+"px"}},vdrStick(){return e=>{const a={width:`${this.stickSize/this.parentScaleX}px`,height:`${this.stickSize/this.parentScaleY}px`};return a[nt.y[e[0]]]=`${this.stickSize/this.parentScaleX/-2}px`,a[nt.x[e[1]]]=`${this.stickSize/this.parentScaleX/-2}px`,a}},width(){return this.parentWidth-this.left-this.right},height(){return this.parentHeight-this.top-this.bottom},rect(){return{left:Math.round(this.left),top:Math.round(this.top),width:Math.round(this.width),height:Math.round(this.height)}}},watch:{active(e){e?this.$emit("activated"):this.$emit("deactivated")},isActive:{immediate:!0,handler(e){this.active=e}},z:{immediate:!0,handler(e){(e>=0||e==="auto")&&(this.zIndex=e)}},x:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.left)return;const i=a-e;this.bodyDown({pageX:this.left,pageY:this.top}),this.bodyMove({x:i,y:0}),this.$nextTick(()=>{this.bodyUp()})}},y:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.top)return;const i=a-e;this.bodyDown({pageX:this.left,pageY:this.top}),this.bodyMove({x:0,y:i}),this.$nextTick(()=>{this.bodyUp()})}},w:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.width)return;const i="mr",f=a-e;this.stickDown(i,{pageX:this.right,pageY:this.top+this.height/2},!0),this.stickMove({x:f,y:0}),this.$nextTick(()=>{this.stickUp()})}},h:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.height)return;const i="bm",f=a-e;this.stickDown(i,{pageX:this.left+this.width/2,pageY:this.bottom},!0),this.stickMove({x:0,y:f}),this.$nextTick(()=>{this.stickUp()})}},parentW(e){this.right=e-this.width-this.left,this.parentWidth=e},parentH(e){this.bottom=e-this.height-this.top,this.parentHeight=e}}},Fo=["onMousedown","onTouchstart"];function Go(e,a,i,f,s,t){return p(),D("div",{class:be(["vdr",`${e.active||e.isActive?"active":"inactive"} ${e.contentClass?e.contentClass:""}`]),style:ce(e.positionStyle),onMousedown:a[0]||(a[0]=o=>e.bodyDown(o)),onTouchstart:a[1]||(a[1]=o=>e.bodyDown(o)),onTouchend:a[2]||(a[2]=o=>e.up(o))},[g("div",{style:ce(e.sizeStyle),class:"content-container",ref:"container"},[_e(e.$slots,"default")],4),(p(!0),D(Q,null,ae(e.sticks,o=>(p(),D("div",{class:be(["vdr-stick",["vdr-stick-"+o,e.isResizable?"":"not-resizable"]]),onMousedown:de(b=>e.stickDown(o,b),["stop","prevent"]),onTouchstart:de(b=>e.stickDown(o,b),["stop","prevent"]),style:ce(e.vdrStick(o))},null,46,Fo))),256))],38)}const gt=pe(Po,[["render",Go]]);function Oe(e){Oe.installed||(Oe.installed=!0,e.component("vue-drag-resize",gt))}const Jo={install:Oe};let Be=null;typeof window<"u"?Be=window.Vue:typeof global<"u"&&(Be=global.Vue);Be&&Be.use(Jo);const Zo={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Ko(e,a){return p(),D("svg",Zo,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1l-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4"},null,-1)]))}const bt=ne({name:"ant-design-right-outlined",render:Ko}),Qo={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function en(e,a){return p(),D("svg",Qo,a[0]||(a[0]=[g("path",{fill:"currentColor","fill-rule":"evenodd",d:"M799.855 166.312c.023.007.043.018.084.059l57.69 57.69c.041.041.052.06.059.084a.1.1 0 0 1 0 .069c-.007.023-.018.042-.059.083L569.926 512l287.703 287.703c.041.04.052.06.059.083a.12.12 0 0 1 0 .07c-.007.022-.018.042-.059.083l-57.69 57.69c-.041.041-.06.052-.084.059a.1.1 0 0 1-.069 0c-.023-.007-.042-.018-.083-.059L512 569.926L224.297 857.629c-.04.041-.06.052-.083.059a.12.12 0 0 1-.07 0c-.022-.007-.042-.018-.083-.059l-57.69-57.69c-.041-.041-.052-.06-.059-.084a.1.1 0 0 1 0-.069c.007-.023.018-.042.059-.083L454.073 512L166.371 224.297c-.041-.04-.052-.06-.059-.083a.12.12 0 0 1 0-.07c.007-.022.018-.042.059-.083l57.69-57.69c.041-.041.06-.052.084-.059a.1.1 0 0 1 .069 0c.023.007.042.018.083.059L512 454.073l287.703-287.702c.04-.041.06-.052.083-.059a.12.12 0 0 1 .07 0Z"},null,-1)]))}const Pe=ne({name:"ant-design-close-outlined",render:en}),tn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function on(e,a){return p(),D("svg",tn,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281l360-281.1c3.8-3 6.1-7.7 6.1-12.6"},null,-1)]))}const _t=ne({name:"ant-design-left-outlined",render:on}),nn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function ln(e,a){return p(),D("svg",nn,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64m0 820c-205.4 0-372-166.6-372-372c0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884m288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372c0 89-31.3 170.8-83.5 234.8"},null,-1)]))}const an=ne({name:"ant-design-stop-outlined",render:ln}),me=Ht(Yt.Workflow,()=>{const e=k(),a=k(),i=k(),f=k([]);function s(u){e.value=u}function t(u){a.value=u}async function o(u){i.value=u;const{data:r,error:d}=await fo({groupName:u});d||(f.value=r.map(c=>({id:c.id,jobName:c.jobName})))}function b(){e.value=void 0,a.value=void 0,i.value=void 0,f.value=[]}return{id:e,type:a,groupName:i,jobList:f,setJobList:o,setType:t,setId:s,clear:b}}),sn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function dn(e,a){return p(),D("svg",sn,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 0 0 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 0 0 9.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9m67.4-174.4L687.8 215l73.3 73.3l-362.7 362.6l-88.9 15.7zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32"},null,-1)]))}const rn=ne({name:"ant-design-edit-outlined",render:dn}),un={class:"flex items-center"},Ae=P({name:"EditableInput",__name:"editable-input",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,f=a,s=k(),t=k(),o=k(!1);W(()=>i.modelValue,r=>{t.value=r},{immediate:!0});const b=()=>{o.value=!0,re(()=>{var r;(r=s.value)==null||r.focus()})},u=()=>{f("update:modelValue",t.value),o.value=!1};return(r,d)=>{const c=qe,x=rn,_=ie,m=Ce;return o.value?(p(),M(c,{key:0,ref_key:"inputRef",ref:s,value:t.value,"onUpdate:value":d[0]||(d[0]=E=>t.value=E),type:"text",onBlur:u},null,8,["value"])):(p(),M(m,{key:1},{default:l(()=>[g("span",un,[V(S(t.value)+" ",1),n(_,{text:"",type:"info",class:"m-l-6px",onClick:b},{icon:l(()=>[n(x,{class:"text-icon"})]),_:1})])]),_:1}))}}}),cn={class:"w-460px flex-center"},pn=P({name:"TaskDrawer",__name:"task-drawer",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1},len:{default:0}},emits:["update:open","save"],setup(e,{emit:a}){const i=e,f=a,s=me(),t=k(!1),o=k({}),b=k([]);W(()=>s.jobList,_=>{b.value=_},{immediate:!0}),W(()=>i.open,_=>{t.value=_},{immediate:!0}),W(()=>i.modelValue,_=>{o.value=_},{immediate:!0});const u=k(),r=()=>{f("update:open",!1),t.value=!1},d=()=>{var _;(_=u.value)==null||_.validate(m=>{m||(r(),f("save",o.value))}).catch(()=>{var m;return(m=window.$message)==null?void 0:m.warning("请检查表单信息")})},c={failStrategy:[{required:!0,message:"请选择失败策略"}],workflowNodeStatus:[{required:!0,message:"请选择工作流状态"}],jobTask:{jobId:[{required:!0,message:"请选择任务"}]}},x=(_,m)=>{o.value.jobTask.jobName=m.label};return(_,m)=>{const E=Te,B=De,y=Ee,C=Le,I=je,R=Ue,Y=ie,h=Re,$=Me;return p(),M($,{show:t.value,"onUpdate:show":m[5]||(m[5]=L=>t.value=L),"display-directive":"if",width:500,onAfterLeave:r},{default:l(()=>[n(h,null,{header:l(()=>[g("div",cn,[n(Ae,{modelValue:o.value.nodeName,"onUpdate:modelValue":m[0]||(m[0]=L=>o.value.nodeName=L),class:"mr-16px max-w-320px min-w-320px"},null,8,["modelValue"]),n(E,{value:o.value.priorityLevel,"onUpdate:value":m[1]||(m[1]=L=>o.value.priorityLevel=L),class:"max-w-110px",options:Array(_.len).fill(0).map((L,O)=>({label:"优先级 "+(O+1),value:O+1}))},null,8,["value","options"])])]),footer:l(()=>[n(Y,{type:"primary",onClick:d},{default:l(()=>m[6]||(m[6]=[V("保存")])),_:1}),n(Y,{class:"ml-12px",onClick:r},{default:l(()=>m[7]||(m[7]=[V("取消")])),_:1})]),default:l(()=>[n(R,{ref_key:"formRef",ref:u,model:o.value,rules:c,"label-align":"left","label-width":"100px"},{default:l(()=>[n(B,{path:"jobTask.jobId",label:"所属任务",placeholder:"请选择任务"},{default:l(()=>[n(E,{value:o.value.jobTask.jobId,"onUpdate:value":[m[2]||(m[2]=L=>o.value.jobTask.jobId=L),x],filterable:"",options:b.value.map(L=>({label:L.jobName,value:L.id}))},null,8,["value","options"])]),_:1}),n(B,{path:"failStrategy",label:"失败策略"},{default:l(()=>[n(I,{value:o.value.failStrategy,"onUpdate:value":m[3]||(m[3]=L=>o.value.failStrategy=L)},{default:l(()=>[n(C,null,{default:l(()=>[(p(!0),D(Q,null,ae(v(Ot),(L,O)=>(p(),M(y,{key:O,label:v(U)(L.label),value:L.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),n(B,{path:"workflowNodeStatus",label:"节点状态"},{default:l(()=>[n(I,{value:o.value.workflowNodeStatus,"onUpdate:value":m[4]||(m[4]=L=>o.value.workflowNodeStatus=L)},{default:l(()=>[n(C,null,{default:l(()=>[(p(!0),D(Q,null,ae(v(Xe),(L,O)=>(p(),M(y,{key:O,label:v(U)(L.label),value:L.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),mn=P({name:"TaskDetail",__name:"task-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,f=a,s=me(),t=k(!1);W(()=>i.open,u=>{t.value=u},{immediate:!0});const o=()=>{f("update:open",!1)},b=u=>{var d;return(d=s.jobList.find(c=>c.id===u))==null?void 0:d.jobName};return(u,r)=>{const d=we,c=ye,x=$e;return p(),M(x,{modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=_=>t.value=_),title:"任务详情",width:["500px","90%"],onAfterLeave:o},{default:l(()=>[n(c,{column:1,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(d,{label:"节点名称"},{default:l(()=>[V(S(u.modelValue.nodeName),1)]),_:1}),n(d,{label:"任务 ID"},{default:l(()=>{var _;return[V(S((_=u.modelValue.jobTask)==null?void 0:_.jobId),1)]}),_:1}),n(d,{label:"任务名称"},{default:l(()=>{var _;return[V(S(b((_=u.modelValue.jobTask)==null?void 0:_.jobId)),1)]}),_:1}),n(d,{label:"失败策略"},{default:l(()=>[V(S(v(U)(v(it)[u.modelValue.failStrategy])),1)]),_:1}),n(d,{label:"工作流状态"},{default:l(()=>[V(S(v(U)(v(dt)[u.modelValue.workflowNodeStatus])),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),fn=P({name:"FlowLogDrawer",__name:"flow-log-drawer",props:qt({title:{default:U("workflow.node.log.title")},taskData:{}},{show:{type:Boolean,default:!0},showModifiers:{}}),emits:["update:show"],setup(e){const a=Xt(e,"show");return(i,f)=>{const s=_o;return p(),M(s,{show:a.value,"onUpdate:show":f[0]||(f[0]=t=>a.value=t),title:i.title,"task-data":i.taskData},null,8,["show","title","task-data"])}}}),vn=P({name:"DetailCard",__name:"detail-card",props:{id:{default:void 0},ids:{default:()=>[]},show:{type:Boolean,default:!1}},emits:["update:show"],setup(e,{emit:a}){ao.registerLanguage("json",so);const i=e,f=a,s=rt(),t=me(),o=k(!1),b=k(!1),u=k(!1),r=k(1),d=k({}),c=k({page:1,pageCount:0,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20,25,30],onUpdatePage:async h=>{c.value.page=h;const $=i.ids[r.value-1];m($)},onUpdatePageSize:async h=>{c.value.pageSize=h;const $=i.ids[r.value-1];m($)}});W(()=>i.show,h=>{o.value=h,h&&B()},{immediate:!0});const x=()=>{f("update:show",!1)};async function _(h){u.value=!0;const{data:$,error:L}=await vo(h);L||(d.value=$,u.value=!1)}async function m(h){u.value=!0;const{data:$,error:L}=await io(h);L||(d.value=$,u.value=!1)}const E=k([]);function B(){E.value=i.ids,re(()=>{i.ids.length>0?m(i.ids[0]):i.id&&(E.value=[d.value.taskBatchId],_(i.id))})}const y=k({}),C=h=>{y.value=h,b.value=!0},I=async()=>{var $;const{error:h}=await uo(t.id,d.value.workflowNodeId);h||($=window.$message)==null||$.success("执行重试成功")};function R(h){return{color:`${h}18`,textColor:h,borderColor:`${h}58`}}const Y=h=>{r.value=h;const $=i.ids[h-1];m($)};return(h,$)=>{const L=we,O=ye,X=ut,N=Ft,z=ro,F=Pt,Z=ho,ee=$e,A=fn;return p(),D(Q,null,[n(ee,{modelValue:o.value,"onUpdate:modelValue":$[2]||($[2]=j=>o.value=j),title:"任务批次详情",width:["800px","90%"],"onUpdate:show":x},Wt({default:l(()=>[E.value&&E.value.length>0?(p(),M(F,{key:0,value:r.value,"onUpdate:value":$[0]||($[0]=j=>r.value=j),type:"segment",animated:""},{default:l(()=>[(p(!0),D(Q,null,ae(E.value,(j,w)=>(p(),M(N,{key:w,name:w+1,tab:j},{default:l(()=>[n(F,{class:"detail-tabs",type:"segment",animated:""},{default:l(()=>[n(N,{name:"info",tab:v(U)("page.log.info")},{default:l(()=>[n(X,{show:u.value},{default:l(()=>[n(O,{class:"pt-12px","label-placement":"left",bordered:"",column:2},{default:l(()=>[n(L,{label:v(U)("page.jobBatch.groupName")},{default:l(()=>{var q;return[V(S((q=d.value)==null?void 0:q.groupName),1)]}),_:1},8,["label"]),n(L,{label:v(U)("page.jobBatch.jobName")},{default:l(()=>{var q;return[V(S((q=d.value)==null?void 0:q.jobName),1)]}),_:1},8,["label"]),n(L,{label:v(U)("page.jobBatch.taskBatchStatus")},{default:l(()=>[v(ke)(d.value.taskBatchStatus)?(p(),M(v(Ve),{key:0,color:R(v(G)[d.value.taskBatchStatus].color)},{default:l(()=>[V(S(v(G)[d.value.taskBatchStatus].title),1)]),_:1},8,["color"])):T("",!0),v(ke)(d.value.jobStatus)?(p(),M(v(Ve),{key:1,color:R(v(Qe)[d.value.jobStatus].color)},{default:l(()=>[V(S(v(U)(v(Qe)[d.value.jobStatus].name)),1)]),_:1},8,["color"])):T("",!0)]),_:1},8,["label"]),n(L,{label:v(U)("page.jobBatch.executionAt")},{default:l(()=>{var q;return[V(S((q=d.value)==null?void 0:q.executionAt),1)]}),_:1},8,["label"]),n(L,{label:v(U)("page.jobBatch.operationReason")},{default:l(()=>[v(ke)(d.value.operationReason)?(p(),M(v(Ve),{key:0,color:R(v(et)[d.value.operationReason].color)},{default:l(()=>[V(S(v(U)(v(et)[d.value.operationReason].name)),1)]),_:1},8,["color"])):T("",!0)]),_:1},8,["label"]),v(s).default?T("",!0):(p(),M(L,{key:0,label:v(U)("page.jobBatch.executorType")},{default:l(()=>[v(ke)(d.value.executorType)?(p(),M(v(Ve),{key:0,color:R(v(tt)[d.value.executorType].color)},{default:l(()=>[V(S(v(U)(v(tt)[d.value.executorType].name)),1)]),_:1},8,["color"])):T("",!0)]),_:1},8,["label"])),n(L,{label:v(U)("page.jobBatch.executorInfo"),span:2},{default:l(()=>{var q;return[V(S((q=d.value)==null?void 0:q.executorInfo),1)]}),_:1},8,["label"]),n(L,{label:v(U)("common.createDt"),span:2},{default:l(()=>{var q;return[V(S((q=d.value)==null?void 0:q.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["show"]),_e(h.$slots,"default",{},void 0,!0)]),_:3},8,["tab"]),n(N,{name:"task",disabled:d.value.taskBatchStatus===99},{tab:l(()=>$[4]||($[4]=[g("span",null,"任务项列表",-1)])),default:l(()=>[n(z,{"row-data":d.value,onShowLog:C,onRetry:I},null,8,["row-data"])]),_:1},8,["disabled"])]),_:3})]),_:2},1032,["name","tab"]))),128))]),_:3},8,["value"])):T("",!0)]),_:2},[h.ids&&h.ids.length>1?{name:"footer",fn:l(()=>[n(Z,{page:r.value,"onUpdate:page":[$[1]||($[1]=j=>r.value=j),Y],class:"text-center","page-size":1,"page-count":h.ids.length},null,8,["page","page-count"])]),key:"0"}:void 0]),1032,["modelValue"]),n(A,{show:b.value,"onUpdate:show":$[3]||($[3]=j=>b.value=j),title:"日志详情","task-data":y.value},null,8,["show","task-data"])],64)}}}),Fe=pe(vn,[["__scopeId","data-v-e19caaf2"]]),hn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function gn(e,a){return p(),D("svg",hn,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8M872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8"},null,-1)]))}const bn=ne({name:"ant-design-swap-outlined",render:gn}),_n={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function wn(e,a){return p(),D("svg",_n,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M752 664c-28.5 0-54.8 10-75.4 26.7L469.4 540.8a160.7 160.7 0 0 0 0-57.6l207.2-149.9C697.2 350 723.5 360 752 360c66.2 0 120-53.8 120-120s-53.8-120-120-120s-120 53.8-120 120c0 11.6 1.6 22.7 4.7 33.3L439.9 415.8C410.7 377.1 364.3 352 312 352c-88.4 0-160 71.6-160 160s71.6 160 160 160c52.3 0 98.7-25.1 127.9-63.8l196.8 142.5c-3.1 10.6-4.7 21.8-4.7 33.3c0 66.2 53.8 120 120 120s120-53.8 120-120s-53.8-120-120-120m0-476c28.7 0 52 23.3 52 52s-23.3 52-52 52s-52-23.3-52-52s23.3-52 52-52M312 600c-48.5 0-88-39.5-88-88s39.5-88 88-88s88 39.5 88 88s-39.5 88-88 88m440 236c-28.7 0-52-23.3-52-52s23.3-52 52-52s52 23.3 52 52s-23.3 52-52 52"},null,-1)]))}const yn=ne({name:"ant-design-share-alt-outlined",render:wn}),kn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Nn(e,a){return p(),D("svg",kn,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8m0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8m0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8M104 228a56 56 0 1 0 112 0a56 56 0 1 0-112 0m0 284a56 56 0 1 0 112 0a56 56 0 1 0-112 0m0 284a56 56 0 1 0 112 0a56 56 0 1 0-112 0"},null,-1)]))}const xn=ne({name:"ant-design-unordered-list-outlined",render:Nn}),$n={class:"add-node-btn-box"},Sn={class:"add-node-btn"},Vn={class:"add-node-popover-body"},Bn={class:"icon"},Cn=P({name:"AddNode",__name:"add-node",props:{modelValue:{},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,f=a,s=t=>{let o={};t===1?o={nodeName:U("workflow.node.task.nodeName"),nodeType:1,conditionNodes:[{nodeName:U("workflow.node.task.conditionNodes.nodeName"),failStrategy:1,priorityLevel:1,workflowNodeStatus:1,jobTask:{jobId:void 0}}],childNode:i.modelValue}:t===2?o={nodeName:U("workflow.node.condition.nodeName"),nodeType:2,conditionNodes:[{nodeName:`${U("workflow.node.condition.conditionNodes.nodeName")} 1`,priorityLevel:1,decision:{expressionType:1,nodeExpression:void 0,logicalCondition:1,defaultDecision:0}},{nodeName:U("workflow.node.condition.conditionNodes.otherNodeName"),priorityLevel:2,decision:{expressionType:1,nodeExpression:"#true",logicalCondition:1,defaultDecision:1}}],childNode:i.modelValue}:t===3&&(o={nodeName:U("workflow.node.callback.nodeName"),nodeType:3,conditionNodes:[{nodeName:U("workflow.node.callback.conditionNodes.nodeName"),workflowNodeStatus:1,callback:{webhook:void 0,contentType:void 0,secret:void 0}}],childNode:i.modelValue}),f("update:modelValue",o)};return(t,o)=>{const b=ht,u=ie,r=xn,d=yn,c=bn,x=We;return p(),D("div",$n,[g("div",Sn,[t.disabled?T("",!0):(p(),M(x,{key:0,placement:"right-end",trigger:"click","overlay-style":{width:"296px"}},{trigger:l(()=>[n(u,{type:"primary",circle:"",strong:""},{default:l(()=>[n(b)]),_:1})]),default:l(()=>[g("div",Vn,[g("ul",Bn,[g("li",null,[n(u,{circle:"",size:"large",onClick:o[0]||(o[0]=_=>s(1))},{default:l(()=>[n(r,{class:"text-20px color-#3296fa"})]),_:1}),g("p",null,S(v(U)("workflow.node.task.nodeName")),1)]),g("li",null,[n(u,{circle:"",size:"large",onClick:o[1]||(o[1]=_=>s(2))},{default:l(()=>[n(d,{class:"text-20px color-#15bc83"})]),_:1}),g("p",null,S(v(U)("workflow.node.condition.nodeName")),1)]),g("li",null,[n(u,{circle:"",size:"large",onClick:o[2]||(o[2]=_=>s(3))},{default:l(()=>[n(c,{class:"text-20px color-#935af6"})]),_:1}),g("p",null,S(v(U)("workflow.node.callback.nodeName")),1)])])])]),_:1}))])])}}}),fe=pe(Cn,[["__scopeId","data-v-f9b0541f"]]),Tn={class:"node-wrap"},Dn={class:"branch-box"},Ln={class:"condition-node"},Un={class:"condition-node-box"},Rn={class:"popover"},Mn={class:"popover-item"},In={class:"popover-item"},jn=["onClick"],En=["onClick"],zn={class:"title"},An={class:"text color-#3296fa"},Hn={key:0},Yn={class:"priority-title"},On={class:"content min-h-72px"},qn={key:0,class:"placeholder"},Xn=["onClick"],Wn={key:1,class:"top-left-cover-line"},Pn={key:2,class:"bottom-left-cover-line"},Fn={key:3,class:"top-right-cover-line"},Gn={key:4,class:"bottom-right-cover-line"},Jn=P({name:"TaskNode",__name:"task-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["refresh","update:modelValue"],setup(e,{emit:a}){const i=e,f=a,s=me(),t=Gt(),o=k({});W(()=>i.modelValue,N=>{o.value=N},{immediate:!0});const b=()=>{var z;const N=o.value.conditionNodes.length+1;(z=o.value.conditionNodes)==null||z.push({nodeName:`${U("workflow.node.task.name")} ${N}`,priorityLevel:N,failStrategy:1,workflowNodeStatus:1,jobTask:{jobId:void 0}}),f("update:modelValue",o.value)},u=(N,z)=>{N.childNode?u(N.childNode,z):N.childNode=z},r=N=>{var z;o.value.conditionNodes.length===1?(o.value.childNode&&(o.value.conditionNodes[0].childNode?u(o.value.conditionNodes[0].childNode,o.value.childNode):o.value.conditionNodes[0].childNode=o.value.childNode),re(()=>{f("update:modelValue",o.value.conditionNodes[0].childNode)})):(z=o.value.conditionNodes)==null||z.splice(N,1)},d=(N,z=1)=>{var F;o.value.conditionNodes[N]=o.value.conditionNodes.splice(N+z,1,o.value.conditionNodes[N])[0],(F=o.value.conditionNodes)==null||F.map((Z,ee)=>Z.priorityLevel=ee+1),f("update:modelValue",o.value)},c=k(0),x=k(!1),_=k({}),m=N=>{const z=o.value.conditionNodes[c.value].priorityLevel,F=N.priorityLevel;o.value.conditionNodes[c.value]=N,z!==F&&d(c.value,F-z),f("update:modelValue",o.value)},E=N=>{i.disabled||(c.value=N,_.value=JSON.parse(JSON.stringify(o.value.conditionNodes[N])),x.value=!0)},B=N=>i.disabled?s.type===2?`node-error node-error-${N.taskBatchStatus&&G[N.taskBatchStatus]?G[N.taskBatchStatus].name:"default"}`:"node-error":"auto-judge-def auto-judge-hover",y=k(),C=k(),I=k(!1),R=k([]),Y=(N,z)=>{var F,Z,ee,A;C.value=[],s.type===2?((F=N.jobBatchList)==null||F.sort((j,w)=>j.taskBatchStatus-w.taskBatchStatus).forEach(j=>{var w,q;j.id?(w=C.value)==null||w.push(j.id):j.jobId&&(y.value=(q=j.jobId)==null?void 0:q.toString())}),(Z=N.jobTask)!=null&&Z.jobId&&(y.value=(A=(ee=N.jobTask)==null?void 0:ee.jobId)==null?void 0:A.toString()),I.value=!0):s.type===1?R.value[z]=!0:E(z)},h=async N=>{const{error:z}=await co(N.id,s.id);z||(t.success("执行重试成功"),f("refresh"))},$=async N=>{const{error:z}=await po(N.id,s.id);z||(t.success("停止任务成功"),f("refresh"))},L=N=>N===4||N===5||N===6,O=N=>N===1||N===2,X=N=>L(N)||O(N);return(N,z)=>{const F=ie,Z=ft,ee=ct,A=an,j=_t,w=ze,q=Pe,ve=Ce,Se=bt,Ge=We,kt=Ie,Nt=xe;return p(),D("div",Tn,[g("div",Dn,[N.disabled?T("",!0):(p(),M(F,{key:0,class:"add-branch",strong:"",type:"success",onClick:b},{default:l(()=>[V(S(v(U)("workflow.node.task.add")),1)]),_:1})),(p(!0),D(Q,null,ae(o.value.conditionNodes,(H,te)=>(p(),D("div",{key:te,class:"col-box"},[g("div",Ln,[g("div",Un,[n(Ge,{disabled:v(s).type!==2||!X(H.taskBatchStatus)},{trigger:l(()=>{var ue,Je;return[g("div",{class:be(["auto-judge cursor-pointer",B(H)]),onClick:he=>Y(H,te)},[te!=0?(p(),D("div",{key:0,class:"sort-left",onClick:de(he=>d(te,-1),["stop"])},[n(j)],8,En)):T("",!0),g("div",zn,[g("span",An,[n(w,{processing:"",dot:"",color:H.workflowNodeStatus===1?"#52c41a":"#ff4d4f"},null,8,["color"]),V("  "+S(H.nodeName)+" ",1),H.id?(p(),D("span",Hn," ("+S(H.id)+")",1)):T("",!0)]),g("span",Yn,S(v(U)("workflow.node.priority"))+S(H.priorityLevel),1),N.disabled?T("",!0):(p(),M(q,{key:0,class:"close",onClick:de(he=>r(te),["stop"])},null,8,["onClick"]))]),g("div",On,[(ue=H.jobTask)!=null&&ue.jobId?T("",!0):(p(),D("div",qn,"请选择任务")),(Je=H.jobTask)!=null&&Je.jobId?(p(),D(Q,{key:1},[g("div",null,[z[5]||(z[5]=g("span",{class:"content_label"},"任务名称: ",-1)),n(ve,{class:"max-w-123px"},{default:l(()=>{var he,Ze;return[V(S(`${(he=H.jobTask)==null?void 0:he.jobName}(${(Ze=H.jobTask)==null?void 0:Ze.jobId})`),1)]}),_:2},1024)]),g("div",null,[z[6]||(z[6]=g("span",{class:"content_label"},"失败策略: ",-1)),V(" "+S(v(U)(v(it)[H.failStrategy])),1)]),z[7]||(z[7]=g("div",null,".........",-1))],64)):T("",!0)]),te!=o.value.conditionNodes.length-1?(p(),D("div",{key:1,class:"sort-right",onClick:de(he=>d(te),["stop"])},[n(Se)],8,Xn)):T("",!0)],10,jn)]}),default:l(()=>[g("div",Rn,[L(H.taskBatchStatus)?(p(),M(F,{key:0,text:"",onClick:ue=>h(H)},{default:l(()=>[g("span",Mn,[n(Z,{class:"mb-3px text-24px font-bold"}),V(" "+S(v(U)("common.retry")),1)])]),_:2},1032,["onClick"])):T("",!0),O(H.taskBatchStatus)&&L(H.taskBatchStatus)?(p(),M(ee,{key:1,vertical:""})):T("",!0),O(H.taskBatchStatus)?(p(),M(F,{key:2,text:"",onClick:ue=>$(H)},{default:l(()=>[g("span",In,[n(A),V(" "+S(v(U)("common.stop")),1)])]),_:2},1032,["onClick"])):T("",!0)])]),_:2},1032,["disabled"]),v(s).type===2&&H.taskBatchStatus?(p(),M(Nt,{key:0},{trigger:l(()=>[g("div",{class:"task-error-tip text-24px",style:ce({color:v(G)[H.taskBatchStatus].color})},[n(kt,{icon:v(G)[H.taskBatchStatus].icon},null,8,["icon"])],4)]),default:l(()=>[V(" "+S(v(G)[H.taskBatchStatus].title),1)]),_:2},1024)):T("",!0),n(fe,{modelValue:H.childNode,"onUpdate:modelValue":ue=>H.childNode=ue,disabled:N.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),H.childNode?_e(N.$slots,"default",{key:0,node:H},void 0,!0):T("",!0),te==0?(p(),D("div",Wn)):T("",!0),te==0?(p(),D("div",Pn)):T("",!0),te==o.value.conditionNodes.length-1?(p(),D("div",Fn)):T("",!0),te==o.value.conditionNodes.length-1?(p(),D("div",Gn)):T("",!0),v(s).type!==0?(p(),M(mn,{key:5,open:R.value[te],"onUpdate:open":ue=>R.value[te]=ue,"model-value":o.value.conditionNodes[te]},null,8,["open","onUpdate:open","model-value"])):T("",!0)]))),128))]),o.value.conditionNodes.length>1?(p(),M(fe,{key:0,modelValue:o.value.childNode,"onUpdate:modelValue":z[0]||(z[0]=H=>o.value.childNode=H),disabled:N.disabled},null,8,["modelValue","disabled"])):T("",!0),v(s).type===0?(p(),M(pn,{key:1,open:x.value,"onUpdate:open":z[1]||(z[1]=H=>x.value=H),modelValue:_.value,"onUpdate:modelValue":z[2]||(z[2]=H=>_.value=H),len:o.value.conditionNodes.length,"onUpdate:len":z[3]||(z[3]=H=>o.value.conditionNodes.length=H),onSave:m},null,8,["open","modelValue","len"])):T("",!0),v(s).type!==0?(p(),M(Fe,{key:2,id:y.value,show:I.value,"onUpdate:show":z[4]||(z[4]=H=>I.value=H),ids:C.value},null,8,["id","show","ids"])):T("",!0)])}}}),Zn=pe(Jn,[["__scopeId","data-v-7f63c83a"]]),Kn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Qn(e,a){return p(),D("svg",Kn,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372"},null,-1),g("path",{fill:"currentColor",d:"M464 336a48 48 0 1 0 96 0a48 48 0 1 0-96 0m72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8"},null,-1)]))}const wt=ne({name:"ant-design-info-circle-outlined",render:Qn}),el={class:"w-460px flex-center"},tl=P({name:"BranchDrawer",__name:"branch-drawer",props:{open:{type:Boolean,default:!1},len:{default:0},modelValue:{default:()=>({})}},emits:["update:open","save"],setup(e,{emit:a}){const i=e,f=a,s=k(!1),t=k({decision:{logicalCondition:1,expressionType:1,nodeExpression:"",checkContents:[]}});W(()=>i.open,_=>{s.value=_},{immediate:!0}),W(()=>i.modelValue,_=>{t.value=_},{immediate:!0});const o=k(),b=()=>{f("update:open",!1),s.value=!1},u=()=>{var _;(_=o.value)==null||_.validate(m=>{m||(b(),f("save",t.value))}).catch(()=>{var m;return(m=window.$message)==null?void 0:m.warning("请检查表单信息")})},r=k(""),d=k("success"),c=async()=>{var E;if(d.value="error",!((E=t.value.decision)!=null&&E.nodeExpression)){r.value="请填写条件表达式";return}const{error:_,data:m}=await mo(t.value.decision);if(_){r.value="接口请求失败";return}else if(m.key!==1||!m.value){r.value=m.value||"请检查条件表达式";return}d.value="success",r.value="表达式校验通过"},x={decision:{expressionType:[{required:!0,message:"请选择表达式类型",trigger:"change",type:"number"}],nodeExpression:[{required:!0,message:"请填写条件表达式",trigger:"blur"}]}};return(_,m)=>{const E=Te,B=Ee,y=Le,C=je,I=De,R=wo,Y=vt,h=ie,$=Ue,L=Re,O=Me;return p(),M(O,{show:s.value,"onUpdate:show":m[5]||(m[5]=X=>s.value=X),"display-directive":"if",width:500,onAfterLeave:b},{default:l(()=>[n(L,null,{header:l(()=>[g("div",el,[n(Ae,{modelValue:t.value.nodeName,"onUpdate:modelValue":m[0]||(m[0]=X=>t.value.nodeName=X),class:"mr-16px max-w-320px min-w-320px"},null,8,["modelValue"]),n(E,{value:t.value.priorityLevel,"onUpdate:value":m[1]||(m[1]=X=>t.value.priorityLevel=X),class:"max-w-110px",options:Array(_.len).fill(0).map((X,N)=>({label:"优先级 "+(N+1),value:N+1}))},null,8,["value","options"])])]),footer:l(()=>[n(h,{type:"primary",onClick:u},{default:l(()=>m[7]||(m[7]=[V("保存")])),_:1}),n(h,{class:"ml-12px",onClick:b},{default:l(()=>m[8]||(m[8]=[V("取消")])),_:1})]),default:l(()=>[n($,{ref_key:"formRef",ref:o,rules:x,model:t.value,"label-align":"left","label-width":"100px"},{default:l(()=>{var X;return[n(I,{path:"decision.expressionType",label:"表达式类型"},{default:l(()=>[n(C,{value:t.value.decision.expressionType,"onUpdate:value":m[2]||(m[2]=N=>t.value.decision.expressionType=N)},{default:l(()=>[n(y,null,{default:l(()=>[(p(!0),D(Q,null,ae(v(Jt),N=>(p(),M(B,{key:N.value,label:N.label,value:N.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),n(I,{path:"decision.nodeExpression",label:"条件表达式","validation-status":d.value,feedback:r.value},{default:l(()=>[n(R,{modelValue:t.value.decision.nodeExpression,"onUpdate:modelValue":m[3]||(m[3]=N=>t.value.decision.nodeExpression=N),placeholder:"请输入条件表达式"},null,8,["modelValue"])]),_:1},8,["validation-status","feedback"]),n(I,{path:"decision.checkContents",label:"模拟上下文","show-feedback":((X=t.value.decision)==null?void 0:X.checkContents)&&t.value.decision.checkContents.length===0},{default:l(()=>[n(Y,{value:t.value.decision.checkContents,"onUpdate:value":m[4]||(m[4]=N=>t.value.decision.checkContents=N),path:"decision.checkContents"},null,8,["value"])]),_:1},8,["show-feedback"]),n(I,{"show-label":!1,"show-feedback":!1},{default:l(()=>[n(h,{type:"primary",ghost:"",block:"",onClick:c},{default:l(()=>m[6]||(m[6]=[V("校验条件表达式")])),_:1})]),_:1})]}),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),ol=pe(tl,[["__scopeId","data-v-f88d9134"]]),yt=P({name:"BranchDesc",__name:"branch-desc",props:{modelValue:{default:()=>({})}},setup(e){const a=e,i=k(""),f=k({".cm-line":{fontSize:"18px"},".cm-scroller":{minHeight:"180px",overflowY:"auto",overflowX:"hidden"}}),s=()=>{var _;const t=document.getElementById("branch-desc"),o=t==null?void 0:t.querySelector(".n-descriptions-table"),b=o==null?void 0:o.querySelector("tbody"),u=document.createElement("tr");u.className="n-descriptions-table-row";const r=document.createElement("th");r.className="n-descriptions-table-header",r.innerHTML="条件表达式",r.setAttribute("colspan","4"),u.appendChild(r),b==null||b.insertBefore(u,b==null?void 0:b.childNodes[4]);const c=b.getElementsByClassName("n-descriptions-table-row")[3];(_=c.querySelector(".n-descriptions-table-header"))==null||_.remove();const x=c.querySelector(".n-descriptions-table-content");x.setAttribute("style","padding: 0"),x==null||x.setAttribute("colspan","4")};return Ne(()=>{var t;re(()=>{s()}),(t=a.modelValue.decision)!=null&&t.nodeExpression&&(i.value=a.modelValue.decision.nodeExpression)}),(t,o)=>{const b=we,u=ye;return p(),M(u,{id:"branch-desc",column:2,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(b,{label:"节点名称",span:2},{default:l(()=>[V(S(t.modelValue.nodeName),1)]),_:1}),n(b,{label:"表达式类型"},{default:l(()=>{var r;return[V(S(v(pt)[(r=t.modelValue.decision)==null?void 0:r.expressionType]),1)]}),_:1}),n(b,{label:"条件表达式",span:2,"content-style":{padding:0}},{default:l(()=>[n(v(yo),{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=r=>i.value=r),readonly:"",disabled:"",theme:f.value,basic:"",lang:v(ko)(),extensions:[v(No)]},null,8,["modelValue","theme","lang","extensions"])]),_:1})]),_:1})}}}),nl=P({name:"BranchDetail",__name:"branch-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,f=a,s=k(!1),t=()=>{f("update:open",!1)};return W(()=>i.open,o=>{s.value=o},{immediate:!0}),(o,b)=>{const u=$e;return p(),M(u,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=r=>s.value=r),title:"决策详情",width:["500px","90%"],onAfterLeave:t},{default:l(()=>[s.value?(p(),M(yt,{key:0,"model-value":o.modelValue},null,8,["model-value"])):T("",!0)]),_:1},8,["modelValue"])}}}),ll={class:"branch-wrap"},al={class:"branch-box-wrap"},sl={class:"branch-box"},il={class:"condition-node"},dl={class:"condition-node-box"},rl=["onClick"],ul=["onClick"],cl={class:"title"},pl={class:"node-title"},ml={key:0},fl={class:"priority-title"},vl={class:"content"},hl=["innerHTML"],gl={key:1,class:"placeholder"},bl=["onClick"],_l={key:1,class:"top-left-cover-line"},wl={key:2,class:"bottom-left-cover-line"},yl={key:3,class:"top-right-cover-line"},kl={key:4,class:"bottom-right-cover-line"},Nl=P({name:"BranchNode",__name:"branch-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,f=a,s=me(),t=k({});W(()=>i.modelValue,h=>{t.value=h},{immediate:!0});const o=()=>{const h=t.value.conditionNodes.length;t.value.conditionNodes.splice(-1,0,{nodeName:`${U("workflow.node.condition.conditionNodes.nodeName")} ${h}`,priorityLevel:h,decision:{expressionType:1,nodeExpression:void 0,logicalCondition:1,defaultDecision:0}}),t.value.conditionNodes[h].priorityLevel=h+1},b=(h,$)=>{h.childNode?b(h.childNode,$):h.childNode=$},u=h=>{var $;($=t.value.conditionNodes)==null||$.splice(h,1),t.value.conditionNodes.length===1&&(t.value.childNode&&(t.value.conditionNodes[0].childNode?b(t.value.conditionNodes[0].childNode,t.value.childNode):t.value.conditionNodes[0].childNode=t.value.childNode),re(()=>{f("update:modelValue",t.value.conditionNodes[0].childNode)}))},r=(h,$=1)=>{var L;t.value.conditionNodes[h]=t.value.conditionNodes.splice(h+$,1,t.value.conditionNodes[h])[0],(L=t.value.conditionNodes)==null||L.map((O,X)=>O.priorityLevel=X+1),f("update:modelValue",t.value)},d=(h,$)=>{const{nodeName:L,decision:O}=h.conditionNodes[$],{expressionType:X,nodeExpression:N}=O;return N?L!==U("workflow.node.condition.conditionNodes.otherNodeName")?`<span class="content_label">${U("workflow.node.condition.conditionNodes.expressionType")}: </span>${pt[X]}
<span class="content_label">${U("workflow.node.condition.conditionNodes.nodeExpression")}: </span><span style="display: inline-block; vertical-align: bottom; width: 120px; overflow: hidden; text-overflow: ellipsis">${N}<span/>`:U("workflow.node.condition.conditionNodes.otherNodeTip"):L===U("workflow.node.condition.conditionNodes.otherNodeName")?U("workflow.node.condition.conditionNodes.otherNodeTip"):null},c=k(0),x=k(!1),_=k([]),m=k({}),E=h=>{const $=t.value.conditionNodes[c.value].priorityLevel,L=h.priorityLevel;t.value.conditionNodes[c.value]=h,$!==L&&r(c.value,L-$),f("update:modelValue",t.value)},B=h=>{!i.disabled&&h!==t.value.conditionNodes.length-1?(c.value=h,m.value=JSON.parse(JSON.stringify(t.value.conditionNodes[h])),x.value=!0):s.type!==0&&(_.value[h]=!0)},y=k([]),C=k(""),I=k([]),R=(h,$)=>{var L;if(I.value=[],h.nodeName!==U("workflow.node.condition.conditionNodes.otherNodeName"))if(s.type===2){if((L=h.jobBatchList)==null||L.forEach(O=>{var X,N;O.id?(X=I.value)==null||X.push(O.id):O.jobId&&(C.value=(N=O.jobId)==null?void 0:N.toString())}),I.value.length===0){_.value[$]=!0;return}y.value[$]=!0}else s.type===1?_.value[$]=!0:B($)},Y=h=>i.disabled?s.type===2?h.nodeName===U("workflow.node.condition.conditionNodes.otherNodeName")?`node-disabled node-error node-error-${h.taskBatchStatus?G[h.taskBatchStatus].name:"default"}`:`node-error node-error-${h.taskBatchStatus?G[h.taskBatchStatus].name:"default"}`:h.nodeName===U("workflow.node.condition.conditionNodes.otherNodeName")?"node-disabled":"node-error":h.nodeName===U("workflow.node.condition.conditionNodes.otherNodeName")?"node-disabled":"auto-judge-def auto-judge-hover";return(h,$)=>{const L=ie,O=_t,X=ze,N=wt,z=xe,F=Pe,Z=bt,ee=Ie;return p(),D("div",ll,[g("div",al,[g("div",sl,[h.disabled?T("",!0):(p(),M(L,{key:0,strong:"",type:"success",class:"add-branch",onClick:o},{default:l(()=>[V(S(v(U)("workflow.node.condition.addBranch")),1)]),_:1})),(p(!0),D(Q,null,ae(t.value.conditionNodes,(A,j)=>(p(),D("div",{key:j,class:"col-box"},[g("div",il,[g("div",dl,[g("div",{class:be(["auto-judge",Y(A)]),onClick:w=>R(A,j)},[j!==0?(p(),D("div",{key:0,class:"sort-left",onClick:de(w=>r(j,-1),["stop"])},[n(O)],8,ul)):T("",!0),g("div",cl,[g("span",pl,[n(X,{dot:"",processing:"",color:"#52c41a"}),V("  "+S(A.nodeName)+" ",1),A.id&&A.nodeName!==v(U)("workflow.node.condition.conditionNodes.otherNodeName")?(p(),D("span",ml,"  ("+S(A.id)+") ",1)):T("",!0),A.nodeName===v(U)("workflow.node.condition.conditionNodes.otherNodeName")?(p(),M(z,{key:1},{trigger:l(()=>[n(N,{class:"ml-3px text-16px"})]),default:l(()=>[V(" "+S(v(U)("workflow.node.condition.conditionNodes.otherTip")),1)]),_:1})):T("",!0)]),g("span",fl,S(v(U)("workflow.node.condition.conditionNodes.priority"))+S(A.priorityLevel),1),h.disabled?T("",!0):(p(),M(F,{key:0,class:"close",onClick:de(w=>u(j),["stop"])},null,8,["onClick"]))]),g("div",vl,[d(t.value,j)?(p(),D("span",{key:0,innerHTML:d(t.value,j)},null,8,hl)):(p(),D("span",gl,S(v(U)("workflow.node.condition.conditionNodes.conditionTip")),1))]),j!==t.value.conditionNodes.length-2?(p(),D("div",{key:1,class:"sort-right",onClick:de(w=>r(j),["stop"])},[n(Z)],8,bl)):T("",!0),v(s).type===2&&A.taskBatchStatus?(p(),M(z,{key:2},{trigger:l(()=>[g("div",{class:"error-tip text-24px",style:ce({color:v(G)[A.taskBatchStatus].color})},[n(ee,{icon:v(G)[A.taskBatchStatus].icon},null,8,["icon"])],4)]),default:l(()=>[V(" "+S(v(G)[A.taskBatchStatus].title),1)]),_:2},1024)):T("",!0)],10,rl),n(fe,{modelValue:A.childNode,"onUpdate:modelValue":w=>A.childNode=w,disabled:h.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),A.childNode?_e(h.$slots,"default",{key:0,node:A},void 0,!0):T("",!0),j==0?(p(),D("div",_l)):T("",!0),j==0?(p(),D("div",wl)):T("",!0),j==t.value.conditionNodes.length-1?(p(),D("div",yl)):T("",!0),j==t.value.conditionNodes.length-1?(p(),D("div",kl)):T("",!0),n(nl,{open:_.value[j],"onUpdate:open":w=>_.value[j]=w,modelValue:t.value.conditionNodes[j],"onUpdate:modelValue":w=>t.value.conditionNodes[j]=w},null,8,["open","onUpdate:open","modelValue","onUpdate:modelValue"]),n(Fe,{id:C.value,show:y.value[j],"onUpdate:show":w=>y.value[j]=w,ids:I.value},{default:l(()=>[$[4]||($[4]=g("div",{class:"header-border"},[g("span",{class:"pl-12px"},"决策节点详情")],-1)),n(yt,{"model-value":t.value.conditionNodes[j]},null,8,["model-value"])]),_:2},1032,["id","show","onUpdate:show","ids"])]))),128))]),n(fe,{modelValue:t.value.childNode,"onUpdate:modelValue":$[0]||($[0]=A=>t.value.childNode=A),disabled:h.disabled},null,8,["modelValue","disabled"])]),n(ol,{open:x.value,"onUpdate:open":$[1]||($[1]=A=>x.value=A),modelValue:m.value,"onUpdate:modelValue":$[2]||($[2]=A=>m.value=A),len:t.value.conditionNodes.length,"onUpdate:len":$[3]||($[3]=A=>t.value.conditionNodes.length=A),onSave:E},null,8,["open","modelValue","len"])])}}}),xl=pe(Nl,[["__scopeId","data-v-61d296a2"]]),$l={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Sl(e,a){return p(),D("svg",$l,a[0]||(a[0]=[g("path",{fill:"currentColor",d:"M112 476h160v72H112zm320 0h160v72H432zm320 0h160v72H752z"},null,-1)]))}const Vl=ne({name:"ant-design-dash-outlined",render:Sl}),Bl={class:"w-460px flex items-center"},Cl=P({name:"CallbackDrawer",__name:"callback-drawer",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open","save"],setup(e,{emit:a}){const i=e,f=a,s=k(!1),t=k({});W(()=>i.open,d=>{s.value=d},{immediate:!0}),W(()=>i.modelValue,d=>{t.value=d},{immediate:!0});const o=k(),b=()=>{f("update:open",!1),s.value=!1},u=()=>{var d;(d=o.value)==null||d.validate(c=>{c||(b(),f("save",t.value))}).catch(()=>{var c;return(c=window.$message)==null?void 0:c.warning("请检查表单信息")})},r={workflowNodeStatus:[{required:!0,message:"请选择工作流状态",trigger:"change"}],callback:{webhook:[{required:!0,message:"请输入 webhook",trigger:"change"}],contentType:[{required:!0,message:"请选择请求类型",trigger:"change",type:"number"}],secret:[{required:!0,message:"请输入秘钥",trigger:"change"}]}};return(d,c)=>{const x=qe,_=De,m=Te,E=Ee,B=Le,y=je,C=Ue,I=ie,R=Re,Y=Me;return p(),M(Y,{show:s.value,"onUpdate:show":c[5]||(c[5]=h=>s.value=h),"display-directive":"if",width:500,onAfterLeave:b},{default:l(()=>[n(R,null,{header:l(()=>[g("div",Bl,[n(Ae,{modelValue:t.value.nodeName,"onUpdate:modelValue":c[0]||(c[0]=h=>t.value.nodeName=h),class:"mr-16px max-w-320px min-w-320px"},null,8,["modelValue"])])]),footer:l(()=>[n(I,{type:"primary",onClick:u},{default:l(()=>c[6]||(c[6]=[V("保存")])),_:1}),n(I,{class:"ml-12px",onClick:b},{default:l(()=>c[7]||(c[7]=[V("取消")])),_:1})]),default:l(()=>[n(C,{ref_key:"formRef",ref:o,model:t.value,rules:r,"label-align":"left","label-width":"100px"},{default:l(()=>[n(_,{path:"callback.webhook",label:"webhook"},{default:l(()=>[n(x,{value:t.value.callback.webhook,"onUpdate:value":c[1]||(c[1]=h=>t.value.callback.webhook=h),placeholder:"请输入 webhook"},null,8,["value"])]),_:1}),n(_,{path:"callback.contentType",label:"请求类型"},{default:l(()=>[n(m,{value:t.value.callback.contentType,"onUpdate:value":c[2]||(c[2]=h=>t.value.callback.contentType=h),options:v(Zt),placeholder:"请选择请求类型"},null,8,["value","options"])]),_:1}),n(_,{path:"callback.secret",label:"秘钥"},{default:l(()=>[n(x,{value:t.value.callback.secret,"onUpdate:value":c[3]||(c[3]=h=>t.value.callback.secret=h),placeholder:"请输入秘钥"},null,8,["value"])]),_:1}),n(_,{name:"workflowNodeStatus",label:"工作流状态",rules:[{required:!0,message:"请选择工作流状态",trigger:"change"}]},{default:l(()=>[n(y,{value:t.value.workflowNodeStatus,"onUpdate:value":c[4]||(c[4]=h=>t.value.workflowNodeStatus=h)},{default:l(()=>[n(B,null,{default:l(()=>[(p(!0),D(Q,null,ae(v(Xe),(h,$)=>(p(),M(E,{key:$,label:v(U)(h.label),value:h.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),Tl=P({name:"CallbackDetail",__name:"callback-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,f=a,s=k(!1);W(()=>i.open,o=>{s.value=o},{immediate:!0});const t=()=>{f("update:open",!1)};return(o,b)=>{const u=we,r=ye,d=$e;return p(),M(d,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=c=>s.value=c),title:"回调详情",width:["500px","90%"],onAfterLeave:t},{default:l(()=>[n(r,{column:1,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(u,{label:"节点名称"},{default:l(()=>[V(S(o.modelValue.nodeName),1)]),_:1}),n(u,{label:"webhook"},{default:l(()=>{var c;return[V(S((c=o.modelValue.callback)==null?void 0:c.webhook),1)]}),_:1}),n(u,{label:"请求类型"},{default:l(()=>{var c;return[V(S(v(Ye)[(c=o.modelValue.callback)==null?void 0:c.contentType]),1)]}),_:1}),n(u,{label:"密钥"},{default:l(()=>{var c;return[V(S((c=o.modelValue.callback)==null?void 0:c.secret),1)]}),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Dl={class:"node-wrap"},Ll={class:"branch-box"},Ul={class:"condition-node min-h-230px"},Rl={class:"condition-node-box pt-0px"},Ml={class:"popover"},Il={class:"popover-item"},jl={class:"popover-item"},El=["onClick"],zl={class:"title"},Al={class:"text text-#935af6"},Hl={class:"flex items-center"},Yl={key:0},Ol={class:"content min-h-81px"},ql={key:0,class:"placeholder"},Xl={class:"flex justify-between"},Wl={class:"content_label"},Pl={key:1,class:"top-left-cover-line"},Fl={key:2,class:"bottom-left-cover-line"},Gl={key:3,class:"top-right-cover-line"},Jl={key:4,class:"bottom-right-cover-line"},Zl=P({name:"CallbackNode",__name:"callback-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,f=a,s=me(),t=k({});W(()=>i.modelValue,I=>{t.value=I},{immediate:!0});const o=(I,R)=>{I.childNode?o(I.childNode,R):I.childNode=R},b=()=>{t.value.childNode&&(t.value.conditionNodes[0].childNode?o(t.value.conditionNodes[0].childNode,t.value.childNode):t.value.conditionNodes[0].childNode=t.value.childNode),re(()=>{f("update:modelValue",t.value.conditionNodes[0].childNode)})},u=k(0),r=k(!1),d=k(!1),c=k({}),x=I=>{t.value.conditionNodes[u.value]=I,f("update:modelValue",t.value)},_=I=>{s.type===0?(u.value=I,c.value=JSON.parse(JSON.stringify(t.value.conditionNodes[I])),r.value=!0):d.value=!0},m=k(!1),E=k(""),B=k([]),y=(I,R)=>{var Y;if(B.value=[],s.type===2){if((Y=I.jobBatchList)==null||Y.forEach(h=>{var $,L;h.id?($=B.value)==null||$.push(h.id):h.jobId&&(E.value=(L=h.jobId)==null?void 0:L.toString())}),B.value.length===0){d.value=!0;return}m.value=!0}else s.type===1?d.value=!0:_(R)},C=I=>i.disabled?s.type===2?`node-error node-error-${I.taskBatchStatus?G[I.taskBatchStatus].name:"default"}`:"node-error":"auto-judge-def auto-judge-hover";return(I,R)=>{const Y=ft,h=ie,$=ct,L=Vl,O=ze,X=wt,N=xe,z=Pe,F=Ce,Z=Ie,ee=We,A=we,j=ye;return p(),D("div",Dl,[g("div",Ll,[(p(!0),D(Q,null,ae(t.value.conditionNodes,(w,q)=>(p(),D("div",{key:q,class:"col-box"},[g("div",Ul,[g("div",Rl,[n(ee,{disabled:v(s).type!==2||!0},{trigger:l(()=>{var ve,Se;return[g("div",{class:be(["auto-judge",C(w)]),onClick:Ge=>y(w,q)},[g("div",zl,[g("span",Al,[g("span",Hl,[n(O,{processing:"",dot:"",color:w.workflowNodeStatus===1?"#52c41a":"#ff4d4f"},null,8,["color"]),V("  "+S(w.nodeName)+" ",1),w.id?(p(),D("span",Yl," ("+S(w.id)+")",1)):T("",!0),n(N,null,{trigger:l(()=>[n(X,{class:"ml-3px text-16px"})]),default:l(()=>[R[7]||(R[7]=V(" 此节点后续将废弃，请使用定时任务中的 HTTP 内置执行器进行替换。 "))]),_:1})])]),I.disabled?T("",!0):(p(),M(z,{key:0,class:"close",onClick:de(b,["stop"])}))]),g("div",Ol,[(ve=w.callback)!=null&&ve.webhook?T("",!0):(p(),D("div",ql,S(v(U)("workflow.node.callback.conditionNodes.webhookTip")),1)),(Se=w.callback)!=null&&Se.webhook?(p(),D(Q,{key:1},[g("div",Xl,[R[8]||(R[8]=g("span",{class:"content_label"},"Webhook:",-1)),n(F,{class:"w-116px"},{default:l(()=>[V(S(w.callback.webhook),1)]),_:2},1024)]),g("div",null,[g("span",Wl,S(v(U)("workflow.node.callback.conditionNodes.contentType"))+": ",1),V(" "+S(v(Ye)[w.callback.contentType]),1)]),R[9]||(R[9]=g("div",null,".........",-1))],64)):T("",!0)]),v(s).type===2&&w.taskBatchStatus?(p(),M(N,{key:0},{trigger:l(()=>[g("div",{class:"error-tip text-24px",style:ce({color:v(G)[w.taskBatchStatus].color})},[n(Z,{icon:v(G)[w.taskBatchStatus].icon},null,8,["icon"])],4)]),default:l(()=>[V(" "+S(v(G)[w.taskBatchStatus].title),1)]),_:2},1024)):T("",!0)],10,El)]}),default:l(()=>[g("div",Ml,[n(h,{text:""},{default:l(()=>[g("span",Il,[n(Y,{class:"mb-3px text-24px font-bold"}),V(" "+S(v(U)("common.retry")),1)])]),_:1}),n($,{vertical:""}),n(h,{text:""},{default:l(()=>[g("span",jl,[n(L,{class:"mb-3px text-24px font-bold"}),R[6]||(R[6]=g("span",null,"忽略",-1))])]),_:1})])]),_:2},1032,["disabled"]),n(fe,{modelValue:w.childNode,"onUpdate:modelValue":ve=>w.childNode=ve,disabled:I.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),w.childNode?_e(I.$slots,"default",{key:0,node:w},void 0,!0):T("",!0),q==0?(p(),D("div",Pl)):T("",!0),q==0?(p(),D("div",Fl)):T("",!0),q==t.value.conditionNodes.length-1?(p(),D("div",Gl)):T("",!0),q==t.value.conditionNodes.length-1?(p(),D("div",Jl)):T("",!0)]))),128))]),t.value.conditionNodes.length>1?(p(),M(fe,{key:0,modelValue:t.value.childNode,"onUpdate:modelValue":R[0]||(R[0]=w=>t.value.childNode=w),disabled:I.disabled},null,8,["modelValue","disabled"])):T("",!0),v(s).type!==0?(p(),M(Tl,{key:1,open:d.value,"onUpdate:open":R[1]||(R[1]=w=>d.value=w),modelValue:t.value.conditionNodes[0],"onUpdate:modelValue":R[2]||(R[2]=w=>t.value.conditionNodes[0]=w)},null,8,["open","modelValue"])):T("",!0),n(Cl,{open:r.value,"onUpdate:open":R[3]||(R[3]=w=>r.value=w),modelValue:c.value,"onUpdate:modelValue":R[4]||(R[4]=w=>c.value=w),onSave:x},null,8,["open","modelValue"]),v(s).type!==0?(p(),M(Fe,{key:2,id:E.value,show:m.value,"onUpdate:show":R[5]||(R[5]=w=>m.value=w),ids:B.value},{default:l(()=>[R[10]||(R[10]=g("div",{class:"header-border"},[g("span",{class:"pl-18px"},"回调节点详情")],-1)),n(j,{column:1,bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(A,{label:"节点名称"},{default:l(()=>[V(S(t.value.conditionNodes[0].nodeName),1)]),_:1}),n(A,{label:"webhook"},{default:l(()=>{var w;return[V(S((w=t.value.conditionNodes[0].callback)==null?void 0:w.webhook),1)]}),_:1}),n(A,{label:"请求类型"},{default:l(()=>{var w;return[V(S(v(Ye)[(w=t.value.conditionNodes[0].callback)==null?void 0:w.contentType]),1)]}),_:1}),n(A,{label:"密钥"},{default:l(()=>{var w;return[V(S((w=t.value.conditionNodes[0].callback)==null?void 0:w.secret),1)]}),_:1})]),_:1})]),_:1},8,["id","show","ids"])):T("",!0)])}}}),Kl=pe(Zl,[["__scopeId","data-v-39010ff7"]]),Ql=P({name:"NodeWrap",__name:"node-wrap",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["refresh","update:modelValue"],setup(e,{emit:a}){const i=e,f=a,s=k({});return W(()=>i.modelValue,t=>{s.value=t},{immediate:!0}),W(()=>s.value,t=>{f("update:modelValue",t)}),(t,o)=>{const b=Kt("NodeWrap",!0);return p(),D(Q,null,[s.value.nodeType==1?(p(),M(Zn,{key:0,modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=u=>s.value=u),disabled:t.disabled,onRefresh:o[1]||(o[1]=()=>f("refresh"))},{default:l(u=>[u.node?(p(),M(b,{key:0,modelValue:u.node.childNode,"onUpdate:modelValue":r=>u.node.childNode=r,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])):T("",!0)]),_:1},8,["modelValue","disabled"])):T("",!0),s.value.nodeType==2?(p(),M(xl,{key:1,modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=u=>s.value=u),disabled:t.disabled},{default:l(u=>[u.node?(p(),M(b,{key:0,modelValue:u.node.childNode,"onUpdate:modelValue":r=>u.node.childNode=r,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])):T("",!0)]),_:1},8,["modelValue","disabled"])):T("",!0),s.value.nodeType==3?(p(),M(Kl,{key:2,modelValue:s.value,"onUpdate:modelValue":o[3]||(o[3]=u=>s.value=u),disabled:t.disabled},{default:l(u=>[u.node?(p(),M(b,{key:0,modelValue:u.node.childNode,"onUpdate:modelValue":r=>u.node.childNode=r,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])):T("",!0)]),_:1},8,["modelValue","disabled"])):T("",!0),s.value.childNode?(p(),M(b,{key:3,modelValue:s.value.childNode,"onUpdate:modelValue":o[4]||(o[4]=u=>s.value.childNode=u),disabled:t.disabled},null,8,["modelValue","disabled"])):T("",!0)],64)}}}),ea=P({name:"StartDetail",__name:"start-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,f=a,s=k(!1);W(()=>i.open,o=>{s.value=o},{immediate:!0});const t=()=>{f("update:open",!1)};return(o,b)=>{const u=we,r=ye,d=$e;return p(),M(d,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=c=>s.value=c),title:"工作流详情",width:["500px","90%"],onAfterLeave:t},{default:l(()=>[n(r,{column:1,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(u,{label:"工作流名称"},{default:l(()=>[V(S(o.modelValue.workflowName),1)]),_:1}),n(u,{label:"组名称"},{default:l(()=>[V(S(o.modelValue.groupName),1)]),_:1}),n(u,{label:"触发类型"},{default:l(()=>[V(S(v(U)(v(Qt)[o.modelValue.triggerType])),1)]),_:1}),n(u,{label:"触发间隔"},{default:l(()=>[V(S(o.modelValue.triggerInterval)+" "+S(o.modelValue.triggerType===2?"秒":null),1)]),_:1}),n(u,{label:"执行超时时间"},{default:l(()=>[V(S(o.modelValue.executorTimeout)+" 秒",1)]),_:1}),n(u,{label:"阻塞策略"},{default:l(()=>[V(S(v(U)(v(mt)[o.modelValue.blockStrategy])),1)]),_:1}),n(u,{label:"工作流上下文"},{default:l(()=>[V(S(o.modelValue.wfContext),1)]),_:1}),n(u,{label:"工作流状态"},{default:l(()=>[V(S(v(U)(v(dt)[o.modelValue.workflowStatus])),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),ta=P({name:"StartDrawer",__name:"start-drawer",props:{modelValue:{default:()=>({wfContexts:[]})},open:{type:Boolean,default:!1}},emits:["update:open","save"],setup(e,{emit:a}){const i=k([]),f=e;Ne(()=>{re(()=>{s()})});async function s(){const y=await $o(4);i.value=y.data}const t=a,o=me();let b="";const u=k(!1),r=k({wfContexts:[],notifyIds:[]}),d=k([]);W(()=>f.open,y=>{u.value=y},{immediate:!0}),W(()=>f.modelValue,y=>{r.value=y,y.triggerType===2&&(r.value.triggerInterval=Number(y.triggerInterval)),y.workflowName?b=y.workflowName:y.groupName?b=y.groupName:b="请选择组",y.wfContext&&(r.value.wfContext=JSON.parse(y.wfContext),r.value.wfContexts=eo(y.wfContext))},{immediate:!0});const c=k(),x=()=>{t("update:open",!1),u.value=!1},_=()=>{var y;(y=c.value)==null||y.validate(C=>{C||(r.value.wfContext=JSON.stringify(no(r.value.wfContexts)||{}),x(),t("save",r.value))}).catch(()=>{var C;return(C=window.$message)==null?void 0:C.warning("请检查表单信息")})};(async()=>{const{data:y,error:C}=await So();C||(d.value=y)})();const E=y=>{y===3?r.value.triggerInterval="* * * * * ?":y===2&&(r.value.triggerInterval=60)},B={groupName:{required:!0,message:"请选择组"},triggerType:{required:!0,message:"请选择触发类型"},triggerInterval:{required:!0,message:"请输入触发间隔"},executorTimeout:{required:!0,message:"请输入执行超时时间"},blockStrategy:{required:!0,message:"请选择阻塞策略"},workflowStatus:{required:!0,message:"请选择工作流状态"}};return(y,C)=>{const I=Te,R=De,Y=go,h=lo,$=bo,L=Ee,O=Le,X=je,N=vt,z=qe,F=Ue,Z=ie,ee=Re,A=Me;return p(),M(A,{show:u.value,"onUpdate:show":C[11]||(C[11]=j=>u.value=j),"display-directive":"if",width:610,onAfterLeave:x},{default:l(()=>[n(ee,{title:v(b)},{header:l(()=>[n(Ae,{modelValue:r.value.workflowName,"onUpdate:modelValue":C[0]||(C[0]=j=>r.value.workflowName=j),class:"max-w-570px min-w-570px"},null,8,["modelValue"])]),footer:l(()=>[n(Z,{type:"primary",onClick:_},{default:l(()=>C[14]||(C[14]=[V("保存")])),_:1}),n(Z,{class:"ml-12px",onClick:x},{default:l(()=>C[15]||(C[15]=[V("取消")])),_:1})]),default:l(()=>[n(F,{ref_key:"formRef",ref:c,model:r.value,rules:B,"label-align":"left","label-width":"100px"},{default:l(()=>{var j;return[n(R,{path:"groupName",label:"组名称"},{default:l(()=>[n(I,{value:r.value.groupName,"onUpdate:value":C[1]||(C[1]=w=>r.value.groupName=w),placeholder:"请选择组",disabled:v(o).type===0&&v(ke)(v(o).id),options:d.value.map(w=>({label:w,value:w}))},null,8,["value","disabled","options"])]),_:1}),n($,{cols:24,"x-gap":"20"},{default:l(()=>[n(Y,{span:8},{default:l(()=>[n(R,{path:"triggerType",label:"触发类型"},{default:l(()=>[n(I,{value:r.value.triggerType,"onUpdate:value":[C[2]||(C[2]=w=>r.value.triggerType=w),E],placeholder:"请选择触发类型",options:v(to).map(w=>({label:v(U)(w.label),value:w.value}))},null,8,["value","options"])]),_:1})]),_:1}),n(Y,{span:16},{default:l(()=>[n(R,{path:"triggerInterval",label:"触发间隔"},{default:l(()=>[r.value.triggerType===3?(p(),M(v(xo),{key:0,modelValue:r.value.triggerInterval,"onUpdate:modelValue":C[3]||(C[3]=w=>r.value.triggerInterval=w),placeholder:"请输入Cron表达式"},null,8,["modelValue"])):(p(),M(h,{key:1,value:r.value.triggerInterval,"onUpdate:value":C[4]||(C[4]=w=>r.value.triggerInterval=w),min:1,class:"w-full",placeholder:"请输入触发间隔"},{suffix:l(()=>C[12]||(C[12]=[V("秒")])),_:1},8,["value"]))]),_:1})]),_:1})]),_:1}),n($,{cols:24,"x-gap":"20"},{default:l(()=>[n(Y,{span:8},{default:l(()=>[n(R,{path:"executorTimeout",label:"执行超时时间"},{default:l(()=>[n(h,{value:r.value.executorTimeout,"onUpdate:value":C[5]||(C[5]=w=>r.value.executorTimeout=w),placeholder:"请输入超时时间",min:1},{suffix:l(()=>C[13]||(C[13]=[V("秒")])),_:1},8,["value"])]),_:1})]),_:1}),n(Y,{span:16},{default:l(()=>[n(R,{path:"blockStrategy",label:"阻塞策略"},{default:l(()=>[n(X,{value:r.value.blockStrategy,"onUpdate:value":C[6]||(C[6]=w=>r.value.blockStrategy=w)},{default:l(()=>[n(O,null,{default:l(()=>[(p(!0),D(Q,null,ae(v(oo),(w,q)=>(p(),M(L,{key:q,label:v(U)(w.label),value:w.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),n(R,{path:"wfContext",label:"工作流上下文","show-feedback":!((j=r.value.wfContexts)!=null&&j.length)},{default:l(()=>[n(N,{value:r.value.wfContexts,"onUpdate:value":C[7]||(C[7]=w=>r.value.wfContexts=w),path:"wfContexts"},null,8,["value"])]),_:1},8,["show-feedback"]),n(R,{path:"workflowStatus",label:"节点状态"},{default:l(()=>[n(X,{value:r.value.workflowStatus,"onUpdate:value":C[8]||(C[8]=w=>r.value.workflowStatus=w)},{default:l(()=>[n(O,null,{default:l(()=>[(p(!0),D(Q,null,ae(v(Xe),(w,q)=>(p(),M(L,{key:q,label:v(U)(w.label),value:w.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),n(R,{path:"notifyIds",label:"告警通知"},{default:l(()=>[n(I,{value:r.value.notifyIds,"onUpdate:value":C[9]||(C[9]=w=>r.value.notifyIds=w),"value-field":"id","label-field":"notifyName",placeholder:"请选择告警通知名称",options:i.value,clearable:"",multiple:""},null,8,["value","options"])]),_:1}),n(R,{path:"description",label:"描述"},{default:l(()=>[n(z,{value:r.value.description,"onUpdate:value":C[10]||(C[10]=w=>r.value.description=w),type:"textarea",autosize:{minRows:5},placeholder:"请输入描述"},null,8,["value"])]),_:1})]}),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),oa={class:"node-wrap"},na={class:"title"},la={class:"text"},aa={class:"text-#ff943e"},sa={key:0,class:"content"},ia={key:1,class:"content min-h-85px"},da=P({name:"StartNode",__name:"start-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,f=a,s=me(),t=k({}),o=k({});W(()=>i.modelValue,c=>{o.value=c},{immediate:!0}),W(()=>o.value,c=>{f("update:modelValue",c)}),W(()=>{var c;return(c=o.value)==null?void 0:c.groupName},c=>{c&&s.setJobList(c)},{immediate:!0});const b=k(!1),u=k(!1),r=c=>{o.value=c},d=()=>{s.type===0?(t.value=JSON.parse(JSON.stringify(o.value)),b.value=!0):u.value=!0};return(c,x)=>{const _=ze,m=Ce,E=Ie,B=xe;return p(),D("div",oa,[g("div",{class:be([`${c.disabled?"start-node-disabled":"node-wrap-box-hover"} ${v(s).type===2?"node-error-success":""}`,"node-wrap-box start-node"]),onClick:d},[g("div",na,[g("span",la,[n(_,{dot:"",color:o.value.workflowStatus===1?"#52c41a":"#ff000d"},null,8,["color"]),g("span",aa,"  "+S(o.value.workflowName?`${o.value.workflowName} ${o.value.id?` (${o.value.id})`:""}`:"请选择组"),1)])]),o.value.groupName?(p(),D("div",sa,[g("div",null,[x[5]||(x[5]=g("span",{class:"content_label"},"组名称: ",-1)),n(m,{class:"max-w-132px"},{default:l(()=>[V(S(o.value.groupName),1)]),_:1})]),g("div",null,[x[6]||(x[6]=g("span",{class:"content_label"},"阻塞策略: ",-1)),V(" "+S(v(U)(v(mt)[o.value.blockStrategy])),1)]),x[7]||(x[7]=g("div",null,".........",-1))])):(p(),D("div",ia,x[8]||(x[8]=[g("span",{class:"placeholder"},"请配置工作流",-1)]))),v(s).type===2?(p(),M(B,{key:2},{trigger:l(()=>[g("div",{class:"error-tip text-24px",style:ce({color:v(G)[3].color})},[n(E,{icon:v(G)[3].icon},null,8,["icon"])],4)]),default:l(()=>[V(" "+S(v(G)[3].title),1)]),_:1})):T("",!0)],2),n(fe,{modelValue:o.value.nodeConfig,"onUpdate:modelValue":x[0]||(x[0]=y=>o.value.nodeConfig=y),disabled:c.disabled},null,8,["modelValue","disabled"]),v(s).type!==0?(p(),M(ea,{key:0,open:u.value,"onUpdate:open":x[1]||(x[1]=y=>u.value=y),modelValue:o.value,"onUpdate:modelValue":x[2]||(x[2]=y=>o.value=y)},null,8,["open","modelValue"])):T("",!0),n(ta,{open:b.value,"onUpdate:open":x[3]||(x[3]=y=>b.value=y),modelValue:t.value,"onUpdate:modelValue":x[4]||(x[4]=y=>t.value=y),onSave:r},null,8,["open","modelValue"])])}}}),ra=pe(da,[["__scopeId","data-v-e0e4d99d"]]),ua={class:"workflow"},ca={class:"workflow-affix"},pa={class:"header"},ma={class:"ml-8px mr-8px text-18px text-#333639 dark:text-#d6d6d6"},fa={key:0,class:"buttons"},va={key:1,class:"buttons"},ha={class:"workflow-body"},ga={class:"box-scale"},ba={class:"end-node"},_a={class:"end-node-text"},Ua=P({name:"SnailWorkflow",__name:"workflow",props:{modelValue:{default:()=>({})},spinning:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","save","cancel","refresh"],setup(e,{emit:a}){const i=e,f=a,s=rt(),t=k(100),o=k({}),b=async()=>{f("save")},u=()=>{f("cancel")};W(()=>i.modelValue,_=>{o.value=_},{immediate:!0}),W(()=>o.value,_=>{f("update:modelValue",_)});const r=_=>{if(t.value+=10*_,_>0){const m=document.querySelector(".workflow-body");m&&(t.value<=160&&m.scrollTo({left:280*t.value/100,behavior:"smooth"}),t.value>160&&m.scrollTo({left:420*t.value/100,behavior:"smooth"}),t.value>200&&m.scrollTo({left:520*t.value/100,behavior:"smooth"}))}t.value<=10?t.value=10:t.value>=300&&(t.value=300)},d=_=>{_.preventDefault(),_.wheelDelta<0?r(-1):r(1)};Ne(()=>{const _=document.querySelector(".workflow");_&&(_.onwheel=m=>d(m))});const c=()=>{const _=document.querySelector(".workflow-design");_&&_.setAttribute("style",`cursor: grabbing; transform: scale(${t.value/100})`)},x=()=>{const _=document.querySelector(".workflow-design");_&&_.setAttribute("style",`cursor: grab; transform: scale(${t.value/100})`)};return(_,m)=>{const E=qo,B=ie,y=xe,C=ht,I=Lo,R=ut;return p(),D("div",ua,[g("div",ca,[n(I,{"trigger-top":0,class:"position-sticky z-2"},{default:l(()=>[g("div",pa,[g("div",null,[n(y,null,{trigger:l(()=>[n(B,{size:"small",strong:"",circle:"",onClick:m[0]||(m[0]=Y=>r(-1))},{default:l(()=>[n(E)]),_:1})]),default:l(()=>[m[5]||(m[5]=V(" 缩小 "))]),_:1}),g("span",ma,S(t.value)+"%",1),n(y,null,{trigger:l(()=>[n(B,{size:"small",strong:"",circle:"",onClick:m[1]||(m[1]=Y=>r(1))},{default:l(()=>[n(C)]),_:1})]),default:l(()=>[m[6]||(m[6]=V(" 放大 "))]),_:1})]),_.disabled?T("",!0):(p(),D("div",fa,[n(B,{type:"info",onClick:b},{default:l(()=>m[7]||(m[7]=[V("保存")])),_:1}),n(B,{class:"ml-16px",onClick:u},{default:l(()=>m[8]||(m[8]=[V("取消")])),_:1})])),_.disabled&&v(s).buttons?(p(),D("div",va,[_e(_.$slots,"buttons")])):T("",!0)])]),_:3}),n(R,{show:_.spinning},{default:l(()=>[g("div",ha,[n(v(gt),{class:"vue-drag","is-draggable":!0,"is-resizable":!1,z:1,onDragging:c,onDragstop:x},{default:l(()=>[g("div",{class:"workflow-design",style:ce(`transform: scale(${t.value/100})`)},[g("div",ga,[n(ra,{modelValue:o.value,"onUpdate:modelValue":m[2]||(m[2]=Y=>o.value=Y),disabled:_.disabled},null,8,["modelValue","disabled"]),o.value.nodeConfig?(p(),M(Ql,{key:0,modelValue:o.value.nodeConfig,"onUpdate:modelValue":m[3]||(m[3]=Y=>o.value.nodeConfig=Y),disabled:_.disabled,onRefresh:m[4]||(m[4]=()=>f("refresh"))},null,8,["modelValue","disabled"])):T("",!0),g("div",ba,[m[9]||(m[9]=g("div",{class:"end-node-circle"},null,-1)),g("div",_a,S(v(U)("workflow.node.endNode")),1)])])],4)]),_:1})])]),_:1},8,["show"])])])}}});export{Ua as _,me as u};
