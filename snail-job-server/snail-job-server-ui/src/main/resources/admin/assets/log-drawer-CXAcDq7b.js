import{d as G,aj as ee,bR as ue,dh as de,r as y,aR as D,b as R,o as r,e as p,aP as se,a0 as me,a1 as pe,cz as fe,q as _e,c1 as ve,c as m,cN as ge,w as s,f as l,cO as he,Q as C,h as g,bP as H,as as P,x as ye,a7 as be,g as $,t as K,aO as te,B as le,_ as ke,W as E,di as xe,dj as we,G as Se,an as Ie,ah as $e,a3 as W,dk as ne,l as ze}from"./index-CW-HgCkC.js";import{_ as Te,a as oe}from"./CollapseItem-_OeQO-9P.js";const Ce={scrollbarProps:Object,items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},Re=G({name:"VirtualList",props:Ce,setup(u){const t=y(null),h=y(null);function f(){const{value:i}=t;i&&i.sync()}function z(i){var o;f(),(o=u.onScroll)===null||o===void 0||o.call(u,i)}function j(i){var o;f(),(o=u.onResize)===null||o===void 0||o.call(u,i)}function L(i){var o;(o=u.onWheel)===null||o===void 0||o.call(u,i)}function b(i,o){var w,S;typeof i=="number"?(w=h.value)===null||w===void 0||w.scrollTo(i,o??0):(S=h.value)===null||S===void 0||S.scrollTo(i)}function _(){var i;return(i=h.value)===null||i===void 0?void 0:i.listElRef}function T(){var i;return(i=h.value)===null||i===void 0?void 0:i.itemsElRef}return{scrollTo:b,scrollbarInstRef:t,virtualListInstRef:h,getScrollContainer:_,getScrollContent:T,handleScroll:z,handleResize:j,handleWheel:L}},render(){return ee(de,Object.assign({},this.scrollbarProps,{ref:"scrollbarInstRef",container:this.getScrollContainer,content:this.getScrollContent}),{default:()=>ee(ue,{ref:"virtualListInstRef",showScrollbar:!1,items:this.items,itemSize:this.itemSize,itemResizable:this.itemResizable,itemsStyle:this.itemsStyle,visibleItemsTag:this.visibleItemsTag,visibleItemsProps:this.visibleItemsProps,ignoreItemResize:this.ignoreItemResize,keyField:this.keyField,defaultScrollKey:this.defaultScrollKey,defaultScrollIndex:this.defaultScrollIndex,paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,onScroll:this.handleScroll,onResize:this.handleResize,onWheel:this.handleWheel},{default:({item:u,index:t})=>{var h,f;return(f=(h=this.$slots).default)===null||f===void 0?void 0:f.call(h,{item:u,index:t})}})})}}),je={class:"inline-block",viewBox:"0 0 14 14",width:"1em",height:"1em"};function Be(u,t){return r(),R("svg",je,t[0]||(t[0]=[p("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[p("path",{d:"M10.13 3.48L7.26.61a.36.36 0 0 0-.52 0L3.87 3.48m6.26 7.04l-2.87 2.87a.36.36 0 0 1-.52 0l-2.87-2.87"}),p("circle",{cx:"7",cy:"7",r:"1.25"})],-1)]))}const Ne=D({name:"streamline-interface-arrows-vertical-scroll-point-move-scroll-vertical",render:Be}),De={class:"inline-block",viewBox:"0 0 14 14",width:"1em",height:"1em"};function Le(u,t){return r(),R("svg",De,t[0]||(t[0]=[p("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[p("path",{d:"m5 11l.5 2l-2 .5"}),p("path",{d:"M5.5 13A6.76 6.76 0 0 1 1 7a6 6 0 0 1 .66-2.736M4.95 1.36a6 6 0 0 0-2.19 1.394M9 3l-.5-2l2-.5"}),p("path",{d:"M8.5 1c2.3.84 4.5 3.42 4.5 6a6 6 0 0 1-1.731 4.2M9 12.64q.33-.117.642-.27M.5.5l13 13"})],-1)]))}const Me=D({name:"streamline-synchronize-disable",render:Le}),qe={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Oe(u,t){return r(),R("svg",qe,t[0]||(t[0]=[p("path",{fill:"currentColor","fill-rule":"evenodd",d:"M2.93 11.2c.072-4.96 4.146-8.95 9.149-8.95a9.16 9.16 0 0 1 7.814 4.357a.75.75 0 0 1-1.277.786a7.66 7.66 0 0 0-6.537-3.643c-4.185 0-7.575 3.328-7.648 7.448l.4-.397a.75.75 0 0 1 1.057 1.065l-1.68 1.666a.75.75 0 0 1-1.056 0l-1.68-1.666A.75.75 0 1 1 2.528 10.8zm16.856-.733a.75.75 0 0 1 1.055 0l1.686 1.666a.75.75 0 1 1-1.054 1.067l-.41-.405c-.07 4.965-4.161 8.955-9.18 8.955a9.2 9.2 0 0 1-7.842-4.356a.75.75 0 1 1 1.277-.788a7.7 7.7 0 0 0 6.565 3.644c4.206 0 7.61-3.333 7.68-7.453l-.408.403a.75.75 0 1 1-1.055-1.067z","clip-rule":"evenodd"},null,-1)]))}const Ve=D({name:"solar-refresh-outline",render:Oe}),Fe={class:"inline-block",viewBox:"0 0 16 16",width:"1em",height:"1em"};function Ae(u,t){return r(),R("svg",Fe,t[0]||(t[0]=[p("path",{fill:"currentColor","fill-rule":"evenodd",d:"M7.706.29c-.222.072-.35.2-.412.409c-.035.117-.041.389-.041 1.809c0 1.881-.002 1.857.19 2.049c.257.256.857.256 1.114 0c.192-.192.19-.168.19-2.049c0-1.82-.003-1.852-.151-2.028C8.472.333 8.339.284 8.04.276a1.7 1.7 0 0 0-.334.014M2.753 2.266c-.158.072-.391.3-.472.462a.6.6 0 0 0-.012.525c.074.165 2.398 2.497 2.581 2.59q.39.2.793-.194c.264-.258.334-.538.2-.799c-.093-.183-2.425-2.507-2.59-2.581a.64.64 0 0 0-.5-.003m10.1.016c-.123.057-.333.254-1.335 1.259c-.921.923-1.202 1.221-1.247 1.319a.62.62 0 0 0 .001.518c.07.15.3.386.455.467c.157.082.39.081.553-.002c.167-.086 2.477-2.396 2.563-2.563a.65.65 0 0 0 .003-.551a1.26 1.26 0 0 0-.454-.446a.57.57 0 0 0-.539-.001M.699 7.292q-.442.139-.441.707c.001.387.145.619.44.707c.118.035.381.041 1.81.041c1.489 0 1.688-.005 1.81-.045a.6.6 0 0 0 .384-.384c.086-.265.043-.641-.094-.827a.7.7 0 0 0-.191-.148l-.137-.076l-1.733-.006c-1.395-.004-1.756.002-1.848.031m11.046-.014a.76.76 0 0 0-.353.214c-.137.185-.18.561-.094.826c.058.18.204.326.384.384c.122.04.321.045 1.81.045c1.429 0 1.692-.006 1.81-.041c.295-.088.439-.32.44-.707c0-.385-.147-.616-.452-.708c-.103-.031-.426-.037-1.794-.035c-.918.002-1.706.012-1.751.022m-6.892 3.004c-.123.057-.333.254-1.335 1.259c-.921.923-1.202 1.221-1.247 1.319a.62.62 0 0 0 .001.518c.07.15.3.386.455.467c.157.082.39.081.553-.002c.167-.086 2.477-2.396 2.563-2.563a.65.65 0 0 0 .003-.551a1.26 1.26 0 0 0-.454-.446a.57.57 0 0 0-.539-.001m5.9-.016c-.158.072-.391.3-.472.462a.6.6 0 0 0-.012.525c.074.165 2.398 2.497 2.581 2.59q.39.2.793-.194c.264-.258.334-.538.2-.799c-.093-.183-2.425-2.507-2.59-2.581a.64.64 0 0 0-.5-.003m-3.008 1.011a.77.77 0 0 0-.353.215c-.138.186-.139.199-.139 1.997c0 1.432.006 1.695.041 1.813q.13.44.706.439q.576.002.706-.439c.062-.212.061-3.427-.002-3.612a.53.53 0 0 0-.284-.344c-.11-.06-.174-.075-.363-.082a1.5 1.5 0 0 0-.312.013"},null,-1)]))}const Pe=D({name:"nonicons-loading16",render:Ae}),Ee={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function We(u,t){return r(),R("svg",Ee,t[0]||(t[0]=[p("path",{fill:"currentColor",d:"m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"},null,-1)]))}const Ue=D({name:"material-symbols-check-circle",render:We});function ae(u,t){return se({url:"/job/log/list",method:"get",params:u,signal:t==null?void 0:t.signal})}function He(u){return se({url:"/retry-task/message/list",method:"get",params:u})}const Ke={class:"flex-center"},Ge={class:"ml-6px"},Je={class:"flex-center gap-8px"},Qe={class:"flex-center"},Xe={key:0,class:"empty-height flex-center"},Ye={class:"flex items-center"},Ze={class:"flex-center gap-8px"},et={key:0,class:"h-full flex-center"},tt=G({name:"LogDrawer",__name:"log-drawer",props:me({title:{default:void 0},drawer:{type:Boolean,default:!0},type:{default:"job"},taskData:{default:void 0},modelValue:{default:()=>[]}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(u){const t=u,h=pe(u,"show"),f=y(!1),z=y(!0),j=y([]),L=y(),b=y(1),_=y([]),T=y();let i=new AbortController;const o=y(!0);let w="0",S=0;const J=()=>{o.value=!0,clearTimeout(T.value),T.value=void 0},U=()=>{o.value||i.abort(),J(),w="0",S=0,_.value=[]};async function B(){clearTimeout(T.value);let n=null,e;if(t.type==="job"){const c=t.taskData,{data:d,error:a}=await ae({taskBatchId:c.taskBatchId,jobId:c.jobId,taskId:c.id,startId:w,fromIndex:S,size:50},i);n=d,e=a}if(t.type==="retry"){const c=t.taskData,{data:d,error:a}=await He({groupName:c.groupName,retryTaskId:c.id,startId:w,fromIndex:S,size:50});n=d,e=a}!e&&n?(o.value=n.finished||b.value===0,w=n.nextStartId,S=n.fromIndex,n.message&&(_.value.push(...n.message),_.value.sort((c,d)=>Number.parseInt(c.time_stamp,10)-Number.parseInt(d.time_stamp,10)).forEach((c,d)=>c.index=d)),Ie(()=>{var c;f.value&&((c=L.value)==null||c.scrollTo({position:"bottom",debounce:!0}))}),!o.value&&b.value!==0&&(T.value=setTimeout(B,b.value*1e3)),o.value&&b.value!==0&&setTimeout(()=>{Q()},5*1e3)):(e==null?void 0:e.code)!=="ERR_CANCELED"&&U()}async function Q(){if(clearTimeout(T.value),t.type==="job"&&b.value!==0){const n=t.taskData,{data:e,error:c}=await ae({taskBatchId:n.taskBatchId,jobId:n.jobId,taskId:n.id,startId:w,fromIndex:S,size:50},i);if(!c&&e){if(e.finished){T.value=setTimeout(Q,5*1e3);return}await B()}}}fe(()=>{U()}),_e(()=>h.value,async n=>{n&&t.modelValue&&(_.value=[...t.modelValue]),(n||!t.drawer)&&t.type&&t.taskData&&(o.value=!1,i=new AbortController,await B()),!n&&t.drawer&&U()},{immediate:!0});function ie(n){var N,O,V,F,A,x,Y,Z;const e=new Date(Number.parseInt(n==null?void 0:n.toString(),10)),c=e.getFullYear(),d=(e.getMonth()+1).toString().length===1?`0${e.getMonth()+1}`:(e.getMonth()+1).toString(),a=((N=e.getDate())==null?void 0:N.toString().length)===1?`0${e.getDate()}`:(O=e.getDate())==null?void 0:O.toString(),v=((V=e.getHours())==null?void 0:V.toString().length)===1?`0${e.getHours()}`:(F=e.getHours())==null?void 0:F.toString(),k=((A=e.getMinutes())==null?void 0:A.toString().length)===1?`0${e.getMinutes()}`:(x=e.getMinutes())==null?void 0:x.toString(),I=((Y=e.getSeconds())==null?void 0:Y.toString().length)===1?`0${e.getSeconds()}`:(Z=e.getSeconds())==null?void 0:Z.toString();return`${c}-${d}-${a} ${v}:${k}:${I}.${e.getMilliseconds()}`}const re=ve();function ce(){let n;t.type==="job"&&(n={type:t.type,taskBatchId:t.taskData.taskBatchId,jobId:t.taskData.jobId,taskId:t.taskData.id}),t.type==="retry"&&(n={type:t.type,groupName:t.taskData.groupName,retryTaskId:t.taskData.id});const e=re.resolve({path:"/log",query:n});window.open(e.href)}const M=async n=>{if(n===-1){o.value&&(o.value=!1,await B());return}if(b.value=n,n===0){J();return}o.value=!1,await B()},q=y([{label:"Off",key:0},{label:"Auto(1s)",key:1},{label:"5s",key:5},{label:"10s",key:10},{label:"30s",key:30},{label:"1m",key:60},{label:"5m",key:300}]),X=G({setup(){if(o.value&&_.value.length===0)return()=>l(H,{class:"h-full flex-center",size:"huge"},null);const n=a=>{const v=a.throwable;if(!v)return l(W,null,null);const k=v.match(/^.+/m);if(!k)return l(W,null,null);const I=v.replace(/^.+(\n|$)/m,"");return l(oe,{title:k[0],name:`throwable-${a.index}`},{default:()=>[l(ne,{"content-class":"p-8px",class:"message-scroll-body"},{default:()=>[`${I}`]})]})},e=a=>{const v=a.message;if(!v)return l(W,null,null);const k=v.match(/^.+/m);if(!k)return l(W,null,null);const I=v.replace(/^.+(\n|$)/m,"").replaceAll(`
`,`
 - `);return I?l(oe,{title:k[0],name:`message-${a.index}`},{default:()=>[l(ne,{"content-class":"p-8px",class:"message-scroll-body"},{default:()=>[` - ${I}`]})]}):l("div",{class:"pl-6px"},[$("- "),`${v}`])},c=a=>{j.value=a},d=a=>{j.value=[]};return()=>l("code",{class:"snail-log"},[l(Te,{accordion:!0,"expanded-names":j.value,"onUpdate:expanded-names":a=>j.value=a,"on-update:expanded-names":c},{default:()=>[l(Re,{ref:L,class:"virtual-list",itemSize:85,itemResizable:!0,paddingBottom:16,items:_.value,scrollbarProps:{xScrollable:!0},onResize:d},{default:({item:a})=>l("pre",{key:a.index,class:"min-h-85px min-w-full"},[l("div",null,[l("span",{class:"log-hljs-time inline-block"},[ie(a.time_stamp)]),l("span",{class:`log-hljs-level-${a.level} ml-12px mr-12px inline-block`},[`${a.level}`]),l("span",{class:"log-hljs-thread mr-12px inline-block"},[`[${a.host}:${a.port}]`]),l("span",{class:"log-hljs-thread mr-12px inline-block"},[`[${a.thread}]`])]),l("div",{class:"log-hljs-location"},[`${a.location}: `]),l("div",null,[e(a)]),l("div",null,[n(a)]),l($e,null,null)])})]})])}});return(n,e)=>{const c=Ue,d=be,a=Pe,v=Ve,k=ke,I=Me,N=Ne,O=xe,V=we,F=he,A=ge;return n.drawer?(r(),m(A,{key:0,show:h.value,"onUpdate:show":e[3]||(e[3]=x=>h.value=x),width:z.value?"100%":"50%","display-directive":"if","auto-focus":!1},{default:s(()=>[l(F,{closable:""},{header:s(()=>[p("div",{class:ye(["flex items-center justify-between",`tool-header${z.value?"-full":""}`])},[p("div",Ke,[o.value?(r(),m(d,{key:0},{trigger:s(()=>[l(c,{class:"text-20px color-success"})]),default:s(()=>[e[6]||(e[6]=$(" 日志加载完成 "))]),_:1})):(r(),m(d,{key:1},{trigger:s(()=>[l(g(P),{size:"small"},{icon:s(()=>[l(a)]),_:1})]),default:s(()=>[e[7]||(e[7]=$(" 日志正在加载 "))]),_:1})),p("span",Ge,K(n.title),1),l(g(te),{trigger:"hover",options:q.value,width:"trigger",onSelect:M},{default:s(()=>[l(d,{placement:"right"},{trigger:s(()=>[l(g(le),{dashed:"",class:"ml-16px w-136px",onClick:e[0]||(e[0]=x=>M(-1))},{icon:s(()=>[p("div",Je,[l(v,{class:"text-18px"}),$(" "+K(q.value.filter(x=>x.key===b.value)[0].label)+" ",1),l(k,{icon:"material-symbols:expand-more-rounded"})])]),_:1})]),default:s(()=>[e[8]||(e[8]=$(" 自动刷新频率 "))]),_:1})]),_:1},8,["options"])]),p("div",Qe,[l(E,{size:"tiny","tooltip-content":f.value?"关闭自动滚动":"开启自动滚动",onClick:e[1]||(e[1]=()=>f.value=!f.value)},{default:s(()=>[f.value?(r(),m(I,{key:0})):(r(),m(N,{key:1}))]),_:1},8,["tooltip-content"]),l(E,{size:"tiny",icon:"hugeicons:share-01","tooltip-content":"在新标签页打开",class:"ml-6px",onClick:ce}),l(E,{size:"tiny","tooltip-content":z.value?"半屏":"全屏",onClick:e[2]||(e[2]=()=>z.value=!z.value)},{default:s(()=>[z.value?(r(),m(O,{key:0})):(r(),m(V,{key:1}))]),_:1},8,["tooltip-content"])])],2)]),default:s(()=>[_.value.length===0?(r(),R("div",Xe,[_.value.length===0&&o.value?(r(),m(g(H),{key:0})):C("",!0),_.value.length===0&&!o.value?(r(),m(g(P),{key:1})):C("",!0)])):C("",!0),_.value.length>0?(r(),m(g(X),{key:1})):C("",!0)]),_:1})]),_:1},8,["show","width"])):(r(),m(g(Se),{key:1,bordered:!1,title:n.title,size:"small",class:"h-full sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[p("div",Ye,[l(g(te),{trigger:"hover",options:q.value,width:"trigger",onSelect:M},{default:s(()=>[l(d,{placement:"right"},{trigger:s(()=>[l(g(le),{dashed:"",class:"mx-12px w-136px",onClick:e[4]||(e[4]=x=>M(-1))},{icon:s(()=>[p("div",Ze,[l(v,{class:"text-18px"}),$(" "+K(q.value.filter(x=>x.key===b.value)[0].label)+" ",1),l(k,{icon:"material-symbols:expand-more-rounded"})])]),_:1})]),default:s(()=>[e[9]||(e[9]=$(" 自动刷新频率 "))]),_:1})]),_:1},8,["options"]),l(E,{size:"tiny",class:"mr-12px","tooltip-content":f.value?"关闭自动滚动":"开启自动滚动",onClick:e[5]||(e[5]=()=>f.value=!f.value)},{default:s(()=>[f.value?(r(),m(I,{key:0})):(r(),m(N,{key:1}))]),_:1},8,["tooltip-content"]),o.value?(r(),m(d,{key:0},{trigger:s(()=>[l(c,{class:"text-20px color-success"})]),default:s(()=>[e[10]||(e[10]=$(" 日志加载完成 "))]),_:1})):(r(),m(d,{key:1},{trigger:s(()=>[l(g(P),{size:"small"},{icon:s(()=>[l(a)]),_:1})]),default:s(()=>[e[11]||(e[11]=$(" 日志正在加载 "))]),_:1}))])]),default:s(()=>[_.value.length===0?(r(),R("div",et,[_.value.length===0&&o.value?(r(),m(g(H),{key:0})):C("",!0),_.value.length===0&&!o.value?(r(),m(g(P),{key:1})):C("",!0)])):C("",!0),l(g(X))]),_:1},8,["title"]))}}}),ot=ze(tt,[["__scopeId","data-v-51d70414"]]);export{ot as _,Ve as a,Ue as b,Pe as c};
