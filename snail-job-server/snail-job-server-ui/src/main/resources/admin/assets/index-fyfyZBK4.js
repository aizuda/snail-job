import{e as Ie,f as De,a as Re,b as $e,u as Ue,c as Ve,N as pe,d as Ce}from"./search-form.vue_vue_type_script_setup_true_lang-xYfW9G7N.js";import{d as Oe,_ as Ke,a as Fe}from"./download-ip38Mwxm.js";import{d as C,z,o as S,c as D,h as e,$ as t,X as Z,aH as Je,a6 as ee,aI as Ae,aJ as Pe,aK as Be,Q as Y,R as oe,C as _e,S as H,b as le,w as l,f as a,g as v,t as T,aL as Me,af as ze,aM as ye,a4 as ve,s as de,r as ge,m as Ge,n as Ee,a as Le,U as me,V as be,aN as Te,a8 as ke,v as qe,a1 as He,x as Qe,a2 as We,B as M,O as je,y as Xe,a9 as q,aO as he,aP as Ye,aQ as Ze,aF as ea,aR as Ne,aS as Se,P as te,u as aa,ad as ta,ae as X,av as ie,ag as la}from"./index-D3rICic-.js";import{b as oa,c as ra,d as na,e as sa,g as ua,h as pa}from"./job-8-wbHxv4.js";import{_ as ia}from"./status-switch.vue_vue_type_script_setup_true_lang-DuU56cot.js";import{u as ma}from"./auth-C5d9H5Pz.js";import{_ as xe}from"./select-group.vue_vue_type_script_setup_true_lang-Bk3YnuuX.js";import{_ as we,a as da}from"./route-key.vue_vue_type_script_setup_true_lang-Cls4SKv2.js";import{_ as fe}from"./code-mirror.vue_vue_type_script_setup_true_lang-CLSflgjt.js";import{a as ca,b as ga,_ as ba}from"./Grid-CRDcRyPk.js";import{_ as fa,a as _a}from"./DescriptionsItem-LhWljJnV.js";import"./Progress-BRSG0yYs.js";import"./group-frwXGSCG.js";import"./index-2ay5PpNs.js";const ya=C({name:"TriggerType",__name:"trigger-type",emits:["update:value"],setup(N,{emit:y}){const n=y,_=z(),s=c=>{n("update:value",c)};return(c,b)=>{const f=ee;return S(),D(f,{value:_.value,"onUpdate:value":[b[0]||(b[0]=o=>_.value=o),s],placeholder:e(t)("common.triggerType.form"),options:e(Z)(e(Je))},null,8,["value","placeholder","options"])}}}),va=C({name:"BlockStrategy",__name:"block-strategy",emits:["update:value"],setup(N,{emit:y}){const n=z(),_=y,s=c=>{_("update:value",c)};return(c,b)=>{const f=ee;return S(),D(f,{value:n.value,"onUpdate:value":[b[0]||(b[0]=o=>n.value=o),s],placeholder:e(t)("common.blockStrategy.form"),options:e(Z)(e(Ae))},null,8,["value","placeholder","options"])}}}),Ta=C({name:"TriggerStrategy",__name:"executor-type",emits:["update:value"],setup(N,{emit:y}){const n=z(),_=y,s=c=>{_("update:value",c)};return(c,b)=>{const f=ee;return S(),D(f,{value:n.value,"onUpdate:value":[b[0]||(b[0]=o=>n.value=o),s],placeholder:e(t)("common.executorType.form"),options:e(Z)(e(Pe))},null,8,["value","placeholder","options"])}}}),ka=C({name:"TaskType",__name:"task-type",emits:["update:value"],setup(N,{emit:y}){const n=y,_=z(),s=c=>{n("update:value",c)};return(c,b)=>{const f=ee;return S(),D(f,{value:_.value,"onUpdate:value":[b[0]||(b[0]=o=>_.value=o),s],placeholder:e(t)("common.routeKey.routeForm"),options:e(Z)(e(Be))},null,8,["value","placeholder","options"])}}}),ja=C({name:"JobTriggerInterval",__name:"job-trigger-interval",props:Y({triggerType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(N){const y=oe(N,"modelValue"),n=N,_=_e(),s=z(n.triggerType===2?Number(y.value):60),c=z(n.triggerType===3?y.value:"* * * * * ?");return H(s,b=>{n.triggerType===2&&(y.value=`${b}`)},{immediate:!0}),H(c,b=>{n.triggerType===3&&(y.value=b)},{immediate:!0}),H(()=>n.triggerType,b=>{b===2?y.value=`${s.value}`:b===3?y.value=c.value:y.value="*"},{immediate:!0}),(b,f)=>{const o=ye,i=we,R=ve,r=de;return S(),le("div",null,[b.triggerType===2?(S(),D(R,{key:0},{default:l(()=>[a(o,{value:s.value,"onUpdate:value":f[0]||(f[0]=I=>s.value=I),placeholder:b.$t("page.jobTask.form.triggerInterval")},null,8,["value","placeholder"]),a(i,null,{default:l(()=>[v(T(b.$t("common.second")),1)]),_:1})]),_:1})):b.triggerType===3?(S(),D(e(Me),{key:1,modelValue:c.value,"onUpdate:modelValue":f[1]||(f[1]=I=>c.value=I),placeholder:b.$t("page.jobTask.form.triggerInterval_CRON"),lang:e(_).locale},null,8,["modelValue","placeholder","lang"])):b.triggerType===99?(S(),D(r,{key:2,disabled:""})):ze("",!0)])}}}),ha=C({name:"JobTaskOperateDrawer",__name:"job-task-operate-drawer",props:Y({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Y(["submitted"],["update:visible"]),setup(N,{emit:y}){const n=N,_=y,s=oe(N,"visible"),c=ge({args:[{arg:""}]}),{formRef:b,validate:f,restoreValidation:o}=Ge(),{defaultRequiredRule:i}=Ee(),R=Le(()=>({add:t("page.jobTask.addJobTask"),edit:t("page.jobTask.editJobTask")})[n.operateType]),r=ge(I());function I(){return{groupName:"",jobName:"",argsStr:"",argsType:1,jobStatus:1,routeKey:1,executorType:1,triggerType:2,executorInfo:"",triggerInterval:"60",blockStrategy:1,executorTimeout:60,maxRetryTimes:3,retryInterval:1,taskType:1,parallelNum:1,description:""}}const O={groupName:i,jobName:i,argsType:i,jobStatus:i,routeKey:i,executorType:i,executorInfo:i,triggerType:i,triggerInterval:i,blockStrategy:i,executorTimeout:i,maxRetryTimes:i,retryInterval:i,taskType:i,parallelNum:i};function re(){if(n.operateType==="add"){Object.assign(r,I());return}n.operateType==="edit"&&n.rowData&&(Object.assign(r,n.rowData),r.taskType===3&&r.argsStr&&Object.assign(c,{args:JSON.parse(r.argsStr).map(j=>({arg:j}))}))}function G(){s.value=!1}async function ae(){var j,u;if(await f(),n.operateType==="add"){const{groupName:V,jobName:k,argsType:J,argsStr:A,jobStatus:K,routeKey:P,executorType:m,executorInfo:d,triggerType:g,triggerInterval:h,blockStrategy:w,executorTimeout:$,maxRetryTimes:U,retryInterval:x,taskType:F,parallelNum:E,description:L}=r,{error:Q}=await oa({groupName:V,jobName:k,argsStr:A,argsType:J,jobStatus:K,routeKey:P,executorType:m,executorInfo:d,triggerType:g,triggerInterval:h,blockStrategy:w,executorTimeout:$,maxRetryTimes:U,retryInterval:x,taskType:F,parallelNum:E,description:L});if(Q)return;(j=window.$message)==null||j.success(t("common.addSuccess"))}if(n.operateType==="edit"){const{id:V,groupName:k,jobName:J,argsStr:A,argsType:K,jobStatus:P,routeKey:m,executorType:d,executorInfo:g,triggerType:h,triggerInterval:w,blockStrategy:$,executorTimeout:U,maxRetryTimes:x,retryInterval:F,taskType:E,parallelNum:L,description:Q}=r,{error:p}=await ra({id:V,groupName:k,jobName:J,argsStr:A,argsType:K,jobStatus:P,routeKey:m,executorType:d,executorInfo:g,triggerType:h,triggerInterval:w,blockStrategy:$,executorTimeout:U,maxRetryTimes:x,retryInterval:F,taskType:E,parallelNum:L,description:Q});if(p)return;(u=window.$message)==null||u.success(t("common.updateSuccess"))}G(),_("submitted")}function ne(){if(r.taskType===3&&c.args){const j=c.args.map(u=>u.arg.trim()).filter(u=>!!u);r.argsStr=j.length>0?JSON.stringify(j):""}return r.argsStr}const se=j=>{c.args.splice(j,1)},ue=()=>{c.args.push({arg:""})};return H(s,()=>{s.value&&(re(),o())}),H(c,()=>{s.value&&r.taskType===3&&ne()}),H(()=>r.taskType,j=>{s.value&&(j!==3&&(c.args=[]),r.argsStr="")}),(j,u)=>{const V=de,k=qe,J=xe,A=He,K=Qe,P=We,m=Ie,d=M,g=De,h=je,w=ca,$=va,U=ga,x=ya,F=ye,E=we,L=ve,Q=Xe;return S(),D(ke,{modelValue:s.value,"onUpdate:modelValue":u[16]||(u[16]=p=>s.value=p),title:R.value,"min-size":480,onHandleSubmit:ae},{footer:l(()=>[a(K,{size:16},{default:l(()=>[a(d,{onClick:G},{default:l(()=>[v(T(e(t)("common.cancel")),1)]),_:1}),a(d,{type:"primary",onClick:ae},{default:l(()=>[v(T(e(t)("common.save")),1)]),_:1})]),_:1})]),default:l(()=>[a(Q,{ref_key:"formRef",ref:b,model:r,rules:O},{default:l(()=>[a(k,{label:e(t)("page.jobTask.jobName"),path:"jobName"},{default:l(()=>[a(V,{value:r.jobName,"onUpdate:value":u[0]||(u[0]=p=>r.jobName=p),maxlength:64,"show-count":"",placeholder:e(t)("page.jobTask.form.jobName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.groupName"),path:"groupName"},{default:l(()=>[a(J,{value:r.groupName,"onUpdate:value":u[1]||(u[1]=p=>r.groupName=p),disabled:n.operateType==="edit"},null,8,["value","disabled"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.jobStatus"),path:"jobStatus"},{default:l(()=>[a(P,{value:r.jobStatus,"onUpdate:value":u[2]||(u[2]=p=>r.jobStatus=p),name:"jobStatus"},{default:l(()=>[a(K,null,{default:l(()=>[(S(!0),le(me,null,be(e(Te),p=>(S(),D(A,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.executorType"),path:"executorType"},{default:l(()=>[a(Ta,{value:r.executorType,"onUpdate:value":u[3]||(u[3]=p=>r.executorType=p)},null,8,["value"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.executorInfo"),path:"executorInfo"},{default:l(()=>[a(V,{value:r.executorInfo,"onUpdate:value":u[4]||(u[4]=p=>r.executorInfo=p),placeholder:e(t)("page.jobTask.form.executorInfo")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.taskType"),path:"taskType"},{default:l(()=>[a(ka,{value:r.taskType,"onUpdate:value":u[5]||(u[5]=p=>r.taskType=p),placeholder:e(t)("page.jobTask.form.taskType")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{label:e(t)("page.jobTask.argsStr"),path:"argsStr",rule:r.taskType===3?e(i):void 0},{default:l(()=>[r.taskType===3?(S(),D(h,{key:0,class:"flex-col"},{default:l(()=>[(S(!0),le(me,null,be(c.args,(p,W)=>(S(),D(k,{key:W,label:`分片参数 ${W+1}`,path:`args[${W}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${e(t)("page.jobTask.form.argsStr")} ${W+1}`,trigger:["input","blur"],validator(){return!!p.arg}}},{default:l(()=>[a(fe,{modelValue:p.arg,"onUpdate:modelValue":ce=>p.arg=ce,lang:"json",placeholder:e(t)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(d,{class:"ml-12px",type:"error",dashed:"",onClick:ce=>se(W)},{default:l(()=>[a(m,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),a(d,{block:"",dashed:"","attr-type":"button",onClick:ue},{default:l(()=>[a(g,{class:"text-icon"})]),_:1})]),_:1})):(S(),D(fe,{key:1,modelValue:r.argsStr,"onUpdate:modelValue":u[6]||(u[6]=p=>r.argsStr=p),lang:"json",placeholder:e(t)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))]),_:1},8,["label","rule"]),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.routeKey"),path:"routeKey"},{default:l(()=>[a(da,{value:r.routeKey,"onUpdate:value":u[7]||(u[7]=p=>r.routeKey=p),"task-type":r.taskType},null,8,["value","task-type"])]),_:1},8,["label"])]),_:1}),a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.blockStrategy"),path:"blockStrategy"},{default:l(()=>[a($,{value:r.blockStrategy,"onUpdate:value":u[8]||(u[8]=p=>r.blockStrategy=p)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.triggerType"),path:"triggerType"},{default:l(()=>[a(x,{value:r.triggerType,"onUpdate:value":u[9]||(u[9]=p=>r.triggerType=p),placeholder:e(t)("page.jobTask.form.triggerType")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.triggerInterval"),path:"triggerInterval"},{default:l(()=>[a(ja,{modelValue:r.triggerInterval,"onUpdate:modelValue":u[10]||(u[10]=p=>r.triggerInterval=p),"trigger-type":r.triggerType},null,8,["modelValue","trigger-type"])]),_:1},8,["label"])]),_:1})]),_:1}),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.executorTimeout"),path:"executorTimeout"},{default:l(()=>[a(L,null,{default:l(()=>[a(F,{value:r.executorTimeout,"onUpdate:value":u[11]||(u[11]=p=>r.executorTimeout=p),min:1,max:99999999,placeholder:e(t)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),a(E,null,{default:l(()=>[v(T(e(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.maxRetryTimes"),path:"maxRetryTimes"},{default:l(()=>[a(F,{value:r.maxRetryTimes,"onUpdate:value":u[12]||(u[12]=p=>r.maxRetryTimes=p),min:1,max:999,placeholder:e(t)("page.jobTask.form.maxRetryTimes"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),a(U,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.retryInterval"),path:"retryInterval"},{default:l(()=>[a(L,null,{default:l(()=>[a(F,{value:r.retryInterval,"onUpdate:value":u[13]||(u[13]=p=>r.retryInterval=p),min:1,max:99999999,placeholder:e(t)("page.jobTask.form.retryInterval"),clearable:""},null,8,["value","placeholder"]),a(E,null,{default:l(()=>[v(T(e(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),a(w,null,{default:l(()=>[a(k,{label:e(t)("page.jobTask.parallelNum"),path:"parallelNum"},{default:l(()=>[a(F,{value:r.parallelNum,"onUpdate:value":u[14]||(u[14]=p=>r.parallelNum=p),min:1,max:999,placeholder:e(t)("page.jobTask.form.parallelNum"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),a(k,{label:e(t)("page.jobTask.description"),path:"description"},{default:l(()=>[a(V,{value:r.description,"onUpdate:value":u[15]||(u[15]=p=>r.description=p),type:"textarea",placeholder:e(t)("page.jobTask.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Na=C({name:"JobTaskSearch",__name:"job-task-search",props:{model:{required:!0},modelModifiers:{}},emits:Y(["reset","search"],["update:model"]),setup(N,{emit:y}){const n=y,_=oe(N,"model");function s(){n("reset")}function c(){n("search")}return(b,f)=>{const o=Re,i=de,R=ee,r=$e;return S(),D(r,{model:_.value,onSearch:c,onReset:s},{default:l(()=>[a(o,{span:"24 s:12 m:6",label:e(t)("page.jobTask.groupName"),path:"groupName",class:"pr-24px"},{default:l(()=>[a(xe,{value:_.value.groupName,"onUpdate:value":f[0]||(f[0]=I=>_.value.groupName=I),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(o,{span:"24 s:12 m:6",label:e(t)("page.jobTask.jobName"),path:"jobName",class:"pr-24px"},{default:l(()=>[a(i,{value:_.value.jobName,"onUpdate:value":f[1]||(f[1]=I=>_.value.jobName=I),placeholder:e(t)("page.jobTask.form.jobName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(o,{span:"24 s:12 m:6",label:e(t)("page.jobTask.jobStatus"),path:"jobStatus",class:"pr-24px"},{default:l(()=>[a(R,{value:_.value.jobStatus,"onUpdate:value":f[2]||(f[2]=I=>_.value.jobStatus=I),placeholder:e(t)("page.jobTask.form.jobStatus"),options:e(Z)(e(Te)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Sa=C({name:"JobTaskDetailDrawer",__name:"job-task-detail-drawer",props:Y({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(N){const y=oe(N,"visible");return(n,_)=>{const s=fa,c=te,b=_a,f=ke;return S(),D(f,{modelValue:y.value,"onUpdate:modelValue":_[0]||(_[0]=o=>y.value=o),title:e(t)("page.jobTask.detail")},{default:l(()=>[a(b,{"label-placement":"top",bordered:"",column:2},{default:l(()=>[a(s,{label:e(t)("page.jobTask.groupName")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.groupName),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.jobName")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.jobName),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.taskType")},{default:l(()=>{var o;return[a(c,{type:e(q)((o=n.rowData)==null?void 0:o.taskType)},{default:l(()=>{var i;return[v(T(e(t)(e(he)[(i=n.rowData)==null?void 0:i.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.argsStr")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.argsStr),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.nextTriggerAt")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.nextTriggerAt),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.jobStatus")},{default:l(()=>{var o;return[a(c,{type:e(q)((o=n.rowData)==null?void 0:o.jobStatus)},{default:l(()=>{var i;return[v(T(e(t)(e(Ye)[(i=n.rowData)==null?void 0:i.jobStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.routeKey")},{default:l(()=>{var o;return[a(c,{type:e(q)((o=n.rowData)==null?void 0:o.routeKey)},{default:l(()=>{var i;return[v(T(e(t)(e(Ze)[(i=n.rowData)==null?void 0:i.routeKey])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.executorType")},{default:l(()=>{var o;return[a(c,{type:e(q)((o=n.rowData)==null?void 0:o.executorType)},{default:l(()=>{var i;return[v(T(e(t)(e(ea)[(i=n.rowData)==null?void 0:i.executorType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.executorInfo")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.executorInfo),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.triggerType")},{default:l(()=>{var o;return[a(c,{type:e(q)((o=n.rowData)==null?void 0:o.triggerType)},{default:l(()=>{var i;return[v(T(e(t)(e(Ne)[(i=n.rowData)==null?void 0:i.triggerType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.triggerInterval")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.triggerInterval),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.blockStrategy")},{default:l(()=>{var o;return[a(c,{type:e(q)((o=n.rowData)==null?void 0:o.blockStrategy)},{default:l(()=>{var i;return[v(T(e(t)(e(Se)[(i=n.rowData)==null?void 0:i.blockStrategy])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.executorTimeout")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.executorTimeout),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.maxRetryTimes")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.maxRetryTimes),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.retryInterval")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.retryInterval),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.parallelNum")},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.parallelNum),1)]}),_:1},8,["label"]),a(s,{label:e(t)("page.jobTask.description"),span:2},{default:l(()=>{var o;return[v(T((o=n.rowData)==null?void 0:o.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),xa={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!la(N)}const Ba=C({name:"job_task",__name:"index",setup(N){const{hasAuth:y}=ma(),n=_e(),{routerPushByKey:_}=aa(),s=z(),{bool:c,setTrue:b}=ta(!1),{columnChecks:f,columns:o,data:i,getData:R,loading:r,mobilePagination:I,searchParams:O,resetSearchParams:re}=Ue({apiFn:na,apiParams:{page:1,size:10,groupName:null,jobName:null,jobStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:t("common.index"),align:"center",width:48},{key:"jobName",title:t("page.jobTask.jobName"),align:"center",width:140,fixed:"left",render:m=>{async function d(){s.value=m,b()}return a(M,{text:!0,tag:"a",type:"primary",onClick:d,class:"ws-normal"},{default:()=>[`${m.jobName}(${m.id})`]})}},{key:"groupName",title:t("page.jobTask.groupName"),align:"left",width:180},{key:"nextTriggerAt",title:t("page.jobTask.nextTriggerAt"),align:"center",width:120},{key:"jobStatus",title:t("page.jobTask.jobStatus"),align:"center",width:60,render:m=>{const d=async(g,h)=>{var $;const{error:w}=await pa({id:m.id,jobStatus:g});w||(m.jobStatus=g,($=window.$message)==null||$.success(t("common.updateSuccess"))),h()};return a(ia,{value:m.jobStatus,"onUpdate:value":g=>m.jobStatus=g,onFetch:d},null)}},{key:"taskType",title:t("page.jobTask.taskType"),align:"center",width:120,render:m=>{if(m.taskType===null)return null;const d={1:"info",2:"success",3:"error"},g=t(he[m.taskType]);return a(te,{type:d[m.taskType]},B(g)?g:{default:()=>[g]})}},{key:"triggerType",title:t("page.jobTask.triggerType"),align:"center",width:120,render:m=>{if(m.triggerType===null)return null;const d={2:"info",3:"success",99:"error"},g=t(Ne[m.triggerType]);return a(te,{type:d[m.triggerType]},B(g)?g:{default:()=>[g]})}},{key:"triggerInterval",title:t("page.jobTask.triggerInterval"),align:"center",width:80},{key:"blockStrategy",title:t("page.jobTask.blockStrategy"),align:"center",width:80,render:m=>{if(m.blockStrategy===null)return null;const d={1:"info",2:"success",3:"error"},g=t(Se[m.blockStrategy]);return a(te,{type:d[m.blockStrategy]},B(g)?g:{default:()=>[g]})}},{key:"executorTimeout",title:t("page.jobTask.executorTimeout"),align:"center",width:80},{key:"updateDt",title:t("page.jobTask.updateDt"),align:"center",width:120},{key:"operate",title:t("common.operate"),align:"center",width:180,fixed:"right",render:m=>{let d,g;return a("div",{class:"flex-center gap-8px"},[a(pe,{onPositiveClick:()=>J(m.id)},{default:()=>t("common.confirmExecute"),trigger:()=>{let h;return a(M,{type:"error",text:!0,ghost:!0,size:"small"},B(h=t("common.execute"))?h:{default:()=>[h]})}}),a(ie,{vertical:!0},null),a(M,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>A(m.id)},B(d=t("common.batchList"))?d:{default:()=>[d]}),a(ie,{vertical:!0},null),a(M,{type:"warning",ghost:!0,text:!0,size:"small",onClick:()=>k(m.id)},B(g=t("common.edit"))?g:{default:()=>[g]}),y("R_ADMIN")?a(me,null,[a(ie,{vertical:!0},null),a(pe,{onPositiveClick:()=>V(m.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let h;return a(M,{type:"error",text:!0,ghost:!0,size:"small"},B(h=t("common.delete"))?h:{default:()=>[h]})}})]):""])}}]}),{drawerVisible:G,operateType:ae,editingData:ne,handleAdd:se,handleEdit:ue,checkedRowKeys:j,onDeleted:u}=Ve(i,R);async function V(m){const{error:d}=await sa(m);d||u()}function k(m){ue(m)}async function J(m){var g,h;const{error:d}=await ua(m);d?(g=window.$message)==null||g.error(t("common.executeFailed")):(h=window.$message)==null||h.success(t("common.executeSuccess"))}function A(m){const d=i.value.find(g=>g.id===m);_("job_batch",{state:{jobId:m,jobName:d.jobName}})}function K(){return{jobIds:j.value,groupName:O.groupName,jobName:O.jobName,jobStatus:O.jobStatus}}function P(){Oe("/job/export",K(),t("page.jobTask.title"))}return(m,d)=>{const g=Ke,h=Fe,w=Ce,$=ba,U=je;return S(),le("div",xa,[a(Na,{model:e(O),"onUpdate:model":d[0]||(d[0]=x=>X(O)?O.value=x:null),onReset:e(re),onSearch:e(R)},null,8,["model","onReset","onSearch"]),a(U,{title:e(t)("page.jobTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":l(()=>[a(w,{columns:e(f),"onUpdate:columns":d[1]||(d[1]=x=>X(f)?f.value=x:null),loading:e(r),"show-delete":!1,onAdd:e(se),onRefresh:e(R)},{addAfter:l(()=>[a(g,{action:"/job/import",accept:"application/json",onRefresh:e(R)},null,8,["onRefresh"]),a(e(pe),{onPositiveClick:P},{trigger:l(()=>[a(e(M),{size:"small",ghost:"",type:"primary",disabled:e(j).length===0&&e(y)("R_USER")},{icon:l(()=>[a(h,{class:"text-icon"})]),default:l(()=>[v(" "+T(e(t)("common.export")),1)]),_:1},8,["disabled"])]),default:l(()=>[v(T(e(j).length===0?e(t)("common.exportAll"):e(t)("common.exportPar",{num:e(j).length})),1)]),_:1})]),_:1},8,["columns","loading","onAdd","onRefresh"])]),default:l(()=>[a($,{"checked-row-keys":e(j),"onUpdate:checkedRowKeys":d[2]||(d[2]=x=>X(j)?j.value=x:null),columns:e(o),data:e(i),"flex-height":!e(n).isMobile,"scroll-x":2e3,loading:e(r),remote:"","row-key":x=>x.id,pagination:e(I),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(ha,{visible:e(G),"onUpdate:visible":d[3]||(d[3]=x=>X(G)?G.value=x:null),"operate-type":e(ae),"row-data":e(ne),onSubmitted:e(R)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(Sa,{visible:e(c),"onUpdate:visible":d[4]||(d[4]=x=>X(c)?c.value=x:null),"row-data":s.value},null,8,["visible","row-data"])])}}});export{Ba as default};
