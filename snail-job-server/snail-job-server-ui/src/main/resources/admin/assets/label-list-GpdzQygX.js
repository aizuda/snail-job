import{d as P,r as V,a as y,q,an as F,b as m,o as u,c as v,Q as B,a3 as b,f as p,h as l,Z as g,w as s,g as c,t as f,e as G,a4 as Q,N as R,D as C,G as N,s as L,B as Z,$ as H,c_ as S,l as W}from"./index-DWIswSJW.js";import{d as X}from"./dashboard-Dz4tsNoS.js";import{_ as U}from"./DynamicTags-7kr09EJ6.js";const Y={class:"flex items-center justify-center"},ee={class:"flex flex-wrap justify-center gap-2"},te=P({__name:"label-list",props:{id:{default:void 0},labels:{default:"{}"},editable:{type:Boolean,default:!1}},emits:["submitted"],setup(z,{emit:T}){const $=z,I=T,o=V(null),_=V(),K=y(()=>{try{return JSON.parse($.labels||"{}")}catch{return{}}}),k=y(()=>Object.entries(K.value).filter(([e])=>e!=="state")),r=y(()=>k.value[0]),i=y(()=>k.value.slice(1)),O=y(()=>i.value.map(([e,a])=>`${e}:${a}`)),j=(e,a)=>e==="env"?a==="prod"?"error":"info":e==="name"?"success":"info",x=async e=>{var t;if(!$.id)return;const{error:a}=await X({id:String($.id),labels:JSON.stringify(e)});if(a){(t=window.$message)==null||t.error(a.message);return}o.value=null,I("submitted")},A=e=>{const[a,t]=e.split(":").map(n=>n.trim());return a&&t?[a,t]:null},h=e=>{var w;if(!Array.isArray(e)||e.length!==2||S(e[0])||S(e[1]))return(w=window.$message)==null||w.error('请输入有效的标签，格式如 "key:value"'),e;const[a,t]=e,n={...K.value,[a]:t};return x(n),o.value=null,e},D=()=>{const e={};i.value.forEach(([a,t])=>{e[a]=t}),x(e)},E=e=>{const a={};if(r.value){const[t,n]=r.value;a[t]=n}e.forEach(t=>{const n=A(t);if(n){const[w,M]=n;a[w]=M}}),x(a)},J=()=>{var e;((e=o.value)==null?void 0:e.length)===2&&h(o.value)},d=e=>{e==null||e(),J()};return q(_,e=>{e&&F(()=>e.focus())}),(e,a)=>(u(),m("div",Y,[k.value.length?(u(),m(b,{key:0},[e.editable?(u(),m(b,{key:1},[p(l(U),{class:"mr-2 flex justify-center",value:[`${r.value[0]}:${r.value[1]}`],type:j(r.value[0],r.value[1]),onCreate:h,"onUpdate:value":D},{trigger:s(({activate:t})=>[r.value&&!i.value.length?(u(),v(l(Z),{key:0,size:"small",dashed:"",onClick:t},{default:s(()=>a[3]||(a[3]=[c("+")])),_:2},1032,["onClick"])):B("",!0)]),input:s(({deactivate:t})=>[p(l(C),{ref_key:"inputRef",ref:_,value:o.value,"onUpdate:value":a[0]||(a[0]=n=>o.value=n),size:"small",pair:"",separator:":",placeholder:["key","value"],onBlur:()=>d(t),onKeydown:N(L(n=>d(t),["prevent"]),["enter"])},null,8,["value","onBlur","onKeydown"])]),_:1},8,["value","type"]),i.value.length?(u(),v(l(R),{key:0,trigger:"click"},{trigger:s(()=>[p(l(g),null,{default:s(()=>[c("+"+f(i.value.length),1)]),_:1})]),default:s(()=>[p(l(U),{class:"flex justify-center",value:O.value,type:"info",onCreate:h,"onUpdate:value":E},{input:s(({deactivate:t})=>[p(l(C),{ref_key:"inputRef",ref:_,value:o.value,"onUpdate:value":a[1]||(a[1]=n=>o.value=n),size:"small",pair:"",separator:":",placeholder:["key","value"],onBlur:()=>d(t),onKeydown:N(L(n=>d(t),["prevent"]),["enter"])},null,8,["value","onBlur","onKeydown"])]),_:1},8,["value"])]),_:1})):B("",!0)],64)):(u(),m(b,{key:0},[p(l(g),{class:"mr-2",type:j(r.value[0],r.value[1])},{default:s(()=>[c(f(r.value[0])+":"+f(r.value[1]),1)]),_:1},8,["type"]),i.value.length?(u(),v(l(R),{key:0,trigger:"click"},{trigger:s(()=>[p(l(g),null,{default:s(()=>[c("+"+f(i.value.length),1)]),_:1})]),default:s(()=>[G("div",ee,[(u(!0),m(b,null,Q(i.value,([t,n])=>(u(),v(l(g),{key:t,type:"info"},{default:s(()=>[c(f(t)+":"+f(n),1)]),_:2},1024))),128))])]),_:1})):B("",!0)],64))],64)):e.editable?(u(),v(l(U),{key:1,type:"info",class:"flex justify-center",onCreate:h,"onUpdate:value":E},{input:s(({deactivate:t})=>[p(l(C),{ref_key:"inputRef",ref:_,value:o.value,"onUpdate:value":a[2]||(a[2]=n=>o.value=n),size:"small",pair:"",separator:":",placeholder:["key","value"],onBlur:()=>d(t),onKeydown:N(L(n=>d(t),["prevent"]),["enter"])},null,8,["value","onBlur","onKeydown"])]),_:1})):k.value.length?B("",!0):(u(),v(l(g),{key:2,type:"info"},{default:s(()=>[c(f(l(H)("common.none")),1)]),_:1}))]))}}),se=W(te,[["__scopeId","data-v-5014e617"]]);export{se as L};
