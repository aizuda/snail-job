import{a as V,N as R,b as G}from"./search-form.vue_vue_type_script_setup_true_lang-B9DCSIZj.js";import{d as H,_ as Z,a as Y}from"./download-CpmmXY_k.js";import{d as C,Z as J,a0 as Q,o as U,c as X,w as s,f as a,h as t,$ as o,a4 as ee,aH as oe,D as te,aa as ae,bZ as le,L as ne,u as re,b as se,ah as P,B as h,g as W,t as $,aK as ie,ac as ce,Y as ue,at as A,cx as me,F as pe,aj as de}from"./index-D11HRvLC.js";import{l as fe,m as we,n as ge,o as ke}from"./workflow-B_Ogzjxw.js";import{_ as he,u as _e,a as ye}from"./table-oGN68_Ra.js";import{_ as xe}from"./status-switch.vue_vue_type_script_setup_true_lang-Cv5sP_Gc.js";import{u as ve}from"./auth-B9UptQv2.js";import{_ as be}from"./select-group.vue_vue_type_script_setup_true_lang-BV1AXeAr.js";import{b as Ne}from"./Grid-BEQeOJ6_.js";import"./Progress-DQlqejcE.js";import"./group-DBuDE6uz.js";const Se=C({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search"],["update:model"]),setup(k,{emit:y}){const d=y,u=Q(k,"model");function N(){d("reset")}function S(){d("search")}return(x,i)=>{const c=he,v=te,T=ae,m=V;return U(),X(m,{model:u.value,onSearch:S,onReset:N},{default:s(()=>[a(c,{span:"24 s:12 m:6",label:t(o)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:s(()=>[a(be,{value:u.value.groupName,"onUpdate:value":i[0]||(i[0]=f=>u.value.groupName=f),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:t(o)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:s(()=>[a(v,{value:u.value.workflowName,"onUpdate:value":i[1]||(i[1]=f=>u.value.workflowName=f),placeholder:t(o)("page.workflow.form.workflowName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:t(o)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:s(()=>[a(T,{value:u.value.workflowStatus,"onUpdate:value":i[2]||(i[2]=f=>u.value.workflowStatus=f),placeholder:t(o)("page.workflow.form.workflowStatus"),options:t(ee)(t(oe)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Te={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function b(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!de(k)}const Ie=C({name:"workflow_task",__name:"index",setup(k){const{hasAuth:y}=ve(),d=le(),u=ne(),{routerPushByKey:N}=re(),{columns:S,columnChecks:x,data:i,getData:c,loading:v,mobilePagination:T,searchParams:m,resetSearchParams:f}=_e({apiFn:fe,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:o("common.index"),align:"center",width:120},{key:"workflowName",title:o("page.workflow.workflowName"),align:"left",minWidth:120,render:e=>{function l(){O(e.id)}return a(h,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[e.workflowName]})}},{key:"groupName",title:o("page.workflow.groupName"),align:"left",minWidth:120},{key:"nextTriggerAt",title:o("page.workflow.nextTriggerAt"),align:"left",minWidth:120},{key:"workflowStatus",title:o("page.workflow.workflowStatus"),align:"left",minWidth:120,render:e=>{const l=async(n,_)=>{var w;const{error:r}=await ke(e.id);r||(e.workflowStatus=n,(w=window.$message)==null||w.success(o("common.updateSuccess"))),_()};return a(xe,{value:e.workflowStatus,"onUpdate:value":n=>e.workflowStatus=n,onFetch:l},null)}},{key:"triggerType",title:o("page.workflow.triggerType"),align:"left",minWidth:120,render:e=>{if(!e.triggerType)return null;const l=o(ie[e.triggerType]);return a(ue,{type:ce(e.triggerType)},b(l)?l:{default:()=>[l]})}},{key:"triggerInterval",title:o("page.workflow.triggerInterval"),align:"left",minWidth:120},{key:"executorTimeout",title:o("page.workflow.executorTimeout"),align:"left",minWidth:120},{key:"updateDt",title:o("page.workflow.updateDt"),align:"left",minWidth:120},{key:"operate",title:o("common.operate"),align:"center",fixed:"right",width:200,render:e=>{let l;const n=[{label:o("common.copy"),key:"copy",click:()=>q(e.id)},{type:"divider",key:"d2"},{label:o("common.batchList"),key:"batchList",click:()=>L(e.id)},{type:"divider",key:"d2"},{show:y("R_ADMIN"),type:"render",key:"delete",render:()=>a("div",{class:"flex-center"},[a(R,{onPositiveClick:()=>z(e.id)},{default:()=>o("common.confirmDelete"),trigger:()=>{let r;return a(h,{quaternary:!0,size:"small"},b(r=o("common.delete"))?r:{default:()=>[r]})}})])}],_=r=>{const w=n.filter(D=>D.key===r)[0].click;w&&w()};return a("div",{class:"flex-center gap-8px"},[a(h,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>I(e.id)},b(l=o("common.edit"))?l:{default:()=>[l]}),a(A,{vertical:!0},null),a(R,{onPositiveClick:()=>E(e.id)},{default:()=>o("common.confirmExecute"),trigger:()=>{let r;return a(h,{type:"error",text:!0,ghost:!0,size:"small"},b(r=o("common.execute"))?r:{default:()=>[r]})}}),a(A,{vertical:!0},null),a(me,{trigger:"click","show-arrow":!1,options:n,size:"small","on-select":_},{default:()=>a(h,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[W("更多")]})})])}}]}),{checkedRowKeys:p,onBatchDeleted:B}=ye(i,c);async function F(){B()}async function z(e){var n;const{error:l}=await we(e);l||((n=window.$message)==null||n.success(o("common.deleteSuccess")),c())}function I(e){d.push({path:"/workflow/form/edit",query:{id:e}})}function j(){d.push({path:"/workflow/form/add"})}function O(e){d.push({path:"/workflow/form/detail",query:{id:e}})}function q(e){d.push({path:"/workflow/form/copy",query:{id:e}})}async function E(e){var n;const{error:l}=await ge(e);l||((n=window.$message)==null||n.success(o("common.executeSuccess")),c())}function M(){return{workflowIds:p.value,groupName:m.groupName,workflowName:m.workflowName,workflowStatus:m.workflowStatus}}function K(){H("/workflow/export",M(),o("page.workflow.title"))}function L(e){const l=i.value.find(n=>n.id===e);N("workflow_batch",{state:{workflowId:e,workflowName:l.workflowName}})}return(e,l)=>{const n=Z,_=Y,r=G,w=Ne,D=pe;return U(),se("div",Te,[a(Se,{model:t(m),"onUpdate:model":l[0]||(l[0]=g=>P(m)?m.value=g:null),onReset:t(f),onSearch:t(c)},null,8,["model","onReset","onSearch"]),a(D,{title:t(o)("page.workflow.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[a(r,{columns:t(x),"onUpdate:columns":l[1]||(l[1]=g=>P(x)?x.value=g:null),"disabled-delete":t(p).length===0,loading:t(v),"show-delete":!1,onAdd:j,onDelete:F,onRefresh:t(c)},{addAfter:s(()=>[a(n,{action:"/workflow/import",accept:"application/json",onRefresh:t(c)},null,8,["onRefresh"]),a(t(R),{onPositiveClick:K},{trigger:s(()=>[a(t(h),{size:"small",ghost:"",type:"primary",disabled:t(p).length===0&&t(y)("R_USER")},{icon:s(()=>[a(_,{class:"text-icon"})]),default:s(()=>[W(" "+$(t(o)("common.export")),1)]),_:1},8,["disabled"])]),default:s(()=>[W($(t(p).length===0?t(o)("common.exportAll"):t(o)("common.exportPar",{num:t(p).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onRefresh"])]),default:s(()=>[a(w,{"checked-row-keys":t(p),"onUpdate:checkedRowKeys":l[2]||(l[2]=g=>P(p)?p.value=g:null),columns:t(S),data:t(i),"flex-height":!t(u).isMobile,"scroll-x":1300,loading:t(v),remote:"","row-key":g=>g.id,pagination:t(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{Ie as default};
