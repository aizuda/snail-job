import{_ as fe,a as _e,N as oe,b as be}from"./search-form.vue_vue_type_script_setup_true_lang-CiN8VA7k.js";import{d as ve,_ as he,a as Se}from"./download-DHVW8dOr.js";import{_ as ye}from"./delete-alert-_CWckxKJ.js";import{d as z,Z as E,a0 as Q,a1 as Ce,z as we,A as Ne,a as ke,$ as t,r as ae,p as De,q as Ge,o as k,c as P,w as a,f as o,g as v,t as C,h as e,b as K,a2 as te,a3 as ne,a4 as Y,a5 as le,a6 as Me,a7 as Re,a8 as xe,D as re,E as $e,H as Pe,B as I,a9 as Te,aa as Ue,ab as ue,I as Oe,ac as ie,ad as B,ae as Ae,af as pe,ag as se,Y as Z,L as Ie,ah as Ve,ai as A,aj as Fe,ak as je,F as Be,al as Ee}from"./index-Dlhm-fK8.js";import{f as ze,a as Le,b as We,c as qe,d as He,e as Je}from"./group-CP2HSNrU.js";import{_ as Ke,u as Ye,a as Ze}from"./table-BumNcT0C.js";import{_ as Qe}from"./status-switch.vue_vue_type_script_setup_true_lang-BF7EJgO0.js";import{u as Xe}from"./auth-VqY08jsz.js";import{_ as eo}from"./round-content-copy-Cpi9SN2Q.js";import{_ as oo,a as to,b as ao}from"./Grid-3R-51InK.js";import{_ as no,a as lo}from"./CollapseItem-Ca_LaRTD.js";import{_ as ro,a as uo}from"./DescriptionsItem-g_tZg_fN.js";import"./Progress-CJD1ciXM.js";const io=z({name:"GroupOperateDrawer",__name:"group-operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(w,{emit:h}){const i=w,m=h,d=Q(w,"visible"),{copy:R,isSupported:T}=Ce(),{formRef:S,validate:u,restoreValidation:g}=we(),{defaultRequiredRule:D}=Ne(),O=ke(()=>({add:t("page.groupConfig.addGroupConfig"),edit:t("page.groupConfig.editGroupConfig")})[i.operateType]),y=ae([]),s=De(U());function U(){return{groupName:"",token:"SJ_Wyz3dmsdbDOkDujOTSSoBjGQP1BMsVnj",groupStatus:1,description:"",idGeneratorMode:2,initScene:1,groupPartition:0}}const L={groupName:[{required:!0,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:t("page.groupConfig.form.groupNameRule")}],token:[D],groupStatus:[D],idGeneratorMode:[D],initScene:[D],groupPartition:[D]};function W(){if(i.operateType==="add"){Object.assign(s,U());return}i.operateType==="edit"&&i.rowData&&Object.assign(s,i.rowData)}function V(){d.value=!1}async function F(){var f,r;if(await u(),i.operateType==="add"){const{groupName:l,token:n,groupStatus:c,description:N,idGeneratorMode:G,initScene:M,groupPartition:_}=s,{error:$}=await ze({groupName:l,token:n,groupStatus:c,description:N,idGeneratorMode:G,initScene:M,groupPartition:_});if($)return;(f=window.$message)==null||f.success(t("common.addSuccess"))}else{const{groupName:l,token:n,groupStatus:c,description:N,idGeneratorMode:G,initScene:M,groupPartition:_}=s,{error:$}=await Le({groupName:l,token:n,groupStatus:c,description:N,idGeneratorMode:G,initScene:M,groupPartition:_});if($)return;(r=window.$message)==null||r.success(t("common.updateSuccess"))}V(),m("submitted")}function x(){s.token=q(32)}function q(f){const r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let l="SJ_";for(let n=0;n<f;n+=1){const c=Math.floor(Math.random()*r.length);l+=r.substring(c,c+1)}return l}const H=async()=>{const{data:f}=await We();y.value=f.map(r=>String(r))};Ge(d,()=>{d.value&&(H(),W(),g())});async function J(f){var r,l;if(!T){(r=window.$message)==null||r.error("您的浏览器不支持 Clipboard API");return}f&&(await R(f),(l=window.$message)==null||l.success("复制成功"))}return(f,r)=>{const l=re,n=$e,c=to,N=Pe,G=oo,M=eo,_=I,$=Te,b=fe,de=Ue,X=no,ee=ue,ge=lo,ce=Oe,me=ie;return k(),P(me,{modelValue:d.value,"onUpdate:modelValue":r[8]||(r[8]=p=>d.value=p),title:O.value,onSubmitted:F},{footer:a(()=>[o(N,{size:16},{default:a(()=>[o(_,{onClick:V},{default:a(()=>[v(C(e(t)("common.cancel")),1)]),_:1}),o(_,{type:"primary",onClick:F},{default:a(()=>[v(C(e(t)("common.save")),1)]),_:1})]),_:1})]),default:a(()=>[o(ce,{ref_key:"formRef",ref:S,model:s,rules:L},{default:a(()=>[o(ge,{"default-expanded-names":["1","2"]},{default:a(()=>[o(X,{title:e(t)("page.groupConfig.commonConfig"),name:"1"},{default:a(()=>[o(n,{label:e(t)("page.groupConfig.groupName"),path:"groupName"},{default:a(()=>[o(l,{value:s.groupName,"onUpdate:value":r[0]||(r[0]=p=>s.groupName=p),maxlength:64,"show-count":"",placeholder:e(t)("page.groupConfig.form.groupName"),disabled:i.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),o(n,{label:e(t)("page.groupConfig.groupStatus"),path:"groupStatus"},{default:a(()=>[o(G,{value:s.groupStatus,"onUpdate:value":r[1]||(r[1]=p=>s.groupStatus=p),name:"groupStatus"},{default:a(()=>[o(N,null,{default:a(()=>[(k(!0),K(Y,null,te(e(ne),p=>(k(),P(c,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(n,{label:e(t)("page.groupConfig.token"),path:"token"},{default:a(()=>[o(de,null,{default:a(()=>[o(l,{value:s.token,"onUpdate:value":r[2]||(r[2]=p=>s.token=p),maxlength:64,placeholder:e(t)("page.groupConfig.form.token"),disabled:i.operateType==="edit"},null,8,["value","placeholder","disabled"]),i.operateType==="edit"?(k(),P($,{key:0,trigger:"hover"},{trigger:a(()=>[o(_,{type:"default",ghost:"",onClick:r[3]||(r[3]=p=>J(s.token))},{default:a(()=>[o(M,{class:"text-icon"})]),_:1})]),default:a(()=>[r[9]||(r[9]=v(" 复制 "))]),_:1})):(k(),P($,{key:1,trigger:"hover"},{trigger:a(()=>[o(_,{type:"default",ghost:"",onClick:x},{default:a(()=>[o(b,{class:"text-icon"})]),_:1})]),default:a(()=>[v(" "+C(e(t)("page.groupConfig.generateToken")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),o(n,{label:e(t)("page.groupConfig.description"),path:"description"},{default:a(()=>[o(l,{value:s.description,"onUpdate:value":r[4]||(r[4]=p=>s.description=p),type:"textarea",maxlength:256,"show-count":"",placeholder:e(t)("page.groupConfig.form.description"),clearable:"",round:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),o(X,{title:e(t)("page.groupConfig.retryConfig"),name:"2"},{default:a(()=>[o(n,{label:e(t)("page.groupConfig.idGeneratorMode"),path:"idGeneratorMode"},{default:a(()=>[o(ee,{value:s.idGeneratorMode,"onUpdate:value":r[5]||(r[5]=p=>s.idGeneratorMode=p),placeholder:e(t)("page.groupConfig.form.idGeneratorMode"),options:e(le)(e(Me))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),o(n,{label:e(t)("page.groupConfig.initScene"),path:"initScene"},{default:a(()=>[o(G,{value:s.initScene,"onUpdate:value":r[6]||(r[6]=p=>s.initScene=p),name:"initScene"},{default:a(()=>[o(N,null,{default:a(()=>[(k(!0),K(Y,null,te(e(Re),p=>(k(),P(c,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(n,{label:e(t)("page.groupConfig.groupPartition"),path:"groupPartition"},{default:a(()=>[o(ee,{value:s.groupPartition,"onUpdate:value":r[7]||(r[7]=p=>s.groupPartition=p),placeholder:e(t)("page.groupConfig.form.groupPartition"),options:e(xe)(y.value)},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),po=z({name:"GroupDetailDrawer",__name:"group-detail-drawer",props:E({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const h=Q(w,"visible");return(i,m)=>{const d=ro,R=Z,T=uo,S=ie;return k(),P(S,{modelValue:h.value,"onUpdate:modelValue":m[0]||(m[0]=u=>h.value=u),title:e(t)("page.groupConfig.detail")},{default:a(()=>[o(T,{"label-placement":"top",bordered:"",column:2},{default:a(()=>[o(d,{label:e(t)("page.groupConfig.groupName"),span:2},{default:a(()=>{var u;return[v(C((u=i.rowData)==null?void 0:u.groupName),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.token"),span:2},{default:a(()=>{var u;return[v(C((u=i.rowData)==null?void 0:u.token),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.groupStatus"),span:1},{default:a(()=>{var u;return[o(R,{type:e(B)((u=i.rowData)==null?void 0:u.groupStatus)},{default:a(()=>{var g;return[v(C(e(t)(e(Ae)[(g=i.rowData)==null?void 0:g.groupStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.idGeneratorMode"),span:1},{default:a(()=>{var u;return[o(R,{type:e(B)((u=i.rowData)==null?void 0:u.idGeneratorMode)},{default:a(()=>{var g;return[v(C(e(t)(e(pe)[(g=i.rowData)==null?void 0:g.idGeneratorMode])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.groupPartition"),span:1},{default:a(()=>{var u;return[v(C((u=i.rowData)==null?void 0:u.groupPartition),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.initScene"),span:1},{default:a(()=>{var u;return[o(R,{type:e(B)((u=i.rowData)==null?void 0:u.initScene)},{default:a(()=>{var g;return[v(C(e(t)(e(se)[(g=i.rowData)==null?void 0:g.initScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.description"),span:2},{default:a(()=>{var u;return[v(C((u=i.rowData)==null?void 0:u.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),so=z({name:"GroupSearch",__name:"group-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(w,{emit:h}){const i=h,m=Q(w,"model");function d(){i("reset")}function R(){i("search")}return(T,S)=>{const u=re,g=Ke,D=ue,O=_e;return k(),P(O,{model:m.value,onSearch:R,onReset:d},{default:a(()=>[o(g,{span:"24 s:12 m:6",label:e(t)("page.groupConfig.groupName"),path:"groupName",class:"pr-24px"},{default:a(()=>[o(u,{value:m.value.groupName,"onUpdate:value":S[0]||(S[0]=y=>m.value.groupName=y),placeholder:e(t)("page.groupConfig.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(g,{span:"24 s:12 m:6",label:e(t)("page.groupConfig.groupStatus"),path:"groupStatus",class:"pr-24px"},{default:a(()=>[o(D,{value:m.value.groupStatus,"onUpdate:value":S[1]||(S[1]=y=>m.value.groupStatus=y),placeholder:e(t)("page.groupConfig.form.groupStatus"),options:e(le)(e(ne)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),go={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function j(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!Ee(w)}const Do=z({name:"group",__name:"index",setup(w){const{hasAuth:h}=Xe(),i=Ie(),m=ae(),{bool:d,setTrue:R}=Ve(!1),{columns:T,columnChecks:S,data:u,getData:g,loading:D,mobilePagination:O,searchParams:y,resetSearchParams:s}=Ye({apiFn:qe,apiParams:{page:1,size:10,groupName:null,groupStatus:null},columns:()=>[{key:"id",title:t("common.index"),align:"center",width:64},{key:"groupName",title:t("page.groupConfig.groupName"),align:"left",minWidth:260,render:l=>{function n(){m.value=l||null,R()}return o(I,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[l.groupName]})}},{key:"groupStatus",title:t("page.groupConfig.groupStatus"),align:"center",width:80,render:l=>{const n=async(c,N)=>{var _;const G=l.groupStatus===1?0:1,{error:M}=await Je({groupName:l.groupName,groupStatus:G});M||(l.groupStatus=c,(_=window.$message)==null||_.success(t("common.updateSuccess"))),N(!M)};return o(Qe,{value:l.groupStatus,"onUpdate:value":c=>l.groupStatus=c,onSubmitted:n,disabled:h("R_USER")},null)}},{key:"idGeneratorMode",title:t("page.groupConfig.idGeneratorMode"),align:"center",width:120,render:l=>{if(l.idGeneratorMode===null)return null;const n=t(pe[l.idGeneratorMode]);return o(Z,{type:"primary"},j(n)?n:{default:()=>[n]})}},{key:"groupPartition",title:t("page.groupConfig.groupPartition"),align:"center",minWidth:60},{key:"initScene",title:t("page.groupConfig.initScene"),align:"center",minWidth:80,render:l=>{if(l.groupStatus===null)return null;const n=t(se[l.initScene]);return o(Z,{type:B(l.initScene)},j(n)?n:{default:()=>[n]})}},{key:"updateDt",title:t("page.groupConfig.updateDt"),align:"left",width:130},{key:"description",title:t("page.groupConfig.description"),align:"left",width:130},{key:"operate",title:t("common.operate"),align:"center",width:130,render:l=>{let n;return h("R_USER")?o(Y,null,null):o("div",{class:"flex-center gap-8px"},[o(I,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>H(l.id)},j(n=t("common.edit"))?n:{default:()=>[n]}),o(je,{vertical:!0},null),o(oe,{onPositiveClick:()=>J(l.groupName)},{default:()=>t("common.confirmDelete"),trigger:()=>{let c;return o(I,{type:"error",text:!0,ghost:!0,size:"small"},j(c=t("common.delete"))?c:{default:()=>[c]})}})])}}]}),{drawerVisible:U,operateType:L,editingData:W,handleAdd:V,handleEdit:F,checkedRowKeys:x,onDeleted:q}=Ze(u,g);function H(l){F(l)}async function J(l){const{error:n}=await He(l);n||q()}function f(){return{groupName:y.groupName,groupStatus:y.groupStatus,groupIds:x.value}}function r(){ve("/group/export",f(),t("page.groupConfig.title"))}return(l,n)=>{const c=ye,N=he,G=Se,M=be,_=ao,$=Be;return k(),K("div",go,[o(so,{model:e(y),"onUpdate:model":n[0]||(n[0]=b=>A(y)?y.value=b:null),onReset:e(s),onSearch:e(g)},null,8,["model","onReset","onSearch"]),o(c),o($,{title:e(t)("page.groupConfig.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[o(M,{columns:e(S),"onUpdate:columns":n[1]||(n[1]=b=>A(S)?S.value=b:null),loading:e(D),"show-add":e(h)("R_ADMIN"),"show-delete":!1,onAdd:e(V),onRefresh:e(g)},{addAfter:a(()=>[e(h)("R_ADMIN")?(k(),P(N,{key:0,action:"/group/import",accept:"application/json",onRefresh:e(g)},null,8,["onRefresh"])):Fe("",!0),o(e(oe),{onPositiveClick:r},{trigger:a(()=>[o(e(I),{size:"small",ghost:"",type:"primary",disabled:e(x).length===0&&e(h)("R_USER")},{icon:a(()=>[o(G,{class:"text-icon"})]),default:a(()=>[v(" "+C(e(t)("common.export")),1)]),_:1},8,["disabled"])]),default:a(()=>[v(C(e(x).length===0?e(t)("common.exportAll"):e(t)("common.exportPar",{num:e(x).length})),1)]),_:1})]),_:1},8,["columns","loading","show-add","onAdd","onRefresh"])]),default:a(()=>[o(_,{"checked-row-keys":e(x),"onUpdate:checkedRowKeys":n[2]||(n[2]=b=>A(x)?x.value=b:null),columns:e(T),data:e(u),"flex-height":!e(i).isMobile,"scroll-x":962,loading:e(D),remote:"","row-key":b=>b.id,pagination:e(O),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(io,{visible:e(U),"onUpdate:visible":n[3]||(n[3]=b=>A(U)?U.value=b:null),"operate-type":e(L),"row-data":e(W),onSubmitted:e(g)},null,8,["visible","operate-type","row-data","onSubmitted"]),o(po,{visible:e(d),"onUpdate:visible":n[4]||(n[4]=b=>A(d)?d.value=b:null),"row-data":m.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Do as default};
