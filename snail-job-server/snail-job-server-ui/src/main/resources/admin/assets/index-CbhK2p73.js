import{a as R,b as $,c as z}from"./log-drawer-BBb_wKUq.js";import{d as A,k as E,r as a,i as O,cz as U,c as d,o as f,w as o,e as B,f as s,aO as W,a7 as q,g as _,B as L,x as M,t as j,_ as F,as as G,h as H,l as J}from"./index-mUIrqFZO.js";import{u as K,_ as P}from"./workflow.vue_vue_type_style_index_0_lang-BtPfDnB0.js";import{g as Q}from"./workflow-JuhkmNQA.js";import"./CollapseItem-Ylp0YizN.js";import"./job-task-list-table.vue_vue_type_script_setup_true_lang-DNvHxnJ0.js";import"./table-CiARbIUu.js";import"./Grid-BaTVMcBE.js";import"./job-AFA64B4a.js";import"./detail-drawer-BRsrBMA8.js";import"./DescriptionsItem-CC29njaD.js";import"./dynamic-input.vue_vue_type_script_setup_true_lang-D0_rwYS5.js";import"./DynamicInput-CqoeNo_2.js";import"./code-mirror-DXVyevbR.js";import"./cron-input.vue_vue_type_style_index_0_lang-CM4XMUU0.js";import"./notify-BMcRFQic.js";import"./group-Bi2fhdLF.js";const X={class:"flex-center"},Y={class:"flex-center gap-8px"},Z=A({name:"workflow_form_batch",__name:"index",setup(ee){const c=K(),S=E(),v=a(!1),g=String(S.query.id),u=a({}),l=a(0),p=a(),k=new AbortController,t=a(!0),y=()=>{t.value=!0,k.abort(),clearTimeout(p.value),p.value=void 0},x=()=>{t.value||k.abort(),y(),u.value={},c.clear()},r=async()=>{v.value=!0;const{data:n,error:e}=await Q(g);e?(e==null?void 0:e.code)!=="ERR_CANCELED"&&x():(u.value=n,t.value=!(n.workflowBatchStatus&&[1,2].includes(n.workflowBatchStatus))||l.value===0,!t.value&&l.value!==0&&(clearTimeout(p.value),p.value=setTimeout(r,l.value*1e3))),v.value=!1},w=async n=>{if(n===-1){t.value&&(t.value=!1,await r());return}if(l.value=n,n===0){y();return}t.value=!1,await r()};O(()=>{c.clear(),c.setType(2),c.setId(g),r()}),U(()=>{x()});const b=a([{label:"Auto(off)",key:0},{label:"1s",key:1},{label:"5s",key:5},{label:"10s",key:10},{label:"30s",key:30},{label:"1m",key:60},{label:"5m",key:300}]);return(n,e)=>{const h=R,N=F,C=L,m=q,T=W,V=$,D=z,I=G;return f(),d(H(P),{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value=i),spinning:!1,disabled:"",onRefresh:e[2]||(e[2]=i=>r())},{buttons:o(()=>[B("div",X,[s(T,{trigger:"hover",width:"trigger",options:b.value,onSelect:w},{default:o(()=>[s(m,{placement:"left"},{trigger:o(()=>[s(C,{dashed:"",class:M(["w-136px",t.value?"mr-16px":"mr-42px"]),onClick:e[0]||(e[0]=i=>w(-1))},{icon:o(()=>[B("div",Y,[s(h,{class:"text-18px"}),_(" "+j(b.value.filter(i=>i.key===l.value)[0].label)+" ",1),s(N,{icon:"material-symbols:expand-more-rounded"})])]),_:1},8,["class"])]),default:o(()=>[e[3]||(e[3]=_(" 自动刷新频率 "))]),_:1})]),_:1},8,["options"]),t.value?(f(),d(m,{key:0,placement:"top"},{trigger:o(()=>[s(V,{class:"text-26px color-success"})]),default:o(()=>[e[4]||(e[4]=_(" 流程批次加载完成 "))]),_:1})):(f(),d(m,{key:1},{trigger:o(()=>[s(I,{size:"small"},{icon:o(()=>[s(D)]),_:1})]),default:o(()=>[e[5]||(e[5]=_(" 流程批次正在加载 "))]),_:1}))])]),_:1},8,["modelValue"])}}}),ke=J(Z,[["__scopeId","data-v-dfdd102d"]]);export{ke as default};
