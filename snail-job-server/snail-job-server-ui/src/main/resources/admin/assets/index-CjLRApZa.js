import{a as A,b as E,c as R}from"./log-drawer-m-GvVrZC.js";import{d as $,k as z,r as s,i as U,bs as W,o as f,c as d,w as e,e as h,f as n,x as q,g as p,t as L,h as M,_ as O,B as j,a8 as F,cs as G,au as H,l as J}from"./index-BxI_8ir5.js";import{u as K,_ as P}from"./workflow.vue_vue_type_style_index_0_lang-BVvScPLI.js";import{g as Q}from"./workflow-C49bAB05.js";import"./CollapseItem-CUobLCgj.js";import"./job-task-list-table.vue_vue_type_script_setup_true_lang-DO4S_MS8.js";import"./table-KwvlieBb.js";import"./Grid-D6if5aLa.js";import"./job-Cl2Rizrz.js";import"./detail-drawer-BdQyK8cj.js";import"./DescriptionsItem-D5s6FkGL.js";import"./code-mirror.vue_vue_type_script_setup_true_lang-yaz4Kucu.js";import"./cron-input.vue_vue_type_style_index_0_lang-C2hp-gtC.js";import"./group-BXqOqznU.js";const X={class:"flex-center"},Y={class:"flex-center gap-8px"},Z=$({name:"workflow_form_batch",__name:"index",setup(ee){const c=K(),B=z(),v=s(!1),g=String(B.query.id),r=s({}),l=s(0),i=s(),k=new AbortController,o=s(!0),y=()=>{o.value=!0,k.abort(),clearTimeout(i.value),i.value=void 0},x=()=>{o.value||k.abort(),y(),r.value={},c.clear()},u=async()=>{v.value=!0;const{data:a,error:t}=await Q(g);t?(t==null?void 0:t.code)!=="ERR_CANCELED"&&x():(r.value=a,o.value=!(a.workflowBatchStatus&&[1,2].includes(a.workflowBatchStatus))||l.value===0,!o.value&&l.value!==0&&(clearTimeout(i.value),i.value=setTimeout(u,l.value*1e3))),v.value=!1},b=async a=>{if(a===-1){o.value&&(o.value=!1,await u());return}if(l.value=a,a===0){y();return}o.value=!1,await u()};U(()=>{c.clear(),c.setType(2),c.setId(g),u()}),W(()=>{x()});const w=s([{label:"Auto(off)",key:0},{label:"1s",key:1},{label:"5s",key:5},{label:"10s",key:10},{label:"30s",key:30},{label:"1m",key:60},{label:"5m",key:300}]);return(a,t)=>{const S=A,N=O,C=j,m=F,T=G,V=E,D=R,I=H;return f(),d(M(P),{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=_=>r.value=_),spinning:!1,disabled:""},{buttons:e(()=>[h("div",X,[n(T,{trigger:"hover",width:"trigger",options:w.value,onSelect:b},{default:e(()=>[n(m,{placement:"left"},{trigger:e(()=>[n(C,{dashed:"",class:q(["w-136px",o.value?"mr-16px":"mr-42px"]),onClick:t[0]||(t[0]=_=>b(-1))},{icon:e(()=>[h("div",Y,[n(S,{class:"text-18px"}),p(" "+L(w.value.filter(_=>_.key===l.value)[0].label)+" ",1),n(N,{icon:"material-symbols:expand-more-rounded"})])]),_:1},8,["class"])]),default:e(()=>[p(" 自动刷新频率 ")]),_:1})]),_:1},8,["options"]),o.value?(f(),d(m,{key:0,placement:"top"},{trigger:e(()=>[n(V,{class:"text-26px color-success"})]),default:e(()=>[p(" 流程批次加载完成 ")]),_:1})):(f(),d(m,{key:1},{trigger:e(()=>[n(I,{size:"small"},{icon:e(()=>[n(D)]),_:1})]),default:e(()=>[p(" 流程批次正在加载 ")]),_:1}))])]),_:1},8,["modelValue"])}}}),de=J(Z,[["__scopeId","data-v-8354c50c"]]);export{de as default};
