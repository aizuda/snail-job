import{a as Se,N as O,c as we,b as De}from"./search-form.vue_vue_type_script_setup_true_lang-B3nrOFM3.js";import{aQ as B,aS as Ie,o as M,b as me,e as ie,d as j,Z as H,a0 as J,r as W,z as ce,A as fe,a as xe,$ as a,p as ge,q as ye,c as K,w as o,f as e,g as y,t as _,h as t,a5 as le,bn as re,ac as oe,E as _e,D as ne,B as C,a9 as ze,aa as Re,ab as se,I as be,H as ve,by as Ue,ad as te,bo as he,bl as ke,Y as ae,ax as $e,aw as Ve,l as Ce,ah as pe,L as Be,i as Ae,ai as q,a4 as G,ak as Z,F as qe,al as Me}from"./index-Cxl_PNjp.js";import{g as Fe}from"./group-CNWTYoXm.js";import{_ as Pe,u as Le,a as Oe}from"./table-BRmcb0CX.js";import{_ as We,a as He}from"./code-mirror.vue_vue_type_script_setup_true_lang-Bjh4pRfc.js";import{_ as ue}from"./select-group.vue_vue_type_script_setup_true_lang-B0zjYzwN.js";import{_ as Ne}from"./select-scene.vue_vue_type_script_setup_true_lang-BLHuX70e.js";import{_ as je,f as Ee}from"./log-drawer-DDgcrX8a.js";import{_ as Ge,a as Ze}from"./DescriptionsItem-rrUPAzSY.js";import{b as Je}from"./Grid-BLjrxj5f.js";import"./CollapseItem-DL-2h2jV.js";function Ke(i){return B({url:"/retry-task/list",method:"get",params:i})}function Qe(i,h){return B({url:`/retry-task/${i}?groupName=${h}`,method:"get"})}function Ye(i){return B({url:"/retry-task",method:"post",data:i})}function Xe(i){return B({url:"/retry-task/batch",method:"post",data:i})}function et(i){return B({url:"/retry-task/status",method:"put",data:i})}function tt(i){return B({url:"/retry-task/manual/trigger/retry/task",method:"post",data:i})}function at(i){return B({url:"/retry-task/manual/trigger/callback/task",method:"post",data:i})}function de(i){return B({url:"/retry-task/batch",method:"delete",data:i})}function lt(i){return B({url:"/retry-task/generate/idempotent-id",method:"post",data:i})}const rt={class:"inline-block",viewBox:"0 0 36 36",width:"1em",height:"1em"};function ot(i,h){return M(),me("svg",rt,h[0]||(h[0]=[ie("path",{fill:"currentColor",d:"M15 32H3a1 1 0 0 0 0 2h12a1 1 0 0 0 0-2M5 30h8a1 1 0 0 0 1-1V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v25a1 1 0 0 0 1 1M9 5.92a1.5 1.5 0 1 1-1.5 1.5A1.5 1.5 0 0 1 9 5.92M6 12.2h5.84v1.6H6Zm0 3h5.84v1.6H6Zm0 3h6v1.6H6ZM16 8h2v1.6h-2zm4 0h2v1.6h-2zm13-3.8h-8a.8.8 0 0 0-.8.8v6a.8.8 0 0 0 .8.8h8a.8.8 0 0 0 .8-.8V5a.8.8 0 0 0-.8-.8m-.8 6h-6.4V5.8h6.4ZM16 20h2v1.6h-2zm4 0h2v1.6h-2zm13-3.8h-8a.8.8 0 0 0-.8.8v6a.8.8 0 0 0 .8.8h8a.8.8 0 0 0 .8-.8v-6a.8.8 0 0 0-.8-.8m-.8 6h-6.4v-4.4h6.4Z"},null,-1),ie("path",{fill:"none",d:"M0 0h36v36H0z"},null,-1)]))}const nt=Ie({name:"clarity-thin-client-solid",render:ot}),st=j({name:"RetryTaskOperateDrawer",__name:"retry-task-operate-drawer",props:H({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(i,{emit:h}){const f=i,m=h,k=J(i,"visible"),N=W([]),{formRef:z,validate:g,restoreValidation:c}=ce(),{defaultRequiredRule:b}=fe(),$=xe(()=>({add:a("page.retryTask.addRetryTask"),edit:a("page.retryTask.editRetryTask")})[f.operateType]),u=ge(s());function s(){return{groupName:"",sceneName:"",idempotentId:"",bizNo:"",executorName:"",argsStr:"",retryStatus:0}}const D={groupName:b,sceneName:b,idempotentId:b,bizNo:b,executorName:b,retryStatus:b};function p(){if(N.value=[],f.operateType==="add"){Object.assign(u,s());return}f.operateType==="edit"&&f.rowData&&(Object.assign(u,f.rowData),N.value=JSON.parse(f.rowData.argsStr||"[]"))}function T(){k.value=!1}async function S(){var R;if(await g(),f.operateType==="add"){const{groupName:d,sceneName:v,idempotentId:n,bizNo:I,executorName:V,retryStatus:F}=u,{error:P}=await Ye({groupName:d,sceneName:v,idempotentId:n,bizNo:I,executorName:V,argsStr:JSON.stringify(N.value),retryStatus:F});if(P)return;(R=window.$message)==null||R.success(a("common.addSuccess"))}T(),m("submitted")}ye(k,()=>{k.value&&(p(),c())});async function U(){const R=u.groupName,d=u.sceneName,v=u.executorName,n=u.argsStr,{data:I,error:V}=await lt({groupName:R,sceneName:d,executorName:v,argsStr:n});V||(u.idempotentId=I)}return(R,d)=>{const v=_e,n=ne,I=nt,V=C,F=ze,P=Re,Q=He,Y=se,X=be,L=ve;return M(),K(oe,{modelValue:k.value,"onUpdate:modelValue":d[7]||(d[7]=l=>k.value=l),title:$.value,onHandleSubmit:S},{footer:o(()=>[e(L,{size:16},{default:o(()=>[e(V,{onClick:T},{default:o(()=>[y(_(t(a)("common.cancel")),1)]),_:1}),e(V,{type:"primary",onClick:S},{default:o(()=>[y(_(t(a)("common.save")),1)]),_:1})]),_:1})]),default:o(()=>[e(X,{ref_key:"formRef",ref:z,model:u,rules:D},{default:o(()=>[e(v,{label:t(a)("page.retryTask.groupName"),path:"groupName"},{default:o(()=>[e(ue,{value:u.groupName,"onUpdate:value":d[0]||(d[0]=l=>u.groupName=l),disabled:f.operateType==="edit"},null,8,["value","disabled"])]),_:1},8,["label"]),e(v,{label:t(a)("page.retryTask.sceneName"),path:"sceneName"},{default:o(()=>[e(Ne,{value:u.sceneName,"onUpdate:value":d[1]||(d[1]=l=>u.sceneName=l),"group-name":u.groupName,disabled:f.operateType==="edit"},null,8,["value","group-name","disabled"])]),_:1},8,["label"]),e(v,{label:t(a)("page.retryTask.idempotentId"),path:"idempotentId"},{default:o(()=>[e(P,null,{default:o(()=>[e(n,{value:u.idempotentId,"onUpdate:value":d[2]||(d[2]=l=>u.idempotentId=l),placeholder:t(a)("page.retryTask.form.idempotentId"),disabled:f.operateType==="edit"},null,8,["value","placeholder","disabled"]),e(F,{trigger:"hover"},{trigger:o(()=>[e(V,{type:"default",ghost:"",disabled:f.operateType==="edit",onClick:U},{default:o(()=>[e(I,{class:"text-icon"})]),_:1},8,["disabled"])]),default:o(()=>[y(" "+_(t(a)("page.retryTask.generateIdempotentId")),1)]),_:1})]),_:1})]),_:1},8,["label"]),e(v,{label:t(a)("page.retryTask.bizNo"),path:"bizNo"},{default:o(()=>[e(n,{value:u.bizNo,"onUpdate:value":d[3]||(d[3]=l=>u.bizNo=l),placeholder:t(a)("page.retryTask.form.bizNo"),disabled:f.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),e(v,{label:t(a)("page.retryTask.executorName"),path:"executorName"},{default:o(()=>[e(n,{value:u.executorName,"onUpdate:value":d[4]||(d[4]=l=>u.executorName=l),placeholder:t(a)("page.retryTask.form.executorName"),disabled:f.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),e(v,{label:t(a)("page.retryTask.argsStr"),path:"argsStr"},{default:o(()=>[e(Q,{value:N.value,"onUpdate:value":d[5]||(d[5]=l=>N.value=l),"on-create":()=>""},{default:o(({index:l})=>[e(v,{class:"w-full","ignore-path-change":"","show-label":!1,"show-feedback":!1,path:`argsStr[${l}]`},{default:o(()=>[e(We,{modelValue:N.value[l],"onUpdate:modelValue":r=>N.value[l]=r,lang:"json",placeholder:t(a)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["path"])]),_:1},8,["value"])]),_:1},8,["label"]),e(v,{label:t(a)("page.retryTask.retryStatus"),path:"retryStatus"},{default:o(()=>[e(Y,{value:u.retryStatus,"onUpdate:value":d[6]||(d[6]=l=>u.retryStatus=l),placeholder:t(a)("page.retryTask.form.retryStatus"),options:t(le)(t(re))},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ut=j({name:"RetryTaskBatchAddDrawer",__name:"retry-task-batch-add-drawer",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:H(["submitted"],["update:visible"]),setup(i,{emit:h}){const f=h,m=J(i,"visible"),{formRef:k,validate:N,restoreValidation:z}=ce(),{defaultRequiredRule:g}=fe(),c=ge(b());function b(){return{groupName:"",retryStatus:0,logStr:""}}const $={groupName:g,retryStatus:g,logStr:g};function u(){m.value=!1}async function s(){var U;await N();const{groupName:D,retryStatus:p,logStr:T}=c,{error:S}=await Xe({groupName:D,retryStatus:p,logStr:T});S||((U=window.$message)==null||U.success(a("common.addSuccess")),u(),f("submitted"))}return ye(m,()=>{m.value&&z()}),(D,p)=>{const T=_e,S=se,U=ne,R=be,d=C,v=ve;return M(),K(oe,{modelValue:m.value,"onUpdate:modelValue":p[3]||(p[3]=n=>m.value=n),title:t(a)("page.retryTask.batchAddRetryTask"),onHandleSubmit:s},{footer:o(()=>[e(v,{size:16},{default:o(()=>[e(d,{onClick:u},{default:o(()=>[y(_(t(a)("common.cancel")),1)]),_:1}),e(d,{type:"primary",onClick:s},{default:o(()=>[y(_(t(a)("common.save")),1)]),_:1})]),_:1})]),default:o(()=>[e(R,{ref_key:"formRef",ref:k,model:c,rules:$},{default:o(()=>[e(T,{label:t(a)("page.retryTask.groupName"),path:"groupName"},{default:o(()=>[e(ue,{value:c.groupName,"onUpdate:value":p[0]||(p[0]=n=>c.groupName=n)},null,8,["value"])]),_:1},8,["label"]),e(T,{label:t(a)("page.retryTask.retryStatus"),path:"retryStatus"},{default:o(()=>[e(S,{value:c.retryStatus,"onUpdate:value":p[1]||(p[1]=n=>c.retryStatus=n),placeholder:t(a)("page.retryTask.form.retryStatus"),options:t(le)(t(re))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(T,{label:t(a)("page.retryTask.form.logStr"),path:"logStr"},{default:o(()=>[e(U,{value:c.logStr,"onUpdate:value":p[2]||(p[2]=n=>c.logStr=n),type:"textarea",placeholder:t(a)("page.retryTask.form.logStr")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),it=j({name:"RetryTaskSearch",__name:"retry-task-search",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search"],["update:model"]),setup(i,{emit:h}){const f=h,m=J(i,"model");function k(){f("reset")}function N(){f("search")}return(z,g)=>{const c=Pe,b=ne,$=se,u=Se;return M(),K(u,{model:m.value,onSearch:N,onReset:k},{default:o(()=>[e(c,{span:"24 s:12 m:6",label:t(a)("page.retryTask.groupName"),path:"groupName",class:"pr-24px"},{default:o(()=>[e(ue,{value:m.value.groupName,"onUpdate:value":g[0]||(g[0]=s=>m.value.groupName=s),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(c,{span:"24 s:12 m:6",label:t(a)("page.retryTask.sceneName"),path:"sceneName",class:"pr-24px"},{default:o(()=>[e(Ne,{value:m.value.sceneName,"onUpdate:value":g[1]||(g[1]=s=>m.value.sceneName=s),"group-name":m.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),e(c,{span:"24 s:12 m:6",label:t(a)("page.retryTask.uniqueId"),path:"uniqueId",class:"pr-24px"},{default:o(()=>[e(b,{value:m.value.uniqueId,"onUpdate:value":g[2]||(g[2]=s=>m.value.uniqueId=s),placeholder:t(a)("page.retryTask.form.uniqueId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(c,{span:"24 s:12 m:6",label:t(a)("page.retryTask.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:o(()=>[e(b,{value:m.value.idempotentId,"onUpdate:value":g[3]||(g[3]=s=>m.value.idempotentId=s),placeholder:t(a)("page.retryTask.form.idempotentId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(c,{span:"24 s:12 m:6",label:t(a)("page.retryTask.bizNo"),path:"bizNo",class:"pr-24px"},{default:o(()=>[e(b,{value:m.value.bizNo,"onUpdate:value":g[4]||(g[4]=s=>m.value.bizNo=s),placeholder:t(a)("page.retryTask.form.bizNo"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(c,{span:"24 s:12 m:6",label:t(a)("page.retryTask.retryStatus"),path:"retryStatus",class:"pr-24px"},{default:o(()=>[e($,{value:m.value.retryStatus,"onUpdate:value":g[5]||(g[5]=s=>m.value.retryStatus=s),placeholder:t(a)("page.retryTask.form.retryStatus"),options:t(le)(t(re)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),pt=j({name:"SceneDetailDrawer",__name:"retry-task-detail-drawer",props:H({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(i){const h=i,f=J(i,"visible"),m=W([]),k=W(),N=new AbortController,z=W(!1);let g="0",c=0;async function b(){const{data:s,error:D}=await Ee({groupName:h.rowData.groupName,uniqueId:h.rowData.uniqueId,startId:g,fromIndex:c,size:50});D||(z.value=s.finished,g=s.nextStartId,c=s.fromIndex,s.message&&(m.value.push(...s.message),m.value.sort((p,T)=>Number.parseInt(p.time_stamp,10)-Number.parseInt(T.time_stamp,10))),z.value||(clearTimeout(k.value),k.value=setTimeout(b,1e3)))}const $=async s=>{s===1&&m.value.length===0&&await b()},u=()=>{z.value=!0,N.abort(),clearTimeout(k.value),k.value=void 0};return Ue(()=>{u()}),(s,D)=>{const p=Ge,T=ae,S=Ze,U=$e,R=je,d=Ve,v=oe;return M(),K(v,{modelValue:f.value,"onUpdate:modelValue":D[0]||(D[0]=n=>f.value=n),title:t(a)("page.retryTask.detail")},{default:o(()=>[e(d,{type:"segment",animated:"","onUpdate:value":$},{default:o(()=>[e(U,{name:0,tab:t(a)("page.log.info")},{default:o(()=>[e(S,{"label-placement":"top",bordered:"",column:2},{default:o(()=>[e(p,{label:t(a)("page.retryTask.uniqueId"),span:2},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.uniqueId),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.groupName"),span:2},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.groupName),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.sceneName"),span:2},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.sceneName),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.nextTriggerAt"),span:1},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.nextTriggerAt),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.retryCount"),span:1},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.retryCount),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.retryStatus"),span:1},{default:o(()=>{var n;return[e(T,{type:t(te)((n=s.rowData)==null?void 0:n.retryStatus)},{default:o(()=>{var I;return[y(_(t(a)(t(he)[(I=s.rowData)==null?void 0:I.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.taskType"),span:1},{default:o(()=>{var n;return[e(T,{type:t(te)((n=s.rowData)==null?void 0:n.taskType)},{default:o(()=>{var I;return[y(_(t(a)(t(ke)[(I=s.rowData)==null?void 0:I.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.bizNo"),span:2},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.bizNo),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.idempotentId"),span:2},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.idempotentId),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.executorName"),span:2},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.executorName),1)]}),_:1},8,["label"]),e(p,{label:t(a)("page.retryTask.argsStr"),span:2},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.argsStr),1)]}),_:1},8,["label"]),e(p,{label:t(a)("common.createDt"),span:1},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.createDt),1)]}),_:1},8,["label"]),e(p,{label:t(a)("common.updateDt"),span:1},{default:o(()=>{var n;return[y(_((n=s.rowData)==null?void 0:n.updateDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),e(U,{name:1,tab:t(a)("page.log.title"),"display-directive":"if"},{default:o(()=>[e(R,{drawer:!1,type:"retry","task-data":s.rowData},null,8,["task-data"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),dt=Ce(pt,[["__scopeId","data-v-4fdfe176"]]),mt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function A(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Me(i)}const St=j({name:"retry_task",__name:"index",setup(i){const h=W(),{bool:f,setTrue:m}=pe(!1),k=Be(),{columns:N,columnChecks:z,data:g,getData:c,loading:b,mobilePagination:$,searchParams:u,resetSearchParams:s}=Le({apiFn:Ke,apiParams:{page:1,size:10,uniqueId:null,groupName:null,sceneName:null,idempotentId:null,bizNo:null,retryStatus:null},columns:()=>[{type:"selection",align:"center",width:48,disabled:l=>l.retryStatus===0},{key:"id",title:a("common.index"),align:"center",width:64},{key:"uniqueId",title:a("page.retryTask.uniqueId"),align:"center",fixed:"left",minWidth:120,render:l=>{async function r(){await I(l),m()}return e(C,{text:!0,tag:"a",type:"primary",onClick:r,class:"ws-normal"},{default:()=>[l.uniqueId]})}},{key:"groupName",title:a("page.retryTask.groupName"),align:"left",resizable:!0,minWidth:120,maxWidth:250},{key:"sceneName",title:a("page.retryTask.sceneName"),align:"left",minWidth:120},{key:"nextTriggerAt",title:a("page.retryTask.nextTriggerAt"),align:"left",resizable:!0,minWidth:120,maxWidth:150},{key:"retryCount",title:a("page.retryTask.retryCount"),align:"center",width:80},{key:"retryStatus",title:a("page.retryTask.retryStatus"),align:"left",width:120,render:l=>{if(l.retryStatus===null)return null;const r=a(he[l.retryStatus]);return e(ae,{type:te(l.retryStatus)},A(r)?r:{default:()=>[r]})}},{key:"taskType",title:a("page.retryTask.taskType"),align:"left",width:100,render:l=>{if(l.taskType===null)return null;const r={1:"warning",2:"error"},w=a(ke[l.taskType]);return e(ae,{type:r[l.taskType]},A(w)?w:{default:()=>[w]})}},{key:"idempotentId",title:a("page.retryTask.idempotentId"),align:"left",resizable:!0,minWidth:150,maxWidth:300},{key:"bizNo",title:a("page.retryTask.bizNo"),align:"left",resizable:!0,minWidth:150,maxWidth:300},{key:"operate",title:a("common.operate"),align:"center",width:260,fixed:"right",render:l=>e("div",{class:"flex-center gap-8px"},[l.retryStatus!==1&&l.retryStatus!==2?e(G,null,[e(O,{onPositiveClick:()=>P(l.groupName,l.uniqueId,l.taskType)},{default:()=>a("common.confirmExecute"),trigger:()=>{let r;return e(C,{type:"info",text:!0,ghost:!0,size:"small"},A(r=a("common.execute"))?r:{default:()=>[r]})}}),e(Z,{vertical:!0},null)]):"",l.retryStatus!==1&&l.retryStatus!==2?e(G,null,[e(O,{onPositiveClick:()=>X(Number(l.id),l.groupName)},{default:()=>a("common.confirmFinish"),trigger:()=>{let r;return e(C,{type:"warning",text:!0,ghost:!0,size:"small"},A(r=a("common.finish"))?r:{default:()=>[r]})}}),e(Z,{vertical:!0},null)]):"",l.retryStatus===0?e(G,null,[e(O,{onPositiveClick:()=>Y(Number(l.id),l.groupName)},{default:()=>a("common.confirmPause"),trigger:()=>{let r;return e(C,{type:"success",text:!0,ghost:!0,size:"small"},A(r=a("common.pause"))?r:{default:()=>[r]})}}),e(Z,{vertical:!0},null)]):"",l.retryStatus===3?e(G,null,[e(O,{onPositiveClick:()=>Q(Number(l.id),l.groupName)},{default:()=>a("common.confirmResume"),trigger:()=>{let r;return e(C,{type:"info",text:!0,ghost:!0,size:"small"},A(r=a("common.resume"))?r:{default:()=>[r]})}}),e(Z,{vertical:!0},null)]):"",e(O,{onPositiveClick:()=>n(l.groupName,l.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let r;return e(C,{type:"error",text:!0,ghost:!0,size:"small"},A(r=a("common.delete"))?r:{default:()=>[r]})}})])}]}),{drawerVisible:D,operateType:p,handleAdd:T,checkedRowKeys:S,onBatchDeleted:U,onDeleted:R}=Oe(g,c),{bool:d,setTrue:v}=pe();async function n(l,r){const{error:w}=await de({groupName:l,ids:[r]});w||R()}async function I(l){const r=await Qe(l.id,l.groupName);h.value=r.data||null}async function V(){const l=S.value;if(l.length===0)return;const r=g.value[0].groupName,{error:w}=await de({groupName:r,ids:l});w||U()}function F(){v()}function P(l,r,w){if(w===1){tt({groupName:l,uniqueIds:[r]});return}w===2&&at({groupName:l,uniqueIds:[r]})}function Q(l,r){L(l,r,0)}function Y(l,r){L(l,r,3)}function X(l,r){L(l,r,1)}async function L(l,r,w){var E;const{error:ee}=await et({id:l,groupName:r,retryStatus:w});ee||((E=window.$message)==null||E.success(a("common.updateSuccess")),c())}return Ae(async()=>{const{error:l,data:r}=await Fe();!l&&r.length>0&&(u.groupName=r[0],c())}),(l,r)=>{const w=we,ee=De,E=Je,Te=qe;return M(),me("div",mt,[e(it,{model:t(u),"onUpdate:model":r[0]||(r[0]=x=>q(u)?u.value=x:null),onReset:t(s),onSearch:t(c)},null,8,["model","onReset","onSearch"]),e(Te,{title:t(a)("page.retryTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":o(()=>[e(ee,{columns:t(z),"onUpdate:columns":r[1]||(r[1]=x=>q(z)?z.value=x:null),"disabled-delete":t(S).length===0,loading:t(b),onAdd:t(T),onDelete:V,onRefresh:t(c)},{addAfter:o(()=>[e(t(C),{size:"small",ghost:"",type:"primary",onClick:F},{icon:o(()=>[e(w,{class:"text-icon"})]),default:o(()=>[y(" "+_(t(a)("common.batchAdd")),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:o(()=>[e(E,{"checked-row-keys":t(S),"onUpdate:checkedRowKeys":r[2]||(r[2]=x=>q(S)?S.value=x:null),columns:t(N),data:t(g),"flex-height":!t(k).isMobile,"scroll-x":2e3,loading:t(b),remote:"","row-key":x=>x.id,pagination:t($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(st,{visible:t(D),"onUpdate:visible":r[3]||(r[3]=x=>q(D)?D.value=x:null),"operate-type":t(p),onSubmitted:t(c)},null,8,["visible","operate-type","onSubmitted"]),e(ut,{visible:t(d),"onUpdate:visible":r[4]||(r[4]=x=>q(d)?d.value=x:null),onSubmitted:t(c)},null,8,["visible","onSubmitted"]),e(dt,{visible:t(f),"onUpdate:visible":r[5]||(r[5]=x=>q(f)?f.value=x:null),"row-data":h.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{St as default};
