import{a as ae,b as ne,N as q}from"./search-form-ChmbPvEh.js";import{_ as le,a as re,d as se}from"./download-CqgZd6rA.js";import{_ as ie}from"./delete-alert--vAGBU2a.js";import{d as z,a0 as F,a1 as V,c as J,o as j,w as s,f as e,h as o,$ as a,D as ue,ad as ce,ae as pe,aF as de,n as me,q as fe,H as we,C as ge,E as _e,B as D,g as R,t as O,aJ as ke,cM as he,cO as ye,l as ve,bZ as xe,K as be,u as Ne,r as Se,af as Ce,b as De,ag as A,F as Te,aM as Ie,aa as We,Z as B,N as $e,ah as E,aO as Re,ai as Ue}from"./index-DPxvecb9.js";import{n as Ae,o as K,p as Me,q as Pe}from"./workflow-Dn9nqVrg.js";import{_ as Be,u as Fe,a as Oe}from"./table-qlAFhrE0.js";import{_ as ze}from"./status-switch.vue_vue_type_script_setup_true_lang-DAsPsSVi.js";import{u as je}from"./auth-CDLrVlMD.js";import{_ as qe}from"./system-user.vue_vue_type_script_setup_true_lang-Bp2x704N.js";import{_ as Ee}from"./select-group.vue_vue_type_script_setup_true_lang-1ffxHWR9.js";import{_ as Ke}from"./dynamic-input.vue_vue_type_script_setup_true_lang-BBwW4qcH.js";import{b as Ve}from"./Grid-CqPyBB90.js";import"./CollapseItem-B-Wk-PiL.js";import"./Progress-QUvb70tG.js";import"./group-BZ9XUFDN.js";import"./DynamicInput-NZwVHGPu.js";const Je=z({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:F(["reset","search"],["update:model"]),setup(h,{emit:T}){const _=T,p=V(h,"model");function y(){_("reset")}function f(){_("search")}return(S,w)=>{const v=Be,C=ue,r=ce,i=qe,x=ae;return j(),J(x,{model:p.value,onSearch:f,onReset:y},{default:s(()=>[e(v,{span:"24 s:12 m:6",label:o(a)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:s(()=>[e(Ee,{value:p.value.groupName,"onUpdate:value":w[0]||(w[0]=u=>p.value.groupName=u),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(v,{span:"24 s:12 m:6",label:o(a)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:s(()=>[e(C,{value:p.value.workflowName,"onUpdate:value":w[1]||(w[1]=u=>p.value.workflowName=u),placeholder:o(a)("page.workflow.form.workflowName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(v,{span:"24 s:12 m:6",label:o(a)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:s(()=>[e(r,{value:p.value.workflowStatus,"onUpdate:value":w[2]||(w[2]=u=>p.value.workflowStatus=u),placeholder:o(a)("page.workflow.form.workflowStatus"),options:o(pe)(o(de)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(v,{span:"24 s:12 m:6",label:o(a)("page.workflow.ownerName"),path:"ownerId",class:"pr-24px"},{default:s(()=>[e(i,{value:p.value.ownerId,"onUpdate:value":w[3]||(w[3]=u=>p.value.ownerId=u),clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Le=z({name:"WorkflowTriggerModal",__name:"workflow-trigger-modal",props:F({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:F(["submitted"],["update:visible"]),setup(h,{emit:T}){const _=h,p=T,y=V(h,"visible"),f=me(S());function S(){var r;return{workflowId:(r=_.rowData)==null?void 0:r.id,tmpWfContext:"",wfContexts:[]}}function w(){const r=_.rowData;if(!r){Object.assign(f,S());return}(r==null?void 0:r.wfContext)&&(f.wfContexts=he(r==null?void 0:r.wfContext)||[])}function v(){y.value=!1}fe(y,()=>{y.value&&w()});async function C(){var x,u;const r=JSON.stringify(ye(f.wfContexts)||{}),{error:i}=await Ae({workflowId:(x=_.rowData)==null?void 0:x.id,tmpWfContext:r});i||((u=window.$message)==null||u.success(a("common.executeSuccess")),v(),p("submitted"))}return(r,i)=>{const x=Ke,u=ge,b=we,U=D,k=_e,M=ke;return j(),J(M,{show:y.value,"onUpdate:show":i[1]||(i[1]=I=>y.value=I),class:"max-w-90% w-600px",preset:"card",title:"执行工作流",bordered:!1},{footer:s(()=>[e(k,{justify:"end",size:16},{default:s(()=>[e(U,{onClick:v},{default:s(()=>[R(O(o(a)("common.cancel")),1)]),_:1}),e(U,{type:"primary",onClick:C},{default:s(()=>i[2]||(i[2]=[R("执行")])),_:1})]),_:1})]),default:s(()=>[e(b,{model:f},{default:s(()=>{var I;return[e(u,{path:"wfContexts",label:"工作流上下文","show-feedback":!((I=f.wfContexts)!=null&&I.length)},{default:s(()=>[e(x,{value:f.wfContexts,"onUpdate:value":i[0]||(i[0]=P=>f.wfContexts=P),path:"wfContexts"},null,8,["value"])]),_:1},8,["show-feedback"])]}),_:1},8,["model"])]),_:1},8,["show"])}}}),Ge=ve(Le,[["__scopeId","data-v-6d715661"]]),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function $(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Ue(h)}const dt=z({name:"workflow_task",__name:"index",setup(h){const{hasAuth:T}=je(),_=xe(),p=be(),{routerPushByKey:y}=Ne(),f=Se(),{bool:S,setTrue:w}=Ce(!1),{columns:v,columnChecks:C,data:r,getData:i,loading:x,mobilePagination:u,searchParams:b,resetSearchParams:U}=Fe({apiFn:Me,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null,ownerId:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:a("common.index"),align:"center",width:120},{key:"workflowName",title:a("page.workflow.workflowName"),align:"center",minWidth:120,render:t=>{function n(){Z(t.id)}return e(D,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[t.workflowName]})}},{key:"groupName",title:a("page.workflow.groupName"),align:"center",minWidth:120},{key:"ownerName",title:a("page.workflow.ownerName"),align:"center",width:180},{key:"nextTriggerAt",title:a("page.workflow.nextTriggerAt"),align:"center",minWidth:120},{key:"workflowStatus",title:a("page.workflow.workflowStatus"),align:"center",minWidth:120,render:t=>{const n=async(l,d)=>{var g;const{error:N}=await Pe(t.id);N||(t.workflowStatus=l,(g=window.$message)==null||g.success(a("common.updateSuccess"))),d(!N)};return e(ze,{value:t.workflowStatus,"onUpdate:value":l=>t.workflowStatus=l,onSubmitted:n},null)}},{key:"triggerType",title:a("page.workflow.triggerType"),align:"center",width:140,render:t=>{if(!t.triggerType)return null;const n=a(Ie[t.triggerType]);return e(B,{type:We(t.triggerType)},$(n)?n:{default:()=>[n]})}},{key:"triggerInterval",title:a("page.workflow.triggerInterval"),align:"center",minWidth:140,render:t=>{const l=(c=>{try{const m=JSON.parse(c);return Array.isArray(m)&&m.every(oe=>typeof oe=="string")?m:null}catch{return null}})(t.triggerInterval);if(!l||l.length===0)return t.triggerInterval;const d=c=>e(B,{class:"cursor-pointer",type:"default"},$(c)?c:{default:()=>[c]});if(l.length===1)return d(l[0]);const[N,g]=l,W=l[l.length-1];return l.length===2?e("div",{class:"flex flex-wrap gap-4px"},[d(N),d(g)]):e($e,{trigger:"hover",class:"cursor-pointer"},{trigger:()=>e("div",{class:"flex flex-center flex-wrap gap-4px"},[d(N),d("..."),d(W)]),default:()=>e("div",{class:"w-310px flex flex-wrap gap-4px"},[l.map(c=>e(B,{class:"cursor-pointer",key:c,type:"default"},$(c)?c:{default:()=>[c]}))])})}},{key:"executorTimeout",title:a("page.workflow.executorTimeout"),align:"center",minWidth:120},{key:"updateDt",title:a("page.workflow.updateDt"),align:"center",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",fixed:"right",width:200,render:t=>{let n,l;const d=[{label:a("common.copy"),key:"copy",click:()=>Q(t.id)},{type:"divider",key:"d2"},{label:a("common.batchList"),key:"batchList",click:()=>te(t.id)},{type:"divider",key:"d2"},{type:"render",key:"delete",render:()=>e("div",{class:"flex-center"},[e(q,{onPositiveClick:()=>L(t.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let g;return e(D,{quaternary:!0,size:"small"},$(g=a("common.delete"))?g:{default:()=>[g]})}})])}],N=g=>{const W=d.filter(c=>c.key===g)[0].click;W&&W()};return e("div",{class:"flex-center gap-8px"},[e(D,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>G(t.id)},$(n=a("common.edit"))?n:{default:()=>[n]}),e(E,{vertical:!0},null),e(D,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>X(t)},$(l=a("common.execute"))?l:{default:()=>[l]}),e(E,{vertical:!0},null),e(Re,{trigger:"click","show-arrow":!1,options:d,size:"small","on-select":N},{default:()=>e(D,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[R("更多")]})})])}}]}),{checkedRowKeys:k,onBatchDeleted:M,onDeleted:I}=Oe(r,i);async function P(){const{error:t}=await K(k.value);t||M()}async function L(t){const{error:n}=await K([t]);n||I()}function G(t){_.push({path:"/workflow/form/edit",query:{id:t}})}function H(){_.push({path:"/workflow/form/add"})}function Z(t){_.push({path:"/workflow/form/detail",query:{id:t}})}function Q(t){_.push({path:"/workflow/form/copy",query:{id:t}})}async function X(t){f.value=t,w()}function Y(){return{workflowIds:k.value,groupName:b.groupName,workflowName:b.workflowName,workflowStatus:b.workflowStatus,ownerId:b.ownerId}}function ee(){se("/workflow/export",Y(),a("page.workflow.title"))}function te(t){const n=r.value.find(l=>l.id===t);y("workflow_batch",{state:{workflowId:t,workflowName:n.workflowName}})}return(t,n)=>{const l=ie,d=le,N=re,g=ne,W=Ve,c=Te;return j(),De("div",He,[e(Je,{model:o(b),"onUpdate:model":n[0]||(n[0]=m=>A(b)?b.value=m:null),onReset:o(U),onSearch:o(i)},null,8,["model","onReset","onSearch"]),e(l),e(c,{title:o(a)("page.workflow.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[e(g,{columns:o(C),"onUpdate:columns":n[1]||(n[1]=m=>A(C)?C.value=m:null),"disabled-delete":o(k).length===0,loading:o(x),"show-delete":o(T)("R_ADMIN"),onAdd:H,onDelete:P,onRefresh:o(i)},{addAfter:s(()=>[e(d,{action:"/workflow/import",accept:"application/json",onRefresh:o(i)},null,8,["onRefresh"]),e(o(q),{onPositiveClick:ee},{trigger:s(()=>[e(o(D),{size:"small",ghost:"",type:"primary",disabled:o(k).length===0&&o(T)("R_USER")},{icon:s(()=>[e(N,{class:"text-icon"})]),default:s(()=>[R(" "+O(o(a)("common.export")),1)]),_:1},8,["disabled"])]),default:s(()=>[R(O(o(k).length===0?o(a)("common.exportAll"):o(a)("common.exportPar",{num:o(k).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-delete","onRefresh"])]),default:s(()=>[e(W,{"checked-row-keys":o(k),"onUpdate:checkedRowKeys":n[2]||(n[2]=m=>A(k)?k.value=m:null),columns:o(v),data:o(r),"flex-height":!o(p).isMobile,"scroll-x":1300,loading:o(x),remote:"","row-key":m=>m.id,pagination:o(u),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(Ge,{visible:o(S),"onUpdate:visible":n[3]||(n[3]=m=>A(S)?S.value=m:null),"row-data":f.value},null,8,["visible","row-data"])])}}});export{dt as default};
