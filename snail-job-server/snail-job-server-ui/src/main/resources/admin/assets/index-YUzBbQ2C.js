import{_ as se,a as de,N as ge,b as ce}from"./search-form.vue_vue_type_script_setup_true_lang-B9DCSIZj.js";import{d as me,_ as fe,a as _e}from"./download-CpmmXY_k.js";import{d as B,Z as j,a0 as K,z as be,A as ve,a as he,$ as t,r as X,p as Se,q as Ce,o as x,c as U,w as a,f as o,g as S,t as C,h as e,b as q,a1 as Q,a2 as ee,a3 as H,a4 as oe,a5 as ye,a6 as we,a7 as Ne,D as te,E as ke,H as De,B as V,a8 as Ge,a9 as Me,aa as ae,I as Re,ab as ne,ac as F,ad as xe,ae as le,af as re,Y as J,L as Pe,ag as Te,ah as O,ai as Ue,F as $e,aj as Oe}from"./index-D11HRvLC.js";import{f as Ae,a as Ie,b as Ve,c as Fe,d as je}from"./group-DBuDE6uz.js";import{_ as Be,u as Ee,a as ze}from"./table-oGN68_Ra.js";import{_ as Le}from"./status-switch.vue_vue_type_script_setup_true_lang-Cv5sP_Gc.js";import{u as We}from"./auth-B9UptQv2.js";import{_ as qe,a as He,b as Je}from"./Grid-BEQeOJ6_.js";import{_ as Ke,a as Ye}from"./CollapseItem-C4NYsEPz.js";import{_ as Ze,a as Qe}from"./DescriptionsItem-QSQ4JSXU.js";import"./Progress-DQlqejcE.js";const Xe=B({name:"GroupOperateDrawer",__name:"group-operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(y,{emit:_}){const i=y,c=_,d=K(y,"visible"),{formRef:M,validate:T,restoreValidation:b}=be(),{defaultRequiredRule:r}=ve(),g=he(()=>({add:t("page.groupConfig.addGroupConfig"),edit:t("page.groupConfig.editGroupConfig")})[i.operateType]),P=X([]),p=Se(v());function v(){return{groupName:"",token:"SJ_Wyz3dmsdbDOkDujOTSSoBjGQP1BMsVnj",groupStatus:1,description:"",idGeneratorMode:2,initScene:1,groupPartition:0}}const E={groupName:[{required:!0,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:t("page.groupConfig.form.groupNameRule")}],token:[r],groupStatus:[r],idGeneratorMode:[r],initScene:[r],groupPartition:[r]};function $(){if(i.operateType==="add"){Object.assign(p,v());return}i.operateType==="edit"&&i.rowData&&Object.assign(p,i.rowData)}function A(){d.value=!1}async function I(){var k,u;if(await T(),i.operateType==="add"){const{groupName:h,token:l,groupStatus:n,description:m,idGeneratorMode:D,initScene:R,groupPartition:w}=p,{error:G}=await Ae({groupName:h,token:l,groupStatus:n,description:m,idGeneratorMode:D,initScene:R,groupPartition:w});if(G)return;(k=window.$message)==null||k.success(t("common.addSuccess"))}else{const{groupName:h,token:l,groupStatus:n,description:m,idGeneratorMode:D,initScene:R,groupPartition:w}=p,{error:G}=await Ie({groupName:h,token:l,groupStatus:n,description:m,idGeneratorMode:D,initScene:R,groupPartition:w});if(G)return;(u=window.$message)==null||u.success(t("common.updateSuccess"))}A(),c("submitted")}function z(){p.token=L(32)}function L(k){const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let h="SJ_";for(let l=0;l<k;l+=1){const n=Math.floor(Math.random()*u.length);h+=u.substring(n,n+1)}return h}const N=async()=>{const{data:k}=await Ve();P.value=k.map(u=>String(u))};return Ce(d,()=>{d.value&&(N(),$(),b())}),(k,u)=>{const h=te,l=ke,n=He,m=De,D=qe,R=se,w=V,G=Ge,f=Me,Y=Ke,Z=ae,ue=Ye,ie=Re,pe=ne;return x(),U(pe,{modelValue:d.value,"onUpdate:modelValue":u[7]||(u[7]=s=>d.value=s),title:g.value,onSubmitted:I},{footer:a(()=>[o(m,{size:16},{default:a(()=>[o(w,{onClick:A},{default:a(()=>[S(C(e(t)("common.cancel")),1)]),_:1}),o(w,{type:"primary",onClick:I},{default:a(()=>[S(C(e(t)("common.save")),1)]),_:1})]),_:1})]),default:a(()=>[o(ie,{ref_key:"formRef",ref:M,model:p,rules:E},{default:a(()=>[o(ue,{"default-expanded-names":["1","2"]},{default:a(()=>[o(Y,{title:e(t)("page.groupConfig.commonConfig"),name:"1"},{default:a(()=>[o(l,{label:e(t)("page.groupConfig.groupName"),path:"groupName"},{default:a(()=>[o(h,{value:p.groupName,"onUpdate:value":u[0]||(u[0]=s=>p.groupName=s),maxlength:64,"show-count":"",placeholder:e(t)("page.groupConfig.form.groupName"),disabled:i.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),o(l,{label:e(t)("page.groupConfig.groupStatus"),path:"groupStatus"},{default:a(()=>[o(D,{value:p.groupStatus,"onUpdate:value":u[1]||(u[1]=s=>p.groupStatus=s),name:"groupStatus"},{default:a(()=>[o(m,null,{default:a(()=>[(x(!0),q(H,null,Q(e(ee),s=>(x(),U(n,{key:s.value,value:s.value,label:e(t)(s.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(l,{label:e(t)("page.groupConfig.token"),path:"token"},{default:a(()=>[o(f,null,{default:a(()=>[o(h,{value:p.token,"onUpdate:value":u[2]||(u[2]=s=>p.token=s),maxlength:64,placeholder:e(t)("page.groupConfig.form.token"),disabled:i.operateType==="edit"},null,8,["value","placeholder","disabled"]),o(G,{trigger:"hover"},{trigger:a(()=>[o(w,{type:"default",ghost:"",disabled:i.operateType==="edit",onClick:z},{default:a(()=>[o(R,{class:"text-icon"})]),_:1},8,["disabled"])]),default:a(()=>[S(" "+C(e(t)("page.groupConfig.generateToken")),1)]),_:1})]),_:1})]),_:1},8,["label"]),o(l,{label:e(t)("page.groupConfig.description"),path:"description"},{default:a(()=>[o(h,{value:p.description,"onUpdate:value":u[3]||(u[3]=s=>p.description=s),type:"textarea",maxlength:256,"show-count":"",placeholder:e(t)("page.groupConfig.form.description"),clearable:"",round:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),o(Y,{title:e(t)("page.groupConfig.retryConfig"),name:"2"},{default:a(()=>[o(l,{label:e(t)("page.groupConfig.idGeneratorMode"),path:"idGeneratorMode"},{default:a(()=>[o(Z,{value:p.idGeneratorMode,"onUpdate:value":u[4]||(u[4]=s=>p.idGeneratorMode=s),placeholder:e(t)("page.groupConfig.form.idGeneratorMode"),options:e(oe)(e(ye))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),o(l,{label:e(t)("page.groupConfig.initScene"),path:"initScene"},{default:a(()=>[o(D,{value:p.initScene,"onUpdate:value":u[5]||(u[5]=s=>p.initScene=s),name:"initScene"},{default:a(()=>[o(m,null,{default:a(()=>[(x(!0),q(H,null,Q(e(we),s=>(x(),U(n,{key:s.value,value:s.value,label:e(t)(s.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),o(l,{label:e(t)("page.groupConfig.groupPartition"),path:"groupPartition"},{default:a(()=>[o(Z,{value:p.groupPartition,"onUpdate:value":u[6]||(u[6]=s=>p.groupPartition=s),placeholder:e(t)("page.groupConfig.form.groupPartition"),options:e(Ne)(P.value)},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),eo=B({name:"GroupDetailDrawer",__name:"group-detail-drawer",props:j({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(y){const _=K(y,"visible");return(i,c)=>{const d=Ze,M=J,T=Qe,b=ne;return x(),U(b,{modelValue:_.value,"onUpdate:modelValue":c[0]||(c[0]=r=>_.value=r),title:e(t)("page.groupConfig.detail")},{default:a(()=>[o(T,{"label-placement":"top",bordered:"",column:2},{default:a(()=>[o(d,{label:e(t)("page.groupConfig.groupName"),span:2},{default:a(()=>{var r;return[S(C((r=i.rowData)==null?void 0:r.groupName),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.token"),span:2},{default:a(()=>{var r;return[S(C((r=i.rowData)==null?void 0:r.token),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.groupStatus"),span:1},{default:a(()=>{var r;return[o(M,{type:e(F)((r=i.rowData)==null?void 0:r.groupStatus)},{default:a(()=>{var g;return[S(C(e(t)(e(xe)[(g=i.rowData)==null?void 0:g.groupStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.idGeneratorMode"),span:1},{default:a(()=>{var r;return[o(M,{type:e(F)((r=i.rowData)==null?void 0:r.idGeneratorMode)},{default:a(()=>{var g;return[S(C(e(t)(e(le)[(g=i.rowData)==null?void 0:g.idGeneratorMode])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.groupPartition"),span:1},{default:a(()=>{var r;return[S(C((r=i.rowData)==null?void 0:r.groupPartition),1)]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.initScene"),span:1},{default:a(()=>{var r;return[o(M,{type:e(F)((r=i.rowData)==null?void 0:r.initScene)},{default:a(()=>{var g;return[S(C(e(t)(e(re)[(g=i.rowData)==null?void 0:g.initScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),o(d,{label:e(t)("page.groupConfig.description"),span:2},{default:a(()=>{var r;return[S(C((r=i.rowData)==null?void 0:r.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),oo=B({name:"GroupSearch",__name:"group-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(y,{emit:_}){const i=_,c=K(y,"model");function d(){i("reset")}function M(){i("search")}return(T,b)=>{const r=te,g=Be,P=ae,p=de;return x(),U(p,{model:c.value,onSearch:M,onReset:d},{default:a(()=>[o(g,{span:"24 s:12 m:6",label:e(t)("page.groupConfig.groupName"),path:"groupName",class:"pr-24px"},{default:a(()=>[o(r,{value:c.value.groupName,"onUpdate:value":b[0]||(b[0]=v=>c.value.groupName=v),placeholder:e(t)("page.groupConfig.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(g,{span:"24 s:12 m:6",label:e(t)("page.groupConfig.groupStatus"),path:"groupStatus",class:"pr-24px"},{default:a(()=>[o(P,{value:c.value.groupStatus,"onUpdate:value":b[1]||(b[1]=v=>c.value.groupStatus=v),placeholder:e(t)("page.groupConfig.form.groupStatus"),options:e(oe)(e(ee)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),to={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Oe(y)}const fo=B({name:"group",__name:"index",setup(y){const{hasAuth:_}=We(),i=Pe(),c=X(),{bool:d,setTrue:M}=Te(!1),{columns:T,columnChecks:b,data:r,getData:g,loading:P,mobilePagination:p,searchParams:v,resetSearchParams:E}=Ee({apiFn:Fe,apiParams:{page:1,size:10,groupName:null,groupStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:t("common.index"),align:"center",width:64},{key:"groupName",title:t("page.groupConfig.groupName"),align:"left",minWidth:260,render:l=>{function n(){c.value=l||null,M()}return o(V,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[l.groupName]})}},{key:"groupStatus",title:t("page.groupConfig.groupStatus"),align:"center",width:80,render:l=>{const n=async(m,D)=>{var G;const R=l.groupStatus===1?0:1,{error:w}=await je({groupName:l.groupName,groupStatus:R});w||(l.groupStatus=m,(G=window.$message)==null||G.success(t("common.updateSuccess"))),D()};return o(Le,{value:l.groupStatus,"onUpdate:value":m=>l.groupStatus=m,onFetch:n,disabled:_("R_USER")},null)}},{key:"idGeneratorMode",title:t("page.groupConfig.idGeneratorMode"),align:"center",width:120,render:l=>{if(l.idGeneratorMode===null)return null;const n=t(le[l.idGeneratorMode]);return o(J,{type:"primary"},W(n)?n:{default:()=>[n]})}},{key:"groupPartition",title:t("page.groupConfig.groupPartition"),align:"center",minWidth:60},{key:"initScene",title:t("page.groupConfig.initScene"),align:"center",minWidth:80,render:l=>{if(l.groupStatus===null)return null;const n=t(re[l.initScene]);return o(J,{type:F(l.initScene)},W(n)?n:{default:()=>[n]})}},{key:"updateDt",title:t("page.groupConfig.updateDt"),align:"left",width:130},{key:"description",title:t("page.groupConfig.description"),align:"left",width:130},{key:"operate",title:t("common.operate"),align:"center",width:130,render:l=>{let n;return _("R_USER")?o(H,null,null):o("div",{class:"flex-center gap-8px"},[o(V,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>k(l.id)},W(n=t("common.edit"))?n:{default:()=>[n]})])}}]}),{drawerVisible:$,operateType:A,editingData:I,handleAdd:z,handleEdit:L,checkedRowKeys:N}=ze(r,g);function k(l){L(l)}function u(){return{groupName:v.groupName,groupStatus:v.groupStatus,groupIds:N.value}}function h(){me("/group/export",u(),t("page.groupConfig.title"))}return(l,n)=>{const m=fe,D=_e,R=ce,w=Je,G=$e;return x(),q("div",to,[o(oo,{model:e(v),"onUpdate:model":n[0]||(n[0]=f=>O(v)?v.value=f:null),onReset:e(E),onSearch:e(g)},null,8,["model","onReset","onSearch"]),o(G,{title:e(t)("page.groupConfig.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[o(R,{columns:e(b),"onUpdate:columns":n[1]||(n[1]=f=>O(b)?b.value=f:null),"disabled-delete":e(N).length===0,loading:e(P),"show-delete":!1,"show-add":e(_)("R_ADMIN"),onAdd:e(z),onRefresh:e(g)},{addAfter:a(()=>[e(_)("R_ADMIN")?(x(),U(m,{key:0,action:"/group/import",accept:"application/json",onRefresh:e(g)},null,8,["onRefresh"])):Ue("",!0),o(e(ge),{onPositiveClick:h},{trigger:a(()=>[o(e(V),{size:"small",ghost:"",type:"primary",disabled:e(N).length===0&&e(_)("R_USER")},{icon:a(()=>[o(D,{class:"text-icon"})]),default:a(()=>[S(" "+C(e(t)("common.export")),1)]),_:1},8,["disabled"])]),default:a(()=>[S(C(e(N).length===0?e(t)("common.exportAll"):e(t)("common.exportPar",{num:e(N).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-add","onAdd","onRefresh"])]),default:a(()=>[o(w,{"checked-row-keys":e(N),"onUpdate:checkedRowKeys":n[2]||(n[2]=f=>O(N)?N.value=f:null),columns:e(T),data:e(r),"flex-height":!e(i).isMobile,"scroll-x":962,loading:e(P),remote:"","row-key":f=>f.id,pagination:e(p),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(Xe,{visible:e($),"onUpdate:visible":n[3]||(n[3]=f=>O($)?$.value=f:null),"operate-type":e(A),"row-data":e(I),onSubmitted:e(g)},null,8,["visible","operate-type","row-data","onSubmitted"]),o(eo,{visible:e(d),"onUpdate:visible":n[4]||(n[4]=f=>O(d)?d.value=f:null),"row-data":c.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{fo as default};
