import{a as te,N as j,b as oe}from"./search-form.vue_vue_type_script_setup_true_lang-COAGZUvR.js";import{d as ae,_ as ne,a as le}from"./download-BT7sMEry.js";import{_ as re}from"./delete-alert-ZqadWz1U.js";import{d as z,Z as A,a0 as L,o as O,c as V,w as r,f as e,h as t,$ as a,ac as se,aH as ie,D as ue,ad as ce,p as pe,q as me,g as W,t as F,d5 as fe,d7 as de,E as we,I as ge,B as b,H as _e,aJ as ke,l as he,c1 as ye,L as ve,u as xe,r as be,ae as Ne,b as Se,af as U,aM as Ce,a9 as De,Y as Te,ah as q,aO as We,F as Re,ai as $e}from"./index-BHXExu3l.js";import{n as Ue,o as Be,p as E,q as Ie}from"./workflow-BKJNJZ8i.js";import{_ as Me,u as Pe,a as Ae}from"./table-CRwvR2hs.js";import{_ as Fe}from"./status-switch.vue_vue_type_script_setup_true_lang-D49r-Opf.js";import{u as ze}from"./auth-Co56ehRE.js";import{_ as Oe}from"./select-group.vue_vue_type_script_setup_true_lang-D27KQ3re.js";import{_ as je}from"./dynamic-input.vue_vue_type_script_setup_true_lang-dONgNtHo.js";import{b as qe}from"./Grid-2b54xPVx.js";import"./Progress-CVf5ngyV.js";import"./group-DJY3eSqv.js";import"./DynamicInput-ClHTOMem.js";const Ee=z({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(g,{emit:N}){const c=N,p=L(g,"model");function _(){c("reset")}function u(){c("search")}return(v,d)=>{const h=Me,x=ue,l=ce,s=te;return O(),V(s,{model:p.value,onSearch:u,onReset:_},{default:r(()=>[e(h,{span:"24 s:12 m:6",label:t(a)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[e(Oe,{value:p.value.groupName,"onUpdate:value":d[0]||(d[0]=i=>p.value.groupName=i),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:t(a)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:r(()=>[e(x,{value:p.value.workflowName,"onUpdate:value":d[1]||(d[1]=i=>p.value.workflowName=i),placeholder:t(a)("page.workflow.form.workflowName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:t(a)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:r(()=>[e(l,{value:p.value.workflowStatus,"onUpdate:value":d[2]||(d[2]=i=>p.value.workflowStatus=i),placeholder:t(a)("page.workflow.form.workflowStatus"),options:t(se)(t(ie)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Le=z({name:"WorkflowTriggerModal",__name:"workflow-trigger-modal",props:A({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(g,{emit:N}){const c=g,p=N,_=L(g,"visible"),u=pe(v());function v(){var l;return{workflowId:(l=c.rowData)==null?void 0:l.id,tmpWfContext:"",wfContexts:[]}}function d(){const l=c.rowData;if(!l){Object.assign(u,v());return}(l==null?void 0:l.wfContext)&&(u.wfContexts=fe(l==null?void 0:l.wfContext)||[])}function h(){_.value=!1}me(_,()=>{_.value&&d()});async function x(){var i,S;const l=JSON.stringify(de(u.wfContexts)||{}),{error:s}=await Ue({workflowId:(i=c.rowData)==null?void 0:i.id,tmpWfContext:l});s||((S=window.$message)==null||S.success(a("common.executeSuccess")),h(),p("submitted"))}return(l,s)=>{const i=je,S=we,y=ge,R=b,m=_e,I=ke;return O(),V(I,{show:_.value,"onUpdate:show":s[1]||(s[1]=C=>_.value=C),class:"max-w-90% w-600px",preset:"card",title:"执行工作流",bordered:!1},{footer:r(()=>[e(m,{justify:"end",size:16},{default:r(()=>[e(R,{onClick:h},{default:r(()=>[W(F(t(a)("common.cancel")),1)]),_:1}),e(R,{type:"primary",onClick:x},{default:r(()=>s[2]||(s[2]=[W("执行")])),_:1})]),_:1})]),default:r(()=>[e(y,{model:u},{default:r(()=>{var C;return[e(S,{path:"wfContexts",label:"工作流上下文","show-feedback":!((C=u.wfContexts)!=null&&C.length)},{default:r(()=>[e(i,{value:u.wfContexts,"onUpdate:value":s[0]||(s[0]=M=>u.wfContexts=M),path:"wfContexts"},null,8,["value"])]),_:1},8,["show-feedback"])]}),_:1},8,["model"])]),_:1},8,["show"])}}}),Ve=he(Le,[["__scopeId","data-v-6d715661"]]),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!$e(g)}const st=z({name:"workflow_task",__name:"index",setup(g){const{hasAuth:N}=ze(),c=ye(),p=ve(),{routerPushByKey:_}=xe(),u=be(),{bool:v,setTrue:d}=Ne(!1),{columns:h,columnChecks:x,data:l,getData:s,loading:i,mobilePagination:S,searchParams:y,resetSearchParams:R}=Pe({apiFn:Be,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:a("common.index"),align:"center",width:120},{key:"workflowName",title:a("page.workflow.workflowName"),align:"left",minWidth:120,render:o=>{function n(){J(o.id)}return e(b,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[o.workflowName]})}},{key:"groupName",title:a("page.workflow.groupName"),align:"left",minWidth:120},{key:"nextTriggerAt",title:a("page.workflow.nextTriggerAt"),align:"left",minWidth:120},{key:"workflowStatus",title:a("page.workflow.workflowStatus"),align:"left",minWidth:120,render:o=>{const n=async(f,D)=>{var w;const{error:T}=await Ie(o.id);T||(o.workflowStatus=f,(w=window.$message)==null||w.success(a("common.updateSuccess"))),D(!T)};return e(Fe,{value:o.workflowStatus,"onUpdate:value":f=>o.workflowStatus=f,onSubmitted:n},null)}},{key:"triggerType",title:a("page.workflow.triggerType"),align:"left",minWidth:120,render:o=>{if(!o.triggerType)return null;const n=a(Ce[o.triggerType]);return e(Te,{type:De(o.triggerType)},B(n)?n:{default:()=>[n]})}},{key:"triggerInterval",title:a("page.workflow.triggerInterval"),align:"left",minWidth:120},{key:"executorTimeout",title:a("page.workflow.executorTimeout"),align:"left",minWidth:120},{key:"updateDt",title:a("page.workflow.updateDt"),align:"left",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",fixed:"right",width:200,render:o=>{let n,f;const D=[{label:a("common.copy"),key:"copy",click:()=>Y(o.id)},{type:"divider",key:"d2"},{label:a("common.batchList"),key:"batchList",click:()=>ee(o.id)},{type:"divider",key:"d2"},{type:"render",key:"delete",render:()=>e("div",{class:"flex-center"},[e(j,{onPositiveClick:()=>H(o.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let w;return e(b,{quaternary:!0,size:"small"},B(w=a("common.delete"))?w:{default:()=>[w]})}})])}],T=w=>{const $=D.filter(P=>P.key===w)[0].click;$&&$()};return e("div",{class:"flex-center gap-8px"},[e(b,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>K(o.id)},B(n=a("common.edit"))?n:{default:()=>[n]}),e(q,{vertical:!0},null),e(b,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>Z(o)},B(f=a("common.execute"))?f:{default:()=>[f]}),e(q,{vertical:!0},null),e(We,{trigger:"click","show-arrow":!1,options:D,size:"small","on-select":T},{default:()=>e(b,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[W("更多")]})})])}}]}),{checkedRowKeys:m,onBatchDeleted:I,onDeleted:C}=Ae(l,s);async function M(){const{error:o}=await E(m.value);o||I()}async function H(o){const{error:n}=await E([o]);n||C()}function K(o){c.push({path:"/workflow/form/edit",query:{id:o}})}function G(){c.push({path:"/workflow/form/add"})}function J(o){c.push({path:"/workflow/form/detail",query:{id:o}})}function Y(o){c.push({path:"/workflow/form/copy",query:{id:o}})}async function Z(o){u.value=o,d()}function Q(){return{workflowIds:m.value,groupName:y.groupName,workflowName:y.workflowName,workflowStatus:y.workflowStatus}}function X(){ae("/workflow/export",Q(),a("page.workflow.title"))}function ee(o){const n=l.value.find(f=>f.id===o);_("workflow_batch",{state:{workflowId:o,workflowName:n.workflowName}})}return(o,n)=>{const f=re,D=ne,T=le,w=oe,$=qe,P=Re;return O(),Se("div",He,[e(Ee,{model:t(y),"onUpdate:model":n[0]||(n[0]=k=>U(y)?y.value=k:null),onReset:t(R),onSearch:t(s)},null,8,["model","onReset","onSearch"]),e(f),e(P,{title:t(a)("page.workflow.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":r(()=>[e(w,{columns:t(x),"onUpdate:columns":n[1]||(n[1]=k=>U(x)?x.value=k:null),"disabled-delete":t(m).length===0,loading:t(i),"show-delete":t(N)("R_ADMIN"),onAdd:G,onDelete:M,onRefresh:t(s)},{addAfter:r(()=>[e(D,{action:"/workflow/import",accept:"application/json",onRefresh:t(s)},null,8,["onRefresh"]),e(t(j),{onPositiveClick:X},{trigger:r(()=>[e(t(b),{size:"small",ghost:"",type:"primary",disabled:t(m).length===0&&t(N)("R_USER")},{icon:r(()=>[e(T,{class:"text-icon"})]),default:r(()=>[W(" "+F(t(a)("common.export")),1)]),_:1},8,["disabled"])]),default:r(()=>[W(F(t(m).length===0?t(a)("common.exportAll"):t(a)("common.exportPar",{num:t(m).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-delete","onRefresh"])]),default:r(()=>[e($,{"checked-row-keys":t(m),"onUpdate:checkedRowKeys":n[2]||(n[2]=k=>U(m)?m.value=k:null),columns:t(h),data:t(l),"flex-height":!t(p).isMobile,"scroll-x":1300,loading:t(i),remote:"","row-key":k=>k.id,pagination:t(S),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(Ve,{visible:t(v),"onUpdate:visible":n[3]||(n[3]=k=>U(v)?v.value=k:null),"row-data":u.value},null,8,["visible","row-data"])])}}});export{st as default};
