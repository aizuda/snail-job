import{a as F,b as E,u as G,N as K,c as H,d as Q}from"./search-form.vue_vue_type_script_setup_true_lang-xYfW9G7N.js";import{aA as $,d as V,Q as W,R as M,o as S,c as R,w as s,f as t,h as e,$ as a,X,bn as J,s as Y,a6 as Z,z as x,aC as ee,g as f,t as y,a9 as U,bo as j,bm as A,P,ay as ae,bp as te,az as le,C as oe,ad as ne,aG as re,B as O,b as se,ae as T,ag as ue,O as ie}from"./index-D3rICic-.js";import{_ as pe}from"./select-group.vue_vue_type_script_setup_true_lang-Bk3YnuuX.js";import{_ as de}from"./select-scene.vue_vue_type_script_setup_true_lang-DxzzLcAX.js";import{_ as me}from"./datetime-range.vue_vue_type_script_setup_true_lang-LaVXNa0e.js";import{_ as ce}from"./detail-drawer-CeEIcqT0.js";import{_ as ge,a as fe}from"./log-CNFmopnc.js";import{_ as ye,a as _e}from"./DescriptionsItem-LhWljJnV.js";import{_ as be}from"./Grid-CRDcRyPk.js";import"./group-frwXGSCG.js";function ve(d){return $({url:"/retry-task-log/list",method:"get",params:d})}function he(d){return $({url:`/retry-task-log/${d}`,method:"get"})}function Ne(d){return $({url:`/retry-task-log/${d}`,method:"delete"})}function we(d){return $({url:"/retry-task-log/ids",method:"delete",data:d})}const ke=V({name:"RetryLogSearch",__name:"retry-log-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search"],["update:model"]),setup(d,{emit:h}){const _=h,r=M(d,"model");function b(){_("reset")}function D(){_("search")}return(N,i)=>{const c=F,g=Y,w=Z,L=E;return S(),R(L,{model:r.value,onSearch:D,onReset:b},{default:s(()=>[t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.groupName"),path:"groupName",class:"pr-24px"},{default:s(()=>[t(pe,{value:r.value.groupName,"onUpdate:value":i[0]||(i[0]=l=>r.value.groupName=l),clearable:""},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.sceneName"),path:"sceneName",class:"pr-24px"},{default:s(()=>[t(de,{value:r.value.sceneName,"onUpdate:value":i[1]||(i[1]=l=>r.value.sceneName=l),"group-name":r.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.UniqueId"),path:"UniqueId",class:"pr-24px"},{default:s(()=>[t(g,{value:r.value.uniqueId,"onUpdate:value":i[2]||(i[2]=l=>r.value.uniqueId=l),placeholder:e(a)("page.retryLog.form.UniqueId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:s(()=>[t(g,{value:r.value.idempotentId,"onUpdate:value":i[3]||(i[3]=l=>r.value.idempotentId=l),placeholder:e(a)("page.retryLog.form.idempotentId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.bizNo"),path:"bizNo",class:"pr-24px"},{default:s(()=>[t(g,{value:r.value.bizNo,"onUpdate:value":i[4]||(i[4]=l=>r.value.bizNo=l),placeholder:e(a)("page.retryLog.form.bizNo"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:e(a)("page.retryLog.retryStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:s(()=>[t(w,{value:r.value.retryStatus,"onUpdate:value":i[5]||(i[5]=l=>r.value.retryStatus=l),placeholder:e(a)("page.retryTask.form.retryStatus"),options:e(X)(e(J)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(c,{span:"24 s:24 m:15 l:12 xl:9",label:e(a)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:s(()=>[t(me,{value:r.value.datetimeRange,"onUpdate:value":i[6]||(i[6]=l=>r.value.datetimeRange=l)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),De=V({name:"SceneDetailDrawer",__name:"retry-log-detail-drawer",props:W({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const h=d,_=M(d,"visible"),r=x([]),b=x(),D=new AbortController,N=x(!1);let i="0",c=0;async function g(){const{data:l,error:v}=await fe({groupName:h.rowData.groupName,uniqueId:h.rowData.uniqueId,startId:i,fromIndex:c,size:50});v||(N.value=l.finished,i=l.nextStartId,c=l.fromIndex,l.message&&(r.value.push(...l.message),r.value.sort((p,k)=>Number.parseInt(p.time_stamp,10)-Number.parseInt(k.time_stamp,10))),N.value||(clearTimeout(b.value),b.value=setTimeout(g,1e3)))}const w=async l=>{l===1&&r.value.length===0&&await g()},L=()=>{N.value=!0,D.abort(),clearTimeout(b.value),b.value=void 0};return ee(()=>{L()}),(l,v)=>{const p=ye,k=P,z=_e,I=ae,u=ge,n=te,q=le,B=ce;return S(),R(B,{modelValue:_.value,"onUpdate:modelValue":v[1]||(v[1]=o=>_.value=o),title:e(a)("page.retryLog.detail"),width:["50%","90%"]},{default:s(()=>[t(q,{type:"segment",animated:"","onUpdate:value":w},{default:s(()=>[t(I,{name:0,tab:e(a)("page.log.info")},{default:s(()=>[t(z,{"label-placement":"top",bordered:"",column:2},{default:s(()=>[t(p,{label:e(a)("page.retryLog.UniqueId"),span:2},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.uniqueId),1)]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryLog.groupName"),span:2},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.groupName),1)]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryLog.sceneName"),span:2},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.sceneName),1)]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryLog.retryStatus"),span:1},{default:s(()=>{var o;return[t(k,{type:e(U)((o=l.rowData)==null?void 0:o.retryStatus)},{default:s(()=>{var m;return[f(y(e(a)(e(j)[(m=l.rowData)==null?void 0:m.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryLog.taskType"),span:1},{default:s(()=>{var o;return[t(k,{type:e(U)((o=l.rowData)==null?void 0:o.taskType)},{default:s(()=>{var m;return[f(y(e(a)(e(A)[(m=l.rowData)==null?void 0:m.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryLog.bizNo"),span:2},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.bizNo),1)]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryLog.idempotentId"),span:2},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.idempotentId),1)]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryTask.executorName"),span:2},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.executorName),1)]}),_:1},8,["label"]),t(p,{label:e(a)("page.retryTask.argsStr"),span:2},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.argsStr),1)]}),_:1},8,["label"]),t(p,{label:e(a)("common.createDt")},{default:s(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),t(I,{name:1,tab:e(a)("page.log.title"),"display-directive":"if"},{default:s(()=>[r.value.length>0?(S(),R(u,{key:0,modelValue:r.value,"onUpdate:modelValue":v[0]||(v[0]=o=>r.value=o),drawer:!1},null,8,["modelValue"])):(S(),R(n,{key:1,class:"h-full"}))]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Le={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function C(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!ue(d)}const Ce=V({name:"retry_log",__name:"index",setup(d){const h=oe(),_=x(),{bool:r,setTrue:b}=ne(!1),D=history.state.retryStatus,{columns:N,columnChecks:i,data:c,getData:g,loading:w,mobilePagination:L,searchParams:l,resetSearchParams:v}=G({apiFn:ve,apiParams:{page:1,size:10,uniqueId:null,groupName:null,sceneName:null,idempotentId:null,bizNo:null,retryStatus:null,datetimeRange:re()},searchParams:{retryStatus:D},columns:()=>[{type:"selection",align:"center",width:48,disabled:u=>u.retryStatus!==1},{key:"id",title:a("common.index"),align:"center",width:64},{key:"uniqueId",title:a("page.retryLog.UniqueId"),align:"left",minWidth:120,render:u=>{async function n(){await I(u),b()}return t(O,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[u.uniqueId]})}},{key:"groupName",title:a("page.retryLog.groupName"),align:"left",minWidth:120},{key:"sceneName",title:a("page.retryLog.sceneName"),align:"left",minWidth:120},{key:"retryStatus",title:a("page.retryLog.retryStatus"),align:"left",minWidth:120,render:u=>{if(u.retryStatus===null)return null;const n=a(j[u.retryStatus]);return t(P,{type:U(u.retryStatus)},C(n)?n:{default:()=>[n]})}},{key:"taskType",title:a("page.retryLog.taskType"),align:"left",minWidth:120,render:u=>{if(u.taskType===null)return null;const n=a(A[u.taskType]);return t(P,{type:U(u.taskType)},C(n)?n:{default:()=>[n]})}},{key:"idempotentId",title:a("page.retryLog.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:a("page.retryLog.bizNo"),align:"left",minWidth:120},{key:"createDt",title:a("page.retryLog.createDt"),align:"left",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",width:130,render:u=>t("div",{class:"flex-center gap-8px"},[u.retryStatus===1?t(K,{onPositiveClick:()=>z(u.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let n;return t(O,{type:"error",text:!0,ghost:!0,size:"small"},C(n=a("common.delete"))?n:{default:()=>[n]})}}):""])}]}),{checkedRowKeys:p}=H(c,g);async function k(){var n;const{error:u}=await we(p.value);u||((n=window.$message)==null||n.success(a("common.deleteSuccess")),g())}async function z(u){var n;await Ne(u),(n=window.$message)==null||n.success(a("common.deleteSuccess")),g()}async function I(u){const n=await he(u.id);_.value=n.data||null}return(u,n)=>{const q=Q,B=be,o=ie;return S(),se("div",Le,[t(ke,{model:e(l),"onUpdate:model":n[0]||(n[0]=m=>T(l)?l.value=m:null),onReset:e(v),onSearch:e(g)},null,8,["model","onReset","onSearch"]),t(o,{title:e(a)("page.retryLog.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[t(q,{columns:e(i),"onUpdate:columns":n[1]||(n[1]=m=>T(i)?i.value=m:null),"disabled-delete":e(p).length===0,loading:e(w),"show-add":!1,onDelete:k,onRefresh:e(g)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:s(()=>[t(B,{"checked-row-keys":e(p),"onUpdate:checkedRowKeys":n[2]||(n[2]=m=>T(p)?p.value=m:null),columns:e(N),data:e(c),"flex-height":!e(h).isMobile,"scroll-x":962,loading:e(w),remote:"","row-key":m=>m.id,pagination:e(L),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),t(De,{visible:e(r),"onUpdate:visible":n[3]||(n[3]=m=>T(r)?r.value=m:null),"row-data":_.value},null,8,["visible","row-data"])])}}});export{Ce as default};
