import{a as ve,N as he,b as Se}from"./search-form.vue_vue_type_script_setup_true_lang-CiN8VA7k.js";import{_ as Te}from"./delete-alert-_CWckxKJ.js";import{d as Y,Z as te,r as A,a0 as W,z as Ne,A as ke,a as we,$ as a,i as Ce,aq as De,p as Ue,q as Le,o as R,c as B,w as n,f as t,g as U,t as L,h as e,a5 as E,aW as de,b as le,a2 as ue,aL as ie,a4 as se,ac as me,E as Re,ab as re,D as ye,H as $e,aK as xe,I as Ie,B as ee,aX as Oe,aY as Be,aZ as Ve,ad as x,a_ as ce,aO as Me,a$ as ge,aj as pe,b0 as _e,Y as K,L as Ae,ah as Fe,ai as H,b1 as Ge,ak as je,F as ze,al as Ee}from"./index-Dlhm-fK8.js";import{a as Pe,b as qe,c as He,d as Ke,e as fe,g as We}from"./notify-CzjhdH-_.js";import{_ as Ye,u as Ze,a as Je}from"./table-BumNcT0C.js";import{f as Xe}from"./retry-scene-BBNEBLY1.js";import{f as Qe}from"./workflow-hI8_w2jc.js";import{h as et}from"./job-DaTjC9FR.js";import{_ as be}from"./select-group.vue_vue_type_script_setup_true_lang-BowmroEB.js";import{_ as tt,d as at,c as nt,a as ot,b as lt}from"./Grid-3R-51InK.js";import{_ as it,a as st}from"./DescriptionsItem-g_tZg_fN.js";import{_ as rt}from"./status-switch.vue_vue_type_script_setup_true_lang-BF7EJgO0.js";import{u as ut}from"./auth-VqY08jsz.js";import"./group-CP2HSNrU.js";const pt=Y({name:"NotifyConfigOperateDrawer",__name:"notify-config-operate-drawer",props:te({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{},retryNotifyStatusDisable:{type:Boolean,default:!0},retryNotifyStatusDisableModifiers:{},retrySceneDisable:{type:Boolean,default:!0},retrySceneDisableModifiers:{}}),emits:te(["update:value","submitted"],["update:visible","update:retryNotifyStatusDisable","update:retrySceneDisable"]),setup(N,{emit:D}){const p=A([]),c=A([]),g=A([]),k=A([]),v=N,_=D,b=W(N,"visible"),h=W(N,"retryNotifyStatusDisable"),i=W(N,"retrySceneDisable"),f=A([]),{formRef:V,validate:P,restoreValidation:C}=Ne(),{defaultRequiredRule:$}=ke(),ae=we(()=>({add:a("page.notifyConfig.addNotifyConfig"),edit:a("page.notifyConfig.editNotifyConfig")})[v.operateType]);Ce(()=>{De(()=>{ne()})});async function ne(){const d=await Pe();p.value=d.data}const l=Ue(I());function I(){return{groupName:null,recipientIds:[],systemTaskType:null,notifyName:"",notifyStatus:1,notifyScene:null,notifyThreshold:16,rateLimiterStatus:1,rateLimiterThreshold:100,description:""}}const oe={groupName:$,systemTaskType:$,notifyName:$,notifyStatus:$,notifyScene:$,recipientIds:$,rateLimiterStatus:$,notifyThreshold:$};function Z(){if(v.operateType==="add"){Object.assign(l,I()),i.value=!0,h.value=!0,f.value=[];return}v.operateType==="edit"&&v.rowData&&(Object.assign(l,v.rowData),s(l.systemTaskType),o(l.notifyScene))}function J(){b.value=!1}async function X(){var d;if(await P(),v.operateType==="add"){const{groupName:r,recipientIds:m,systemTaskType:y,notifyName:T,notifyStatus:w,notifyScene:M,notifyThreshold:F,rateLimiterStatus:O,rateLimiterThreshold:G,description:j}=l,{error:q}=await qe({groupName:r,recipientIds:m,systemTaskType:y,notifyName:T,notifyStatus:w,notifyScene:M,notifyThreshold:F,rateLimiterStatus:O,rateLimiterThreshold:G,description:j});if(q)return}if(v.operateType==="edit"){const{id:r,groupName:m,recipientIds:y,notifyStatus:T,notifyName:w,systemTaskType:M,notifyScene:F,notifyThreshold:O,rateLimiterStatus:G,rateLimiterThreshold:j,description:q}=l,{error:Q}=await He({id:r,groupName:m,recipientIds:y,systemTaskType:M,notifyName:w,notifyStatus:T,notifyScene:F,notifyThreshold:O,rateLimiterStatus:G,rateLimiterThreshold:j,description:q});if(Q)return}(d=window.$message)==null||d.success(a("common.updateSuccess")),J(),_("submitted")}async function s(d){var m,y;if(d===1){const T=await Xe({groupName:l.groupName});c.value=T.data,f.value=E(Oe)}else if(d===3){const T=await et({groupName:l.groupName});g.value=(m=T.data)==null?void 0:m.map(w=>(w.id=String(w.id),w)),f.value=E(Be)}else if(d===4){const T=await Qe({groupName:l.groupName});k.value=(y=T.data)==null?void 0:y.map(w=>(w.id=String(w.id),w)),f.value=E(Ve)}await o(l.notifyScene);let r=!1;f.value.map(T=>(T.value===l.notifyScene&&(r=!0),String(T.value))),r||(l.notifyScene=null)}async function o(d){i.value=!(l.systemTaskType===1&&(d===1||d===2||d===5||d===6)),d===7&&(l.notifyThreshold=0)}function S(d){Z(),l.groupName=d,s(1),o(1)}return Le(b,()=>{b.value&&(Z(),C())}),(d,r)=>{const m=Re,y=re,T=ye,w=ot,M=$e,F=tt,O=at,G=xe,j=nt,q=Ie,Q=ee;return R(),B(me,{modelValue:b.value,"onUpdate:modelValue":r[10]||(r[10]=u=>b.value=u),title:ae.value,"min-size":480,onHandleSubmit:X},{footer:n(()=>[t(M,{size:16},{default:n(()=>[t(Q,{onClick:J},{default:n(()=>[U(L(e(a)("common.cancel")),1)]),_:1}),t(Q,{type:"primary",onClick:X},{default:n(()=>[U(L(e(a)("common.save")),1)]),_:1})]),_:1})]),default:n(()=>[t(q,{ref_key:"formRef",ref:V,model:l,rules:oe},{default:n(()=>[t(m,{label:e(a)("page.notifyConfig.groupName"),path:"groupName"},{default:n(()=>[t(be,{value:l.groupName,"onUpdate:value":r[0]||(r[0]=u=>l.groupName=u),"onUpdate:modelValue":S},null,8,["value"])]),_:1},8,["label"]),t(m,{label:e(a)("page.notifyConfig.systemTaskType"),path:"systemTaskType"},{default:n(()=>[t(y,{value:l.systemTaskType,"onUpdate:value":[r[1]||(r[1]=u=>l.systemTaskType=u),s],placeholder:e(a)("page.notifyConfig.form.systemTaskType"),options:e(E)(e(de))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(m,{label:e(a)("page.notifyConfig.notifyScene"),path:"notifyScene"},{default:n(()=>[t(y,{value:l.notifyScene,"onUpdate:value":[r[2]||(r[2]=u=>l.notifyScene=u),o],placeholder:e(a)("page.notifyConfig.form.notifyScene"),options:f.value},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(m,{label:e(a)("page.notifyConfig.notifyRecipient"),path:"recipientIds"},{default:n(()=>[t(y,{value:l.recipientIds,"onUpdate:value":r[3]||(r[3]=u=>l.recipientIds=u),placeholder:e(a)("page.notifyConfig.form.notifyRecipient"),options:p.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(m,{label:e(a)("page.notifyConfig.notifyName"),path:"notifyName"},{default:n(()=>[t(T,{value:l.notifyName,"onUpdate:value":r[4]||(r[4]=u=>l.notifyName=u),placeholder:e(a)("page.notifyConfig.form.notifyName"),maxlength:32},null,8,["value","placeholder"])]),_:1},8,["label"]),t(j,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t(O,null,{default:n(()=>[t(m,{label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus"},{default:n(()=>[t(F,{value:l.notifyStatus,"onUpdate:value":r[5]||(r[5]=u=>l.notifyStatus=u),name:"notifyStatus"},{default:n(()=>[t(M,null,{default:n(()=>[(R(!0),le(se,null,ue(e(ie),u=>(R(),B(w,{key:u.value,value:u.value,label:e(a)(u.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),t(O,null,{default:n(()=>[t(m,{label:e(a)("page.notifyConfig.notifyThreshold"),path:"notifyThreshold"},{default:n(()=>[t(G,{value:l.notifyThreshold,"onUpdate:value":r[6]||(r[6]=u=>l.notifyThreshold=u),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:i.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(j,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t(O,null,{default:n(()=>[t(m,{label:e(a)("page.notifyConfig.rateLimiterStatus"),path:"rateLimiterStatus"},{default:n(()=>[t(F,{value:l.rateLimiterStatus,"onUpdate:value":r[7]||(r[7]=u=>l.rateLimiterStatus=u),name:"rateLimiterStatus",disabled:i.value},{default:n(()=>[t(M,null,{default:n(()=>[(R(!0),le(se,null,ue(e(ie),u=>(R(),B(w,{key:u.value,value:u.value,label:e(a)(u.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"])]),_:1}),t(O,null,{default:n(()=>[t(m,{label:e(a)("page.notifyConfig.rateLimiterThreshold"),path:"notifyThreshold"},{default:n(()=>[t(G,{value:l.rateLimiterThreshold,"onUpdate:value":r[8]||(r[8]=u=>l.rateLimiterThreshold=u),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:i.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(m,{label:e(a)("page.notifyConfig.description"),path:"description"},{default:n(()=>[t(T,{value:l.description,"onUpdate:value":r[9]||(r[9]=u=>l.description=u),type:"textarea",placeholder:e(a)("page.notifyConfig.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ft=Y({name:"SystemTaskType",__name:"system-task-type",emits:["update:value"],setup(N,{emit:D}){const p=D,c=A(),g=k=>{p("update:value",k)};return(k,v)=>{const _=re;return R(),B(_,{value:c.value,"onUpdate:value":[v[0]||(v[0]=b=>c.value=b),g],placeholder:e(a)("page.notifyConfig.systemTaskType"),options:e(E)(e(de))},null,8,["value","placeholder","options"])}}}),dt=Y({name:"NotifyConfigSearch",__name:"notify-config-search",props:{model:{required:!0},modelModifiers:{}},emits:te(["reset","search"],["update:model"]),setup(N,{emit:D}){const p=D,c=W(N,"model");function g(){p("reset")}function k(){p("search")}return(v,_)=>{const b=ye,h=Ye,i=be,f=ft,V=re,P=ve;return R(),B(P,{"btn-span":"12 s:24 m:24 1:24 xl:24",model:c.value,onSearch:k,onReset:g},{default:n(()=>[t(h,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyName"),path:"notifyName",class:"pr-24px"},{default:n(()=>[t(b,{value:c.value.notifyName,"onUpdate:value":_[0]||(_[0]=C=>c.value.notifyName=C),placeholder:e(a)("page.notifyConfig.form.notifyName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(h,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t(i,{value:c.value.groupName,"onUpdate:value":_[1]||(_[1]=C=>c.value.groupName=C),clearable:""},null,8,["value"])]),_:1},8,["label"]),t(h,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.systemTaskType"),path:"systemTaskType",class:"pr-24px"},{default:n(()=>[t(f,{value:c.value.systemTaskType,"onUpdate:value":_[2]||(_[2]=C=>c.value.systemTaskType=C),clearable:""},null,8,["value"])]),_:1},8,["label"]),t(h,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus",class:"pr-24px"},{default:n(()=>[t(V,{value:c.value.notifyStatus,"onUpdate:value":_[3]||(_[3]=C=>c.value.notifyStatus=C),placeholder:e(a)("page.notifyConfig.notifyStatus"),options:e(E)(e(ie)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),mt=Y({name:"NotifyConfigDetailDrawer",__name:"notify-config-detail-drawer",props:te({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(N){const D=W(N,"visible");return(p,c)=>{const g=it,k=K,v=st,_=me;return R(),B(_,{modelValue:D.value,"onUpdate:modelValue":c[0]||(c[0]=b=>D.value=b),title:e(a)("page.groupConfig.detail")},{default:n(()=>[t(v,{"label-placement":"top",bordered:"",column:2},{default:n(()=>{var b,h;return[t(g,{label:e(a)("page.notifyConfig.notifyName"),span:2},{default:n(()=>{var i;return[U(L((i=p.rowData)==null?void 0:i.notifyName),1)]}),_:1},8,["label"]),t(g,{label:e(a)("page.groupConfig.groupName"),span:2},{default:n(()=>{var i;return[U(L((i=p.rowData)==null?void 0:i.groupName),1)]}),_:1},8,["label"]),t(g,{label:e(a)("page.notifyConfig.systemTaskType"),span:1},{default:n(()=>{var i;return[t(k,{type:e(x)((i=p.rowData)==null?void 0:i.systemTaskType)},{default:n(()=>{var f;return[U(L(e(a)(e(ce)[(f=p.rowData)==null?void 0:f.systemTaskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(g,{label:e(a)("page.notifyConfig.notifyStatus"),span:1},{default:n(()=>{var i;return[t(k,{type:e(x)((i=p.rowData)==null?void 0:i.notifyStatus)},{default:n(()=>{var f;return[U(L(e(a)(e(Me)[(f=p.rowData)==null?void 0:f.notifyStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),((b=p.rowData)==null?void 0:b.systemTaskType)===1?(R(),B(g,{key:0,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>{var i;return[t(k,{type:e(x)((i=p.rowData)==null?void 0:i.notifyScene)},{default:n(()=>{var f;return[U(L(e(a)(e(ge)[(f=p.rowData)==null?void 0:f.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):pe("",!0),((h=p.rowData)==null?void 0:h.systemTaskType)===3?(R(),B(g,{key:1,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>{var i;return[t(k,{type:e(x)((i=p.rowData)==null?void 0:i.notifyScene)},{default:n(()=>{var f;return[U(L(e(a)(e(_e)[(f=p.rowData)==null?void 0:f.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):pe("",!0),t(g,{label:e(a)("page.notifyConfig.notifyThreshold"),span:1},{default:n(()=>{var i;return[t(k,{type:e(x)((i=p.rowData)==null?void 0:i.notifyThreshold)},{default:n(()=>{var f;return[U(L((f=p.rowData)==null?void 0:f.notifyThreshold),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(g,{label:e(a)("common.createDt"),span:2},{default:n(()=>{var i;return[U(L((i=p.rowData)==null?void 0:i.createDt),1)]}),_:1},8,["label"]),t(g,{label:e(a)("page.notifyConfig.description"),span:2},{default:n(()=>{var i;return[U(L((i=p.rowData)==null?void 0:i.description),1)]}),_:1},8,["label"])]}),_:1})]),_:1},8,["modelValue","title"])}}}),yt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function z(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Ee(N)}const Lt=Y({name:"notify_config",__name:"index",setup(N){const{hasAuth:D}=ut(),p=Ae(),c=A(),{bool:g,setTrue:k}=Fe(!1),{columns:v,columnChecks:_,data:b,getData:h,loading:i,mobilePagination:f,searchParams:V,resetSearchParams:P}=Ze({apiFn:Ke,apiParams:{page:1,size:10,groupName:null,notifyStatus:null,notifyScene:null,notifyName:null,systemTaskType:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:a("common.index"),align:"center",width:64},{key:"notifyName",title:a("page.notifyConfig.notifyName"),align:"left",width:120,render:s=>{function o(){c.value=s||null,k()}return t(ee,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[s.notifyName]})}},{key:"groupName",title:a("page.notifyConfig.groupName"),align:"left",width:120},{key:"systemTaskType",title:a("page.notifyConfig.systemTaskType"),align:"left",width:120,render:s=>{if(s.systemTaskType===null)return null;const o=a(ce[s.systemTaskType]);return t(K,{type:x(s.systemTaskType)},z(o)?o:{default:()=>[o]})}},{key:"notifyStatus",title:a("page.notifyConfig.notifyStatus"),align:"left",width:120,render:s=>{const o=async(S,d)=>{var m;const{error:r}=await We(s.id,S);r||(s.notifyStatus=S,(m=window.$message)==null||m.success(a("common.updateSuccess"))),d(!r)};return t(rt,{value:s.notifyStatus,"onUpdate:value":S=>s.notifyStatus=S,onSubmitted:o},null)}},{key:"notifyName",title:a("page.notifyConfig.notifyName"),align:"left",width:120},{key:"notifyScene",title:a("page.notifyConfig.notifyScene"),align:"left",width:160,render:s=>{if(s.notifyScene===null)return null;if(s.systemTaskType===1){const o=a(ge[s.notifyScene]);return t(K,{type:x(s.notifyScene)},z(o)?o:{default:()=>[o]})}if(s.systemTaskType===3){const o=a(_e[s.notifyScene]);return t(K,{type:x(s.notifyScene)},z(o)?o:{default:()=>[o]})}if(s.systemTaskType===4){const o=a(Ge[s.notifyScene]);return t(K,{type:x(s.notifyScene)},z(o)?o:{default:()=>[o]})}return null}},{key:"notifyThreshold",title:a("page.notifyConfig.notifyThreshold"),align:"left",width:120},{key:"createDt",title:a("common.createDt"),align:"left",width:120},{key:"description",title:a("page.notifyConfig.description"),align:"left",width:120},{key:"operate",title:a("common.operate"),align:"center",width:130,fixed:"right",render:s=>{let o;return t("div",{class:"flex-center gap-8px"},[t(ee,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>X(s.id)},z(o=a("common.edit"))?o:{default:()=>[o]}),D("R_ADMIN")?t(se,null,[t(je,{vertical:!0},null),t(he,{onPositiveClick:()=>J(s.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let S;return t("span",null,[t(ee,{type:"error",text:!0,ghost:!0,size:"small"},z(S=a("common.delete"))?S:{default:()=>[S]})])}})]):""])}}]}),{drawerVisible:C,operateType:$,editingData:ae,handleAdd:ne,handleEdit:l,checkedRowKeys:I,onBatchDeleted:oe}=Je(b,h);async function Z(){const{error:s}=await fe(I.value);s||oe()}async function J(s){var S;const{error:o}=await fe([s]);o||((S=window.$message)==null||S.success(a("common.deleteSuccess")),h())}function X(s){l(s)}return(s,o)=>{const S=Te,d=Se,r=lt,m=ze;return R(),le("div",yt,[t(dt,{model:e(V),"onUpdate:model":o[0]||(o[0]=y=>H(V)?V.value=y:null),onReset:e(P),onSearch:e(h)},null,8,["model","onReset","onSearch"]),t(S),t(m,{title:e(a)("page.notifyConfig.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":n(()=>[t(d,{columns:e(_),"onUpdate:columns":o[1]||(o[1]=y=>H(_)?_.value=y:null),"disabled-delete":e(I).length===0,loading:e(i),"show-delete":e(D)("R_ADMIN"),onAdd:e(ne),onDelete:Z,onRefresh:e(h)},null,8,["columns","disabled-delete","loading","show-delete","onAdd","onRefresh"])]),default:n(()=>[t(r,{"checked-row-keys":e(I),"onUpdate:checkedRowKeys":o[2]||(o[2]=y=>H(I)?I.value=y:null),columns:e(v),data:e(b),"flex-height":!e(p).isMobile,"scroll-x":962,loading:e(i),remote:"","row-key":y=>y.id,pagination:e(f),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(pt,{visible:e(C),"onUpdate:visible":o[3]||(o[3]=y=>H(C)?C.value=y:null),"operate-type":e($),"row-data":e(ae),onSubmitted:e(h)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(mt,{visible:e(g),"onUpdate:visible":o[4]||(o[4]=y=>H(g)?g.value=y:null),"row-data":c.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Lt as default};
