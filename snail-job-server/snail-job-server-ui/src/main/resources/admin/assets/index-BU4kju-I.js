import{a as K,N as A,b as Q}from"./search-form.vue_vue_type_script_setup_true_lang-B9DCSIZj.js";import{d as V,Z as W,r as D,a0 as O,q as X,o as I,c as G,w as r,f as e,h as a,$ as t,b as q,g as B,t as k,ac as C,ax as E,ay as H,az as ee,a3 as M,Y as U,aw as ae,av as te,L as oe,ag as z,aA as le,a8 as ne,_ as se,B as $,aB as re,ah as L,ai as ue,aj as ie,at as F,F as ce}from"./index-D11HRvLC.js";import{_ as pe,f as me,a as de,b as fe}from"./job-task-list-table.vue_vue_type_script_setup_true_lang-DFSIKcqE.js";import{_ as be,u as ge}from"./table-oGN68_Ra.js";import{_ as _e}from"./select-group.vue_vue_type_script_setup_true_lang-BV1AXeAr.js";import{_ as he,a as ve}from"./task-batch-status.vue_vue_type_script_setup_true_lang-GCdqSiBt.js";import{_ as ye}from"./datetime-range.vue_vue_type_script_setup_true_lang-bHhHNs5l.js";import{f as Be}from"./job-DWJU1EVy.js";import{_ as ke}from"./log-drawer-Dqe3cuCl.js";import{_ as je}from"./detail-drawer-B0WyCEXR.js";import{_ as Se,a as we}from"./DescriptionsItem-QSQ4JSXU.js";import{b as Ne}from"./Grid-BEQeOJ6_.js";import"./group-DBuDE6uz.js";import"./CollapseItem-C4NYsEPz.js";const De=V({name:"JobBatchSearch",__name:"job-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search"],["update:model"]),setup(v,{emit:w}){const b=D(!1),f=w,j=D([]),l=O(v,"model"),m=D(l.value.jobName);function d(){m.value="",f("reset")}function S(){f("search")}async function x(){const u=await Be({keywords:m.value,groupName:l.value.groupName});j.value=u.data}function y(u){l.value.jobId=u}X(()=>m.value,u=>{u.length!==0?x():b.value=!1});function R(u){return u.map(i=>({value:i.id,label:i.jobName}))}function T(u){return[u.label,`(${u.value})`]}return(u,i)=>{const o=be,c=ve,J=K;return I(),G(J,{"btn-span":"12 s:24 m:10 l:12 xl:16",model:l.value,onSearch:S,onReset:d},{default:r(()=>[e(o,{span:"24 s:12 m:8",label:a(t)("page.jobBatch.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[e(_e,{value:l.value.groupName,"onUpdate:value":i[0]||(i[0]=g=>l.value.groupName=g),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(o,{span:"24 s:12 m:8",label:a(t)("page.jobBatch.jobName"),path:"jobName",class:"pr-24px"},{default:r(()=>[e(c,{value:m.value,"onUpdate:value":i[1]||(i[1]=g=>m.value=g),placeholder:a(t)("page.jobBatch.form.jobName"),options:R(j.value),"empty-visible":b.value,clearable:"",filterable:"","render-label":T,onSelect:y},null,8,["value","placeholder","options","empty-visible"])]),_:1},8,["label"]),e(o,{span:"24 s:12 m:8",label:a(t)("page.jobBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:r(()=>[e(he,{value:l.value.taskBatchStatus,"onUpdate:value":i[2]||(i[2]=g=>l.value.taskBatchStatus=g),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(o,{span:"24 s:24 m:14 l:12 xl:8",label:a(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:r(()=>[e(ye,{value:l.value.datetimeRange,"onUpdate:value":i[3]||(i[3]=g=>l.value.datetimeRange=g)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),xe=V({name:"JobBatchDetailDrawer",__name:"job-batch-detail-drawer",props:W({rowData:{default:null},log:{type:Boolean,default:!1}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const w=O(v,"visible"),b=D(),f=D(!1);async function j(l){f.value=!0,b.value=l}return(l,m)=>{const d=Se,S=U,x=we,y=ae,R=pe,T=te,u=je,i=ke;return I(),q(M,null,[e(u,{modelValue:w.value,"onUpdate:modelValue":m[0]||(m[0]=o=>w.value=o),title:a(t)("page.jobBatch.detail"),width:["50%","90%"]},{default:r(()=>[e(T,{type:"segment",animated:"","default-value":l.log?1:0},{default:r(()=>[e(y,{name:0,tab:a(t)("page.log.info")},{default:r(()=>[e(x,{"label-placement":"top",bordered:"",column:2},{default:r(()=>[e(d,{label:a(t)("page.jobBatch.groupName")},{default:r(()=>{var o;return[B(k((o=l.rowData)==null?void 0:o.groupName),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.jobBatch.jobName")},{default:r(()=>{var o;return[B(k((o=l.rowData)==null?void 0:o.jobName),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.jobBatch.taskBatchStatus")},{default:r(()=>{var o;return[e(S,{type:a(C)((o=l.rowData)==null?void 0:o.taskBatchStatus)},{default:r(()=>{var c;return[B(k(a(t)(a(E)[(c=l.rowData)==null?void 0:c.taskBatchStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(d,{label:a(t)("page.jobBatch.executionAt")},{default:r(()=>{var o;return[B(k((o=l.rowData)==null?void 0:o.executionAt),1)]}),_:1},8,["label"]),e(d,{label:a(t)("page.jobBatch.operationReason")},{default:r(()=>{var o;return[e(S,{type:a(C)((o=l.rowData)==null?void 0:o.operationReason)},{default:r(()=>{var c;return[B(k(a(t)(a(H)[(c=l.rowData)==null?void 0:c.operationReason])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(d,{label:a(t)("page.jobBatch.executorType")},{default:r(()=>{var o;return[e(S,{type:a(C)((o=l.rowData)==null?void 0:o.executorType)},{default:r(()=>{var c;return[B(k(a(t)(a(ee)[(c=l.rowData)==null?void 0:c.executorType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(d,{label:a(t)("page.jobBatch.executorInfo"),span:2},{default:r(()=>{var o;return[B(k((o=l.rowData)==null?void 0:o.executorInfo),1)]}),_:1},8,["label"]),e(d,{label:a(t)("common.createDt"),span:2},{default:r(()=>{var o;return[B(k((o=l.rowData)==null?void 0:o.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),e(y,{name:1,tab:a(t)("page.log.title"),"display-directive":"if"},{default:r(()=>[e(R,{"row-data":l.rowData,onShowLog:j},null,8,["row-data"])]),_:1},8,["tab"])]),_:1},8,["default-value"])]),_:1},8,["modelValue","title"]),e(i,{show:f.value,"onUpdate:show":m[1]||(m[1]=o=>f.value=o),title:a(t)("page.log.title"),"task-data":b.value},null,8,["show","title","task-data"])],64)}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function N(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!ie(v)}const Oe=V({name:"job_batch",__name:"index",setup(v){const w=oe(),b=D(),{bool:f,setTrue:j}=z(!1),{bool:l,setBool:m}=z(!1),d=history.state.jobName,S=history.state.jobId,x=history.state.taskBatchStatus,{columnChecks:y,columns:R,data:T,getData:u,loading:i,mobilePagination:o,searchParams:c,resetSearchParams:J}=ge({apiFn:me,apiParams:{page:1,size:10,groupName:null,jobName:null,taskBatchStatus:null,jobId:null,datetimeRange:le()},searchParams:{jobId:S,jobName:d,taskBatchStatus:x},columns:()=>[{key:"id",align:"center",width:120,title:()=>e("div",{class:"flex-center"},[e("span",null,[t("page.jobBatch.jobTask.id")]),e(ne,{trigger:"hover"},{trigger:()=>e("span",{class:"mb-2px ml-5px text-16px"},[e(se,{icon:"ant-design:info-circle-outlined"},null)]),default:()=>e("span",null,[t("common.idDetailTip")])})]),render:n=>{function s(){b.value=n,m(!1),j()}return e($,{text:!0,tag:"a",type:"primary",onClick:s,class:"ws-normal"},{default:()=>[n.id]})}},{key:"groupName",title:t("page.jobBatch.groupName"),align:"left",minWidth:120},{key:"taskType",title:t("page.jobBatch.taskType"),align:"center",width:120,render:n=>{if(n.taskType===null)return null;const s={1:"info",2:"success",3:"error",4:"primary",5:"warning"},p=t(re[n.taskType]);return e(U,{type:s[n.taskType]},N(p)?p:{default:()=>[p]})}},{key:"jobName",title:t("page.jobBatch.jobName"),align:"center",minWidth:120},{key:"executionAt",title:t("page.jobBatch.executionAt"),align:"center",minWidth:120},{key:"taskBatchStatus",title:t("page.jobBatch.taskBatchStatus"),align:"center",minWidth:120,render:n=>{if(n.taskBatchStatus===null)return null;const s=t(E[n.taskBatchStatus]);return e(U,{type:{1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"}[n.taskBatchStatus]},N(s)?s:{default:()=>[s]})}},{key:"operationReason",title:t("page.jobBatch.operationReason"),align:"center",minWidth:120,render:n=>{if(n.operationReason===null)return null;const s=t(H[n.operationReason]);return e(U,{type:C(n.operationReason)},N(s)?s:{default:()=>[s]})}},{key:"createDt",title:t("common.createDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:n=>{let s;const p=()=>n.taskBatchStatus===1||n.taskBatchStatus===2?e(M,null,[e(F,{vertical:!0},null),e(A,{onPositiveClick:()=>Z(n.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let _;return e($,{type:"error",text:!0,ghost:!0,size:"small"},N(_=t("common.stop"))?_:{default:()=>[_]})}})]):null,P=()=>n.taskBatchStatus===4||n.taskBatchStatus===5||n.taskBatchStatus===6?e(M,null,[e(F,{vertical:!0},null),e(A,{onPositiveClick:()=>Y(n.id)},{default:()=>t("common.confirmRetry"),trigger:()=>{let _;return e($,{type:"error",text:!0,ghost:!0,size:"small"},N(_=t("common.retry"))?_:{default:()=>[_]})}})]):null;return e("div",{class:"flex-center gap-8px"},[e($,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>g(n)},N(s=t("common.log"))?s:{default:()=>[s]}),p(),P()])}}]});function g(n){b.value=n,m(!0),j()}async function Y(n){var p;const{error:s}=await de(n);s||((p=window.$message)==null||p.success(t("common.operateSuccess")),u())}async function Z(n){var p;const{error:s}=await fe(n);s||((p=window.$message)==null||p.success(t("common.operateSuccess")),u())}return(n,s)=>{const p=Q,P=Ne,_=ce;return I(),q("div",Re,[e(De,{model:a(c),"onUpdate:model":s[0]||(s[0]=h=>L(c)?c.value=h:null),onReset:a(J),onSearch:a(u)},null,8,["model","onReset","onSearch"]),e(_,{title:a(t)("page.jobBatch.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":r(()=>[e(p,{columns:a(y),"onUpdate:columns":s[1]||(s[1]=h=>L(y)?y.value=h:null),loading:a(i),"show-delete":!1,"show-add":!1,onRefresh:a(u)},null,8,["columns","loading","onRefresh"])]),default:r(()=>[e(P,{columns:a(R),data:a(T),"flex-height":!a(w).isMobile,"scroll-x":962,loading:a(i),remote:"","row-key":h=>h.id,pagination:a(o),class:"sm:h-full"},null,8,["columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(f)?(I(),G(xe,{key:0,visible:a(f),"onUpdate:visible":s[2]||(s[2]=h=>L(f)?f.value=h:null),log:a(l),"onUpdate:log":s[3]||(s[3]=h=>L(l)?l.value=h:null),"row-data":b.value},null,8,["visible","log","row-data"])):ue("",!0)])}}});export{Oe as default};
