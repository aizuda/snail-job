import{_ as Z,a as Q,N as W,b as J}from"./search-form.vue_vue_type_script_setup_true_lang-D7hHwQXT.js";import{_ as X}from"./delete-alert-C8iwsugF.js";import{aP as $,d as M,Z as B,y as G,a0 as K,z as Y,A as ee,a as te,$ as a,p as ae,q as ne,o as O,c as H,w as i,f as e,g as z,t as V,h as t,ab as oe,aQ as le,D as L,B as R,a8 as se,a9 as ie,E as re,I as ce,H as ue,L as de,r as me,K as pe,b as _e,ah as T,_ as P,a3 as fe,aj as E,F as ge,ak as he}from"./index--PhRNylI.js";import{_ as ye,u as ve,a as be}from"./table-DvozQPKE.js";import{b as we}from"./Grid-C8sbif0M.js";function ke(l){return $({url:"/namespace/list",method:"get",params:l})}function xe(l){return $({url:"/namespace",method:"post",data:l})}function Ie(l){return $({url:"/namespace",method:"put",data:l})}function Ne(l){return $({url:`/namespace/${l}`,method:"delete"})}const qe=M({name:"NamespaceOperateDrawer",__name:"namespace-operate-drawer",props:B({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:B(["submitted"],["update:visible"]),setup(l,{emit:k}){const c=l,d=k,x=G(),m=K(l,"visible"),{formRef:b,validate:h,restoreValidation:_}=Y(),{defaultRequiredRule:w}=ee(),I=te(()=>({add:a("page.namespace.addNamespace"),edit:a("page.namespace.editNamespace")})[c.operateType]),s=ae(q());function q(){return{name:"",uniqueId:""}}const N={name:w,uniqueId:{required:!1,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:a("page.namespace.form.uniqueIdRule")}};function C(){s.uniqueId=le(32)}function U(){if(c.operateType==="add"){Object.assign(s,q());return}c.operateType==="edit"&&c.rowData&&Object.assign(s,c.rowData)}function S(){m.value=!1}async function D(){var p,u;if(await h(),c.operateType==="add"){const{name:f,uniqueId:y}=s,{error:n}=await xe({name:f,uniqueId:y});if(n)return;(p=window.$message)==null||p.success(a("common.addSuccess"))}if(c.operateType==="edit"){const{id:f,name:y,uniqueId:n}=s,{error:o}=await Ie({id:f,name:y,uniqueId:n});if(o)return;(u=window.$message)==null||u.success(a("common.updateSuccess"))}await x.getUserInfo(),S(),d("submitted")}return ne(m,()=>{m.value&&(U(),_())}),(p,u)=>{const f=L,y=Z,n=R,o=se,v=ie,g=re,A=ce,F=ue;return O(),H(oe,{modelValue:m.value,"onUpdate:modelValue":u[2]||(u[2]=r=>m.value=r),title:I.value,onSubmitted:D},{footer:i(()=>[e(F,{size:16},{default:i(()=>[e(n,{onClick:S},{default:i(()=>[z(V(t(a)("common.cancel")),1)]),_:1}),e(n,{type:"primary",onClick:D},{default:i(()=>[z(V(t(a)("common.save")),1)]),_:1})]),_:1})]),default:i(()=>[e(A,{ref_key:"formRef",ref:b,model:s,rules:N},{default:i(()=>[e(g,{label:t(a)("page.namespace.uniqueId"),path:"uniqueId"},{default:i(()=>[e(v,null,{default:i(()=>[e(f,{value:s.uniqueId,"onUpdate:value":u[0]||(u[0]=r=>s.uniqueId=r),disabled:c.operateType==="edit",placeholder:t(a)("page.namespace.form.uniqueId")},null,8,["value","disabled","placeholder"]),e(o,{trigger:"hover"},{trigger:i(()=>[e(n,{type:"default",ghost:"",disabled:c.operateType==="edit",onClick:C},{default:i(()=>[e(y,{class:"text-icon"})]),_:1},8,["disabled"])]),default:i(()=>[z(" "+V(t(a)("common.generateRandomly")),1)]),_:1})]),_:1})]),_:1},8,["label"]),e(g,{label:t(a)("page.namespace.name"),path:"name"},{default:i(()=>[e(f,{value:s.name,"onUpdate:value":u[1]||(u[1]=r=>s.name=r),placeholder:t(a)("page.namespace.form.name")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Se=M({name:"NamespaceSearch",__name:"namespace-search",props:{model:{required:!0},modelModifiers:{}},emits:B(["reset","search"],["update:model"]),setup(l,{emit:k}){const c=k,d=K(l,"model");function x(){c("reset")}function m(){c("search")}return(b,h)=>{const _=L,w=ye,I=Q;return O(),H(I,{model:d.value,onSearch:m,onReset:x},{default:i(()=>[e(w,{span:"24 s:12 m:6",label:t(a)("page.namespace.keyword"),path:"keyword",class:"pr-24px"},{default:i(()=>[e(_,{value:d.value.keyword,"onUpdate:value":h[0]||(h[0]=s=>d.value.keyword=s),placeholder:t(a)("page.namespace.form.keyword"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),De={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function j(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!he(l)}const Ae=M({name:"namespace",__name:"index",setup(l){const k=de(),c=G(),d=me(pe.get("namespaceId")),x=n=>{d.value=n,c.setNamespaceId(n)},{columns:m,columnChecks:b,data:h,getData:_,loading:w,mobilePagination:I,searchParams:s,resetSearchParams:q}=ve({apiFn:ke,apiParams:{page:1,size:10,keyword:null},columns:()=>[{key:"id",title:a("common.index"),align:"center",width:64},{key:"name",title:a("page.namespace.name"),align:"left",width:120},{key:"status",title:a("common.active"),align:"center",width:40,render:n=>e("div",{class:"flex justify-center"},[d.value===n.uniqueId?e(P,{icon:"material-symbols:check-circle",class:"text-20px color-success"},null):e(P,{icon:"material-symbols:cancel",class:"text-20px color-gray400"},null)])},{key:"uniqueId",title:a("page.namespace.uniqueId"),align:"left",width:180},{key:"createDt",title:a("page.common.createTime"),align:"left",width:130},{key:"updateDt",title:a("page.common.upadteTime"),align:"left",width:130},{key:"operate",title:a("common.operate"),align:"center",width:80,render:n=>{let o,v;return e("div",{class:"flex-center gap-8px"},[e(R,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>f(n.id)},j(o=a("common.edit"))?o:{default:()=>[o]}),d.value!==n.uniqueId?e(fe,null,[e(E,{vertical:!0},null),e(R,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>x(n.uniqueId)},j(v=a("common.switch"))?v:{default:()=>[v]}),e(E,{vertical:!0},null),e(W,{onPositiveClick:()=>y(n.uniqueId)},{default:()=>a("common.confirmDelete"),trigger:()=>{let g;return e(R,{type:"error",text:!0,ghost:!0,size:"small"},j(g=a("common.delete"))?g:{default:()=>[g]})}})]):""])}}]}),{drawerVisible:N,operateType:C,editingData:U,handleAdd:S,handleEdit:D,checkedRowKeys:p,onDeleted:u}=be(h,_);function f(n){D(n)}async function y(n){const{error:o}=await Ne(n);o||u()}return(n,o)=>{const v=X,g=J,A=we,F=ge;return O(),_e("div",De,[e(Se,{model:t(s),"onUpdate:model":o[0]||(o[0]=r=>T(s)?s.value=r:null),onReset:t(q),onSearch:t(_)},null,8,["model","onReset","onSearch"]),e(v),e(F,{title:t(a)("page.namespace.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":i(()=>[e(g,{columns:t(b),"onUpdate:columns":o[1]||(o[1]=r=>T(b)?b.value=r:null),"disabled-delete":t(p).length===0,loading:t(w),"show-delete":!1,onAdd:t(S),onRefresh:t(_)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:i(()=>[e(A,{"checked-row-keys":t(p),"onUpdate:checkedRowKeys":o[2]||(o[2]=r=>T(p)?p.value=r:null),columns:t(m),data:t(h),"flex-height":!t(k).isMobile,"scroll-x":962,loading:t(w),remote:"","row-key":r=>r.id,pagination:t(I),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(qe,{visible:t(N),"onUpdate:visible":o[3]||(o[3]=r=>T(N)?N.value=r:null),"operate-type":t(C),"row-data":t(U),onSubmitted:t(_)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Ae as default};
