import{d as R,j as A,k as N}from"./Grid-DNunwvuN.js";import{d as q,aj as M,dV as $,C as H,r as C,e5 as U,e6 as W,e7 as Y,af as B,n as L,e8 as E,a as O,ao as X,L as J,$ as z,q as Q,aq as Z}from"./index-CW-HgCkC.js";const ee=Object.assign(Object.assign({},N),W),oe=q({__GRID_ITEM__:!0,name:"FormItemGridItem",alias:["FormItemGi"],props:ee,setup(){const a=C(null);return{formItemInstRef:a,validate:(...t)=>{const{value:f}=a;if(f)return f.validate(...t)},restoreValidation:()=>{const{value:t}=a;t&&t.restoreValidation()}}},render(){return M(R,$(this.$.vnode.props||{},A),{default:()=>{const a=$(this.$props,U);return M(H,Object.assign({ref:"formItemInstRef"},a),this.$slots)}})}});function ae(a){const{loading:m,startLoading:y,endLoading:t}=Y(),{bool:f,setBool:h}=B(),{apiFn:I,apiParams:d,transformer:S,immediate:w=!0,getColumnChecks:_,getColumns:b}=a,g=L(E({...d})),s=C(a.columns()),P=C([]),i=C(_(a.columns())),p=O(()=>b(s.value,i.value));function D(){s.value=a.columns();const u=new Map(i.value.map(c=>[c.key,c.checked])),k=_(s.value);i.value=k.map(c=>({...c,checked:u.get(c.key)??c.checked}))}async function v(){var e;y();const u=T(g),k=await I(u),c=S(k);P.value=c.data,h(c.data.length===0),await((e=a.onFetched)==null?void 0:e.call(a,c)),t()}function T(u){const k={};return Object.entries(u).forEach(([c,e])=>{e!=null&&(k[c]=e)}),k}function r(u){Object.assign(g,u)}function j(){Object.assign(g,E(d))}return w&&(a.searchParams&&r(a.searchParams),v()),{loading:m,empty:f,data:P,columns:p,columnChecks:i,reloadColumns:D,getData:v,searchParams:g,updateSearchParams:r,resetSearchParams:j}}function re(a){const m=X(),y=J(),t=O(()=>y.isMobile),{apiFn:f,apiParams:h,immediate:I}=a,d=a.showTotal||!0,S="__selection__",w="__expand__",{loading:_,empty:b,data:g,columns:s,columnChecks:P,reloadColumns:i,getData:p,searchParams:D,updateSearchParams:v,resetSearchParams:T}=ae({apiFn:f,apiParams:h,searchParams:a.searchParams,columns:a.columns,transformer:e=>{const{data:l=[],page:n=1,size:x=10,total:o=0}=e.data||{},F=x<=0?10:x;return{data:l.map((V,G)=>({...V,index:(n-1)*F+G+1})),pageNum:n,pageSize:F,total:o}},getColumnChecks:e=>{const l=[];return e.forEach(n=>{K(n)?l.push({key:n.key,title:n.title,checked:!0}):n.type==="selection"?l.push({key:S,title:z("common.check"),checked:!0}):n.type==="expand"&&l.push({key:w,title:z("common.expandColumn"),checked:!0})}),l},getColumns:(e,l)=>{const n=new Map;return e.forEach(o=>{K(o)?n.set(o.key,o):o.type==="selection"?n.set(S,o):o.type==="expand"&&n.set(w,o),t.value&&o.fixed&&(o.fixed=void 0)}),l.filter(o=>o.checked).map(o=>n.get(o.key))},onFetched:async e=>{const{pageNum:l,pageSize:n,total:x}=e;u({page:l,pageSize:n,itemCount:x})},immediate:I}),r=L({page:1,pageSize:10,showSizePicker:!0,itemCount:0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{r.page=e,v({page:e,size:r.pageSize}),p()},onUpdatePageSize:async e=>{r.pageSize=e,r.page=1,v({page:r.page,size:e}),p()},prefix:e=>z("datatable.itemCount",{total:e.itemCount})}),j=O(()=>({...r,pageSlot:t.value?3:9,prefix:!t.value&&d?r.prefix:void 0}));function u(e){Object.assign(r,e)}async function k(e=1){u({page:e}),v({page:e,size:r.pageSize}),await p()}return m.run(()=>{Q(()=>y.locale,()=>{i()})}),Z(()=>{m.stop()}),{loading:_,empty:b,data:g,columns:s,columnChecks:P,reloadColumns:i,pagination:r,mobilePagination:j,updatePagination:u,getData:p,getDataByPage:k,searchParams:D,updateSearchParams:v,resetSearchParams:()=>{T(),p()}}}function ce(a,m){const{bool:y,setTrue:t,setFalse:f}=B(),h=C("add");function I(){h.value="add",t()}const d=C(null);function S(s){h.value="edit";const P=a.value.find(i=>i.id===s)||null;d.value=E(P),t()}function w(s){var i;h.value="add";const P=a.value.find(p=>p.id===s)||null;d.value=E(P),(i=d.value)==null||delete i.id,t()}const _=C([]);async function b(){var s;(s=window.$message)==null||s.success(z("common.deleteSuccess")),_.value=[],await m()}async function g(){var s;(s=window.$message)==null||s.success(z("common.deleteSuccess")),await m()}return{drawerVisible:y,openDrawer:t,closeDrawer:f,operateType:h,handleAdd:I,editingData:d,handleEdit:S,handleCopy:w,checkedRowKeys:_,onBatchDeleted:b,onDeleted:g}}function K(a){return!!a.key}export{oe as _,ce as a,re as u};
