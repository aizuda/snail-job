import{a as Y,N as R,b as Z}from"./search-form.vue_vue_type_script_setup_true_lang-Csk6aNWf.js";import{d as J,_ as Q,a as X}from"./download-rDh6m1OR.js";import{_ as ee}from"./delete-alert-CIZguut5.js";import{d as C,Z as te,a0 as oe,o as U,c as ae,w as s,f as a,h as t,$ as o,a4 as le,aH as ne,D as re,aa as se,bT as ie,L as ce,u as ue,b as me,ah as P,B as h,g as W,t as A,aK as pe,ac as de,Y as fe,aj as $,cs as we,F as ge,ak as ke}from"./index-D2gfy4BV.js";import{n as he,o as B,p as _e,q as ye}from"./workflow-DL9sDB8e.js";import{_ as xe,u as ve,a as be}from"./table-CBd8wgyy.js";import{_ as Ne}from"./status-switch.vue_vue_type_script_setup_true_lang-Bxu7mMSu.js";import{u as Se}from"./auth-DqDVYr_u.js";import{_ as Te}from"./select-group.vue_vue_type_script_setup_true_lang-BaCzN5y0.js";import{b as De}from"./Grid-DUVCwFN_.js";import"./Progress-C54cQ0Ku.js";import"./group-CHo9Y09B.js";const Re=C({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:te(["reset","search"],["update:model"]),setup(k,{emit:y}){const d=y,c=oe(k,"model");function N(){d("reset")}function S(){d("search")}return(x,i)=>{const u=xe,v=re,T=se,p=Y;return U(),ae(p,{model:c.value,onSearch:S,onReset:N},{default:s(()=>[a(u,{span:"24 s:12 m:6",label:t(o)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:s(()=>[a(Te,{value:c.value.groupName,"onUpdate:value":i[0]||(i[0]=f=>c.value.groupName=f),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(u,{span:"24 s:12 m:6",label:t(o)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:s(()=>[a(v,{value:c.value.workflowName,"onUpdate:value":i[1]||(i[1]=f=>c.value.workflowName=f),placeholder:t(o)("page.workflow.form.workflowName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(u,{span:"24 s:12 m:6",label:t(o)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:s(()=>[a(T,{value:c.value.workflowStatus,"onUpdate:value":i[2]||(i[2]=f=>c.value.workflowStatus=f),placeholder:t(o)("page.workflow.form.workflowStatus"),options:t(le)(t(ne)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Pe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function b(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!ke(k)}const Ee=C({name:"workflow_task",__name:"index",setup(k){const{hasAuth:y}=Se(),d=ie(),c=ce(),{routerPushByKey:N}=ue(),{columns:S,columnChecks:x,data:i,getData:u,loading:v,mobilePagination:T,searchParams:p,resetSearchParams:f}=ve({apiFn:he,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:o("common.index"),align:"center",width:120},{key:"workflowName",title:o("page.workflow.workflowName"),align:"left",minWidth:120,render:e=>{function l(){E(e.id)}return a(h,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[e.workflowName]})}},{key:"groupName",title:o("page.workflow.groupName"),align:"left",minWidth:120},{key:"nextTriggerAt",title:o("page.workflow.nextTriggerAt"),align:"left",minWidth:120},{key:"workflowStatus",title:o("page.workflow.workflowStatus"),align:"left",minWidth:120,render:e=>{const l=async(n,_)=>{var w;const{error:r}=await ye(e.id);r||(e.workflowStatus=n,(w=window.$message)==null||w.success(o("common.updateSuccess"))),_()};return a(Ne,{value:e.workflowStatus,"onUpdate:value":n=>e.workflowStatus=n,onFetch:l},null)}},{key:"triggerType",title:o("page.workflow.triggerType"),align:"left",minWidth:120,render:e=>{if(!e.triggerType)return null;const l=o(pe[e.triggerType]);return a(fe,{type:de(e.triggerType)},b(l)?l:{default:()=>[l]})}},{key:"triggerInterval",title:o("page.workflow.triggerInterval"),align:"left",minWidth:120},{key:"executorTimeout",title:o("page.workflow.executorTimeout"),align:"left",minWidth:120},{key:"updateDt",title:o("page.workflow.updateDt"),align:"left",minWidth:120},{key:"operate",title:o("common.operate"),align:"center",fixed:"right",width:200,render:e=>{let l;const n=[{label:o("common.copy"),key:"copy",click:()=>M(e.id)},{type:"divider",key:"d2"},{label:o("common.batchList"),key:"batchList",click:()=>G(e.id)},{type:"divider",key:"d2"},{type:"render",key:"delete",render:()=>a("div",{class:"flex-center"},[a(R,{onPositiveClick:()=>j(e.id)},{default:()=>o("common.confirmDelete"),trigger:()=>{let r;return a(h,{quaternary:!0,size:"small"},b(r=o("common.delete"))?r:{default:()=>[r]})}})])}],_=r=>{const w=n.filter(D=>D.key===r)[0].click;w&&w()};return a("div",{class:"flex-center gap-8px"},[a(h,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>q(e.id)},b(l=o("common.edit"))?l:{default:()=>[l]}),a($,{vertical:!0},null),a(R,{onPositiveClick:()=>K(e.id)},{default:()=>o("common.confirmExecute"),trigger:()=>{let r;return a(h,{type:"error",text:!0,ghost:!0,size:"small"},b(r=o("common.execute"))?r:{default:()=>[r]})}}),a($,{vertical:!0},null),a(we,{trigger:"click","show-arrow":!1,options:n,size:"small","on-select":_},{default:()=>a(h,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[W("更多")]})})])}}]}),{checkedRowKeys:m,onBatchDeleted:F,onDeleted:z}=be(i,u);async function I(){const{error:e}=await B(m.value);e||F()}async function j(e){const{error:l}=await B([e]);l||z()}function q(e){d.push({path:"/workflow/form/edit",query:{id:e}})}function O(){d.push({path:"/workflow/form/add"})}function E(e){d.push({path:"/workflow/form/detail",query:{id:e}})}function M(e){d.push({path:"/workflow/form/copy",query:{id:e}})}async function K(e){var n;const{error:l}=await _e(e);l||((n=window.$message)==null||n.success(o("common.executeSuccess")),u())}function L(){return{workflowIds:m.value,groupName:p.groupName,workflowName:p.workflowName,workflowStatus:p.workflowStatus}}function V(){J("/workflow/export",L(),o("page.workflow.title"))}function G(e){const l=i.value.find(n=>n.id===e);N("workflow_batch",{state:{workflowId:e,workflowName:l.workflowName}})}return(e,l)=>{const n=ee,_=Q,r=X,w=Z,D=De,H=ge;return U(),me("div",Pe,[a(Re,{model:t(p),"onUpdate:model":l[0]||(l[0]=g=>P(p)?p.value=g:null),onReset:t(f),onSearch:t(u)},null,8,["model","onReset","onSearch"]),a(n),a(H,{title:t(o)("page.workflow.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[a(w,{columns:t(x),"onUpdate:columns":l[1]||(l[1]=g=>P(x)?x.value=g:null),"disabled-delete":t(m).length===0,loading:t(v),"show-delete":t(y)("R_ADMIN"),onAdd:O,onDelete:I,onRefresh:t(u)},{addAfter:s(()=>[a(_,{action:"/workflow/import",accept:"application/json",onRefresh:t(u)},null,8,["onRefresh"]),a(t(R),{onPositiveClick:V},{trigger:s(()=>[a(t(h),{size:"small",ghost:"",type:"primary",disabled:t(m).length===0&&t(y)("R_USER")},{icon:s(()=>[a(r,{class:"text-icon"})]),default:s(()=>[W(" "+A(t(o)("common.export")),1)]),_:1},8,["disabled"])]),default:s(()=>[W(A(t(m).length===0?t(o)("common.exportAll"):t(o)("common.exportPar",{num:t(m).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-delete","onRefresh"])]),default:s(()=>[a(D,{"checked-row-keys":t(m),"onUpdate:checkedRowKeys":l[2]||(l[2]=g=>P(m)?m.value=g:null),columns:t(S),data:t(i),"flex-height":!t(c).isMobile,"scroll-x":1300,loading:t(v),remote:"","row-key":g=>g.id,pagination:t(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{Ee as default};
