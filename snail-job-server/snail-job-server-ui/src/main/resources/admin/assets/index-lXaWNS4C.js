import{c as Re,d as $e,a as Ue,N as ie,b as Ve}from"./search-form.vue_vue_type_script_setup_true_lang-Csk6aNWf.js";import{d as Ce,_ as Je,a as Oe}from"./download-rDh6m1OR.js";import{_ as Be}from"./delete-alert-CIZguut5.js";import{d as B,r as M,o as x,c as I,h as e,$ as t,a4 as ee,aC as Ae,aa as ae,aD as Fe,aE as Ke,aF as Me,Z as X,a0 as ne,L as ve,q as H,b as re,w as l,f as a,g as k,t as j,ai as Te,aG as ke,a9 as je,D as de,p as ge,z as Pe,A as ze,a as Ge,a1 as be,aH as he,a3 as _e,ab as Ee,E as Le,H as qe,B as E,F as Ne,I as He,ac as q,aB as Se,aI as We,aJ as Ye,az as Ze,aK as xe,aL as we,Y as oe,u as Qe,ag as Xe,ah as Q,aj as me,ak as ea}from"./index-D2gfy4BV.js";import{a as aa,b as ta,c as la,d as fe,e as oa,g as ra}from"./job-zG0yc1zw.js";import{_ as na,u as sa,a as ua}from"./table-CBd8wgyy.js";import{_ as pa}from"./status-switch.vue_vue_type_script_setup_true_lang-Bxu7mMSu.js";import{u as ia}from"./auth-DqDVYr_u.js";import{_ as De}from"./select-group.vue_vue_type_script_setup_true_lang-BaCzN5y0.js";import{_ as Ie,a as ma}from"./route-key.vue_vue_type_script_setup_true_lang-CPLfwHaj.js";import{_ as ye}from"./code-mirror.vue_vue_type_script_setup_true_lang-qktOrMmh.js";import{_ as da}from"./cron-input.vue_vue_type_style_index_0_lang-Bx5dJ8gU.js";import{_ as ca,d as ga,c as ba,a as _a,b as fa}from"./Grid-DUVCwFN_.js";import{_ as ya}from"./detail-drawer-CQjfY8zD.js";import{_ as va,a as Ta}from"./DescriptionsItem-LCBYJ9Xx.js";import"./Progress-C54cQ0Ku.js";import"./group-CHo9Y09B.js";const ka=B({name:"TriggerType",__name:"trigger-type",emits:["update:value"],setup(w,{emit:v}){const n=v,f=M(),p=d=>{n("update:value",d)};return(d,c)=>{const b=ae;return x(),I(b,{value:f.value,"onUpdate:value":[c[0]||(c[0]=o=>f.value=o),p],placeholder:e(t)("common.triggerType.form"),options:e(ee)(e(Ae))},null,8,["value","placeholder","options"])}}}),ja=B({name:"BlockStrategy",__name:"block-strategy",emits:["update:value"],setup(w,{emit:v}){const n=M(),f=v,p=d=>{f("update:value",d)};return(d,c)=>{const b=ae;return x(),I(b,{value:n.value,"onUpdate:value":[c[0]||(c[0]=o=>n.value=o),p],placeholder:e(t)("common.blockStrategy.form"),options:e(ee)(e(Fe))},null,8,["value","placeholder","options"])}}}),ha=B({name:"TriggerStrategy",__name:"executor-type",emits:["update:value"],setup(w,{emit:v}){const n=M(),f=v,p=d=>{f("update:value",d)};return(d,c)=>{const b=ae;return x(),I(b,{value:n.value,"onUpdate:value":[c[0]||(c[0]=o=>n.value=o),p],placeholder:e(t)("common.executorType.form"),options:e(ee)(e(Ke))},null,8,["value","placeholder","options"])}}}),Na=B({name:"TaskType",__name:"task-type",emits:["update:value"],setup(w,{emit:v}){const n=v,f=M(),p=d=>{n("update:value",d)};return(d,c)=>{const b=ae;return x(),I(b,{value:f.value,"onUpdate:value":[c[0]||(c[0]=o=>f.value=o),p],placeholder:e(t)("common.routeKey.routeForm"),options:e(ee)(e(Me))},null,8,["value","placeholder","options"])}}}),Sa=B({name:"JobTriggerInterval",__name:"job-trigger-interval",props:X({triggerType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(w){const v=ne(w,"modelValue"),n=w,f=ve(),p=M(n.triggerType===2?Number(v.value):60),d=M(n.triggerType===3?v.value:"* * * * * ?");return H(p,c=>{n.triggerType===2&&(v.value=`${c}`)},{immediate:!0}),H(d,c=>{n.triggerType===3&&(v.value=c)},{immediate:!0}),H(()=>n.triggerType,c=>{c===2?v.value=`${p.value}`:c===3?v.value=d.value:v.value="*"},{immediate:!0}),(c,b)=>{const o=ke,_=Ie,y=je,A=de;return x(),re("div",null,[c.triggerType===2?(x(),I(y,{key:0},{default:l(()=>[a(o,{value:p.value,"onUpdate:value":b[0]||(b[0]=r=>p.value=r),placeholder:c.$t("page.jobTask.form.triggerInterval")},null,8,["value","placeholder"]),a(_,null,{default:l(()=>[k(j(c.$t("common.second")),1)]),_:1})]),_:1})):c.triggerType===3?(x(),I(e(da),{key:1,modelValue:d.value,"onUpdate:modelValue":b[1]||(b[1]=r=>d.value=r),placeholder:c.$t("page.jobTask.form.triggerInterval_CRON"),lang:e(f).locale},null,8,["modelValue","placeholder","lang"])):c.triggerType===99?(x(),I(A,{key:2,disabled:""})):Te("",!0)])}}}),xa=B({name:"JobTaskOperateDrawer",__name:"job-task-operate-drawer",props:X({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(w,{emit:v}){const n=w,f=v,p=ne(w,"visible"),d=ge({args:[{arg:""}]}),c=M(0),{formRef:b,validate:o,restoreValidation:_}=Pe(),{defaultRequiredRule:y}=ze(),A=Ge(()=>({add:t("page.jobTask.addJobTask"),edit:t("page.jobTask.editJobTask")})[n.operateType]),r=ge(C());function C(){return{groupName:"",jobName:"",argsStr:"",argsType:1,jobStatus:1,routeKey:4,executorType:1,triggerType:2,executorInfo:"",triggerInterval:"60",blockStrategy:1,executorTimeout:60,maxRetryTimes:3,retryInterval:1,taskType:1,parallelNum:1,description:""}}const se={groupName:y,jobName:y,argsType:y,jobStatus:y,routeKey:y,executorType:y,executorInfo:y,triggerType:y,triggerInterval:y,blockStrategy:y,executorTimeout:y,maxRetryTimes:y,retryInterval:y,taskType:y,parallelNum:y};function W(){if(n.operateType==="add"){Object.assign(r,C());return}if(n.operateType==="edit"&&n.rowData&&(Object.assign(r,n.rowData),r.taskType===3&&r.argsStr&&Object.assign(d,{args:JSON.parse(r.argsStr).map(N=>({arg:N}))}),r.taskType===5&&r.argsStr)){const N=JSON.parse(r.argsStr);c.value=N.shardNum,r.argsStr=N.argsStr}}function te(){p.value=!1}async function le(){var N,s;if(await o(),n.operateType==="add"){const{groupName:J,jobName:T,argsType:P,argsStr:O,jobStatus:F,routeKey:z,executorType:$,executorInfo:i,triggerType:m,triggerInterval:g,blockStrategy:h,executorTimeout:D,maxRetryTimes:U,retryInterval:V,taskType:K,parallelNum:S,description:L}=r,{error:Y}=await aa({groupName:J,jobName:T,argsStr:K===5?JSON.stringify({shardNum:c.value,argsStr:O}):O,argsType:P,jobStatus:F,routeKey:z,executorType:$,executorInfo:i,triggerType:m,triggerInterval:g,blockStrategy:h,executorTimeout:D,maxRetryTimes:U,retryInterval:V,taskType:K,parallelNum:S,description:L});if(Y)return;(N=window.$message)==null||N.success(t("common.addSuccess"))}if(n.operateType==="edit"){const{id:J,groupName:T,jobName:P,argsStr:O,argsType:F,jobStatus:z,routeKey:$,executorType:i,executorInfo:m,triggerType:g,triggerInterval:h,blockStrategy:D,executorTimeout:U,maxRetryTimes:V,retryInterval:K,taskType:S,parallelNum:L,description:Y}=r,{error:u}=await ta({id:J,groupName:T,jobName:P,argsStr:S===5?JSON.stringify({shardNum:c.value,argsStr:O}):O,argsType:F,jobStatus:z,routeKey:$,executorType:i,executorInfo:m,triggerType:g,triggerInterval:h,blockStrategy:D,executorTimeout:U,maxRetryTimes:V,retryInterval:K,taskType:S,parallelNum:L,description:Y});if(u)return;(s=window.$message)==null||s.success(t("common.updateSuccess"))}te(),f("submitted")}function ue(){if(r.taskType===3&&d.args){const N=d.args.map(s=>s.arg.trim()).filter(s=>!!s);r.argsStr=N.length>0?JSON.stringify(N):""}return r.argsStr}const pe=N=>{d.args.splice(N,1)},R=()=>{d.args.push({arg:""})};return H(p,()=>{p.value&&(W(),_())}),H(d,()=>{p.value&&r.taskType===3&&ue()}),H(()=>r.taskType,N=>{n.operateType==="add"&&p.value&&(N!==3&&(d.args=[]),N!==5&&(c.value=1),r.argsStr="")}),(N,s)=>{const J=de,T=Le,P=De,O=_a,F=qe,z=ca,$=ke,i=$e,m=E,g=Re,h=Ne,D=ga,U=ja,V=ba,K=ka,S=Ie,L=je,Y=He;return x(),I(Ee,{modelValue:p.value,"onUpdate:modelValue":s[17]||(s[17]=u=>p.value=u),title:A.value,"min-size":480,onHandleSubmit:le},{footer:l(()=>[a(F,{size:16},{default:l(()=>[a(m,{onClick:te},{default:l(()=>[k(j(e(t)("common.cancel")),1)]),_:1}),a(m,{type:"primary",onClick:le},{default:l(()=>[k(j(e(t)("common.save")),1)]),_:1})]),_:1})]),default:l(()=>[a(Y,{ref_key:"formRef",ref:b,model:r,rules:se},{default:l(()=>[a(T,{label:e(t)("page.jobTask.jobName"),path:"jobName"},{default:l(()=>[a(J,{value:r.jobName,"onUpdate:value":s[0]||(s[0]=u=>r.jobName=u),maxlength:64,"show-count":"",placeholder:e(t)("page.jobTask.form.jobName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(T,{label:e(t)("page.jobTask.groupName"),path:"groupName"},{default:l(()=>[a(P,{value:r.groupName,"onUpdate:value":s[1]||(s[1]=u=>r.groupName=u),disabled:n.operateType==="edit"},null,8,["value","disabled"])]),_:1},8,["label"]),a(T,{label:e(t)("page.jobTask.jobStatus"),path:"jobStatus"},{default:l(()=>[a(z,{value:r.jobStatus,"onUpdate:value":s[2]||(s[2]=u=>r.jobStatus=u),name:"jobStatus"},{default:l(()=>[a(F,null,{default:l(()=>[(x(!0),re(_e,null,be(e(he),u=>(x(),I(O,{key:u.value,value:u.value,label:e(t)(u.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),a(T,{label:e(t)("page.jobTask.executorType"),path:"executorType"},{default:l(()=>[a(ha,{value:r.executorType,"onUpdate:value":s[3]||(s[3]=u=>r.executorType=u)},null,8,["value"])]),_:1},8,["label"]),a(T,{label:e(t)("page.jobTask.executorInfo"),path:"executorInfo"},{default:l(()=>[a(J,{value:r.executorInfo,"onUpdate:value":s[4]||(s[4]=u=>r.executorInfo=u),placeholder:e(t)("page.jobTask.form.executorInfo")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(T,{label:e(t)("page.jobTask.taskType"),path:"taskType"},{default:l(()=>[a(Na,{value:r.taskType,"onUpdate:value":s[5]||(s[5]=u=>r.taskType=u),placeholder:e(t)("page.jobTask.form.taskType")},null,8,["value","placeholder"])]),_:1},8,["label"]),r.taskType===5?(x(),I(T,{key:0,label:e(t)("page.jobTask.shardNum")},{default:l(()=>[a($,{value:c.value,"onUpdate:value":s[6]||(s[6]=u=>c.value=u),min:1,placeholder:e(t)("page.jobTask.form.shardNum")},null,8,["value","placeholder"])]),_:1},8,["label"])):Te("",!0),a(T,{label:e(t)("page.jobTask.argsStr"),path:"argsStr",rule:r.taskType===3?e(y):void 0},{default:l(()=>[r.taskType===3?(x(),I(h,{key:0,class:"flex-col"},{default:l(()=>[(x(!0),re(_e,null,be(d.args,(u,Z)=>(x(),I(T,{key:Z,label:`分片参数 ${Z+1}`,path:`args[${Z}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${e(t)("page.jobTask.form.argsStr")} ${Z+1}`,trigger:["input","blur"],validator(){return!!u.arg}}},{default:l(()=>[a(ye,{modelValue:u.arg,"onUpdate:modelValue":ce=>u.arg=ce,lang:"json",placeholder:e(t)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(m,{class:"ml-12px",type:"error",dashed:"",onClick:ce=>pe(Z)},{default:l(()=>[a(i,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),a(m,{block:"",dashed:"","attr-type":"button",onClick:R},{default:l(()=>[a(g,{class:"text-icon"})]),_:1})]),_:1})):(x(),I(ye,{key:1,modelValue:r.argsStr,"onUpdate:modelValue":s[7]||(s[7]=u=>r.argsStr=u),lang:"json",placeholder:e(t)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))]),_:1},8,["label","rule"]),a(V,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.routeKey"),path:"routeKey"},{default:l(()=>[a(ma,{value:r.routeKey,"onUpdate:value":s[8]||(s[8]=u=>r.routeKey=u),"task-type":r.taskType},null,8,["value","task-type"])]),_:1},8,["label"])]),_:1}),a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.blockStrategy"),path:"blockStrategy"},{default:l(()=>[a(U,{value:r.blockStrategy,"onUpdate:value":s[9]||(s[9]=u=>r.blockStrategy=u)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),a(V,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.triggerType"),path:"triggerType"},{default:l(()=>[a(K,{value:r.triggerType,"onUpdate:value":s[10]||(s[10]=u=>r.triggerType=u),placeholder:e(t)("page.jobTask.form.triggerType")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.triggerInterval"),path:"triggerInterval"},{default:l(()=>[a(Sa,{modelValue:r.triggerInterval,"onUpdate:modelValue":s[11]||(s[11]=u=>r.triggerInterval=u),"trigger-type":r.triggerType},null,8,["modelValue","trigger-type"])]),_:1},8,["label"])]),_:1})]),_:1}),a(V,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.executorTimeout"),path:"executorTimeout"},{default:l(()=>[a(L,null,{default:l(()=>[a($,{value:r.executorTimeout,"onUpdate:value":s[12]||(s[12]=u=>r.executorTimeout=u),min:1,max:99999999,placeholder:e(t)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),a(S,null,{default:l(()=>[k(j(e(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.maxRetryTimes"),path:"maxRetryTimes"},{default:l(()=>[a($,{value:r.maxRetryTimes,"onUpdate:value":s[13]||(s[13]=u=>r.maxRetryTimes=u),min:0,max:999,placeholder:e(t)("page.jobTask.form.maxRetryTimes"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),a(V,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.retryInterval"),path:"retryInterval"},{default:l(()=>[a(L,null,{default:l(()=>[a($,{value:r.retryInterval,"onUpdate:value":s[14]||(s[14]=u=>r.retryInterval=u),min:1,max:99999999,placeholder:e(t)("page.jobTask.form.retryInterval"),clearable:""},null,8,["value","placeholder"]),a(S,null,{default:l(()=>[k(j(e(t)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),a(D,null,{default:l(()=>[a(T,{label:e(t)("page.jobTask.parallelNum"),path:"parallelNum"},{default:l(()=>[a($,{value:r.parallelNum,"onUpdate:value":s[15]||(s[15]=u=>r.parallelNum=u),min:1,max:999,placeholder:e(t)("page.jobTask.form.parallelNum"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),a(T,{label:e(t)("page.jobTask.description"),path:"description"},{default:l(()=>[a(J,{value:r.description,"onUpdate:value":s[16]||(s[16]=u=>r.description=u),type:"textarea",placeholder:e(t)("page.jobTask.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),wa=B({name:"JobTaskSearch",__name:"job-task-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search"],["update:model"]),setup(w,{emit:v}){const n=v,f=ne(w,"model");function p(){n("reset")}function d(){n("search")}return(c,b)=>{const o=na,_=de,y=ae,A=Ue;return x(),I(A,{model:f.value,onSearch:d,onReset:p},{default:l(()=>[a(o,{span:"24 s:12 m:6",label:e(t)("page.jobTask.groupName"),path:"groupName",class:"pr-24px"},{default:l(()=>[a(De,{value:f.value.groupName,"onUpdate:value":b[0]||(b[0]=r=>f.value.groupName=r),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(o,{span:"24 s:12 m:6",label:e(t)("page.jobTask.jobName"),path:"jobName",class:"pr-24px"},{default:l(()=>[a(_,{value:f.value.jobName,"onUpdate:value":b[1]||(b[1]=r=>f.value.jobName=r),placeholder:e(t)("page.jobTask.form.jobName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(o,{span:"24 s:12 m:6",label:e(t)("page.jobTask.jobStatus"),path:"jobStatus",class:"pr-24px"},{default:l(()=>[a(y,{value:f.value.jobStatus,"onUpdate:value":b[2]||(b[2]=r=>f.value.jobStatus=r),placeholder:e(t)("page.jobTask.form.jobStatus"),options:e(ee)(e(he)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Da=B({name:"JobTaskDetailDrawer",__name:"job-task-detail-drawer",props:X({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const v=ne(w,"visible");return(n,f)=>{const p=va,d=oe,c=Ta,b=ya;return x(),I(b,{modelValue:v.value,"onUpdate:modelValue":f[0]||(f[0]=o=>v.value=o),title:e(t)("page.jobTask.detail"),width:["50%","90%"]},{default:l(()=>[a(c,{"label-placement":"top",bordered:"",column:2},{default:l(()=>[a(p,{label:e(t)("page.jobTask.groupName")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.groupName),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.jobName")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.jobName),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.taskType")},{default:l(()=>{var o;return[a(d,{type:e(q)((o=n.rowData)==null?void 0:o.taskType)},{default:l(()=>{var _;return[k(j(e(t)(e(Se)[(_=n.rowData)==null?void 0:_.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.argsStr")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.argsStr),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.nextTriggerAt")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.nextTriggerAt),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.jobStatus")},{default:l(()=>{var o;return[a(d,{type:e(q)((o=n.rowData)==null?void 0:o.jobStatus)},{default:l(()=>{var _;return[k(j(e(t)(e(We)[(_=n.rowData)==null?void 0:_.jobStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.routeKey")},{default:l(()=>{var o;return[a(d,{type:e(q)((o=n.rowData)==null?void 0:o.routeKey)},{default:l(()=>{var _;return[k(j(e(t)(e(Ye)[(_=n.rowData)==null?void 0:_.routeKey])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.executorType")},{default:l(()=>{var o;return[a(d,{type:e(q)((o=n.rowData)==null?void 0:o.executorType)},{default:l(()=>{var _;return[k(j(e(t)(e(Ze)[(_=n.rowData)==null?void 0:_.executorType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.executorInfo")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.executorInfo),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.triggerType")},{default:l(()=>{var o;return[a(d,{type:e(q)((o=n.rowData)==null?void 0:o.triggerType)},{default:l(()=>{var _;return[k(j(e(t)(e(xe)[(_=n.rowData)==null?void 0:_.triggerType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.triggerInterval")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.triggerInterval),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.blockStrategy")},{default:l(()=>{var o;return[a(d,{type:e(q)((o=n.rowData)==null?void 0:o.blockStrategy)},{default:l(()=>{var _;return[k(j(e(t)(e(we)[(_=n.rowData)==null?void 0:_.blockStrategy])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.executorTimeout")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.executorTimeout),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.maxRetryTimes")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.maxRetryTimes),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.retryInterval")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.retryInterval),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.parallelNum")},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.parallelNum),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.jobTask.description"),span:2},{default:l(()=>{var o;return[k(j((o=n.rowData)==null?void 0:o.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Ia={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function G(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!ea(w)}const qa=B({name:"job_task",__name:"index",setup(w){const{hasAuth:v}=ia(),n=ve(),{routerPushByKey:f}=Qe(),p=M(),{bool:d,setTrue:c}=Xe(!1),{columnChecks:b,columns:o,data:_,getData:y,loading:A,mobilePagination:r,searchParams:C,resetSearchParams:se}=sa({apiFn:la,apiParams:{page:1,size:10,groupName:null,jobName:null,jobStatus:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:t("common.index"),align:"center",width:48},{key:"jobName",title:t("page.jobTask.jobName"),align:"center",width:140,fixed:"left",render:i=>{async function m(){p.value=i,c()}return a(E,{text:!0,tag:"a",type:"primary",onClick:m,class:"ws-normal"},{default:()=>[`${i.jobName}`]})}},{key:"groupName",title:t("page.jobTask.groupName"),align:"left",width:180},{key:"nextTriggerAt",title:t("page.jobTask.nextTriggerAt"),align:"center",width:120},{key:"jobStatus",title:t("page.jobTask.jobStatus"),align:"center",width:60,render:i=>{const m=async(g,h)=>{var U;const{error:D}=await ra({id:i.id,jobStatus:g});D||(i.jobStatus=g,(U=window.$message)==null||U.success(t("common.updateSuccess"))),h()};return a(pa,{value:i.jobStatus,"onUpdate:value":g=>i.jobStatus=g,onFetch:m},null)}},{key:"taskType",title:t("page.jobTask.taskType"),align:"center",width:120,render:i=>{if(i.taskType===null)return null;const m={1:"info",2:"success",3:"error",4:"primary",5:"warning"},g=t(Se[i.taskType]);return a(oe,{type:m[i.taskType]},G(g)?g:{default:()=>[g]})}},{key:"triggerType",title:t("page.jobTask.triggerType"),align:"center",width:120,render:i=>{if(i.triggerType===null)return null;const m={2:"info",3:"success",99:"error"},g=t(xe[i.triggerType]);return a(oe,{type:m[i.triggerType]},G(g)?g:{default:()=>[g]})}},{key:"triggerInterval",title:t("page.jobTask.triggerInterval"),align:"center",width:80},{key:"blockStrategy",title:t("page.jobTask.blockStrategy"),align:"center",width:80,render:i=>{if(i.blockStrategy===null)return null;const m={1:"info",2:"success",3:"error",4:"warning"},g=t(we[i.blockStrategy]);return a(oe,{type:m[i.blockStrategy]},G(g)?g:{default:()=>[g]})}},{key:"executorTimeout",title:t("page.jobTask.executorTimeout"),align:"center",width:80},{key:"updateDt",title:t("page.jobTask.updateDt"),align:"center",width:120},{key:"operate",title:t("common.operate"),align:"center",width:180,fixed:"right",render:i=>{let m,g;return a("div",{class:"flex-center gap-8px"},[a(ie,{onPositiveClick:()=>O(i.id)},{default:()=>t("common.confirmExecute"),trigger:()=>{let h;return a(E,{type:"error",text:!0,ghost:!0,size:"small"},G(h=t("common.execute"))?h:{default:()=>[h]})}}),a(me,{vertical:!0},null),a(E,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>F(i.id)},G(m=t("common.batchList"))?m:{default:()=>[m]}),a(me,{vertical:!0},null),a(E,{type:"warning",ghost:!0,text:!0,size:"small",onClick:()=>P(i.id)},G(g=t("common.edit"))?g:{default:()=>[g]}),a(me,{vertical:!0},null),a(ie,{onPositiveClick:()=>J(i.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let h;return a(E,{type:"error",text:!0,ghost:!0,size:"small"},G(h=t("common.delete"))?h:{default:()=>[h]})}})])}}]}),{drawerVisible:W,operateType:te,editingData:le,handleAdd:ue,handleEdit:pe,checkedRowKeys:R,onDeleted:N,onBatchDeleted:s}=ua(_,y);async function J(i){const{error:m}=await fe([i]);m||N()}async function T(){const{error:i}=await fe(R.value);i||s()}function P(i){pe(i)}async function O(i){var g,h;const{error:m}=await oa(i);m?(g=window.$message)==null||g.error(t("common.executeFailed")):(h=window.$message)==null||h.success(t("common.executeSuccess"))}function F(i){const m=_.value.find(g=>g.id===i);f("job_batch",{state:{jobId:i,jobName:m.jobName}})}function z(){return{jobIds:R.value,groupName:C.groupName,jobName:C.jobName,jobStatus:C.jobStatus}}function $(){Ce("/job/export",z(),t("page.jobTask.title"))}return(i,m)=>{const g=Be,h=Je,D=Oe,U=Ve,V=fa,K=Ne;return x(),re("div",Ia,[a(wa,{model:e(C),"onUpdate:model":m[0]||(m[0]=S=>Q(C)?C.value=S:null),onReset:e(se),onSearch:e(y)},null,8,["model","onReset","onSearch"]),a(g),a(K,{title:e(t)("page.jobTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":l(()=>[a(U,{columns:e(b),"onUpdate:columns":m[1]||(m[1]=S=>Q(b)?b.value=S:null),loading:e(A),"disabled-delete":e(R).length===0,"show-delete":e(v)("R_ADMIN"),onAdd:e(ue),onDelete:T,onRefresh:e(y)},{addAfter:l(()=>[a(h,{action:"/job/import",accept:"application/json",onRefresh:e(y)},null,8,["onRefresh"]),a(e(ie),{onPositiveClick:$},{trigger:l(()=>[a(e(E),{size:"small",ghost:"",type:"primary",disabled:e(R).length===0&&e(v)("R_USER")},{icon:l(()=>[a(D,{class:"text-icon"})]),default:l(()=>[k(" "+j(e(t)("common.export")),1)]),_:1},8,["disabled"])]),default:l(()=>[k(j(e(R).length===0?e(t)("common.exportAll"):e(t)("common.exportPar",{num:e(R).length})),1)]),_:1})]),_:1},8,["columns","loading","disabled-delete","show-delete","onAdd","onRefresh"])]),default:l(()=>[a(V,{"checked-row-keys":e(R),"onUpdate:checkedRowKeys":m[2]||(m[2]=S=>Q(R)?R.value=S:null),columns:e(o),data:e(_),"flex-height":!e(n).isMobile,"scroll-x":2e3,loading:e(A),remote:"","row-key":S=>S.id,pagination:e(r),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(xa,{visible:e(W),"onUpdate:visible":m[3]||(m[3]=S=>Q(W)?W.value=S:null),"operate-type":e(te),"row-data":e(le),onSubmitted:e(y)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(Da,{visible:e(d),"onUpdate:visible":m[4]||(m[4]=S=>Q(d)?d.value=S:null),"row-data":p.value},null,8,["visible","row-data"])])}}});export{qa as default};
