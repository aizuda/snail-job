import{a as E,b as J,N as L}from"./search-form-ChmbPvEh.js";import{aP as k,aR as Q,b as B,o as R,e as X,d as z,a0 as P,a1 as T,c as U,w as n,f as t,h as a,$ as l,D as Y,g,t as f,a9 as Z,K as ee,r as ae,af as te,b4 as le,i as oe,ag as D,B as w,F as ne,ah as re,ai as se}from"./index-DPxvecb9.js";import{g as ie}from"./group-BZ9XUFDN.js";import{_ as de,u as ue,a as me}from"./table-qlAFhrE0.js";import{_ as ce}from"./select-group.vue_vue_type_script_setup_true_lang-1ffxHWR9.js";import{_ as pe}from"./select-scene.vue_vue_type_script_setup_true_lang-BaW_9SLG.js";import{_ as ge}from"./datetime-range.vue_vue_type_script_setup_true_lang-Ctz-nQB_.js";import{_ as fe,a as _e}from"./DescriptionsItem-B751nMzO.js";import{b as be}from"./Grid-CqPyBB90.js";import"./CollapseItem-B-Wk-PiL.js";import"./retry-scene-BHMqnpcr.js";import"./DatePicker-DUClq5iN.js";function he(i){return k({url:"/retry-dead-letter/list",method:"get",params:i})}function ye(i,p){return k({url:`/retry-dead-letter/${i}?groupName=${p}`,method:"get"})}function $(i){return k({url:"/retry-dead-letter/batch/rollback",method:"post",data:i})}function I(i){return k({url:"/retry-dead-letter/batch",method:"delete",data:i})}const ve={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ne(i,p){return R(),B("svg",ve,p[0]||(p[0]=[X("path",{fill:"currentColor",d:"M20.93 14A7 7 0 0 1 14 20H5.5v-2H14a5 5 0 1 0 0-10H6.914l2.5 2.5L8 11.914L3.086 7L8 2.086L9.414 3.5L6.914 6H14a7 7 0 0 1 7 7v1z"},null,-1)]))}const De=Q({name:"tdesign-rollback",render:Ne}),we=z({name:"RetryDeadLetterSearch",__name:"dead-letter-search",props:{model:{required:!0},modelModifiers:{}},emits:P(["reset","search"],["update:model"]),setup(i,{emit:p}){const d=p,s=T(i,"model");function m(){d("reset")}function y(){d("search")}return(h,e)=>{const c=de,v=Y,x=E;return R(),U(x,{"btn-span":"24 s:12 m:9 l:12 xl:15",model:s.value,onSearch:y,onReset:m},{default:n(()=>[t(c,{span:"24 s:12 m:6",label:a(l)("page.retryTask.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t(ce,{value:s.value.groupName,"onUpdate:value":e[0]||(e[0]=u=>s.value.groupName=u),clearable:""},null,8,["value"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:a(l)("page.retryTask.sceneName"),path:"sceneName",class:"pr-24px"},{default:n(()=>[t(pe,{value:s.value.sceneName,"onUpdate:value":e[1]||(e[1]=u=>s.value.sceneName=u),"group-name":s.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:a(l)("page.retry.bizNo"),path:"bizNo",class:"pr-24px"},{default:n(()=>[t(v,{value:s.value.bizNo,"onUpdate:value":e[2]||(e[2]=u=>s.value.bizNo=u),placeholder:a(l)("page.retry.form.bizNo"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:6",label:a(l)("page.retry.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:n(()=>[t(v,{value:s.value.idempotentId,"onUpdate:value":e[3]||(e[3]=u=>s.value.idempotentId=u),placeholder:a(l)("page.retry.form.idempotentId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{span:"24 s:12 m:15 l:12 xl:9",label:a(l)("page.common.createTime"),path:"datetimeRange"},{default:n(()=>[t(ge,{value:s.value.datetimeRange,"onUpdate:value":e[4]||(e[4]=u=>s.value.datetimeRange=u)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ke=z({name:"RetryDeadLetterDetailDrawer",__name:"retry-letter-detail-drawer",props:P({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(i){const p=T(i,"visible");return(d,s)=>{const m=_e,y=fe,h=Z;return R(),U(h,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),title:a(l)("page.retryDeadLetter.detail")},{default:n(()=>[t(y,{"label-placement":"top",bordered:"",column:3},{default:n(()=>[t(m,{label:a(l)("page.retry.groupName"),span:3},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.groupName),1)]}),_:1},8,["label"]),t(m,{label:a(l)("page.retry.sceneName"),span:3},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.sceneName),1)]}),_:1},8,["label"]),t(m,{label:a(l)("page.retry.bizNo"),span:3},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.bizNo),1)]}),_:1},8,["label"]),t(m,{label:a(l)("page.retry.idempotentId"),span:3},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.idempotentId),1)]}),_:1},8,["label"]),t(m,{label:a(l)("page.retry.executorName"),span:3},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.executorName),1)]}),_:1},8,["label"]),t(m,{label:a(l)("page.retry.argsStr"),span:3},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.argsStr),1)]}),_:1},8,["label"]),t(m,{label:a(l)("page.retry.serializerName"),span:2},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.serializerName),1)]}),_:1},8,["label"]),t(m,{label:a(l)("common.createDt"),span:3},{default:n(()=>{var e;return[g(f((e=d.rowData)==null?void 0:e.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function S(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!se(i)}const Ae=z({name:"retry_dead-letter",__name:"index",setup(i){const p=ee(),d=ae(),{bool:s,setTrue:m}=te(!1),{columns:y,columnChecks:h,data:e,getData:c,loading:v,mobilePagination:x,searchParams:u,resetSearchParams:C}=ue({apiFn:he,apiParams:{page:1,size:10,groupName:null,sceneName:null,datetimeRange:le()},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:l("common.index"),align:"center",width:120,render:r=>{async function o(){await W(r),m()}return t(w,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[r.id]})}},{key:"groupName",title:l("page.retryDeadLetter.groupName"),align:"center",minWidth:120},{key:"sceneName",title:l("page.retryDeadLetter.sceneName"),align:"center",minWidth:120},{key:"idempotentId",title:l("page.retryDeadLetter.idempotentId"),align:"center",minWidth:120},{key:"bizNo",title:l("page.retryDeadLetter.bizNo"),align:"center",minWidth:120},{key:"createDt",title:l("page.retryDeadLetter.createDt"),align:"center",minWidth:120},{key:"operate",title:l("common.operate"),align:"center",width:130,render:r=>t("div",{class:"flex-center gap-8px"},[t(L,{onPositiveClick:()=>F(r)},{default:()=>l("common.confirmRollback"),trigger:()=>{let o;return t(w,{type:"info",text:!0,ghost:!0,size:"small"},S(o=l("common.rollback"))?o:{default:()=>[o]})}}),t(re,{vertical:!0},null),t(L,{onPositiveClick:()=>H(r)},{default:()=>l("common.confirmDelete"),trigger:()=>{let o;return t(w,{type:"error",text:!0,ghost:!0,size:"small"},S(o=l("common.delete"))?o:{default:()=>[o]})}})])}]}),{handleAdd:V,checkedRowKeys:b,onDeleted:A,onBatchDeleted:M}=me(e,c);async function O(){const{error:r}=await I({ids:b.value,groupName:u.groupName});r||r||M()}async function G(){var o;const{error:r}=await $({ids:b.value});r||((o=window.$message)==null||o.success(l("common.rollbackSuccess")),c())}async function H(r){const{error:o}=await I({ids:[r.id],groupName:r.groupName});o||A()}async function W(r){const o=await ye(r.id,r.groupName);d.value=o.data||null}async function F(r){var N;const{error:o}=await $({ids:[r.id],groupName:r.groupName});o||((N=window.$message)==null||N.success(l("common.rollbackSuccess")),c())}return oe(async()=>{const{error:r,data:o}=await ie();!r&&o.length>0&&c()}),(r,o)=>{const N=De,j=J,K=be,q=ne;return R(),B("div",Re,[t(we,{model:a(u),"onUpdate:model":o[0]||(o[0]=_=>D(u)?u.value=_:null),onReset:a(C),onSearch:a(c)},null,8,["model","onReset","onSearch"]),t(q,{title:a(l)("page.retryDeadLetter.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":n(()=>[t(j,{columns:a(h),"onUpdate:columns":o[1]||(o[1]=_=>D(h)?h.value=_:null),"disabled-delete":a(b).length===0,loading:a(v),"show-add":!1,onAdd:a(V),onDelete:O,onRefresh:a(c)},{addAfter:n(()=>[t(a(L),{onPositiveClick:G},{trigger:n(()=>[t(a(w),{size:"small",ghost:"",type:"primary",disabled:a(b).length===0},{icon:n(()=>[t(N,{class:"text-icon"})]),default:n(()=>[g(" "+f(a(l)("common.batchRollback")),1)]),_:1},8,["disabled"])]),default:n(()=>[g(" "+f(a(l)("common.confirmRollback")),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[t(K,{"checked-row-keys":a(b),"onUpdate:checkedRowKeys":o[2]||(o[2]=_=>D(b)?b.value=_:null),columns:a(y),data:a(e),"flex-height":!a(p).isMobile,"scroll-x":962,loading:a(v),remote:"","row-key":_=>_.id,pagination:a(x),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(ke,{visible:a(s),"onUpdate:visible":o[3]||(o[3]=_=>D(s)?s.value=_:null),"row-data":d.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Ae as default};
