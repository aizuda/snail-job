import{a as z,b as A,c as E}from"./log-drawer-Dqe3cuCl.js";import{d as R,k as $,r as s,i as U,bz as W,o as f,c as d,w as e,e as h,f as n,x as q,g as p,t as L,h as M,_ as O,B as j,a8 as F,cx as G,au as H,l as J}from"./index-D11HRvLC.js";import{u as K,_ as P}from"./workflow.vue_vue_type_style_index_0_lang-CRcqtLx3.js";import{d as Q}from"./workflow-B_Ogzjxw.js";import"./CollapseItem-C4NYsEPz.js";import"./job-DWJU1EVy.js";import"./Grid-BEQeOJ6_.js";import"./DescriptionsItem-QSQ4JSXU.js";import"./job-task-list-table.vue_vue_type_script_setup_true_lang-DFSIKcqE.js";import"./table-oGN68_Ra.js";import"./code-mirror.vue_vue_type_script_setup_true_lang--sv6Sl5J.js";import"./cron-input.vue_vue_type_style_index_0_lang-CQfeC2zV.js";import"./group-DBuDE6uz.js";const X={class:"flex-center"},Y={class:"flex-center gap-8px"},Z=R({name:"workflow_form_batch",__name:"index",setup(ee){const c=K(),B=$(),v=s(!1),g=String(B.query.id),r=s({}),l=s(0),i=s(),k=new AbortController,o=s(!0),x=()=>{o.value=!0,k.abort(),clearTimeout(i.value),i.value=void 0},y=()=>{o.value||k.abort(),x(),r.value={},c.clear()},u=async()=>{v.value=!0;const{data:a,error:t}=await Q(g);t?(t==null?void 0:t.code)!=="ERR_CANCELED"&&y():(r.value=a,o.value=!(a.workflowBatchStatus&&[1,2].includes(a.workflowBatchStatus))||l.value===0,!o.value&&l.value!==0&&(clearTimeout(i.value),i.value=setTimeout(u,l.value*1e3))),v.value=!1},b=async a=>{if(a===-1){o.value&&(o.value=!1,await u());return}if(l.value=a,a===0){x();return}o.value=!1,await u()};U(()=>{c.clear(),c.setType(2),c.setId(g),u()}),W(()=>{y()});const w=s([{label:"Auto(off)",key:0},{label:"1s",key:1},{label:"5s",key:5},{label:"10s",key:10},{label:"30s",key:30},{label:"1m",key:60},{label:"5m",key:300}]);return(a,t)=>{const S=z,N=O,C=j,m=F,T=G,V=A,D=E,I=H;return f(),d(M(P),{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=_=>r.value=_),spinning:!1,disabled:""},{buttons:e(()=>[h("div",X,[n(T,{trigger:"hover",width:"trigger",options:w.value,onSelect:b},{default:e(()=>[n(m,{placement:"left"},{trigger:e(()=>[n(C,{dashed:"",class:q(["w-136px",o.value?"mr-16px":"mr-42px"]),onClick:t[0]||(t[0]=_=>b(-1))},{icon:e(()=>[h("div",Y,[n(S,{class:"text-18px"}),p(" "+L(w.value.filter(_=>_.key===l.value)[0].label)+" ",1),n(N,{icon:"material-symbols:expand-more-rounded"})])]),_:1},8,["class"])]),default:e(()=>[p(" 自动刷新频率 ")]),_:1})]),_:1},8,["options"]),o.value?(f(),d(m,{key:0,placement:"top"},{trigger:e(()=>[n(V,{class:"text-26px color-success"})]),default:e(()=>[p(" 流程批次加载完成 ")]),_:1})):(f(),d(m,{key:1},{trigger:e(()=>[n(I,{size:"small"},{icon:e(()=>[n(D)]),_:1})]),default:e(()=>[p(" 流程批次正在加载 ")]),_:1}))])]),_:1},8,["modelValue"])}}}),fe=J(Z,[["__scopeId","data-v-8354c50c"]]);export{fe as default};
