import{_ as me,a as _e,b as fe,N as ee}from"./search-form-CKlPFgxd.js";import{_ as be,a as ve,d as Se}from"./download-DQ5LX4-P.js";import{_ as he}from"./delete-alert-BnO1r6QD.js";import{d as F,a0 as E,a1 as Y,a2 as oe,z as we,A as ye,a as Ce,$ as o,r as ne,n as Ne,q as ke,c as A,o as x,w as n,f as t,I as De,h as e,C as xe,D as ae,E as Re,b as Q,a3 as Z,a4 as te,a5 as le,a6 as $e,a7 as Te,g as G,B as P,t as R,a8 as Ge,a9 as re,e as J,Z as ue,aa as H,ab as Ue,ac as se,ad as Ie,ae as Ae,L as Oe,af as Pe,ag as M,Q as Me,G as Be,ah as Ve,ai as Ee}from"./index-CW-HgCkC.js";import{f as Fe,a as je,b as ze,c as Le,d as qe,e as We}from"./group-Bv7in7Sf.js";import{_ as Je,u as Ke,a as Qe}from"./table-pZMqSpSu.js";import{_ as Ze}from"./status-switch.vue_vue_type_script_setup_true_lang-Dh5CX7zX.js";import{u as He}from"./auth-95bx-ara.js";import{_ as ie}from"./round-content-copy-gkE9hcwz.js";import{_ as Ye,a as Xe,b as et}from"./Grid-DNunwvuN.js";import{_ as tt,a as ot}from"./CollapseItem-_OeQO-9P.js";import{_ as nt,a as at}from"./DescriptionsItem-CtvncyNk.js";import"./Progress-z7wGZgIo.js";const lt=F({name:"GroupOperateDrawer",__name:"group-operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(N,{emit:w}){const g=N,y=w,_=Y(N,"visible"),{copy:c,isSupported:C}=oe(),{formRef:d,validate:k,restoreValidation:i}=we(),{defaultRequiredRule:f}=ye(),O=Ce(()=>({add:o("page.groupConfig.addGroupConfig"),edit:o("page.groupConfig.editGroupConfig")})[g.operateType]),b=ne([]),l=Ne(m());function m(){return{groupName:"",token:"SJ_Wyz3dmsdbDOkDujOTSSoBjGQP1BMsVnj",groupStatus:1,description:"",idGeneratorMode:2,initScene:1,groupPartition:0}}const j={groupName:[{required:!0,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:o("page.groupConfig.form.groupNameRule")}],token:[f],groupStatus:[f],idGeneratorMode:[f],initScene:[f],groupPartition:[f]};function z(){if(g.operateType==="add"){Object.assign(l,m());return}g.operateType==="edit"&&g.rowData&&Object.assign(l,g.rowData)}function B(){_.value=!1}async function V(){var v,u;if(await k(),g.operateType==="add"){const{groupName:r,token:a,groupStatus:s,description:D,idGeneratorMode:$,initScene:T,groupPartition:S}=l,{error:I}=await Fe({groupName:r,token:a,groupStatus:s,description:D,idGeneratorMode:$,initScene:T,groupPartition:S});if(I)return;(v=window.$message)==null||v.success(o("common.addSuccess"))}else{const{groupName:r,token:a,groupStatus:s,description:D,idGeneratorMode:$,initScene:T,groupPartition:S}=l,{error:I}=await je({groupName:r,token:a,groupStatus:s,description:D,idGeneratorMode:$,initScene:T,groupPartition:S});if(I)return;(u=window.$message)==null||u.success(o("common.updateSuccess"))}B(),y("submitted")}function U(){l.token=L(32)}function L(v){const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let r="SJ_";for(let a=0;a<v;a+=1){const s=Math.floor(Math.random()*u.length);r+=u.substring(s,s+1)}return r}const q=async()=>{const{data:v}=await ze();b.value=v.map(u=>String(u))};ke(_,()=>{_.value&&(q(),z(),i())});async function W(v){var u,r;if(!C){(u=window.$message)==null||u.error("您的浏览器不支持 Clipboard API");return}if(v){if(navigator.clipboard&&window.isSecureContext)await c(v);else{const a=document.createRange();a.selectNode(document.getElementById("tokenOperateInput"));const s=window.getSelection();s!=null&&s.rangeCount&&s.removeAllRanges(),s==null||s.addRange(a),document.execCommand("copy")}(r=window.$message)==null||r.success("复制成功")}}return(v,u)=>{const r=ae,a=xe,s=Xe,D=Re,$=Ye,T=ie,S=P,I=Te,h=me,pe=$e,X=ot,de=tt,ce=De,ge=re;return x(),A(ge,{modelValue:_.value,"onUpdate:modelValue":u[6]||(u[6]=p=>_.value=p),title:O.value,onSubmitted:V},{footer:n(()=>[t(D,{size:16},{default:n(()=>[t(S,{onClick:B},{default:n(()=>[G(R(e(o)("common.cancel")),1)]),_:1}),t(S,{type:"primary",onClick:V},{default:n(()=>[G(R(e(o)("common.save")),1)]),_:1})]),_:1})]),default:n(()=>[t(ce,{ref_key:"formRef",ref:d,model:l,rules:j},{default:n(()=>[t(de,{"default-expanded-names":["1","2"]},{default:n(()=>[t(X,{title:e(o)("page.groupConfig.commonConfig"),name:"1"},{default:n(()=>[t(a,{label:e(o)("page.groupConfig.groupName"),path:"groupName"},{default:n(()=>[t(r,{value:l.groupName,"onUpdate:value":u[0]||(u[0]=p=>l.groupName=p),maxlength:64,"show-count":"",placeholder:e(o)("page.groupConfig.form.groupName"),disabled:g.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),t(a,{label:e(o)("page.groupConfig.groupStatus"),path:"groupStatus"},{default:n(()=>[t($,{value:l.groupStatus,"onUpdate:value":u[1]||(u[1]=p=>l.groupStatus=p),name:"groupStatus"},{default:n(()=>[t(D,null,{default:n(()=>[(x(!0),Q(Z,null,te(e(le),p=>(x(),A(s,{key:p.value,value:p.value,label:e(o)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(a,{label:e(o)("page.groupConfig.token"),path:"token"},{default:n(()=>[t(pe,null,{default:n(()=>[t(r,{id:"tokenOperateInput",value:l.token,"onUpdate:value":u[2]||(u[2]=p=>l.token=p),maxlength:64,placeholder:e(o)("page.groupConfig.form.token"),disabled:g.operateType==="edit"},null,8,["value","placeholder","disabled"]),g.operateType==="edit"?(x(),A(I,{key:0,trigger:"hover"},{trigger:n(()=>[t(S,{type:"default",ghost:"",onClick:u[3]||(u[3]=p=>W(l.token))},{default:n(()=>[t(T,{class:"text-icon"})]),_:1})]),default:n(()=>[u[7]||(u[7]=G(" 复制 "))]),_:1})):(x(),A(I,{key:1,trigger:"hover"},{trigger:n(()=>[t(S,{type:"default",ghost:"",onClick:U},{default:n(()=>[t(h,{class:"text-icon"})]),_:1})]),default:n(()=>[G(" "+R(e(o)("page.groupConfig.generateToken")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),t(a,{label:e(o)("page.groupConfig.description"),path:"description"},{default:n(()=>[t(r,{value:l.description,"onUpdate:value":u[4]||(u[4]=p=>l.description=p),type:"textarea",maxlength:256,"show-count":"",placeholder:e(o)("page.groupConfig.form.description"),clearable:"",round:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),t(X,{title:e(o)("page.groupConfig.retryConfig"),name:"2"},{default:n(()=>[t(a,{label:e(o)("page.groupConfig.initScene"),path:"initScene"},{default:n(()=>[t($,{value:l.initScene,"onUpdate:value":u[5]||(u[5]=p=>l.initScene=p),name:"initScene"},{default:n(()=>[t(D,null,{default:n(()=>[(x(!0),Q(Z,null,te(e(Ge),p=>(x(),A(s,{key:p.value,value:p.value,label:e(o)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),rt={class:"flex items-center gap-2"},ut={id:"tokenDetailInput"},st=F({name:"GroupDetailDrawer",__name:"group-detail-drawer",props:E({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(N){const w=Y(N,"visible"),{copy:g,isSupported:y}=oe();async function _(c){var C,d;if(!y){(C=window.$message)==null||C.error("您的浏览器不支持 Clipboard API");return}if(c){if(navigator.clipboard&&window.isSecureContext)await g(c);else{const k=document.createRange();k.selectNode(document.getElementById("tokenDetailInput"));const i=window.getSelection();i!=null&&i.rangeCount&&i.removeAllRanges(),i==null||i.addRange(k),document.execCommand("copy")}(d=window.$message)==null||d.success("复制成功")}}return(c,C)=>{const d=at,k=ie,i=P,f=ue,O=nt,b=re;return x(),A(b,{modelValue:w.value,"onUpdate:modelValue":C[1]||(C[1]=l=>w.value=l),title:e(o)("page.groupConfig.detail")},{default:n(()=>[t(O,{"label-placement":"top",bordered:"",column:1},{default:n(()=>[t(d,{label:e(o)("page.groupConfig.groupName"),span:1},{default:n(()=>{var l;return[G(R((l=c.rowData)==null?void 0:l.groupName),1)]}),_:1},8,["label"]),t(d,{span:1},{label:n(()=>[J("div",rt,[J("span",null,R(e(o)("page.groupConfig.token")),1),t(i,{type:"default",text:"",onClick:C[0]||(C[0]=l=>{var m;return _((m=c.rowData)==null?void 0:m.token)})},{default:n(()=>[t(k,{class:"text-icon"})]),_:1})])]),default:n(()=>{var l;return[J("span",ut,R((l=c.rowData)==null?void 0:l.token),1)]}),_:1}),t(d,{label:e(o)("page.groupConfig.groupStatus"),span:1},{default:n(()=>{var l;return[t(f,{type:e(H)((l=c.rowData)==null?void 0:l.groupStatus)},{default:n(()=>{var m;return[G(R(e(o)(e(Ue)[(m=c.rowData)==null?void 0:m.groupStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(d,{label:e(o)("page.groupConfig.initScene"),span:1},{default:n(()=>{var l;return[t(f,{type:e(H)((l=c.rowData)==null?void 0:l.initScene)},{default:n(()=>{var m;return[G(R(e(o)(e(se)[(m=c.rowData)==null?void 0:m.initScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(d,{label:e(o)("page.groupConfig.description"),span:1},{default:n(()=>{var l;return[G(R((l=c.rowData)==null?void 0:l.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),it=F({name:"GroupSearch",__name:"group-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(N,{emit:w}){const g=w,y=Y(N,"model");function _(){g("reset")}function c(){g("search")}return(C,d)=>{const k=ae,i=Je,f=Ie,O=_e;return x(),A(O,{model:y.value,onSearch:c,onReset:_},{default:n(()=>[t(i,{span:"24 s:12 m:6",label:e(o)("page.groupConfig.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t(k,{value:y.value.groupName,"onUpdate:value":d[0]||(d[0]=b=>y.value.groupName=b),placeholder:e(o)("page.groupConfig.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(i,{span:"24 s:12 m:6",label:e(o)("page.groupConfig.groupStatus"),path:"groupStatus",class:"pr-24px"},{default:n(()=>[t(f,{value:y.value.groupStatus,"onUpdate:value":d[1]||(d[1]=b=>y.value.groupStatus=b),placeholder:e(o)("page.groupConfig.form.groupStatus"),options:e(Ae)(e(le)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),pt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Ee(N)}const Nt=F({name:"group",__name:"index",setup(N){const{hasAuth:w}=He(),g=Oe(),y=ne(),{bool:_,setTrue:c}=Pe(!1),{columns:C,columnChecks:d,data:k,getData:i,loading:f,mobilePagination:O,searchParams:b,resetSearchParams:l}=Ke({apiFn:Le,apiParams:{page:1,size:10,groupName:null,groupStatus:null},columns:()=>[{key:"id",title:o("common.index"),align:"center",width:64},{key:"groupName",title:o("page.groupConfig.groupName"),align:"center",minWidth:100,render:r=>{function a(){y.value=r||null,c()}return t(P,{text:!0,tag:"a",type:"primary",onClick:a,class:"ws-normal"},{default:()=>[r.groupName]})}},{key:"groupStatus",title:o("page.groupConfig.groupStatus"),align:"center",width:120,render:r=>{const a=async(s,D)=>{var S;const $=r.groupStatus===1?0:1,{error:T}=await qe({groupName:r.groupName,groupStatus:$});T||(r.groupStatus=s,(S=window.$message)==null||S.success(o("common.updateSuccess"))),D(!T)};return t(Ze,{value:r.groupStatus,"onUpdate:value":s=>r.groupStatus=s,onSubmitted:a,disabled:w("R_USER")},null)}},{key:"initScene",title:o("page.groupConfig.initScene"),align:"center",minWidth:120,render:r=>{if(r.groupStatus===null)return null;const a=o(se[r.initScene]);return t(ue,{type:H(r.initScene)},K(a)?a:{default:()=>[a]})}},{key:"updateDt",title:o("page.groupConfig.updateDt"),align:"center",width:120},{key:"description",title:o("page.groupConfig.description"),align:"center",width:250},{key:"operate",title:o("common.operate"),align:"center",width:120,render:r=>{let a;return w("R_USER")?t(Z,null,null):t("div",{class:"flex-center gap-8px"},[t(P,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>q(r.id)},K(a=o("common.edit"))?a:{default:()=>[a]}),t(Ve,{vertical:!0},null),t(ee,{onPositiveClick:()=>W(r.groupName)},{default:()=>o("common.confirmDelete"),trigger:()=>{let s;return t(P,{type:"error",text:!0,ghost:!0,size:"small"},K(s=o("common.delete"))?s:{default:()=>[s]})}})])}}]}),{drawerVisible:m,operateType:j,editingData:z,handleAdd:B,handleEdit:V,checkedRowKeys:U,onDeleted:L}=Qe(k,i);function q(r){V(r)}async function W(r){const{error:a}=await We(r);a||L()}function v(){return{groupName:b.groupName,groupStatus:b.groupStatus,groupIds:U.value}}function u(){Se("/group/export",v(),o("page.groupConfig.title"))}return(r,a)=>{const s=he,D=be,$=ve,T=fe,S=et,I=Be;return x(),Q("div",pt,[t(it,{model:e(b),"onUpdate:model":a[0]||(a[0]=h=>M(b)?b.value=h:null),onReset:e(l),onSearch:e(i)},null,8,["model","onReset","onSearch"]),t(s),t(I,{title:e(o)("page.groupConfig.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(T,{columns:e(d),"onUpdate:columns":a[1]||(a[1]=h=>M(d)?d.value=h:null),loading:e(f),"show-add":e(w)("R_ADMIN"),"show-delete":!1,onAdd:e(B),onRefresh:e(i)},{addAfter:n(()=>[e(w)("R_ADMIN")?(x(),A(D,{key:0,action:"/group/import",accept:"application/json",onRefresh:e(i)},null,8,["onRefresh"])):Me("",!0),t(e(ee),{onPositiveClick:u},{trigger:n(()=>[t(e(P),{size:"small",ghost:"",type:"primary",disabled:e(U).length===0&&e(w)("R_USER")},{icon:n(()=>[t($,{class:"text-icon"})]),default:n(()=>[G(" "+R(e(o)("common.export")),1)]),_:1},8,["disabled"])]),default:n(()=>[G(R(e(U).length===0?e(o)("common.exportAll"):e(o)("common.exportPar",{num:e(U).length})),1)]),_:1})]),_:1},8,["columns","loading","show-add","onAdd","onRefresh"])]),default:n(()=>[t(S,{"checked-row-keys":e(U),"onUpdate:checkedRowKeys":a[2]||(a[2]=h=>M(U)?U.value=h:null),columns:e(C),data:e(k),"flex-height":!e(g).isMobile,"scroll-x":962,loading:e(f),remote:"","row-key":h=>h.id,pagination:e(O),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(lt,{visible:e(m),"onUpdate:visible":a[3]||(a[3]=h=>M(m)?m.value=h:null),"operate-type":e(j),"row-data":e(z),onSubmitted:e(i)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(st,{visible:e(_),"onUpdate:visible":a[4]||(a[4]=h=>M(_)?_.value=h:null),"row-data":y.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Nt as default};
