import{a as A,b as G,N as O}from"./search-form-CGyqgbAn.js";import{d as C,a0 as T,a1 as I,c as M,o as U,ad as j,h as o,ae as q,av as K,$ as t,r as D,q as E,w as h,f as l,c1 as H,L as Z,bl as J,b as Q,ag as W,G as X,B as $,aw as Y,Z as P,ax as ee,aa as ae,a3 as te,ah as oe,ai as le}from"./index-D6me0eLt.js";import{f as ne,a as se,b as re,c as ce,d as ue}from"./workflow-BOpOsGMT.js";import{_ as ie,u as me,a as pe}from"./table-C2ZMKOSd.js";import{_ as de}from"./select-group.vue_vue_type_script_setup_true_lang-tjhrOmkT.js";import{_ as fe}from"./datetime-range.vue_vue_type_script_setup_true_lang--8uo3sed.js";import{_ as he}from"./AutoComplete-Cc0ZcSb9.js";import{b as ke}from"./Grid-CfmYRQfD.js";import"./CollapseItem-CBhFOVhp.js";import"./group-CBB4DW2_.js";const we=C({name:"TaskBatchStatus",__name:"task-batch-status",props:T({disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const k=c,p=I(c,"modelValue");return(_,d)=>{const s=j;return U(),M(s,{value:p.value,"onUpdate:value":d[0]||(d[0]=u=>p.value=u),placeholder:o(t)("common.taskBatchStatus.form"),options:o(q)(o(K)),disabled:k.disabled,clearable:k.clearable},null,8,["value","placeholder","options","disabled","clearable"])}}}),ge=C({name:"WorkflowBatchSearch",__name:"workflow-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:T(["reset","search"],["update:model"]),setup(c,{emit:k}){const p=D(!1),_=k,d=D([]),s=I(c,"model"),u=D(s.value.workflowName);function v(){u.value="",_("reset")}function B(){_("search")}async function w(){const r=await ne({keywords:u.value,groupName:s.value.groupName});d.value=r.data}function y(r){s.value.workflowId=r}E(()=>u.value,r=>{r.length!==0?w():p.value=!1});function x(r){return r.map(n=>({value:n.id,label:n.workflowName}))}function b(r){return[r.label,`(${r.value})`]}return(r,n)=>{const g=ie,N=he,R=A;return U(),M(R,{"btn-span":"12 s:24 m:10 l:12 xl:16",model:s.value,onSearch:B,onReset:v},{default:h(()=>[l(g,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.groupName"),path:"groupName",class:"pr-24px"},{default:h(()=>[l(de,{value:s.value.groupName,"onUpdate:value":n[0]||(n[0]=i=>s.value.groupName=i),clearable:""},null,8,["value"])]),_:1},8,["label"]),l(g,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.workflowName"),"label-width":100,path:"workflowName",class:"pr-24px"},{default:h(()=>[l(N,{value:u.value,"onUpdate:value":n[1]||(n[1]=i=>u.value=i),placeholder:o(t)("page.workflowBatch.form.workflowName"),options:x(d.value),"empty-visible":p.value,clearable:"",filterable:"","render-label":b,onSelect:y},null,8,["value","placeholder","options","empty-visible"])]),_:1},8,["label"]),l(g,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:h(()=>[l(we,{value:s.value.taskBatchStatus,"onUpdate:value":n[2]||(n[2]=i=>s.value.taskBatchStatus=i),clearable:""},null,8,["value"])]),_:1},8,["label"]),l(g,{span:"24 s:24 m:14 l:12 xl:8",label:o(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:h(()=>[l(fe,{value:s.value.datetimeRange,"onUpdate:value":n[3]||(n[3]=i=>s.value.datetimeRange=i)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),_e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function S(c){return typeof c=="function"||Object.prototype.toString.call(c)==="[object Object]"&&!le(c)}const $e=C({name:"workflow_batch",__name:"index",setup(c){const k=H(),p=Z(),_=history.state.workflowId,d=history.state.workflowName,s=history.state.taskBatchStatus,{columns:u,columnChecks:v,data:B,getData:w,loading:y,mobilePagination:x,searchParams:b,resetSearchParams:r}=me({apiFn:re,apiParams:{page:1,size:10,workflowId:null,workflowName:null,groupName:null,taskBatchStatus:null,datetimeRange:J()},searchParams:{workflowId:_,workflowName:d,taskBatchStatus:s},columns:()=>[{type:"selection"},{key:"id",title:t("common.index"),align:"center",width:120,render:e=>{function a(){F(e.id)}return l($,{text:!0,tag:"a",type:"primary",onClick:a,class:"ws-normal"},{default:()=>[e.id]})}},{key:"workflowName",title:t("page.workflowBatch.workflowName"),align:"center",minWidth:120},{key:"groupName",title:t("page.workflowBatch.groupName"),align:"center",minWidth:120},{key:"executionAt",title:t("page.workflowBatch.executionAt"),align:"center",minWidth:120},{key:"taskBatchStatus",title:t("page.workflowBatch.taskBatchStatus"),align:"center",minWidth:120,render:e=>{if(!e.taskBatchStatus)return null;const a={1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"},m=t(Y[e.taskBatchStatus]);return l(P,{type:a[e.taskBatchStatus]},S(m)?m:{default:()=>[m]})}},{key:"operationReason",title:t("page.workflowBatch.operationReason"),align:"center",minWidth:120,render:e=>{if(e.operationReason===null)return null;const a=t(ee[e.operationReason]);return l(P,{type:ae(e.operationReason)},S(a)?a:{default:()=>[a]})}},{key:"createDt",title:t("page.workflowBatch.createDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:e=>l("div",{class:"flex-center gap-8px"},[(e==null?void 0:e.taskBatchStatus)===1||(e==null?void 0:e.taskBatchStatus)===2?l(te,null,[l(O,{onPositiveClick:()=>V(e.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let a;return l($,{type:"error",text:!0,ghost:!0,size:"small"},S(a=t("common.stop"))?a:{default:()=>[a]})}}),l(oe,{vertical:!0},null)]):"",l(O,{onPositiveClick:()=>R(e.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let a;return l($,{type:"error",text:!0,ghost:!0,size:"small"},S(a=t("common.delete"))?a:{default:()=>[a]})}})])}]}),{checkedRowKeys:n,onDeleted:g,onBatchDeleted:N}=pe(B,w);async function R(e){const{error:a}=await ce(e);a||g()}async function i(){const{error:e}=await se(n.value);e||N()}async function V(e){var m;const{error:a}=await ue(e);a||((m=window.$message)==null||m.success(t("common.executeSuccess")),w())}function F(e){k.push({path:"/workflow/form/batch",query:{id:e}})}return(e,a)=>{const m=G,L=ke,z=X;return U(),Q("div",_e,[l(ge,{model:o(b),"onUpdate:model":a[0]||(a[0]=f=>W(b)?b.value=f:null),onReset:o(r),onSearch:o(w)},null,8,["model","onReset","onSearch"]),l(z,{title:o(t)("page.workflowBatch.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":h(()=>[l(m,{columns:o(v),"onUpdate:columns":a[1]||(a[1]=f=>W(v)?v.value=f:null),"disabled-delete":o(n).length===0,loading:o(y),"show-add":!1,onDelete:i,onRefresh:o(w)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:h(()=>[l(L,{"checked-row-keys":o(n),"onUpdate:checkedRowKeys":a[2]||(a[2]=f=>W(n)?n.value=f:null),columns:o(u),data:o(B),"flex-height":!o(p).isMobile,"scroll-x":962,loading:o(y),remote:"","row-key":f=>f.id,pagination:o(x),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{$e as default};
