import{_ as Q}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CAikEgod.js";import{bj as S,o as x,b as V,e as X,d as B,U as G,V as q,p as I,i as Y,c as A,w as n,f as l,h as t,$ as a,a1 as z,a3 as Z,g as m,t as f,a4 as M,cv as P,N as W,s as ee,a8 as te,a9 as T,B as R,I as ae,aa as oe}from"./index-DydImCNJ.js";import{_ as le,u as re,a as ne,N as se}from"./table-BB81mEh2.js";import{_ as ie}from"./search-form.vue_vue_type_script_setup_true_lang-G2vaTHhL.js";import{e as de}from"./group-DHxaJaDV.js";import{f as ce}from"./retry-scene-OT8iOQeb.js";import{_ as ue}from"./operate-drawer-B2Yn2ELy.js";import{_ as pe,a as me}from"./DescriptionsItem-BKhQ5GOr.js";import{b as fe}from"./Grid-C0ryvMLX.js";import"./Space-HTlydpS2.js";import"./form-CXP3EjI2.js";import"./round-search-BN-yNV5a.js";import"./close-fullscreen-rounded-Cdf1DUar.js";function ge(s){return S({url:"/retry-dead-letter/list",method:"get",params:s})}function _e(s,g){return S({url:`/retry-dead-letter/${s}?groupName=${g}`,method:"get"})}function C(s){return S({url:"/retry-dead-letter/batch/rollback",method:"post",data:s})}function U(s){return S({url:"/retry-dead-letter/batch",method:"delete",data:s})}const ye={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},be=X("path",{fill:"currentColor",d:"M20.93 14A7.002 7.002 0 0 1 14 20H5.5v-2H14a5 5 0 1 0 0-10H6.914l2.5 2.5L8 11.914L3.086 7L8 2.086L9.414 3.5L6.914 6H14a7 7 0 0 1 7 7v1z"},null,-1),he=[be];function Ne(s,g){return x(),V("svg",ye,[...he])}const ke={name:"tdesign-rollback",render:Ne},De=B({name:"RetryDeadLetterSearch",__name:"dead-letter-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(s,{emit:g}){const i=g,c=q(s,"model"),d=I([]),b=I([]);async function h(){const k=await de();d.value=k.data}async function D(k){if(k){const u=await ce({groupName:k});b.value=u.data.map(v=>v.sceneName)}else c.value.sceneName="",b.value=[]}function e(){i("reset")}function N(){i("search")}return Y(()=>{h()}),(k,u)=>{const v=Z,L=le,y=ie;return x(),A(y,{model:c.value,onSearch:N,onReset:e},{default:n(()=>[l(L,{span:"24 s:12 m:6",label:t(a)("page.retryDeadLetter.groupName"),path:"groupName",class:"py-1 pr-24px"},{default:n(()=>[l(v,{value:c.value.groupName,"onUpdate:value":[u[0]||(u[0]=w=>c.value.groupName=w),D],placeholder:t(a)("page.retryDeadLetter.form.groupName"),options:t(z)(d.value),clearable:"",filterable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),l(L,{span:"24 s:12 m:6",label:t(a)("page.retryDeadLetter.sceneName"),path:"sceneName",class:"py-1 pr-24px"},{default:n(()=>[l(v,{value:c.value.sceneName,"onUpdate:value":u[1]||(u[1]=w=>c.value.sceneName=w),placeholder:t(a)("page.retryDeadLetter.form.sceneName"),options:t(z)(b.value),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ve=B({name:"RetryDeadLetterDetailDrawer",__name:"retry-letter-detail-drawer",props:G({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(s){const g=q(s,"visible");return(i,c)=>{const d=pe,b=W,h=me,D=ue;return x(),A(D,{modelValue:g.value,"onUpdate:modelValue":c[0]||(c[0]=e=>g.value=e),title:t(a)("page.retryDeadLetter.detail")},{default:n(()=>[l(h,{"label-placement":"top",bordered:"",column:3},{default:n(()=>[l(d,{label:t(a)("page.retryTask.uniqueId"),span:3},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.uniqueId),1)]}),_:1},8,["label"]),l(d,{label:t(a)("page.retryTask.groupName"),span:3},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.groupName),1)]}),_:1},8,["label"]),l(d,{label:t(a)("page.retryTask.sceneName"),span:3},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.sceneName),1)]}),_:1},8,["label"]),l(d,{label:t(a)("page.retryTask.taskType"),span:1},{default:n(()=>{var e;return[l(b,{type:t(M)((e=i.rowData)==null?void 0:e.taskType)},{default:n(()=>{var N;return[m(f(t(a)(t(P)[(N=i.rowData)==null?void 0:N.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),l(d,{label:t(a)("page.retryTask.bizNo"),span:2},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.bizNo),1)]}),_:1},8,["label"]),l(d,{label:t(a)("page.retryTask.idempotentId"),span:3},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.idempotentId),1)]}),_:1},8,["label"]),l(d,{label:t(a)("page.retryTask.executorName"),span:3},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.executorName),1)]}),_:1},8,["label"]),l(d,{label:t(a)("page.retryTask.argsStr"),span:3},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.argsStr),1)]}),_:1},8,["label"]),l(d,{label:t(a)("common.createDt"),span:3},{default:n(()=>{var e;return[m(f((e=i.rowData)==null?void 0:e.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),we={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function $(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!oe(s)}const qe=B({name:"retry_dead-letter",__name:"index",setup(s){const g=ee(),i=I(),{bool:c,setTrue:d}=te(!1),{columns:b,columnChecks:h,data:D,getData:e,loading:N,mobilePagination:k,searchParams:u,resetSearchParams:v}=re({apiFn:ge,apiParams:{page:1,size:10},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:a("common.index"),align:"center",width:64},{key:"uniqueId",title:a("page.retryDeadLetter.uniqueId"),align:"left",minWidth:120,render:r=>{async function o(){await j(r),d()}return l(R,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[r.uniqueId]})}},{key:"groupName",title:a("page.retryDeadLetter.groupName"),align:"left",minWidth:120},{key:"sceneName",title:a("page.retryDeadLetter.sceneName"),align:"left",minWidth:120},{key:"idempotentId",title:a("page.retryDeadLetter.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:a("page.retryDeadLetter.bizNo"),align:"left",minWidth:120},{key:"taskType",title:a("page.retryDeadLetter.taskType"),align:"left",minWidth:120,render:r=>{if(r.taskType===null)return null;const o=a(P[r.taskType]);return l(W,{type:M(r.taskType)},$(o)?o:{default:()=>[o]})}},{key:"createDt",title:a("page.retryDeadLetter.createDt"),align:"left",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",width:130,render:r=>{let o;return l("div",{class:"flex-center gap-8px"},[l(R,{type:"primary",ghost:!0,size:"small",onClick:()=>F(r)},$(o=a("common.rollback"))?o:{default:()=>[o]}),l(se,{onPositiveClick:()=>H(r)},{default:()=>a("common.confirmDelete"),trigger:()=>{let p;return l(R,{type:"error",ghost:!0,size:"small"},$(p=a("common.delete"))?p:{default:()=>[p]})}})])}}]}),{handleAdd:L,checkedRowKeys:y}=ne(D,e);async function w(){var o;const{error:r}=await U({ids:y.value,groupName:u.groupName});r||((o=window.$message)==null||o.success(a("common.deleteSuccess")),e())}async function O(){var o;const{error:r}=await C({ids:y.value,groupName:u.groupName});r||((o=window.$message)==null||o.success(a("common.rollbackSuccess")),e())}async function H(r){var p;const{error:o}=await U({ids:[r.id],groupName:r.groupName});o||((p=window.$message)==null||p.success(a("common.deleteSuccess")),e())}async function j(r){const o=await _e(r.id,r.groupName);i.value=o.data||null}async function F(r){var p;const{error:o}=await C({ids:[r.id],groupName:r.groupName});o||((p=window.$message)==null||p.success(a("common.rollbackSuccess")),e())}return(r,o)=>{const p=ke,K=Q,E=fe,J=ae;return x(),V("div",we,[l(De,{model:t(u),"onUpdate:model":o[0]||(o[0]=_=>T(u)?u.value=_:null),onReset:t(v),onSearch:t(e)},null,8,["model","onReset","onSearch"]),l(J,{title:t(a)("page.retryDeadLetter.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":n(()=>[l(K,{columns:t(h),"onUpdate:columns":o[1]||(o[1]=_=>T(h)?h.value=_:null),"disabled-delete":t(y).length===0,loading:t(N),onAdd:t(L),onDelete:w,onRefresh:t(e)},{addAfter:n(()=>[l(t(R),{size:"small",ghost:"",type:"primary",onClick:O},{icon:n(()=>[l(p,{class:"text-icon"})]),default:n(()=>[m(" "+f(t(a)("common.batchRollback")),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[l(E,{"checked-row-keys":t(y),"onUpdate:checkedRowKeys":o[2]||(o[2]=_=>T(y)?y.value=_:null),columns:t(b),data:t(D),"flex-height":!t(g).isMobile,"scroll-x":962,loading:t(N),remote:"","row-key":_=>_.id,pagination:t(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),l(ve,{visible:t(c),"onUpdate:visible":o[3]||(o[3]=_=>T(c)?c.value=_:null),"row-data":i.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{qe as default};
