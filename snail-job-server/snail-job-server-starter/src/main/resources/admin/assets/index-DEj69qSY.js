import{_ as A,u as E,a as K,N as G,b as H}from"./table-Bdl3-G-Y.js";import{bi as R,d as P,U as M,V as O,o as I,c as T,w as r,f as l,h as t,$ as a,n as J,p as U,bk as Q,g as f,t as y,a8 as x,cz as j,cy as F,N as C,bg as X,cd as Y,bh as Z,s as ee,ac as te,b as ae,ad as S,B as W,I as le,ae as oe}from"./index-CHgAHQIl.js";import{_ as ne}from"./search-form.vue_vue_type_script_setup_true_lang-BfZ4by1v.js";import{_ as re}from"./select-group.vue_vue_type_script_setup_true_lang-fZ9yr9an.js";import{_ as se}from"./select-scene.vue_vue_type_script_setup_true_lang-DkFHmVNh.js";import{_ as ie}from"./detail-drawer-CWz6q5KO.js";import{_ as ue,a as pe}from"./log-BNPnMg-G.js";import{_ as de,a as me}from"./DescriptionsItem-sCQ7QkHp.js";import{_ as ce}from"./Grid-DHGKk79k.js";import"./FormItem-B3tfy17D.js";import"./Space-CeVCCXQI.js";import"./round-search-KK91k1IY.js";import"./form-BuwwOwyC.js";import"./group-BUALrrKR.js";import"./retry-scene-BlErNK4f.js";import"./close-fullscreen-rounded-DtEdfPev.js";function ge(u){return R({url:"/retry-task-log/list",method:"get",params:u})}function fe(u){return R({url:`/retry-task-log/${u}`,method:"get"})}function ye(u){return R({url:`/retry-task-log/${u}`,method:"delete"})}function _e(u){return R({url:"/retry-task-log/ids",method:"delete",data:u})}const be=P({name:"RetryLogSearch",__name:"retry-log-search",props:{model:{required:!0},modelModifiers:{}},emits:M(["reset","search"],["update:model"]),setup(u,{emit:N}){const b=N,s=O(u,"model");function v(){b("reset")}function k(){b("search")}return(h,p)=>{const m=A,_=J,D=ne;return I(),T(D,{model:s.value,onSearch:k,onReset:v},{default:r(()=>[l(m,{span:"24 s:12 m:6",label:t(a)("page.retryLog.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[l(re,{value:s.value.groupName,"onUpdate:value":p[0]||(p[0]=d=>s.value.groupName=d)},null,8,["value"])]),_:1},8,["label"]),l(m,{span:"24 s:12 m:6",label:t(a)("page.retryLog.sceneName"),path:"sceneName",class:"pr-24px"},{default:r(()=>[l(se,{value:s.value.sceneName,"onUpdate:value":p[1]||(p[1]=d=>s.value.sceneName=d),"group-name":s.value.groupName},null,8,["value","group-name"])]),_:1},8,["label"]),l(m,{span:"24 s:12 m:6",label:t(a)("page.retryLog.UniqueId"),path:"UniqueId",class:"pr-24px"},{default:r(()=>[l(_,{value:s.value.uniqueId,"onUpdate:value":p[2]||(p[2]=d=>s.value.uniqueId=d),placeholder:t(a)("page.retryLog.form.UniqueId")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{span:"24 s:12 m:6",label:t(a)("page.retryLog.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:r(()=>[l(_,{value:s.value.idempotentId,"onUpdate:value":p[3]||(p[3]=d=>s.value.idempotentId=d),placeholder:t(a)("page.retryLog.form.idempotentId")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(m,{span:"24 s:12 m:6",label:t(a)("page.retryLog.bizNo"),path:"bizNo",class:"pr-24px"},{default:r(()=>[l(_,{value:s.value.bizNo,"onUpdate:value":p[4]||(p[4]=d=>s.value.bizNo=d),placeholder:t(a)("page.retryLog.form.bizNo")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ve=P({name:"SceneDetailDrawer",__name:"retry-log-detail-drawer",props:M({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(u){const N=u,b=O(u,"visible"),s=U([]),v=U(),k=new AbortController,h=U(!1);let p="0",m=0;async function _(){const{data:i,error:g}=await pe({groupName:N.rowData.groupName,uniqueId:N.rowData.uniqueId,startId:p,fromIndex:m,size:50});g||(h.value=i.finished,p=i.nextStartId,m=i.fromIndex,i.message&&(s.value.push(...i.message),s.value.sort((c,w)=>Number.parseInt(c.time_stamp,10)-Number.parseInt(w.time_stamp,10))),h.value||(clearTimeout(v.value),v.value=setTimeout(_,1e3)))}const D=async i=>{i===1&&s.value.length===0&&await _()},d=()=>{h.value=!0,k.abort(),clearTimeout(v.value),v.value=void 0};return Q(()=>{d()}),(i,g)=>{const c=de,w=C,$=me,n=X,o=ue,q=Y,z=Z,B=ie;return I(),T(B,{modelValue:b.value,"onUpdate:modelValue":g[1]||(g[1]=e=>b.value=e),title:t(a)("page.retryLog.detail"),width:["50%","90%"]},{default:r(()=>[l(z,{type:"segment",animated:"","onUpdate:value":D},{default:r(()=>[l(n,{name:0,tab:t(a)("page.log.info")},{default:r(()=>[l($,{"label-placement":"top",bordered:"",column:2},{default:r(()=>[l(c,{label:t(a)("page.retryLog.UniqueId"),span:2},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.uniqueId),1)]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryLog.groupName"),span:2},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.groupName),1)]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryLog.sceneName"),span:2},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.sceneName),1)]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryLog.retryStatus"),span:1},{default:r(()=>{var e;return[l(w,{type:t(x)((e=i.rowData)==null?void 0:e.retryStatus)},{default:r(()=>{var L;return[f(y(t(a)(t(j)[(L=i.rowData)==null?void 0:L.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryLog.taskType"),span:1},{default:r(()=>{var e;return[l(w,{type:t(x)((e=i.rowData)==null?void 0:e.taskType)},{default:r(()=>{var L;return[f(y(t(a)(t(F)[(L=i.rowData)==null?void 0:L.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryLog.bizNo"),span:2},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.bizNo),1)]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryLog.idempotentId"),span:2},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.idempotentId),1)]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryTask.executorName"),span:2},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.executorName),1)]}),_:1},8,["label"]),l(c,{label:t(a)("page.retryTask.argsStr"),span:2},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.argsStr),1)]}),_:1},8,["label"]),l(c,{label:t(a)("common.createDt")},{default:r(()=>{var e;return[f(y((e=i.rowData)==null?void 0:e.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),l(n,{name:1,tab:t(a)("page.log.title"),"display-directive":"if"},{default:r(()=>[s.value.length>0?(I(),T(o,{key:0,modelValue:s.value,"onUpdate:modelValue":g[0]||(g[0]=e=>s.value=e),drawer:!1},null,8,["modelValue"])):(I(),T(q,{key:1,class:"h-full"}))]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),he={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function V(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!oe(u)}const Ce=P({name:"retry_log",__name:"index",setup(u){const N=ee(),b=U(),{bool:s,setTrue:v}=te(!1),{columns:k,columnChecks:h,data:p,getData:m,loading:_,mobilePagination:D,searchParams:d,resetSearchParams:i}=E({apiFn:ge,apiParams:{page:1,size:10,uniqueId:null,groupName:null,sceneName:null,idempotentId:null,bizNo:null},columns:()=>[{type:"selection",align:"center",width:48,disabled:n=>n.retryStatus!==1},{key:"index",title:a("common.index"),align:"center",width:64},{key:"uniqueId",title:a("page.retryLog.UniqueId"),align:"left",minWidth:120,render:n=>{async function o(){await $(n),v()}return l(W,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[n.uniqueId]})}},{key:"groupName",title:a("page.retryLog.groupName"),align:"left",minWidth:120},{key:"sceneName",title:a("page.retryLog.sceneName"),align:"left",minWidth:120},{key:"retryStatus",title:a("page.retryLog.retryStatus"),align:"left",minWidth:120,render:n=>{if(n.retryStatus===null)return null;const o=a(j[n.retryStatus]);return l(C,{type:x(n.retryStatus)},V(o)?o:{default:()=>[o]})}},{key:"taskType",title:a("page.retryLog.taskType"),align:"left",minWidth:120,render:n=>{if(n.taskType===null)return null;const o=a(F[n.taskType]);return l(C,{type:x(n.taskType)},V(o)?o:{default:()=>[o]})}},{key:"idempotentId",title:a("page.retryLog.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:a("page.retryLog.bizNo"),align:"left",minWidth:120},{key:"createDt",title:a("page.retryLog.createDt"),align:"left",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",width:130,render:n=>l("div",{class:"flex-center gap-8px"},[n.retryStatus===1?l(G,{onPositiveClick:()=>w(n.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let o;return l(W,{type:"error",text:!0,ghost:!0,size:"small"},V(o=a("common.delete"))?o:{default:()=>[o]})}}):""])}]}),{checkedRowKeys:g}=K(p,m);async function c(){var o;const{error:n}=await _e(g.value);n||((o=window.$message)==null||o.success(a("common.deleteSuccess")),m())}async function w(n){var o;await ye(n),(o=window.$message)==null||o.success(a("common.deleteSuccess")),m()}async function $(n){const o=await fe(n.id);b.value=o.data||null}return(n,o)=>{const q=H,z=ce,B=le;return I(),ae("div",he,[l(be,{model:t(d),"onUpdate:model":o[0]||(o[0]=e=>S(d)?d.value=e:null),onReset:t(i),onSearch:t(m)},null,8,["model","onReset","onSearch"]),l(B,{title:t(a)("page.retryLog.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":r(()=>[l(q,{columns:t(h),"onUpdate:columns":o[1]||(o[1]=e=>S(h)?h.value=e:null),"disabled-delete":t(g).length===0,loading:t(_),"show-add":!1,onDelete:c,onRefresh:t(m)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:r(()=>[l(z,{"checked-row-keys":t(g),"onUpdate:checkedRowKeys":o[2]||(o[2]=e=>S(g)?g.value=e:null),columns:t(k),data:t(p),"flex-height":!t(N).isMobile,"scroll-x":962,loading:t(_),remote:"","row-key":e=>e.id,pagination:t(D),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),l(ve,{visible:t(s),"onUpdate:visible":o[3]||(o[3]=e=>S(s)?s.value=e:null),"row-data":b.value},null,8,["visible","row-data"])])}}});export{Ce as default};
