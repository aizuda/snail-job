import{a as z,b as F,N as J}from"./search-form-2lTL1-HK.js";import{d as D,a0 as U,a1 as E,c as C,o as V,w as d,f as e,h as r,$ as s,z as L,n as K,q as W,H as q,C as H,D as A,ad as G,ae as Z,b2 as Q,E as X,B,g as x,t as R,a9 as Y,K as ee,b as te,ag as j,F as ae,a7 as ne,b3 as le,Z as c,a3 as M,N as oe,ay as se,ah as re,ai as ie}from"./index-C0p55rrf.js";import{d as ue,e as pe,g as de}from"./dashboard-CJiJ5IBm.js";import{_ as ce,u as me,a as fe}from"./table-B8N7pgiA.js";import{L as ge}from"./label-list-Clk3Q1a1.js";import{_ as _e}from"./select-group.vue_vue_type_script_setup_true_lang-BHwrakTI.js";import{_ as ye}from"./labels-input.vue_vue_type_script_setup_true_lang-B_oS-ADO.js";import{b as be}from"./Grid-DvIYbIW9.js";import"./CollapseItem-BWVJFROc.js";import"./DynamicTags-CJUeOSLO.js";import"./group-Bzk_FTzz.js";import"./DynamicInput-IPp7NvjD.js";const he=D({name:"PodsSearch",__name:"pods-search",props:{model:{required:!0},modelModifiers:{}},emits:U(["reset","search"],["update:model"]),setup(_,{emit:S}){const v=S,y=E(_,"model");function g(){v("reset")}function b(){v("search")}return(T,k)=>{const n=ce,O=z;return V(),C(O,{model:y.value,onSearch:b,onReset:g},{default:d(()=>[e(n,{span:"24 s:12 m:6",label:r(s)("page.pods.groupName"),path:"groupName",class:"pr-24px"},{default:d(()=>[e(_e,{value:y.value.groupName,"onUpdate:value":k[0]||(k[0]=P=>y.value.groupName=P),placeholder:r(s)("page.pods.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ve=D({name:"PodsOperateDrawer",__name:"pods-operate-drawer",props:U({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:U(["submitted"],["update:visible"]),setup(_,{emit:S}){const v=_,y=S,g=E(_,"visible"),{formRef:b,validate:T,restoreValidation:k}=L(),n=K(O());function O(){return{id:"",labels:"{}",labelMap:[],nodeType:1,groupName:"",hostIp:"",hostPort:""}}function P(){n.labelMap=[],Object.assign(n,v.rowData),n.labels&&(n.labelMap=Object.entries(JSON.parse(n.labels)).filter(([m,i])=>m!=="state").map(([m,i])=>({key:m,value:i})))}async function N(){var h,t;await T();const m={};(h=n.labelMap)==null||h.forEach(a=>{m[a.key]=a.value});const{error:i}=await ue({id:n.id,labels:JSON.stringify(m)});i||((t=window.$message)==null||t.success(s("common.updateSuccess")),$(),y("submitted"))}function $(){g.value=!1}return W(g,()=>{g.value&&(P(),k())}),(m,i)=>{const h=A,t=H,a=G,l=ye,p=q,u=B,o=X;return V(),C(Y,{modelValue:g.value,"onUpdate:modelValue":i[6]||(i[6]=w=>g.value=w),"min-size":480,title:"编辑在线机器"},{footer:d(()=>[e(o,{size:16},{default:d(()=>[e(u,{onClick:$},{default:d(()=>[x(R(r(s)("common.cancel")),1)]),_:1}),e(u,{type:"primary",onClick:N},{default:d(()=>[x(R(r(s)("common.save")),1)]),_:1})]),_:1})]),default:d(()=>[e(p,{ref_key:"formRef",ref:b,model:n},{default:d(()=>{var w;return[e(t,{label:"ID",path:"id"},{default:d(()=>[e(h,{value:n.id,"onUpdate:value":i[0]||(i[0]=f=>n.id=f),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"类型",path:"nodeType"},{default:d(()=>[e(a,{value:n.nodeType,"onUpdate:value":i[1]||(i[1]=f=>n.nodeType=f),options:r(Z)(r(Q)),disabled:""},null,8,["value","options"])]),_:1}),e(t,{label:"组名称",path:"groupName"},{default:d(()=>[e(h,{value:n.groupName,"onUpdate:value":i[2]||(i[2]=f=>n.groupName=f),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"IP",path:"hostIp"},{default:d(()=>[e(h,{value:n.hostIp,"onUpdate:value":i[3]||(i[3]=f=>n.hostIp=f),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"端口",path:"hostPort"},{default:d(()=>[e(h,{value:n.hostPort,"onUpdate:value":i[4]||(i[4]=f=>n.hostPort=f),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"标签",path:"labelMap","show-feedback":!((w=n.labelMap)!=null&&w.length)},{default:d(()=>[e(l,{value:n.labelMap,"onUpdate:value":i[5]||(i[5]=f=>n.labelMap=f),path:"labelMap"},null,8,["value"])]),_:1},8,["show-feedback"])]}),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function I(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!ie(_)}const Be=D({name:"pods",__name:"index",setup(_){const S=ee(),{columns:v,columnChecks:y,data:g,getData:b,loading:T,mobilePagination:k,searchParams:n,resetSearchParams:O}=me({apiFn:pe,apiParams:{page:1,size:10,groupName:null},columns:()=>[{key:"hostId",title:s("page.pods.hostId"),align:"center",width:80,render:t=>{function a(p,u=4,o=4){if(!p)return"";const w=u+o+3;return p.length<=w?p:`${p.slice(0,u)}...${p.slice(-o)}`}const l=a(t.hostId,4,4);return e(ne,null,{trigger:()=>e("span",{style:"max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: inline-block; vertical-align: middle;"},[l]),default:()=>t.hostId})}},{key:"nodeType",title:s("page.pods.nodeType"),align:"center",width:80,render:t=>{if(t.nodeType===null)return null;const a={1:"info",2:"primary"},l=s(le[t.nodeType]);return e(c,{type:a[t.nodeType]},I(l)?l:{default:()=>[l]})}},{key:"groupName",title:s("page.pods.groupName"),align:"center",width:120,resizable:!0,minWidth:120,maxWidth:200},{key:"labels",title:s("page.pods.labels"),align:"center",width:140,render:t=>e(ge,{id:t.id,labels:t.labels},null)},{key:"hostIp",title:s("page.pods.hostIp"),align:"center",width:120,render:t=>`${t.hostIp}:${t.hostPort}`},{key:"nodeStatus",title:"状态",align:"center",width:60,render:t=>{if(!t.labels||t.nodeType===2)return e(c,{type:"success"},{default:()=>[x("up")]});const l=JSON.parse(t.labels||"{}").state||"",u={up:"success",down:"error"}[l]||"default";return e(c,{type:u},I(l)?l:{default:()=>[l]})}},{key:"consumerBuckets",title:s("page.pods.consumerBuckets"),align:"center",width:100,render:t=>{if(t.nodeType===null)return null;const a=t.consumerBuckets||[];return t.nodeType===1?e(M,null,[x("Path: "),e(c,{type:"info"},{default:()=>[t.contextPath??"/"]})]):a.length===0?null:a.length===1?e(M,null,[e("span",null,[x("Bucket: ")]),e(c,{type:"info",class:"m-1 justify-center"},{default:()=>[a[0]]})]):a.length===2?e(M,null,[e(c,{type:"info",class:"m-1 justify-center"},{default:()=>[a[0]]}),e(c,{type:"info",class:"m-1 justify-center"},{default:()=>[a[1]]})]):e(M,null,[e(c,{type:"info",class:"m-1 justify-center"},{default:()=>[a[0]]}),e(oe,{trigger:"hover",placement:"top"},{trigger:()=>e(c,{type:"info",class:"m-1 justify-center"},{default:()=>[x("...")]}),default:()=>e("div",{class:"grid grid-cols-16"},[a.map(l=>e(c,{type:"info",key:l,class:"m-1 justify-center"},I(l)?l:{default:()=>[l]}))])}),e(c,{type:"info",class:"m-1 justify-center"},{default:()=>[a[a.length-1]]})])}},{key:"executorType",title:s("page.pods.executorType"),align:"center",width:80,render:t=>{const a=JSON.parse(t.extAttrs||"{}");if((o=>Object.keys(o).length===0&&o.constructor===Object)(a)||a===null)return null;const p=a==null?void 0:a.executorType,u=p?s(se[p]):s("common.none");return e(c,{type:"info"},I(u)?u:{default:()=>[u]})}},{key:"systemVersion",title:s("page.pods.systemVersion"),align:"center",width:80,render:t=>{const a=JSON.parse(t.extAttrs||"{}");return(p=>Object.keys(p).length===0&&p.constructor===Object)(a)||a===null?null:e(c,{type:"info"},{default:()=>[(a==null?void 0:a.systemVersion)||s("common.none")]})}},{key:"updateDt",title:s("page.pods.updateDt"),align:"center",width:100},{key:"operate",title:s("common.operate"),align:"center",width:80,render:t=>{const a=()=>{let u;return t.nodeType===2?null:e(B,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>h(t.id)},I(u=s("common.edit"))?u:{default:()=>[u]})},l=()=>{if(!t.labels||t.nodeType===2)return null;const u=JSON.parse(t.labels||"{}");let o;return u.state==="up"?o=2:o=1,e(J,{onPositiveClick:()=>P(t.id,o)},{default:()=>o===1?s("page.pods.online"):s("page.pods.offline"),trigger:()=>e(B,{type:"error",text:!0,ghost:!0,size:"small"},{default:()=>[o===1?s("page.pods.online"):s("page.pods.offline")]})})},p=[a(),l()];return e("div",{class:"flex-center gap-8px"},[p.filter(Boolean).map((u,o)=>e(M,null,[o!==0&&e(re,{vertical:!0},null),u]))])}}]});async function P(t,a){const{error:l}=await de({id:t,serverNodeStatus:a});l||b()}const{checkedRowKeys:N,handleEdit:$,drawerVisible:m,editingData:i}=fe(g,b);function h(t){$(t)}return(t,a)=>{const l=F,p=be,u=ae;return V(),te("div",ke,[e(he,{model:r(n),"onUpdate:model":a[0]||(a[0]=o=>j(n)?n.value=o:null),onReset:r(O),onSearch:r(b)},null,8,["model","onReset","onSearch"]),e(u,{title:r(s)("page.pods.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":d(()=>[e(l,{columns:r(y),"onUpdate:columns":a[1]||(a[1]=o=>j(y)?y.value=o:null),"disabled-delete":r(N).length===0,loading:r(T),"show-add":!1,"show-delete":!1,onRefresh:r(b)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:d(()=>[e(p,{"checked-row-keys":r(N),"onUpdate:checkedRowKeys":a[2]||(a[2]=o=>j(N)?N.value=o:null),columns:r(v),data:r(g),"flex-height":!r(S).isMobile,"scroll-x":962,loading:r(T),remote:"","row-key":o=>o.hostId,pagination:r(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(ve,{visible:r(m),"onUpdate:visible":a[3]||(a[3]=o=>j(m)?m.value=o:null),"row-data":r(i),onSubmitted:r(b)},null,8,["visible","row-data","onSubmitted"])])}}});export{Be as default};
