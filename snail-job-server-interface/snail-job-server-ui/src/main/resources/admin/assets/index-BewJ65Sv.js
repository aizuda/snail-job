import{a as le,b as ne,N as A}from"./search-form-CSouas8Y.js";import{d as z,Z as E,r as T,a0 as K,p as se,c as q,o as P,w as n,f as e,h as a,$ as t,ac as re,ad as ue,au as ie,b as H,a2 as V,as as ce,at as pe,g as w,t as j,Y as I,a9 as L,av as Y,aw as Z,ax as me,j as de,J as fe,ae as F,ay as be,P as ge,af as C,E as he,B as U,a6 as _e,_ as ve,az as ye,aA as G,ag as O,ah as ke}from"./index-DsXulf34.js";import{_ as Be,f as Q,a as we,b as je,c as Se,d as De}from"./job-task-list-table.vue_vue_type_script_setup_true_lang-wvbV9UtV.js";import{_ as Ne,u as xe,a as Re}from"./table-C5lzqi4D.js";import{f as Te}from"./job-DnRsninN.js";import{_ as $e}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{_ as Je}from"./datetime-range.vue_vue_type_script_setup_true_lang-BX2GIQW5.js";import{_ as Ce}from"./AutoComplete-BGx6szdi.js";import{_ as Ue}from"./log-drawer-C3TDW99Z.js";import{_ as Ie}from"./detail-drawer-BuPycGzQ.js";import{_ as Le,a as Pe}from"./DescriptionsItem-BEs7Hiy4.js";import{b as Me}from"./Grid-DdJm4X1d.js";import"./CollapseItem-4hJT8hQy.js";import"./group-DephWMPB.js";import"./DatePicker-B2fzTH2d.js";const Ae=z({name:"JobBatchSearch",__name:"job-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(g,{emit:$}){const h=T(!1),f=$,_=T([]),u=K(g,"model"),b=T(u.value.jobName);function s(){b.value="",f("reset")}function y(){f("search")}async function p(){const r=await Te({keywords:b.value,groupName:u.value.groupName});_.value=r.data}function v(r){u.value.jobId=r}se(()=>b.value,r=>{r.length!==0?(p(),u.value.jobName=r):(h.value=!1,u.value.jobId=null,u.value.jobName=null)});function J(r){return r.map(i=>({value:i.id,label:i.jobName}))}function S(r){return[r.label,`(${r.value})`]}return(r,i)=>{const k=Ne,D=Ce,N=re,x=le;return P(),q(x,{"btn-span":"12 s:24 m:10 l:12 xl:16",model:u.value,onSearch:y,onReset:s},{default:n(()=>[e(k,{span:"24 s:12 m:8",label:a(t)("page.jobBatch.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[e($e,{value:u.value.groupName,"onUpdate:value":i[0]||(i[0]=m=>u.value.groupName=m),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(k,{span:"24 s:12 m:8",label:a(t)("page.jobBatch.jobName"),path:"jobName",class:"pr-24px"},{default:n(()=>[e(D,{value:b.value,"onUpdate:value":i[1]||(i[1]=m=>b.value=m),placeholder:a(t)("page.jobBatch.form.jobName"),options:J(_.value),"empty-visible":h.value,clearable:"",filterable:"","render-label":S,onSelect:v},null,8,["value","placeholder","options","empty-visible"])]),_:1},8,["label"]),e(k,{span:"24 s:12 m:8",label:a(t)("page.jobBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:n(()=>[e(N,{value:u.value.taskBatchStatus,"onUpdate:value":i[2]||(i[2]=m=>u.value.taskBatchStatus=m),multiple:"","max-tag-count":"responsive",placeholder:a(t)("common.taskBatchStatus.form"),options:a(ue)(a(ie)).filter(m=>![98,99].includes(m.value)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(k,{span:"24 s:24 m:14 l:12 xl:8",label:a(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:n(()=>[e(Je,{value:u.value.datetimeRange,"onUpdate:value":i[3]||(i[3]=m=>u.value.datetimeRange=m)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Oe=z({name:"JobBatchDetailDrawer",__name:"job-batch-detail-drawer",props:E({rowData:{default:null},log:{type:Boolean,default:!1}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(g){const $=g,h=K(g,"visible"),f=T(),_=T(!1);async function u(s){_.value=!0,f.value=s}async function b(){const{error:s}=await Q($.rowData.id);s||window.$message?.success(t("common.operateSuccess"))}return(s,y)=>{const p=Pe,v=I,J=Le,S=pe,r=Be,i=ce,k=Ie,D=Ue;return P(),H(V,null,[e(k,{modelValue:h.value,"onUpdate:modelValue":y[0]||(y[0]=N=>h.value=N),title:a(t)("page.jobBatch.detail"),width:["50%","90%"]},{default:n(()=>[e(i,{type:"segment",animated:"","default-value":s.log?1:0},{default:n(()=>[e(S,{name:0,tab:a(t)("page.log.info")},{default:n(()=>[e(J,{class:"pt-16px","label-placement":"top",bordered:"",column:2},{default:n(()=>[e(p,{label:a(t)("page.jobBatch.groupName")},{default:n(()=>[w(j(s.rowData?.groupName),1)]),_:1},8,["label"]),e(p,{label:a(t)("page.jobBatch.jobName")},{default:n(()=>[w(j(s.rowData?.jobName),1)]),_:1},8,["label"]),e(p,{label:a(t)("page.jobBatch.taskBatchStatus")},{default:n(()=>[e(v,{type:a(L)(s.rowData?.taskBatchStatus)},{default:n(()=>[w(j(a(t)(a(Y)[s.rowData?.taskBatchStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(p,{label:a(t)("page.jobBatch.executionAt")},{default:n(()=>[w(j(s.rowData?.executionAt),1)]),_:1},8,["label"]),e(p,{label:a(t)("page.jobBatch.operationReason")},{default:n(()=>[e(v,{type:a(L)(s.rowData?.operationReason)},{default:n(()=>[w(j(a(t)(a(Z)[s.rowData?.operationReason])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(p,{label:a(t)("page.jobBatch.executorType")},{default:n(()=>[e(v,{type:a(L)(s.rowData?.executorType)},{default:n(()=>[w(j(a(t)(a(me)[s.rowData?.executorType])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(p,{label:a(t)("page.jobBatch.executorInfo"),span:2},{default:n(()=>[w(j(s.rowData?.executorInfo),1)]),_:1},8,["label"]),e(p,{label:a(t)("common.createDt"),span:2},{default:n(()=>[w(j(s.rowData?.createDt),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),e(S,{name:1,tab:a(t)("page.log.title"),"display-directive":"if"},{default:n(()=>[e(r,{"row-data":s.rowData,onShowLog:u,onRetry:b},null,8,["row-data"])]),_:1},8,["tab"])]),_:1},8,["default-value"])]),_:1},8,["modelValue","title"]),e(D,{show:_.value,"onUpdate:show":y[1]||(y[1]=N=>_.value=N),title:a(t)("page.log.title"),"task-data":f.value},null,8,["show","title","task-data"])],64)}}}),Ve=de(Oe,[["__scopeId","data-v-f20ef5e0"]]),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function R(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!ke(g)}const lt=z({name:"job_batch",__name:"index",setup(g){const $=fe(),h=T(),{bool:f,setTrue:_}=F(!1),{bool:u,setBool:b}=F(!1),s=history.state.jobName,y=history.state.jobId,p=history.state.taskBatchStatus?[history.state.taskBatchStatus]:[],{columnChecks:v,columns:J,data:S,getData:r,loading:i,mobilePagination:k,searchParams:D,resetSearchParams:N}=xe({apiFn:je,apiParams:{page:1,size:10,groupName:null,jobName:null,taskBatchStatus:null,jobId:null,datetimeRange:be()},searchParams:{jobId:y,jobName:s,taskBatchStatus:p},columns:()=>[{type:"selection",width:30},{key:"id",align:"center",width:100,fixed:"left",title:()=>e("div",{class:"flex-center"},[e("span",null,[t("page.jobBatch.jobTask.id")]),e(_e,{trigger:"hover"},{trigger:()=>e("span",{class:"mb-2px ml-5px text-16px"},[e(ve,{icon:"ant-design:info-circle-outlined"},null)]),default:()=>e("span",null,[t("common.idDetailTip")])})]),render:o=>{function l(){h.value=o,b(!1),_()}return e(U,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[o.id]})}},{key:"groupName",title:t("page.jobBatch.groupName"),align:"left",width:150},{key:"taskType",title:t("page.jobBatch.taskType"),align:"center",width:120,render:o=>{if(o.taskType===null)return null;const l={1:"info",2:"success",3:"error",4:"primary",5:"warning"},B=t(ye[o.taskType]);return e(I,{type:l[o.taskType]},R(B)?B:{default:()=>[B]})}},{key:"jobName",title:t("page.jobBatch.jobName"),align:"center",width:150},{key:"executionAt",title:t("page.jobBatch.executionAt"),align:"center",width:120},{key:"duration",title:t("page.jobBatch.duration"),align:"center",width:120,render:o=>o.taskBatchStatus===3?Math.round(G(o.updateDt).diff(G(o.executionAt))/1e3):null},{key:"taskBatchStatus",title:t("page.jobBatch.taskBatchStatus"),align:"center",width:120,render:o=>{if(o.taskBatchStatus===null)return null;const l=t(Y[o.taskBatchStatus]);return e(I,{type:{1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"}[o.taskBatchStatus]},R(l)?l:{default:()=>[l]})}},{key:"operationReason",title:t("page.jobBatch.operationReason"),align:"center",width:120,render:o=>{if(o.operationReason===null)return null;const l=t(Z[o.operationReason]);return e(I,{type:L(o.operationReason)},R(l)?l:{default:()=>[l]})}},{key:"createDt",title:t("common.createDt"),align:"center",width:120},{key:"operate",title:t("common.operate"),align:"center",width:180,fixed:"right",render:o=>{let l;const B=()=>o.taskBatchStatus===1||o.taskBatchStatus===2?e(V,null,[e(O,{vertical:!0},null),e(A,{onPositiveClick:()=>oe(o.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let c;return e(U,{type:"error",text:!0,ghost:!0,size:"small"},R(c=t("common.stop"))?c:{default:()=>[c]})}})]):null,M=()=>o.taskBatchStatus===4||o.taskBatchStatus===5||o.taskBatchStatus===6?e(V,null,[e(O,{vertical:!0},null),e(A,{onPositiveClick:()=>ae(o.id)},{default:()=>t("common.confirmRetry"),trigger:()=>{let c;return e(U,{type:"error",text:!0,ghost:!0,size:"small"},R(c=t("common.retry"))?c:{default:()=>[c]})}})]):null;return e("div",{class:"flex-center gap-8px"},[e(U,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>te(o)},R(l=t("common.log"))?l:{default:()=>[l]}),B(),M(),e(O,{vertical:!0},null),e(A,{onPositiveClick:()=>X(o.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let c;return e(U,{type:"error",text:!0,ghost:!0,size:"small"},R(c=t("common.delete"))?c:{default:()=>[c]})}})])}}]}),{checkedRowKeys:x,onDeleted:m,onBatchDeleted:W}=Re(S,r);async function X(o){const{error:l}=await Se(o);l||m()}async function ee(){const{error:o}=await we(x.value);o||W()}function te(o){h.value=o,b(!0),_()}async function ae(o){const{error:l}=await Q(o);l||(window.$message?.success(t("common.operateSuccess")),r())}async function oe(o){const{error:l}=await De(o);l||(window.$message?.success(t("common.operateSuccess")),r())}return(o,l)=>{const B=ne,M=Me,c=he;return P(),H("div",ze,[e(Ae,{model:a(D),"onUpdate:model":l[0]||(l[0]=d=>C(D)?D.value=d:null),onReset:a(N),onSearch:a(r)},null,8,["model","onReset","onSearch"]),e(c,{title:a(t)("page.jobBatch.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":n(()=>[e(B,{columns:a(v),"onUpdate:columns":l[1]||(l[1]=d=>C(v)?v.value=d:null),"disabled-delete":a(x).length===0,loading:a(i),"show-add":!1,onDelete:ee,onRefresh:a(r)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:n(()=>[e(M,{"checked-row-keys":a(x),"onUpdate:checkedRowKeys":l[2]||(l[2]=d=>C(x)?x.value=d:null),columns:a(J),data:a(S),"flex-height":!a($).isMobile,"scroll-x":1200,loading:a(i),remote:"","row-key":d=>d.id,pagination:a(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(f)?(P(),q(Ve,{key:0,visible:a(f),"onUpdate:visible":l[3]||(l[3]=d=>C(f)?f.value=d:null),log:a(u),"onUpdate:log":l[4]||(l[4]=d=>C(u)?u.value=d:null),"row-data":h.value},null,8,["visible","log","row-data"])):ge("",!0)])}}});export{lt as default};
