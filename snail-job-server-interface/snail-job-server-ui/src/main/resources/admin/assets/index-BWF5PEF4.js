import{a as j,b as q,N as P}from"./search-form-2lTL1-HK.js";import{d as $,a0 as I,a1 as M,c as V,o as U,ad as G,h as o,ae as K,av as Z,$ as t,r as W,q as E,w as h,f as a,bZ as H,K as J,b4 as Q,b as X,ag as C,F as Y,B as x,aw as ee,Z as T,ax as ae,aa as te,ah as F,a3 as oe,ai as le}from"./index-C0p55rrf.js";import{f as ne,a as se,b as re,c as ce,d as ue}from"./workflow-DNUT-EGc.js";import{_ as ie,u as me,a as pe}from"./table-B8N7pgiA.js";import{_ as de}from"./select-group.vue_vue_type_script_setup_true_lang-BHwrakTI.js";import{_ as fe}from"./datetime-range.vue_vue_type_script_setup_true_lang-x0TjQ57D.js";import{_ as he}from"./AutoComplete-mwMzWXaf.js";import{b as ke}from"./Grid-DvIYbIW9.js";import"./CollapseItem-BWVJFROc.js";import"./group-Bzk_FTzz.js";import"./DatePicker--2_VzZ6E.js";const ge=$({name:"TaskBatchStatus",__name:"task-batch-status",props:I({disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const k=u,p=M(u,"modelValue");return(_,d)=>{const r=G;return U(),V(r,{value:p.value,"onUpdate:value":d[0]||(d[0]=i=>p.value=i),placeholder:o(t)("common.taskBatchStatus.form"),options:o(K)(o(Z)),disabled:k.disabled,clearable:k.clearable},null,8,["value","placeholder","options","disabled","clearable"])}}}),we=$({name:"WorkflowBatchSearch",__name:"workflow-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:I(["reset","search"],["update:model"]),setup(u,{emit:k}){const p=W(!1),_=k,d=W([]),r=M(u,"model"),i=W(r.value.workflowName);function v(){i.value="",_("reset")}function y(){_("search")}async function g(){const c=await ne({keywords:i.value,groupName:r.value.groupName});d.value=c.data}function S(c){r.value.workflowId=c}E(()=>i.value,c=>{c.length!==0?g():p.value=!1});function N(c){return c.map(n=>({value:n.id,label:n.workflowName}))}function b(c){return[c.label,`(${c.value})`]}return(c,n)=>{const w=ie,R=he,D=j;return U(),V(D,{"btn-span":"12 s:24 m:10 l:12 xl:16",model:r.value,onSearch:y,onReset:v},{default:h(()=>[a(w,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.groupName"),path:"groupName",class:"pr-24px"},{default:h(()=>[a(de,{value:r.value.groupName,"onUpdate:value":n[0]||(n[0]=m=>r.value.groupName=m),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(w,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.workflowName"),"label-width":100,path:"workflowName",class:"pr-24px"},{default:h(()=>[a(R,{value:i.value,"onUpdate:value":n[1]||(n[1]=m=>i.value=m),placeholder:o(t)("page.workflowBatch.form.workflowName"),options:N(d.value),"empty-visible":p.value,clearable:"",filterable:"","render-label":b,onSelect:S},null,8,["value","placeholder","options","empty-visible"])]),_:1},8,["label"]),a(w,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:h(()=>[a(ge,{value:r.value.taskBatchStatus,"onUpdate:value":n[2]||(n[2]=m=>r.value.taskBatchStatus=m),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(w,{span:"24 s:24 m:14 l:12 xl:8",label:o(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:h(()=>[a(fe,{value:r.value.datetimeRange,"onUpdate:value":n[3]||(n[3]=m=>r.value.datetimeRange=m)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),_e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!le(u)}const $e=$({name:"workflow_batch",__name:"index",setup(u){const k=H(),p=J(),_=history.state.workflowId,d=history.state.workflowName,r=history.state.taskBatchStatus,{columns:i,columnChecks:v,data:y,getData:g,loading:S,mobilePagination:N,searchParams:b,resetSearchParams:c}=me({apiFn:re,apiParams:{page:1,size:10,workflowId:null,workflowName:null,groupName:null,taskBatchStatus:null,datetimeRange:Q()},searchParams:{workflowId:_,workflowName:d,taskBatchStatus:r},columns:()=>[{type:"selection"},{key:"id",title:t("common.index"),align:"center",width:120,render:e=>a(x,{text:!0,tag:"a",type:"primary",onClick:()=>O(e.id),class:"ws-normal"},{default:()=>[e.id]})},{key:"workflowName",title:t("page.workflowBatch.workflowName"),align:"center",minWidth:120},{key:"groupName",title:t("page.workflowBatch.groupName"),align:"center",minWidth:120},{key:"executionAt",title:t("page.workflowBatch.executionAt"),align:"center",minWidth:120},{key:"taskBatchStatus",title:t("page.workflowBatch.taskBatchStatus"),align:"center",minWidth:120,render:e=>{if(!e.taskBatchStatus)return null;const l={1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"},s=t(ee[e.taskBatchStatus]);return a(T,{type:l[e.taskBatchStatus]},B(s)?s:{default:()=>[s]})}},{key:"operationReason",title:t("page.workflowBatch.operationReason"),align:"center",minWidth:120,render:e=>{if(e.operationReason===null)return null;const l=t(ae[e.operationReason]);return a(T,{type:te(e.operationReason)},B(l)?l:{default:()=>[l]})}},{key:"createDt",title:t("page.workflowBatch.createDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",minWidth:130,render:e=>{let l;return a("div",{class:"flex-center gap-8px"},[a(x,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>O(e.id)},B(l=t("common.log"))?l:{default:()=>[l]}),a(F,{vertical:!0},null),(e==null?void 0:e.taskBatchStatus)===1||(e==null?void 0:e.taskBatchStatus)===2?a(oe,null,[a(P,{onPositiveClick:()=>z(e.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let s;return a(x,{type:"error",text:!0,ghost:!0,size:"small"},B(s=t("common.stop"))?s:{default:()=>[s]})}}),a(F,{vertical:!0},null)]):null,a(P,{onPositiveClick:()=>D(e.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let s;return a(x,{type:"error",text:!0,ghost:!0,size:"small"},B(s=t("common.delete"))?s:{default:()=>[s]})}})])}}]}),{checkedRowKeys:n,onDeleted:w,onBatchDeleted:R}=pe(y,g);async function D(e){const{error:l}=await ce(e);l||w()}async function m(){const{error:e}=await se(n.value);e||R()}async function z(e){var s;const{error:l}=await ue(e);l||((s=window.$message)==null||s.success(t("common.executeSuccess")),g())}function O(e){k.push({path:"/workflow/form/batch",query:{id:e}})}return(e,l)=>{const s=q,A=ke,L=Y;return U(),X("div",_e,[a(we,{model:o(b),"onUpdate:model":l[0]||(l[0]=f=>C(b)?b.value=f:null),onReset:o(c),onSearch:o(g)},null,8,["model","onReset","onSearch"]),a(L,{title:o(t)("page.workflowBatch.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":h(()=>[a(s,{columns:o(v),"onUpdate:columns":l[1]||(l[1]=f=>C(v)?v.value=f:null),"disabled-delete":o(n).length===0,loading:o(S),"show-add":!1,onDelete:m,onRefresh:o(g)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:h(()=>[a(A,{"checked-row-keys":o(n),"onUpdate:checkedRowKeys":l[2]||(l[2]=f=>C(n)?n.value=f:null),columns:o(i),data:o(y),"flex-height":!o(p).isMobile,"scroll-x":962,loading:o(S),remote:"","row-key":f=>f.id,pagination:o(N),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{$e as default};
