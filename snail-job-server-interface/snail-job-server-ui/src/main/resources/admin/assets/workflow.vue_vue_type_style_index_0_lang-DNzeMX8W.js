import{ba as se,bb as le,d as F,ai as J,bc as tt,cg as ot,r as y,a as te,l as xe,ce as Nt,ch as xt,p as W,am as ue,bL as ze,b9 as K,ci as $t,cj as St,by as Vt,ck as Bt,cl as Tt,bu as Ct,b$ as Ge,S as Dt,bE as Lt,cm as Ut,cn as Rt,bd as nt,co as It,cp as Mt,bN as jt,bf as Et,cq as zt,cr as At,cs as Ot,aR as ae,b as B,o as c,e as _,ct as ge,s as pe,a2 as Z,a3 as ne,q as re,v as be,j as me,c as R,C as Ye,aZ as Be,w as l,g as x,f as n,t as N,B as ie,cu as Te,cv as Ce,G as De,A as Le,ac as Ue,D as Re,h as f,cw as Yt,cx as He,Y as _e,$ as D,az as Ht,a6 as ye,ah as qt,cy as lt,cz as qe,Z as Xt,a0 as Wt,cA as at,cB as Pt,P as $,as as Ft,at as Gt,ar as st,aH as Ne,cC as G,cD as Je,cE as Ze,cF as Ke,N as Xe,cG as Jt,ag as it,_ as Ie,cH as Zt,cI as dt,cJ as Kt,cK as Ae,cL as Qt,aL as eo,aM as rt,cM as to,cN as oo,aG as no,bk as lo,cO as ao}from"./index-DsXulf34.js";import{H as so,j as io,e as ro,_ as uo,g as ut}from"./job-task-list-table.vue_vue_type_script_setup_true_lang-wvbV9UtV.js";import{j as co,k as po,l as mo,m as fo}from"./workflow-BRHQyGIj.js";import{k as vo,l as ho}from"./job-DnRsninN.js";import{L as _o}from"./label-list-CM9sEsZ3.js";import{_ as Me,a as je,e as bo,c as go,d as yo}from"./Grid-DdJm4X1d.js";import{_ as $e}from"./detail-drawer-BuPycGzQ.js";import{_ as we,a as ke}from"./DescriptionsItem-BEs7Hiy4.js";import{_ as wo}from"./log-drawer-C3TDW99Z.js";import{_ as ct}from"./dynamic-input.vue_vue_type_script_setup_true_lang-CFAMlseU.js";import{_ as ko,s as No,o as xo,j as $o}from"./code-mirror-5CHqaaLi.js";import{_ as So}from"./system-user.vue_vue_type_script_setup_true_lang-BeDWgk3F.js";import{_ as Vo}from"./job-trigger-interval.vue_vue_type_script_setup_true_lang-3GUKqu-u.js";import{f as Bo}from"./notify-CjnxS7b5.js";import{e as To}from"./group-DephWMPB.js";function Co(e){return typeof e=="string"?document.querySelector(e):typeof e=="function"?e():e}const Do=se("affix",[le("affixed",{position:"fixed"},[le("absolute-positioned",{position:"absolute"})])]);function Lo(e){return e instanceof HTMLElement?e.scrollTop:window.scrollY}function Uo(e){return e instanceof HTMLElement?e.getBoundingClientRect():{top:0,bottom:window.innerHeight}}const Ro={listenTo:[String,Object,Function],top:Number,bottom:Number,triggerTop:Number,triggerBottom:Number,position:{type:String,default:"fixed"},offsetTop:{type:Number,validator:()=>!0,default:void 0},offsetBottom:{type:Number,validator:()=>!0,default:void 0},target:{type:Function,validator:()=>!0,default:void 0}},Io=F({name:"Affix",props:Ro,setup(e){const{mergedClsPrefixRef:a}=tt(e);ot("-affix",Do,a);let i=null;const p=y(!1),s=y(!1),t=y(null),o=y(null),b=te(()=>s.value||p.value),r=te(()=>{var S,g;return(g=(S=e.triggerTop)!==null&&S!==void 0?S:e.offsetTop)!==null&&g!==void 0?g:e.top}),u=te(()=>{var S,g;return(g=(S=e.top)!==null&&S!==void 0?S:e.triggerTop)!==null&&g!==void 0?g:e.offsetTop}),d=te(()=>{var S,g;return(g=(S=e.bottom)!==null&&S!==void 0?S:e.triggerBottom)!==null&&g!==void 0?g:e.offsetBottom}),m=te(()=>{var S,g;return(g=(S=e.triggerBottom)!==null&&S!==void 0?S:e.offsetBottom)!==null&&g!==void 0?g:e.bottom}),k=y(null),w=()=>{const{target:S,listenTo:g}=e;S?i=S():g?i=Co(g):i=document,i&&(i.addEventListener("scroll",v),v())};function v(){xt(T)}function T(){const{value:S}=k;if(!i||!S)return;const g=Lo(i);if(b.value){o.value!==null&&g<o.value&&(p.value=!1,o.value=null),t.value!==null&&g>t.value&&(s.value=!1,t.value=null);return}const U=Uo(i),I=S.getBoundingClientRect(),C=I.top-U.top,X=U.bottom-I.bottom,h=r.value,L=m.value;h!==void 0&&C<=h?(p.value=!0,o.value=g-(h-C)):(p.value=!1,o.value=null),L!==void 0&&X<=L?(s.value=!0,t.value=g+L-X):(s.value=!1,t.value=null)}return xe(()=>{w()}),Nt(()=>{i&&i.removeEventListener("scroll",v)}),{selfRef:k,affixed:b,mergedClsPrefix:a,mergedstyle:te(()=>{const S={};return p.value&&r.value!==void 0&&u.value!==void 0&&(S.top=`${u.value}px`),s.value&&m.value!==void 0&&d.value!==void 0&&(S.bottom=`${d.value}px`),S})}},render(){const{mergedClsPrefix:e}=this;return J("div",{ref:"selfRef",class:[`${e}-affix`,{[`${e}-affix--affixed`]:this.affixed,[`${e}-affix--absolute-positioned`]:this.position==="absolute"}],style:this.mergedstyle},this.$slots)}}),Qe=F({name:"SlotMachineNumber",props:{clsPrefix:{type:String,required:!0},value:{type:[Number,String],required:!0},oldOriginalNumber:{type:Number,default:void 0},newOriginalNumber:{type:Number,default:void 0}},setup(e){const a=y(null),i=y(e.value),p=y(e.value),s=y("up"),t=y(!1),o=te(()=>t.value?`${e.clsPrefix}-base-slot-machine-current-number--${s.value}-scroll`:null),b=te(()=>t.value?`${e.clsPrefix}-base-slot-machine-old-number--${s.value}-scroll`:null);W(ze(e,"value"),(d,m)=>{i.value=m,p.value=d,ue(r)});function r(){const d=e.newOriginalNumber,m=e.oldOriginalNumber;m===void 0||d===void 0||(d>m?u("up"):m>d&&u("down"))}function u(d){s.value=d,t.value=!1,ue(()=>{var m;(m=a.value)===null||m===void 0||m.offsetWidth,t.value=!0})}return()=>{const{clsPrefix:d}=e;return J("span",{ref:a,class:`${d}-base-slot-machine-number`},i.value!==null?J("span",{class:[`${d}-base-slot-machine-old-number ${d}-base-slot-machine-old-number--top`,b.value]},i.value):null,J("span",{class:[`${d}-base-slot-machine-current-number`,o.value]},J("span",{ref:"numberWrapper",class:[`${d}-base-slot-machine-current-number__inner`,typeof e.value!="number"&&`${d}-base-slot-machine-current-number__inner--not-number`]},p.value)),i.value!==null?J("span",{class:[`${d}-base-slot-machine-old-number ${d}-base-slot-machine-old-number--bottom`,b.value]},i.value):null)}}}),{cubicBezierEaseOut:he}=$t;function Mo({duration:e=".2s"}={}){return[K("&.fade-up-width-expand-transition-leave-active",{transition:`
 opacity ${e} ${he},
 max-width ${e} ${he},
 transform ${e} ${he}
 `}),K("&.fade-up-width-expand-transition-enter-active",{transition:`
 opacity ${e} ${he},
 max-width ${e} ${he},
 transform ${e} ${he}
 `}),K("&.fade-up-width-expand-transition-enter-to",{opacity:1,transform:"translateX(0) translateY(0)"}),K("&.fade-up-width-expand-transition-enter-from",{maxWidth:"0 !important",opacity:0,transform:"translateY(60%)"}),K("&.fade-up-width-expand-transition-leave-from",{opacity:1,transform:"translateY(0)"}),K("&.fade-up-width-expand-transition-leave-to",{maxWidth:"0 !important",opacity:0,transform:"translateY(60%)"})]}const jo=K([K("@keyframes n-base-slot-machine-fade-up-in",`
 from {
 transform: translateY(60%);
 opacity: 0;
 }
 to {
 transform: translateY(0);
 opacity: 1;
 }
 `),K("@keyframes n-base-slot-machine-fade-down-in",`
 from {
 transform: translateY(-60%);
 opacity: 0;
 }
 to {
 transform: translateY(0);
 opacity: 1;
 }
 `),K("@keyframes n-base-slot-machine-fade-up-out",`
 from {
 transform: translateY(0%);
 opacity: 1;
 }
 to {
 transform: translateY(-60%);
 opacity: 0;
 }
 `),K("@keyframes n-base-slot-machine-fade-down-out",`
 from {
 transform: translateY(0%);
 opacity: 1;
 }
 to {
 transform: translateY(60%);
 opacity: 0;
 }
 `),se("base-slot-machine",`
 overflow: hidden;
 white-space: nowrap;
 display: inline-block;
 height: 18px;
 line-height: 18px;
 `,[se("base-slot-machine-number",`
 display: inline-block;
 position: relative;
 height: 18px;
 width: .6em;
 max-width: .6em;
 `,[Mo({duration:".2s"}),St({duration:".2s",delay:"0s"}),se("base-slot-machine-old-number",`
 display: inline-block;
 opacity: 0;
 position: absolute;
 left: 0;
 right: 0;
 `,[le("top",{transform:"translateY(-100%)"}),le("bottom",{transform:"translateY(100%)"}),le("down-scroll",{animation:"n-base-slot-machine-fade-down-out .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1}),le("up-scroll",{animation:"n-base-slot-machine-fade-up-out .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1})]),se("base-slot-machine-current-number",`
 display: inline-block;
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 1;
 transform: translateY(0);
 width: .6em;
 `,[le("down-scroll",{animation:"n-base-slot-machine-fade-down-in .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1}),le("up-scroll",{animation:"n-base-slot-machine-fade-up-in .2s cubic-bezier(0, 0, .2, 1)",animationIterationCount:1}),Vt("inner",`
 display: inline-block;
 position: absolute;
 right: 0;
 top: 0;
 width: .6em;
 `,[le("not-number",`
 right: unset;
 left: 0;
 `)])])])])]),Eo=F({name:"BaseSlotMachine",props:{clsPrefix:{type:String,required:!0},value:{type:[Number,String],default:0},max:{type:Number,default:void 0},appeared:{type:Boolean,required:!0}},setup(e){ot("-base-slot-machine",jo,ze(e,"clsPrefix"));const a=y(),i=y(),p=te(()=>{if(typeof e.value=="string")return[];if(e.value<1)return[0];const s=[];let t=e.value;for(e.max!==void 0&&(t=Math.min(e.max,t));t>=1;)s.push(t%10),t/=10,t=Math.floor(t);return s.reverse(),s});return W(ze(e,"value"),(s,t)=>{typeof s=="string"?(i.value=void 0,a.value=void 0):typeof t=="string"?(i.value=s,a.value=void 0):(i.value=s,a.value=t)}),()=>{const{value:s,clsPrefix:t}=e;return typeof s=="number"?J("span",{class:`${t}-base-slot-machine`},J(Bt,{name:"fade-up-width-expand-transition",tag:"span"},{default:()=>p.value.map((o,b)=>J(Qe,{clsPrefix:t,key:p.value.length-b-1,oldOriginalNumber:a.value,newOriginalNumber:i.value,value:o}))}),J(Tt,{key:"+",width:!0},{default:()=>e.max!==void 0&&e.max<s?J(Qe,{clsPrefix:t,value:"+"}):null})):J("span",{class:`${t}-base-slot-machine`},s)}}});function zo(e){const{errorColor:a,infoColor:i,successColor:p,warningColor:s,fontFamily:t}=e;return{color:a,colorInfo:i,colorSuccess:p,colorError:a,colorWarning:s,fontSize:"12px",fontFamily:t}}const Ao={common:Ct,self:zo},Oo=K([K("@keyframes badge-wave-spread",{from:{boxShadow:"0 0 0.5px 0px var(--n-ripple-color)",opacity:.6},to:{boxShadow:"0 0 0.5px 4.5px var(--n-ripple-color)",opacity:0}}),se("badge",`
 display: inline-flex;
 position: relative;
 vertical-align: middle;
 font-family: var(--n-font-family);
 `,[le("as-is",[se("badge-sup",{position:"static",transform:"translateX(0)"},[Ge({transformOrigin:"left bottom",originalTransform:"translateX(0)"})])]),le("dot",[se("badge-sup",`
 height: 8px;
 width: 8px;
 padding: 0;
 min-width: 8px;
 left: 100%;
 bottom: calc(100% - 4px);
 `,[K("::before","border-radius: 4px;")])]),se("badge-sup",`
 background: var(--n-color);
 transition:
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 color: #FFF;
 position: absolute;
 height: 18px;
 line-height: 18px;
 border-radius: 9px;
 padding: 0 6px;
 text-align: center;
 font-size: var(--n-font-size);
 transform: translateX(-50%);
 left: 100%;
 bottom: calc(100% - 9px);
 font-variant-numeric: tabular-nums;
 z-index: 2;
 display: flex;
 align-items: center;
 `,[Ge({transformOrigin:"left bottom",originalTransform:"translateX(-50%)"}),se("base-wave",{zIndex:1,animationDuration:"2s",animationIterationCount:"infinite",animationDelay:"1s",animationTimingFunction:"var(--n-ripple-bezier)",animationName:"badge-wave-spread"}),K("&::before",`
 opacity: 0;
 transform: scale(1);
 border-radius: 9px;
 content: "";
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 `)])])]),Yo=Object.assign(Object.assign({},nt.props),{value:[String,Number],max:Number,dot:Boolean,type:{type:String,default:"default"},show:{type:Boolean,default:!0},showZero:Boolean,processing:Boolean,color:String,offset:Array}),Se=F({name:"Badge",props:Yo,setup(e,{slots:a}){const{mergedClsPrefixRef:i,inlineThemeDisabled:p,mergedRtlRef:s}=tt(e),t=nt("Badge","-badge",Oo,Ao,e,i),o=y(!1),b=()=>{o.value=!0},r=()=>{o.value=!1},u=te(()=>e.show&&(e.dot||e.value!==void 0&&!(!e.showZero&&Number(e.value)<=0)||!It(a.value)));xe(()=>{u.value&&(o.value=!0)});const d=Mt("Badge",s,i),m=te(()=>{const{type:v,color:T}=e,{common:{cubicBezierEaseInOut:S,cubicBezierEaseOut:g},self:{[jt("color",v)]:U,fontFamily:I,fontSize:C}}=t.value;return{"--n-font-size":C,"--n-font-family":I,"--n-color":T||U,"--n-ripple-color":T||U,"--n-bezier":S,"--n-ripple-bezier":g}}),k=p?Et("badge",te(()=>{let v="";const{type:T,color:S}=e;return T&&(v+=T[0]),S&&(v+=zt(S)),v}),m,e):void 0,w=te(()=>{const{offset:v}=e;if(!v)return;const[T,S]=v,g=typeof T=="number"?`${T}px`:T,U=typeof S=="number"?`${S}px`:S;return{transform:`translate(calc(${d?.value?"50%":"-50%"} + ${g}), ${U})`}});return{rtlEnabled:d,mergedClsPrefix:i,appeared:o,showBadge:u,handleAfterEnter:b,handleAfterLeave:r,cssVars:p?void 0:m,themeClass:k?.themeClass,onRender:k?.onRender,offsetStyle:w}},render(){var e;const{mergedClsPrefix:a,onRender:i,themeClass:p,$slots:s}=this;i?.();const t=(e=s.default)===null||e===void 0?void 0:e.call(s);return J("div",{class:[`${a}-badge`,this.rtlEnabled&&`${a}-badge--rtl`,p,{[`${a}-badge--dot`]:this.dot,[`${a}-badge--as-is`]:!t}],style:this.cssVars},t,J(Dt,{name:"fade-in-scale-up-transition",onAfterEnter:this.handleAfterEnter,onAfterLeave:this.handleAfterLeave},{default:()=>this.showBadge?J("sup",{class:`${a}-badge-sup`,title:Lt(this.value),style:this.offsetStyle},Ut(s.value,()=>[this.dot?null:J(Eo,{clsPrefix:a,appeared:this.appeared,max:this.max,value:this.value})]),this.processing?J(Rt,{clsPrefix:a}):null):null}))}}),fe=At(Ot.Workflow,()=>{const e=y(),a=y(),i=y(),p=y([]);function s(r){e.value=r}function t(r){a.value=r}async function o(r){i.value=r;const{data:u,error:d}=await vo({groupName:r});d||(p.value=u)}function b(){e.value=void 0,a.value=void 0,i.value=void 0,p.value=[]}return{id:e,type:a,groupName:i,jobList:p,setJobList:o,setType:t,setId:s,clear:b}}),Ho={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function qo(e,a){return c(),B("svg",Ho,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8"},null,-1),_("path",{fill:"currentColor",d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8Z"},null,-1)])])}const pt=ae({name:"ant-design-plus-outlined",render:qo}),Xo={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Wo(e,a){return c(),B("svg",Xo,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8"},null,-1)])])}const Po=ae({name:"ant-design-minus-outlined",render:Wo}),et={y:{t:"top",m:"marginTop",b:"bottom"},x:{l:"left",m:"marginLeft",r:"right"}};function Fo(e){e.forEach((a,i)=>{document.documentElement.addEventListener(i,a)})}function Go(e){e.forEach((a,i)=>{document.documentElement.removeEventListener(i,a)})}const Jo={name:"vue-drag-resize",emits:["clicked","dragging","dragstop","resizing","resizestop","activated","deactivated"],props:{stickSize:{type:Number,default:8},parentScaleX:{type:Number,default:1},parentScaleY:{type:Number,default:1},isActive:{type:Boolean,default:!1},preventActiveBehavior:{type:Boolean,default:!1},isDraggable:{type:Boolean,default:!0},isResizable:{type:Boolean,default:!0},aspectRatio:{type:Boolean,default:!1},parentLimitation:{type:Boolean,default:!1},snapToGrid:{type:Boolean,default:!1},gridX:{type:Number,default:50,validator(e){return e>=0}},gridY:{type:Number,default:50,validator(e){return e>=0}},parentW:{type:Number,default:0,validator(e){return e>=0}},parentH:{type:Number,default:0,validator(e){return e>=0}},w:{type:[String,Number],default:200,validator(e){return typeof e=="string"?e==="auto":e>=0}},h:{type:[String,Number],default:200,validator(e){return typeof e=="string"?e==="auto":e>=0}},minw:{type:Number,default:50,validator(e){return e>=0}},minh:{type:Number,default:50,validator(e){return e>=0}},x:{type:Number,default:0,validator(e){return typeof e=="number"}},y:{type:Number,default:0,validator(e){return typeof e=="number"}},z:{type:[String,Number],default:"auto",validator(e){return typeof e=="string"?e==="auto":e>=0}},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},sticks:{type:Array,default(){return["tl","tm","tr","mr","br","bm","bl","ml"]}},axis:{type:String,default:"both",validator(e){return["x","y","both","none"].indexOf(e)!==-1}},contentClass:{type:String,required:!1,default:""}},data(){return{fixAspectRatio:null,active:null,zIndex:null,parentWidth:null,parentHeight:null,left:null,top:null,right:null,bottom:null,minHeight:null}},beforeCreate(){this.stickDrag=!1,this.bodyDrag=!1,this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}},this.currentStick=null},mounted(){this.parentElement=this.$el.parentNode,this.parentWidth=this.parentW?this.parentW:this.parentElement.clientWidth,this.parentHeight=this.parentH?this.parentH:this.parentElement.clientHeight,this.left=this.x,this.top=this.y,this.right=this.parentWidth-(this.w==="auto"?this.$refs.container.scrollWidth:this.w)-this.left,this.bottom=this.parentHeight-(this.h==="auto"?this.$refs.container.scrollHeight:this.h)-this.top,this.domEvents=new Map([["mousemove",this.move],["mouseup",this.up],["mouseleave",this.up],["mousedown",this.deselect],["touchmove",this.move],["touchend",this.up],["touchcancel",this.up],["touchstart",this.up]]),Fo(this.domEvents),this.dragHandle&&[...this.$el.querySelectorAll(this.dragHandle)].forEach(e=>{e.setAttribute("data-drag-handle",this._uid)}),this.dragCancel&&[...this.$el.querySelectorAll(this.dragCancel)].forEach(e=>{e.setAttribute("data-drag-cancel",this._uid)})},beforeDestroy(){Go(this.domEvents)},methods:{deselect(){this.preventActiveBehavior||(this.active=!1)},move(e){if(!this.stickDrag&&!this.bodyDrag)return;e.stopPropagation();const a=typeof e.pageX<"u"?e.pageX:e.touches[0].pageX,i=typeof e.pageY<"u"?e.pageY:e.touches[0].pageY,{dimensionsBeforeMove:p}=this,s={x:(p.pointerX-a)/this.parentScaleX,y:(p.pointerY-i)/this.parentScaleY};if(this.stickDrag&&this.stickMove(s),this.bodyDrag){if(this.axis==="x")s.y=0;else if(this.axis==="y")s.x=0;else if(this.axis==="none")return;this.bodyMove(s)}},up(e){this.stickDrag?this.stickUp(e):this.bodyDrag&&this.bodyUp(e)},bodyDown(e){const{target:a,button:i}=e;if(this.preventActiveBehavior||(this.active=!0),i&&i!==0||(this.$emit("clicked",e),!this.active)||this.dragHandle&&a.getAttribute("data-drag-handle")!==this._uid.toString()||this.dragCancel&&a.getAttribute("data-drag-cancel")===this._uid.toString())return;typeof e.stopPropagation<"u"&&e.stopPropagation(),typeof e.preventDefault<"u"&&e.preventDefault(),this.isDraggable&&(this.bodyDrag=!0);const p=typeof e.pageX<"u"?e.pageX:e.touches[0].pageX,s=typeof e.pageY<"u"?e.pageY:e.touches[0].pageY;this.saveDimensionsBeforeMove({pointerX:p,pointerY:s}),this.parentLimitation&&(this.limits=this.calcDragLimitation())},bodyMove(e){const{dimensionsBeforeMove:a,parentWidth:i,parentHeight:p,gridX:s,gridY:t,width:o,height:b}=this;let r=a.top-e.y,u=a.bottom+e.y,d=a.left-e.x,m=a.right+e.x;if(this.snapToGrid){let k=!0,w=!0,v=r-Math.floor(r/t)*t,T=p-u-Math.floor((p-u)/t)*t,S=d-Math.floor(d/s)*s,g=i-m-Math.floor((i-m)/s)*s;v>t/2&&(v-=t),T>t/2&&(T-=t),S>s/2&&(S-=s),g>s/2&&(g-=s),Math.abs(T)<Math.abs(v)&&(k=!1),Math.abs(g)<Math.abs(S)&&(w=!1),r-=k?v:T,u=p-b-r,d-=w?S:g,m=i-o-d}({newLeft:this.left,newRight:this.right,newTop:this.top,newBottom:this.bottom}=this.rectCorrectionByLimit({newLeft:d,newRight:m,newTop:r,newBottom:u})),this.$emit("dragging",this.rect)},bodyUp(){this.bodyDrag=!1,this.$emit("dragging",this.rect),this.$emit("dragstop",this.rect),this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}}},stickDown(e,a,i=!1){if((!this.isResizable||!this.active)&&!i)return;this.stickDrag=!0;const p=typeof a.pageX<"u"?a.pageX:a.touches[0].pageX,s=typeof a.pageY<"u"?a.pageY:a.touches[0].pageY;this.saveDimensionsBeforeMove({pointerX:p,pointerY:s}),this.currentStick=e,this.limits=this.calcResizeLimits()},saveDimensionsBeforeMove({pointerX:e,pointerY:a}){this.dimensionsBeforeMove.pointerX=e,this.dimensionsBeforeMove.pointerY=a,this.dimensionsBeforeMove.left=this.left,this.dimensionsBeforeMove.right=this.right,this.dimensionsBeforeMove.top=this.top,this.dimensionsBeforeMove.bottom=this.bottom,this.dimensionsBeforeMove.width=this.width,this.dimensionsBeforeMove.height=this.height,this.aspectFactor=this.width/this.height},stickMove(e){const{currentStick:a,dimensionsBeforeMove:i,gridY:p,gridX:s,snapToGrid:t,parentHeight:o,parentWidth:b}=this;let r=i.top,u=i.bottom,d=i.left,m=i.right;switch(a[0]){case"b":u=i.bottom+e.y,t&&(u=o-Math.round((o-u)/p)*p);break;case"t":r=i.top-e.y,t&&(r=Math.round(r/p)*p);break}switch(a[1]){case"r":m=i.right+e.x,t&&(m=b-Math.round((b-m)/s)*s);break;case"l":d=i.left-e.x,t&&(d=Math.round(d/s)*s);break}({newLeft:d,newRight:m,newTop:r,newBottom:u}=this.rectCorrectionByLimit({newLeft:d,newRight:m,newTop:r,newBottom:u})),this.aspectRatio&&({newLeft:d,newRight:m,newTop:r,newBottom:u}=this.rectCorrectionByAspectRatio({newLeft:d,newRight:m,newTop:r,newBottom:u})),this.left=d,this.right=m,this.top=r,this.bottom=u,this.$emit("resizing",this.rect)},stickUp(){this.stickDrag=!1,this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}},this.$emit("resizing",this.rect),this.$emit("resizestop",this.rect)},calcDragLimitation(){const{parentWidth:e,parentHeight:a}=this;return{left:{min:0,max:e-this.width},right:{min:0,max:e-this.width},top:{min:0,max:a-this.height},bottom:{min:0,max:a-this.height}}},calcResizeLimits(){const{aspectFactor:e,width:a,height:i,bottom:p,top:s,left:t,right:o}=this;let{minh:b,minw:r}=this;const u=this.parentLimitation?0:null;this.aspectRatio&&(r/b>e?b=r/e:r=e*b);const d={left:{min:u,max:t+(a-r)},right:{min:u,max:o+(a-r)},top:{min:u,max:s+(i-b)},bottom:{min:u,max:p+(i-b)}};if(this.aspectRatio){const m={left:{min:t-Math.min(s,p)*e*2,max:t+(i-b)/2*e*2},right:{min:o-Math.min(s,p)*e*2,max:o+(i-b)/2*e*2},top:{min:s-Math.min(t,o)/e*2,max:s+(a-r)/2/e*2},bottom:{min:p-Math.min(t,o)/e*2,max:p+(a-r)/2/e*2}};this.currentStick[0]==="m"?(d.left={min:Math.max(d.left.min,m.left.min),max:Math.min(d.left.max,m.left.max)},d.right={min:Math.max(d.right.min,m.right.min),max:Math.min(d.right.max,m.right.max)}):this.currentStick[1]==="m"&&(d.top={min:Math.max(d.top.min,m.top.min),max:Math.min(d.top.max,m.top.max)},d.bottom={min:Math.max(d.bottom.min,m.bottom.min),max:Math.min(d.bottom.max,m.bottom.max)})}return d},sideCorrectionByLimit(e,a){let i=a;return e.min!==null&&a<e.min?i=e.min:e.max!==null&&e.max<a&&(i=e.max),i},rectCorrectionByLimit(e){const{limits:a}=this;let{newRight:i,newLeft:p,newBottom:s,newTop:t}=e;return p=this.sideCorrectionByLimit(a.left,p),i=this.sideCorrectionByLimit(a.right,i),t=this.sideCorrectionByLimit(a.top,t),s=this.sideCorrectionByLimit(a.bottom,s),{newLeft:p,newRight:i,newTop:t,newBottom:s}},rectCorrectionByAspectRatio(e){let{newLeft:a,newRight:i,newTop:p,newBottom:s}=e;const{parentWidth:t,parentHeight:o,currentStick:b,aspectFactor:r,dimensionsBeforeMove:u}=this;let d=t-a-i,m=o-p-s;if(b[1]==="m"){const k=m-u.height;a-=k*r/2,i-=k*r/2}else if(b[0]==="m"){const k=d-u.width;p-=k/r/2,s-=k/r/2}else d/m>r?(d=r*m,b[1]==="l"?a=t-i-d:i=t-a-d):(m=d/r,b[0]==="t"?p=o-s-m:s=o-p-m);return{newLeft:a,newRight:i,newTop:p,newBottom:s}}},computed:{positionStyle(){return{top:this.top+"px",left:this.left+"px",zIndex:this.zIndex}},sizeStyle(){return{width:this.w=="auto"?"auto":this.width+"px",height:this.h=="auto"?"auto":this.height+"px"}},vdrStick(){return e=>{const a={width:`${this.stickSize/this.parentScaleX}px`,height:`${this.stickSize/this.parentScaleY}px`};return a[et.y[e[0]]]=`${this.stickSize/this.parentScaleX/-2}px`,a[et.x[e[1]]]=`${this.stickSize/this.parentScaleX/-2}px`,a}},width(){return this.parentWidth-this.left-this.right},height(){return this.parentHeight-this.top-this.bottom},rect(){return{left:Math.round(this.left),top:Math.round(this.top),width:Math.round(this.width),height:Math.round(this.height)}}},watch:{active(e){e?this.$emit("activated"):this.$emit("deactivated")},isActive:{immediate:!0,handler(e){this.active=e}},z:{immediate:!0,handler(e){(e>=0||e==="auto")&&(this.zIndex=e)}},x:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.left)return;const i=a-e;this.bodyDown({pageX:this.left,pageY:this.top}),this.bodyMove({x:i,y:0}),this.$nextTick(()=>{this.bodyUp()})}},y:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.top)return;const i=a-e;this.bodyDown({pageX:this.left,pageY:this.top}),this.bodyMove({x:0,y:i}),this.$nextTick(()=>{this.bodyUp()})}},w:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.width)return;const i="mr",p=a-e;this.stickDown(i,{pageX:this.right,pageY:this.top+this.height/2},!0),this.stickMove({x:p,y:0}),this.$nextTick(()=>{this.stickUp()})}},h:{handler(e,a){if(this.stickDrag||this.bodyDrag||e===this.height)return;const i="bm",p=a-e;this.stickDown(i,{pageX:this.left+this.width/2,pageY:this.bottom},!0),this.stickMove({x:0,y:p}),this.$nextTick(()=>{this.stickUp()})}},parentW(e){this.right=e-this.width-this.left,this.parentWidth=e},parentH(e){this.bottom=e-this.height-this.top,this.parentHeight=e}}},Zo=["onMousedown","onTouchstart"];function Ko(e,a,i,p,s,t){return c(),B("div",{class:be(["vdr",`${e.active||e.isActive?"active":"inactive"} ${e.contentClass?e.contentClass:""}`]),style:pe(e.positionStyle),onMousedown:a[0]||(a[0]=o=>e.bodyDown(o)),onTouchstart:a[1]||(a[1]=o=>e.bodyDown(o)),onTouchend:a[2]||(a[2]=o=>e.up(o))},[_("div",{style:pe(e.sizeStyle),class:"content-container",ref:"container"},[ge(e.$slots,"default")],4),(c(!0),B(Z,null,ne(e.sticks,o=>(c(),B("div",{class:be(["vdr-stick",["vdr-stick-"+o,e.isResizable?"":"not-resizable"]]),onMousedown:re(b=>e.stickDown(o,b),["stop","prevent"]),onTouchstart:re(b=>e.stickDown(o,b),["stop","prevent"]),style:pe(e.vdrStick(o))},null,46,Zo))),256))],38)}const mt=me(Jo,[["render",Ko]]);function Oe(e){Oe.installed||(Oe.installed=!0,e.component("vue-drag-resize",mt))}const Qo={install:Oe};let Ve=null;typeof window<"u"?Ve=window.Vue:typeof global<"u"&&(Ve=global.Vue);Ve&&Ve.use(Qo);const en={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function tn(e,a){return c(),B("svg",en,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1l-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4"},null,-1)])])}const ft=ae({name:"ant-design-right-outlined",render:tn}),on={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function nn(e,a){return c(),B("svg",on,[...a[0]||(a[0]=[_("path",{fill:"currentColor","fill-rule":"evenodd",d:"M799.855 166.312c.023.007.043.018.084.059l57.69 57.69c.041.041.052.06.059.084a.1.1 0 0 1 0 .069c-.007.023-.018.042-.059.083L569.926 512l287.703 287.703c.041.04.052.06.059.083a.12.12 0 0 1 0 .07c-.007.022-.018.042-.059.083l-57.69 57.69c-.041.041-.06.052-.084.059a.1.1 0 0 1-.069 0c-.023-.007-.042-.018-.083-.059L512 569.926L224.297 857.629c-.04.041-.06.052-.083.059a.12.12 0 0 1-.07 0c-.022-.007-.042-.018-.083-.059l-57.69-57.69c-.041-.041-.052-.06-.059-.084a.1.1 0 0 1 0-.069c.007-.023.018-.042.059-.083L454.073 512L166.371 224.297c-.041-.04-.052-.06-.059-.083a.12.12 0 0 1 0-.07c.007-.022.018-.042.059-.083l57.69-57.69c.041-.041.06-.052.084-.059a.1.1 0 0 1 .069 0c.023.007.042.018.083.059L512 454.073l287.703-287.702c.04-.041.06-.052.083-.059a.12.12 0 0 1 .07 0Z"},null,-1)])])}const We=ae({name:"ant-design-close-outlined",render:nn}),ln={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function an(e,a){return c(),B("svg",ln,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281l360-281.1c3.8-3 6.1-7.7 6.1-12.6"},null,-1)])])}const vt=ae({name:"ant-design-left-outlined",render:an}),sn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function dn(e,a){return c(),B("svg",sn,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64m0 820c-205.4 0-372-166.6-372-372c0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884m288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372c0 89-31.3 170.8-83.5 234.8"},null,-1)])])}const rn=ae({name:"ant-design-stop-outlined",render:dn}),un={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function cn(e,a){return c(),B("svg",un,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 0 0 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 0 0 9.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9m67.4-174.4L687.8 215l73.3 73.3l-362.7 362.6l-88.9 15.7zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32"},null,-1)])])}const pn=ae({name:"ant-design-edit-outlined",render:cn}),mn={class:"flex items-center"},Ee=F({name:"EditableInput",__name:"editable-input",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,p=a,s=y(),t=y(),o=y(!1);W(()=>i.modelValue,u=>{t.value=u},{immediate:!0});const b=()=>{o.value=!0,ue(()=>{s.value?.focus()})},r=()=>{p("update:modelValue",t.value),o.value=!1};return(u,d)=>{const m=Ye,k=pn,w=ie,v=Be;return o.value?(c(),R(m,{key:0,ref_key:"inputRef",ref:s,value:t.value,"onUpdate:value":d[0]||(d[0]=T=>t.value=T),type:"text",onBlur:r},null,8,["value"])):(c(),R(v,{key:1},{default:l(()=>[_("span",mn,[x(N(t.value)+" ",1),n(w,{text:"",type:"info",class:"m-l-6px",onClick:b},{icon:l(()=>[n(k,{class:"text-icon"})]),_:1})])]),_:1}))}}}),fn={class:"w-460px flex-center"};function vn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qt(e)}const hn=F({name:"TaskDrawer",__name:"task-drawer",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1},len:{default:0}},emits:["update:open","save"],setup(e,{emit:a}){const i=e,p=a,s=fe(),t=y(!1),o=y({}),b=y([]);W(()=>s.jobList,v=>{b.value=v},{immediate:!0}),W(()=>i.open,v=>{t.value=v},{immediate:!0}),W(()=>i.modelValue,v=>{o.value=v},{immediate:!0});const r=y(),u=()=>{p("update:open",!1),t.value=!1},d=()=>{r.value?.validate(v=>{v||(u(),p("save",o.value))}).catch(()=>window.$message?.warning("请检查表单信息"))},m={failStrategy:[{required:!0,message:"请选择失败策略"}],workflowNodeStatus:[{required:!0,message:"请选择工作流状态"}],jobTask:{jobId:[{required:!0,message:"请选择任务"}]}},k=(v,T)=>{o.value.jobTask.jobName=T.jobName,o.value.jobTask.labels=T.labels},w=v=>n(ye,{trigger:"hover",placement:"left"},{trigger:()=>{let T;return n("div",{class:"flex-y-center gap-6px"},[v.taskType?n(_e,{type:"info",size:"small"},vn(T=D(Ht[v.taskType]))?T:{default:()=>[T]}):null,n("span",null,[v.jobName])])},default:()=>n("div",null,[v.jobName,x(" ( "),v.executorInfo,x(" )")])});return(v,T)=>{const S=Ue,g=Le,U=je,I=Re,C=Me,X=De,h=ie,L=Ce,A=Te;return c(),R(A,{show:t.value,"onUpdate:show":T[5]||(T[5]=O=>t.value=O),"display-directive":"if",width:500,onAfterLeave:u},{default:l(()=>[n(L,null,{header:l(()=>[_("div",fn,[n(Ee,{modelValue:o.value.nodeName,"onUpdate:modelValue":T[0]||(T[0]=O=>o.value.nodeName=O),class:"mr-16px max-w-320px min-w-320px"},null,8,["modelValue"]),n(S,{value:o.value.priorityLevel,"onUpdate:value":T[1]||(T[1]=O=>o.value.priorityLevel=O),class:"max-w-110px",options:Array(v.len).fill(0).map((O,Y)=>({label:"优先级 "+(Y+1),value:Y+1}))},null,8,["value","options"])])]),footer:l(()=>[n(h,{type:"primary",onClick:d},{default:l(()=>T[6]||(T[6]=[x("保存")])),_:1,__:[6]}),n(h,{class:"ml-12px",onClick:u},{default:l(()=>T[7]||(T[7]=[x("取消")])),_:1,__:[7]})]),default:l(()=>[n(X,{ref_key:"formRef",ref:r,model:o.value,rules:m,"label-align":"left","label-width":"100px"},{default:l(()=>[n(g,{path:"jobTask.jobId",label:"所属任务",placeholder:"请选择任务"},{default:l(()=>[n(S,{value:o.value.jobTask.jobId,"onUpdate:value":[T[2]||(T[2]=O=>o.value.jobTask.jobId=O),k],filterable:"","render-label":w,"label-field":"jobName","value-field":"id",options:b.value},null,8,["value","options"])]),_:1}),n(g,{path:"failStrategy",label:"失败策略"},{default:l(()=>[n(C,{value:o.value.failStrategy,"onUpdate:value":T[3]||(T[3]=O=>o.value.failStrategy=O)},{default:l(()=>[n(I,null,{default:l(()=>[(c(!0),B(Z,null,ne(f(Yt),(O,Y)=>(c(),R(U,{key:Y,label:f(D)(O.label),value:O.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),n(g,{path:"workflowNodeStatus",label:"任务状态"},{default:l(()=>[n(C,{value:o.value.workflowNodeStatus,"onUpdate:value":T[4]||(T[4]=O=>o.value.workflowNodeStatus=O)},{default:l(()=>[n(I,null,{default:l(()=>[(c(!0),B(Z,null,ne(f(He),(O,Y)=>(c(),R(U,{key:Y,label:f(D)(O.label),value:O.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),_n=F({name:"TaskDetail",__name:"task-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,p=a,s=fe(),t=y(!1);W(()=>i.open,r=>{t.value=r},{immediate:!0});const o=()=>{p("update:open",!1)},b=r=>s.jobList.find(d=>d.id===r)?.jobName;return(r,u)=>{const d=ke,m=we,k=$e;return c(),R(k,{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=w=>t.value=w),title:"任务详情",width:["500px","90%"],onAfterLeave:o},{default:l(()=>[n(m,{column:1,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(d,{label:"节点名称"},{default:l(()=>[x(N(r.modelValue.nodeName),1)]),_:1}),n(d,{label:"任务 ID"},{default:l(()=>[x(N(r.modelValue.jobTask?.jobId),1)]),_:1}),n(d,{label:"任务名称"},{default:l(()=>[x(N(b(r.modelValue.jobTask?.jobId)),1)]),_:1}),n(d,{label:"失败策略"},{default:l(()=>[x(N(f(D)(f(lt)[r.modelValue.failStrategy])),1)]),_:1}),n(d,{label:"任务状态"},{default:l(()=>[x(N(f(D)(f(qe)[r.modelValue.workflowNodeStatus])),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),bn=F({name:"FlowLogDrawer",__name:"flow-log-drawer",props:Xt({title:{default:D("workflow.node.log.title")},taskData:{}},{show:{type:Boolean,default:!0},showModifiers:{}}),emits:["update:show"],setup(e){const a=Wt(e,"show");return(i,p)=>{const s=wo;return c(),R(s,{show:a.value,"onUpdate:show":p[0]||(p[0]=t=>a.value=t),title:i.title,"task-data":i.taskData},null,8,["show","title","task-data"])}}}),gn=F({name:"DetailCard",__name:"detail-card",props:{id:{default:void 0},ids:{default:()=>[]},show:{type:Boolean,default:!1}},emits:["update:show"],setup(e,{emit:a}){so.registerLanguage("json",io);const i=e,p=a,s=at(),t=fe(),o=y(!1),b=y(!1),r=y(!1),u=y(1),d=y({}),m=y({page:1,pageCount:0,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20,25,30],onUpdatePage:async h=>{m.value.page=h;const L=i.ids[u.value-1];v(L)},onUpdatePageSize:async h=>{m.value.pageSize=h;const L=i.ids[u.value-1];v(L)}});W(()=>i.show,h=>{o.value=h,h&&S()},{immediate:!0});const k=()=>{p("update:show",!1)};async function w(h){r.value=!0;const{data:L,error:A}=await ho(h);A||(d.value=L,r.value=!1)}async function v(h){r.value=!0;const{data:L,error:A}=await ro(h);A||(d.value=L,r.value=!1)}const T=y([]);function S(){T.value=i.ids,ue(()=>{i.ids.length>0?v(i.ids[0]):i.id&&(T.value=[d.value.taskBatchId],w(i.id))})}const g=y({}),U=h=>{g.value=h,b.value=!0},I=async()=>{const{error:h}=await co(t.id,d.value.workflowNodeId);h||window.$message?.success("执行重试成功")};function C(h){return{color:`${h}18`,textColor:h,borderColor:`${h}58`}}const X=h=>{u.value=h;const L=i.ids[h-1];v(L)};return(h,L)=>{const A=ke,O=we,Y=st,V=Gt,E=uo,P=Ft,ee=bo,de=$e,H=bn;return c(),B(Z,null,[n(de,{modelValue:o.value,"onUpdate:modelValue":L[2]||(L[2]=q=>o.value=q),title:"任务批次详情",width:["800px","90%"],"onUpdate:show":k},Pt({default:l(()=>[T.value&&T.value.length>0?(c(),R(P,{key:0,value:u.value,"onUpdate:value":L[0]||(L[0]=q=>u.value=q),type:"segment",animated:""},{default:l(()=>[(c(!0),B(Z,null,ne(T.value,(q,M)=>(c(),R(V,{key:M,name:M+1,tab:q},{default:l(()=>[n(P,{class:"detail-tabs",type:"segment",animated:""},{default:l(()=>[n(V,{name:"info",tab:f(D)("page.log.info")},{default:l(()=>[n(Y,{show:r.value},{default:l(()=>[n(O,{class:"pt-12px","label-placement":"left",bordered:"",column:2},{default:l(()=>[n(A,{label:f(D)("page.jobBatch.groupName")},{default:l(()=>[x(N(d.value?.groupName),1)]),_:1},8,["label"]),n(A,{label:f(D)("page.jobBatch.jobName")},{default:l(()=>[x(N(d.value?.jobName),1)]),_:1},8,["label"]),n(A,{label:f(D)("page.jobBatch.taskBatchStatus")},{default:l(()=>[f(Ne)(d.value.taskBatchStatus)?(c(),R(f(_e),{key:0,color:C(f(G)[d.value.taskBatchStatus].color)},{default:l(()=>[x(N(f(G)[d.value.taskBatchStatus].title),1)]),_:1},8,["color"])):$("",!0),f(Ne)(d.value.jobStatus)?(c(),R(f(_e),{key:1,color:C(f(Je)[d.value.jobStatus].color)},{default:l(()=>[x(N(f(D)(f(Je)[d.value.jobStatus].name)),1)]),_:1},8,["color"])):$("",!0)]),_:1},8,["label"]),n(A,{label:f(D)("page.jobBatch.executionAt")},{default:l(()=>[x(N(d.value?.executionAt),1)]),_:1},8,["label"]),n(A,{label:f(D)("page.jobBatch.operationReason")},{default:l(()=>[f(Ne)(d.value.operationReason)?(c(),R(f(_e),{key:0,color:C(f(Ze)[d.value.operationReason].color)},{default:l(()=>[x(N(f(D)(f(Ze)[d.value.operationReason].name)),1)]),_:1},8,["color"])):$("",!0)]),_:1},8,["label"]),f(s).default?$("",!0):(c(),R(A,{key:0,label:f(D)("page.jobBatch.executorType")},{default:l(()=>[f(Ne)(d.value.executorType)?(c(),R(f(_e),{key:0,color:C(f(Ke)[d.value.executorType].color)},{default:l(()=>[x(N(f(D)(f(Ke)[d.value.executorType].name)),1)]),_:1},8,["color"])):$("",!0)]),_:1},8,["label"])),n(A,{label:f(D)("page.jobBatch.executorInfo"),span:2},{default:l(()=>[x(N(d.value?.executorInfo),1)]),_:1},8,["label"]),n(A,{label:f(D)("common.createDt"),span:2},{default:l(()=>[x(N(d.value?.createDt),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["show"]),ge(h.$slots,"default",{},void 0,!0)]),_:3},8,["tab"]),n(V,{name:"task",tab:"任务项列表",disabled:d.value.taskBatchStatus===99},{default:l(()=>[n(E,{"row-data":d.value,onShowLog:U,onRetry:I},null,8,["row-data"])]),_:1},8,["disabled"])]),_:3})]),_:2},1032,["name","tab"]))),128))]),_:3},8,["value"])):$("",!0)]),_:2},[h.ids&&h.ids.length>1?{name:"footer",fn:l(()=>[n(ee,{page:u.value,"onUpdate:page":[L[1]||(L[1]=q=>u.value=q),X],class:"text-center","page-size":1,"page-count":h.ids.length},null,8,["page","page-count"])]),key:"0"}:void 0]),1032,["modelValue"]),n(H,{show:b.value,"onUpdate:show":L[3]||(L[3]=q=>b.value=q),title:"日志详情","task-data":g.value},null,8,["show","task-data"])],64)}}}),Pe=me(gn,[["__scopeId","data-v-734c0e54"]]),yn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function wn(e,a){return c(),B("svg",yn,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M752 664c-28.5 0-54.8 10-75.4 26.7L469.4 540.8a160.7 160.7 0 0 0 0-57.6l207.2-149.9C697.2 350 723.5 360 752 360c66.2 0 120-53.8 120-120s-53.8-120-120-120s-120 53.8-120 120c0 11.6 1.6 22.7 4.7 33.3L439.9 415.8C410.7 377.1 364.3 352 312 352c-88.4 0-160 71.6-160 160s71.6 160 160 160c52.3 0 98.7-25.1 127.9-63.8l196.8 142.5c-3.1 10.6-4.7 21.8-4.7 33.3c0 66.2 53.8 120 120 120s120-53.8 120-120s-53.8-120-120-120m0-476c28.7 0 52 23.3 52 52s-23.3 52-52 52s-52-23.3-52-52s23.3-52 52-52M312 600c-48.5 0-88-39.5-88-88s39.5-88 88-88s88 39.5 88 88s-39.5 88-88 88m440 236c-28.7 0-52-23.3-52-52s23.3-52 52-52s52 23.3 52 52s-23.3 52-52 52"},null,-1)])])}const kn=ae({name:"ant-design-share-alt-outlined",render:wn}),Nn={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function xn(e,a){return c(),B("svg",Nn,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8m0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8m0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8M104 228a56 56 0 1 0 112 0a56 56 0 1 0-112 0m0 284a56 56 0 1 0 112 0a56 56 0 1 0-112 0m0 284a56 56 0 1 0 112 0a56 56 0 1 0-112 0"},null,-1)])])}const $n=ae({name:"ant-design-unordered-list-outlined",render:xn}),Sn={class:"add-node-btn-box"},Vn={class:"add-node-btn"},Bn={class:"add-node-popover-body"},Tn={class:"icon"},Cn=F({name:"AddNode",__name:"add-node",props:{modelValue:{},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,p=a,s=t=>{let o={};t===1?o={nodeName:D("workflow.node.task.nodeName"),nodeType:1,conditionNodes:[{nodeName:D("workflow.node.task.conditionNodes.nodeName"),failStrategy:1,priorityLevel:1,workflowNodeStatus:1,jobTask:{jobId:void 0}}],childNode:i.modelValue}:t===2?o={nodeName:D("workflow.node.condition.nodeName"),nodeType:2,conditionNodes:[{nodeName:`${D("workflow.node.condition.conditionNodes.nodeName")} 1`,priorityLevel:1,decision:{expressionType:1,nodeExpression:void 0,logicalCondition:1,defaultDecision:0}},{nodeName:D("workflow.node.condition.conditionNodes.otherNodeName"),priorityLevel:2,decision:{expressionType:1,nodeExpression:"#true",logicalCondition:1,defaultDecision:1}}],childNode:i.modelValue}:t===3&&(o={nodeName:D("workflow.node.callback.nodeName"),nodeType:3,conditionNodes:[{nodeName:D("workflow.node.callback.conditionNodes.nodeName"),workflowNodeStatus:1,callback:{webhook:void 0,contentType:void 0,secret:void 0}}],childNode:i.modelValue}),p("update:modelValue",o)};return(t,o)=>{const b=pt,r=ie,u=$n,d=kn,m=Xe;return c(),B("div",Sn,[_("div",Vn,[t.disabled?$("",!0):(c(),R(m,{key:0,placement:"right-end",trigger:"click","overlay-style":{width:"296px"}},{trigger:l(()=>[n(r,{type:"primary",circle:"",strong:""},{default:l(()=>[n(b)]),_:1})]),default:l(()=>[_("div",Bn,[_("ul",Tn,[_("li",null,[n(r,{circle:"",size:"large",onClick:o[0]||(o[0]=k=>s(1))},{default:l(()=>[n(u,{class:"text-20px color-#3296fa"})]),_:1}),_("p",null,N(f(D)("workflow.node.task.nodeName")),1)]),_("li",null,[n(r,{circle:"",size:"large",onClick:o[1]||(o[1]=k=>s(2))},{default:l(()=>[n(d,{class:"text-20px color-#15bc83"})]),_:1}),_("p",null,N(f(D)("workflow.node.condition.nodeName")),1)])])])]),_:1}))])])}}}),ve=me(Cn,[["__scopeId","data-v-a08c8cf7"]]),Dn={class:"node-wrap"},Ln={class:"branch-box"},Un={class:"condition-node"},Rn={class:"condition-node-box"},In={class:"popover"},Mn={class:"popover-item"},jn={class:"popover-item"},En=["onClick"],zn=["onClick"],An={class:"title"},On={class:"text color-#3296fa"},Yn={key:0},Hn={class:"priority-title"},qn={class:"content min-h-72px"},Xn={key:0,class:"placeholder"},Wn={class:"inline-block max-w-190px overflow-hidden whitespace-nowrap"},Pn={class:"flex-y-center gap-8px"},Fn={class:"flex-y-center gap-6px"},Gn={class:"flex-y-center gap-6px"},Jn=["onClick"],Zn={key:1,class:"top-left-cover-line"},Kn={key:2,class:"bottom-left-cover-line"},Qn={key:3,class:"top-right-cover-line"},el={key:4,class:"bottom-right-cover-line"},tl=F({name:"TaskNode",__name:"task-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["refresh","update:modelValue"],setup(e,{emit:a}){const i=e,p=a,s=fe(),t=Jt(),o=y({});W(()=>i.modelValue,V=>{o.value=V},{immediate:!0});const b=()=>{const V=o.value.conditionNodes.length+1;o.value.conditionNodes?.push({nodeName:`${D("workflow.node.task.name")} ${V}`,priorityLevel:V,failStrategy:1,workflowNodeStatus:1,jobTask:{jobId:void 0}}),p("update:modelValue",o.value)},r=(V,E)=>{V.childNode?r(V.childNode,E):V.childNode=E},u=V=>{o.value.conditionNodes.length===1?(o.value.childNode&&(o.value.conditionNodes[0].childNode?r(o.value.conditionNodes[0].childNode,o.value.childNode):o.value.conditionNodes[0].childNode=o.value.childNode),ue(()=>{p("update:modelValue",o.value.conditionNodes[0].childNode)})):o.value.conditionNodes?.splice(V,1)},d=(V,E=1)=>{o.value.conditionNodes[V]=o.value.conditionNodes.splice(V+E,1,o.value.conditionNodes[V])[0],o.value.conditionNodes?.map((P,ee)=>P.priorityLevel=ee+1),p("update:modelValue",o.value)},m=y(0),k=y(!1),w=y({}),v=V=>{const E=o.value.conditionNodes[m.value].priorityLevel,P=V.priorityLevel;o.value.conditionNodes[m.value]=V,E!==P&&d(m.value,P-E),p("update:modelValue",o.value)},T=V=>{i.disabled||(m.value=V,w.value=JSON.parse(JSON.stringify(o.value.conditionNodes[V])),k.value=!0)},S=V=>i.disabled?s.type===2?`node-error node-error-${V.taskBatchStatus&&G[V.taskBatchStatus]?G[V.taskBatchStatus].name:"default"}`:"node-error":"auto-judge-def auto-judge-hover",g=y(),U=y(),I=y(!1),C=y([]),X=(V,E)=>{U.value=[],s.type===2?(V.jobBatchList?.sort((P,ee)=>P.taskBatchStatus-ee.taskBatchStatus).forEach(P=>{P.id?U.value?.push(P.id):P.jobId&&(g.value=P.jobId?.toString())}),V.jobTask?.jobId&&(g.value=V.jobTask?.jobId?.toString()),I.value=!0):s.type===1?C.value[E]=!0:T(E)},h=async V=>{const{error:E}=await po(V.id,s.id);E||(t.success("执行重试成功"),p("refresh"))},L=async V=>{const{error:E}=await mo(V.id,s.id);E||(t.success("停止任务成功"),p("refresh"))},A=V=>V===4||V===5||V===6,O=V=>V===1||V===2,Y=V=>A(V)||O(V);return(V,E)=>{const P=ie,ee=ut,de=it,H=rn,q=vt,M=Se,j=We,ce=_e,Fe=ye,bt=Be,gt=ft,yt=Xe,wt=Ie;return c(),B("div",Dn,[_("div",Ln,[V.disabled?$("",!0):(c(),R(P,{key:0,class:"add-branch",strong:"",type:"success",onClick:b},{default:l(()=>[x(N(f(D)("workflow.node.task.add")),1)]),_:1})),(c(!0),B(Z,null,ne(o.value.conditionNodes,(z,Q)=>(c(),B("div",{key:Q,class:"col-box"},[_("div",Un,[_("div",Rn,[n(yt,{disabled:f(s).type!==2||!Y(z.taskBatchStatus)},{trigger:l(()=>[_("div",{class:be(["auto-judge cursor-pointer",S(z)]),onClick:oe=>X(z,Q)},[Q!=0?(c(),B("div",{key:0,class:"sort-left",onClick:re(oe=>d(Q,-1),["stop"])},[n(q)],8,zn)):$("",!0),_("div",An,[_("span",On,[n(M,{processing:"",dot:"",color:z.workflowNodeStatus===1?"#52c41a":"#ff4d4f"},null,8,["color"]),x("  "+N(z.nodeName)+" ",1),z.id?(c(),B("span",Yn," ("+N(z.id)+")",1)):$("",!0)]),_("span",Hn,N(f(D)("workflow.node.priority"))+N(z.priorityLevel),1),V.disabled?$("",!0):(c(),R(j,{key:0,class:"close",onClick:re(oe=>u(Q),["stop"])},null,8,["onClick"]))]),_("div",qn,[z.jobTask?.jobId?$("",!0):(c(),B("div",Xn,"请选择任务")),z.jobTask?.jobId?(c(),B(Z,{key:1},[_("div",null,[z.jobTask?.labels?(c(),R(Fe,{key:0},{trigger:l(()=>[_("div",Wn,[_("div",Pn,[E[5]||(E[5]=_("span",{class:"content_label"},"标签:",-1)),_("div",Fn,[n(_o,{labels:z.jobTask?.labels},null,8,["labels"])])])])]),default:l(()=>[_("div",Gn,[(c(!0),B(Z,null,ne(Object.entries(JSON.parse(z.jobTask?.labels||"{}")),([oe,kt])=>(c(),R(ce,{key:oe,type:"default"},{default:l(()=>[x(N(oe)+":"+N(kt),1)]),_:2},1024))),128))])]),_:2},1024)):$("",!0)]),_("div",null,[n(bt,{class:"max-w-123px"},{default:l(()=>[E[6]||(E[6]=_("span",{class:"content_label"},"任务名称: ",-1)),x(" "+N(`${z.jobTask?.jobName}(${z.jobTask?.jobId})`),1)]),_:2,__:[6]},1024)]),_("div",null,[E[7]||(E[7]=_("span",{class:"content_label"},"失败策略: ",-1)),x(" "+N(f(D)(f(lt)[z.failStrategy])),1)]),E[8]||(E[8]=_("div",null,".........",-1))],64)):$("",!0)]),Q!=o.value.conditionNodes.length-1?(c(),B("div",{key:1,class:"sort-right",onClick:re(oe=>d(Q),["stop"])},[n(gt)],8,Jn)):$("",!0)],10,En)]),default:l(()=>[_("div",In,[A(z.taskBatchStatus)?(c(),R(P,{key:0,text:"",onClick:oe=>h(z)},{default:l(()=>[_("span",Mn,[n(ee,{class:"mb-3px text-24px font-bold"}),x(" "+N(f(D)("common.retry")),1)])]),_:2},1032,["onClick"])):$("",!0),O(z.taskBatchStatus)&&A(z.taskBatchStatus)?(c(),R(de,{key:1,vertical:""})):$("",!0),O(z.taskBatchStatus)?(c(),R(P,{key:2,text:"",onClick:oe=>L(z)},{default:l(()=>[_("span",jn,[n(H),x(" "+N(f(D)("common.stop")),1)])]),_:2},1032,["onClick"])):$("",!0)])]),_:2},1032,["disabled"]),f(s).type===2&&z.taskBatchStatus?(c(),R(Fe,{key:0},{trigger:l(()=>[_("div",{class:"task-error-tip text-24px",style:pe({color:f(G)[z.taskBatchStatus].color})},[n(wt,{icon:f(G)[z.taskBatchStatus].icon},null,8,["icon"])],4)]),default:l(()=>[x(" "+N(f(G)[z.taskBatchStatus].title),1)]),_:2},1024)):$("",!0),n(ve,{modelValue:z.childNode,"onUpdate:modelValue":oe=>z.childNode=oe,disabled:V.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),z.childNode?ge(V.$slots,"default",{key:0,node:z},void 0,!0):$("",!0),Q==0?(c(),B("div",Zn)):$("",!0),Q==0?(c(),B("div",Kn)):$("",!0),Q==o.value.conditionNodes.length-1?(c(),B("div",Qn)):$("",!0),Q==o.value.conditionNodes.length-1?(c(),B("div",el)):$("",!0),f(s).type!==0?(c(),R(_n,{key:5,open:C.value[Q],"onUpdate:open":oe=>C.value[Q]=oe,"model-value":o.value.conditionNodes[Q]},null,8,["open","onUpdate:open","model-value"])):$("",!0)]))),128))]),o.value.conditionNodes.length>1?(c(),R(ve,{key:0,modelValue:o.value.childNode,"onUpdate:modelValue":E[0]||(E[0]=z=>o.value.childNode=z),disabled:V.disabled},null,8,["modelValue","disabled"])):$("",!0),f(s).type===0?(c(),R(hn,{key:1,open:k.value,"onUpdate:open":E[1]||(E[1]=z=>k.value=z),modelValue:w.value,"onUpdate:modelValue":E[2]||(E[2]=z=>w.value=z),len:o.value.conditionNodes.length,"onUpdate:len":E[3]||(E[3]=z=>o.value.conditionNodes.length=z),onSave:v},null,8,["open","modelValue","len"])):$("",!0),f(s).type!==0?(c(),R(Pe,{key:2,id:g.value,show:I.value,"onUpdate:show":E[4]||(E[4]=z=>I.value=z),ids:U.value},null,8,["id","show","ids"])):$("",!0)])}}}),ol=me(tl,[["__scopeId","data-v-1c4c7c4f"]]),nl={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function ll(e,a){return c(),B("svg",nl,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372"},null,-1),_("path",{fill:"currentColor",d:"M464 336a48 48 0 1 0 96 0a48 48 0 1 0-96 0m72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8"},null,-1)])])}const ht=ae({name:"ant-design-info-circle-outlined",render:ll}),al={class:"w-460px flex-center"},sl=F({name:"BranchDrawer",__name:"branch-drawer",props:{open:{type:Boolean,default:!1},len:{default:0},modelValue:{default:()=>({})}},emits:["update:open","save"],setup(e,{emit:a}){const i=e,p=a,s=y(!1),t=y({decision:{logicalCondition:1,expressionType:1,nodeExpression:"",checkContents:[]}});W(()=>i.open,w=>{s.value=w},{immediate:!0}),W(()=>i.modelValue,w=>{t.value=w},{immediate:!0});const o=y(),b=()=>{p("update:open",!1),s.value=!1},r=()=>{o.value?.validate(w=>{w||(b(),p("save",t.value))}).catch(()=>window.$message?.warning("请检查表单信息"))},u=y(""),d=y("success"),m=async()=>{if(d.value="error",!t.value.decision?.nodeExpression){u.value="请填写条件表达式";return}const{error:w,data:v}=await fo(t.value.decision);if(w){u.value="接口请求失败";return}else if(v.key!==1||!v.value){u.value=v.value||"请检查条件表达式";return}d.value="success",u.value="表达式校验通过"},k={decision:{expressionType:[{required:!0,message:"请选择表达式类型",trigger:"change",type:"number"}],nodeExpression:[{required:!0,message:"请填写条件表达式",trigger:"blur"}]}};return(w,v)=>{const T=Ue,S=je,g=Re,U=Me,I=Le,C=ko,X=ct,h=ie,L=De,A=Ce,O=Te;return c(),R(O,{show:s.value,"onUpdate:show":v[5]||(v[5]=Y=>s.value=Y),"display-directive":"if",width:500,onAfterLeave:b},{default:l(()=>[n(A,null,{header:l(()=>[_("div",al,[n(Ee,{modelValue:t.value.nodeName,"onUpdate:modelValue":v[0]||(v[0]=Y=>t.value.nodeName=Y),class:"mr-16px max-w-320px min-w-320px"},null,8,["modelValue"]),n(T,{value:t.value.priorityLevel,"onUpdate:value":v[1]||(v[1]=Y=>t.value.priorityLevel=Y),class:"max-w-110px",options:Array(w.len).fill(0).map((Y,V)=>({label:"优先级 "+(V+1),value:V+1}))},null,8,["value","options"])])]),footer:l(()=>[n(h,{type:"primary",onClick:r},{default:l(()=>v[7]||(v[7]=[x("保存")])),_:1,__:[7]}),n(h,{class:"ml-12px",onClick:b},{default:l(()=>v[8]||(v[8]=[x("取消")])),_:1,__:[8]})]),default:l(()=>[n(L,{ref_key:"formRef",ref:o,rules:k,model:t.value,"label-align":"left","label-width":"100px"},{default:l(()=>[n(I,{path:"decision.expressionType",label:"表达式类型"},{default:l(()=>[n(U,{value:t.value.decision.expressionType,"onUpdate:value":v[2]||(v[2]=Y=>t.value.decision.expressionType=Y)},{default:l(()=>[n(g,null,{default:l(()=>[(c(!0),B(Z,null,ne(f(Zt),Y=>(c(),R(S,{key:Y.value,label:Y.label,value:Y.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),n(I,{path:"decision.nodeExpression",label:"条件表达式","validation-status":d.value,feedback:u.value},{default:l(()=>[n(C,{modelValue:t.value.decision.nodeExpression,"onUpdate:modelValue":v[3]||(v[3]=Y=>t.value.decision.nodeExpression=Y),placeholder:"请输入条件表达式"},null,8,["modelValue"])]),_:1},8,["validation-status","feedback"]),n(I,{path:"decision.checkContents",label:"模拟上下文","show-feedback":t.value.decision?.checkContents&&t.value.decision.checkContents.length===0},{default:l(()=>[n(X,{value:t.value.decision.checkContents,"onUpdate:value":v[4]||(v[4]=Y=>t.value.decision.checkContents=Y),path:"decision.checkContents"},null,8,["value"])]),_:1},8,["show-feedback"]),n(I,{"show-label":!1,"show-feedback":!1},{default:l(()=>[n(h,{type:"primary",ghost:"",block:"",onClick:m},{default:l(()=>v[6]||(v[6]=[x("校验条件表达式")])),_:1,__:[6]})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),il=me(sl,[["__scopeId","data-v-46c51c05"]]),_t=F({name:"BranchDesc",__name:"branch-desc",props:{modelValue:{default:()=>({})}},setup(e){const a=e,i=y(""),p=y({".cm-line":{fontSize:"18px"},".cm-scroller":{minHeight:"180px",overflowY:"auto",overflowX:"hidden"}}),s=()=>{const b=document.getElementById("branch-desc")?.querySelector(".n-descriptions-table")?.querySelector("tbody"),r=document.createElement("tr");r.className="n-descriptions-table-row";const u=document.createElement("th");u.className="n-descriptions-table-header",u.innerHTML="条件表达式",u.setAttribute("colspan","4"),r.appendChild(u),b?.insertBefore(r,b?.childNodes[4]);const m=b.getElementsByClassName("n-descriptions-table-row")[3];m.querySelector(".n-descriptions-table-header")?.remove();const k=m.querySelector(".n-descriptions-table-content");k.setAttribute("style","padding: 0"),k?.setAttribute("colspan","4")};return xe(()=>{ue(()=>{s()}),a.modelValue.decision?.nodeExpression&&(i.value=a.modelValue.decision.nodeExpression)}),(t,o)=>{const b=ke,r=we;return c(),R(r,{id:"branch-desc",column:2,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(b,{label:"节点名称",span:2},{default:l(()=>[x(N(t.modelValue.nodeName),1)]),_:1}),n(b,{label:"表达式类型"},{default:l(()=>[x(N(f(dt)[t.modelValue.decision?.expressionType]),1)]),_:1}),n(b,{label:"条件表达式",span:2,"content-style":{padding:0}},{default:l(()=>[n(f(No),{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=u=>i.value=u),readonly:"",disabled:"",theme:p.value,basic:"",lang:f($o)(),extensions:[f(xo)]},null,8,["modelValue","theme","lang","extensions"])]),_:1})]),_:1})}}}),dl=F({name:"BranchDetail",__name:"branch-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,p=a,s=y(!1),t=()=>{p("update:open",!1)};return W(()=>i.open,o=>{s.value=o},{immediate:!0}),(o,b)=>{const r=$e;return c(),R(r,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=u=>s.value=u),title:"决策详情",width:["500px","90%"],onAfterLeave:t},{default:l(()=>[s.value?(c(),R(_t,{key:0,"model-value":o.modelValue},null,8,["model-value"])):$("",!0)]),_:1},8,["modelValue"])}}}),rl={class:"branch-wrap"},ul={class:"branch-box-wrap"},cl={class:"branch-box"},pl={class:"condition-node"},ml={class:"condition-node-box"},fl=["onClick"],vl=["onClick"],hl={class:"title"},_l={class:"node-title"},bl={key:0},gl={class:"priority-title"},yl={class:"content"},wl=["innerHTML"],kl={key:1,class:"placeholder"},Nl=["onClick"],xl={key:1,class:"top-left-cover-line"},$l={key:2,class:"bottom-left-cover-line"},Sl={key:3,class:"top-right-cover-line"},Vl={key:4,class:"bottom-right-cover-line"},Bl=F({name:"BranchNode",__name:"branch-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,p=a,s=fe(),t=y({});W(()=>i.modelValue,h=>{t.value=h},{immediate:!0});const o=()=>{const h=t.value.conditionNodes.length;t.value.conditionNodes.splice(-1,0,{nodeName:`${D("workflow.node.condition.conditionNodes.nodeName")} ${h}`,priorityLevel:h,decision:{expressionType:1,nodeExpression:void 0,logicalCondition:1,defaultDecision:0}}),t.value.conditionNodes[h].priorityLevel=h+1},b=(h,L)=>{h.childNode?b(h.childNode,L):h.childNode=L},r=h=>{t.value.conditionNodes?.splice(h,1),t.value.conditionNodes.length===1&&(t.value.childNode&&(t.value.conditionNodes[0].childNode?b(t.value.conditionNodes[0].childNode,t.value.childNode):t.value.conditionNodes[0].childNode=t.value.childNode),ue(()=>{p("update:modelValue",t.value.conditionNodes[0].childNode)}))},u=(h,L=1)=>{t.value.conditionNodes[h]=t.value.conditionNodes.splice(h+L,1,t.value.conditionNodes[h])[0],t.value.conditionNodes?.map((A,O)=>A.priorityLevel=O+1),p("update:modelValue",t.value)},d=(h,L)=>{const{nodeName:A,decision:O}=h.conditionNodes[L],{expressionType:Y,nodeExpression:V}=O;return V?A!==D("workflow.node.condition.conditionNodes.otherNodeName")?`<span class="content_label">${D("workflow.node.condition.conditionNodes.expressionType")}: </span>${dt[Y]}
<span class="content_label">${D("workflow.node.condition.conditionNodes.nodeExpression")}: </span><span style="display: inline-block; vertical-align: bottom; width: 120px; overflow: hidden; text-overflow: ellipsis">${V}<span/>`:D("workflow.node.condition.conditionNodes.otherNodeTip"):A===D("workflow.node.condition.conditionNodes.otherNodeName")?D("workflow.node.condition.conditionNodes.otherNodeTip"):null},m=y(0),k=y(!1),w=y([]),v=y({}),T=h=>{const L=t.value.conditionNodes[m.value].priorityLevel,A=h.priorityLevel;t.value.conditionNodes[m.value]=h,L!==A&&u(m.value,A-L),p("update:modelValue",t.value)},S=h=>{!i.disabled&&h!==t.value.conditionNodes.length-1?(m.value=h,v.value=JSON.parse(JSON.stringify(t.value.conditionNodes[h])),k.value=!0):s.type!==0&&(w.value[h]=!0)},g=y([]),U=y(""),I=y([]),C=(h,L)=>{if(I.value=[],h.nodeName!==D("workflow.node.condition.conditionNodes.otherNodeName"))if(s.type===2){if(h.jobBatchList?.forEach(A=>{A.id?I.value?.push(A.id):A.jobId&&(U.value=A.jobId?.toString())}),I.value.length===0){w.value[L]=!0;return}g.value[L]=!0}else s.type===1?w.value[L]=!0:S(L)},X=h=>i.disabled?s.type===2?h.nodeName===D("workflow.node.condition.conditionNodes.otherNodeName")?`node-disabled node-error node-error-${h.taskBatchStatus?G[h.taskBatchStatus].name:"default"}`:`node-error node-error-${h.taskBatchStatus?G[h.taskBatchStatus].name:"default"}`:h.nodeName===D("workflow.node.condition.conditionNodes.otherNodeName")?"node-disabled":"node-error":h.nodeName===D("workflow.node.condition.conditionNodes.otherNodeName")?"node-disabled":"auto-judge-def auto-judge-hover";return(h,L)=>{const A=ie,O=vt,Y=Se,V=ht,E=ye,P=We,ee=ft,de=Ie;return c(),B("div",rl,[_("div",ul,[_("div",cl,[h.disabled?$("",!0):(c(),R(A,{key:0,strong:"",type:"success",class:"add-branch",onClick:o},{default:l(()=>[x(N(f(D)("workflow.node.condition.addBranch")),1)]),_:1})),(c(!0),B(Z,null,ne(t.value.conditionNodes,(H,q)=>(c(),B("div",{key:q,class:"col-box"},[_("div",pl,[_("div",ml,[_("div",{class:be(["auto-judge",X(H)]),onClick:M=>C(H,q)},[q!==0?(c(),B("div",{key:0,class:"sort-left",onClick:re(M=>u(q,-1),["stop"])},[n(O)],8,vl)):$("",!0),_("div",hl,[_("span",_l,[n(Y,{dot:"",processing:"",color:"#52c41a"}),x("  "+N(H.nodeName)+" ",1),H.id&&H.nodeName!==f(D)("workflow.node.condition.conditionNodes.otherNodeName")?(c(),B("span",bl,"  ("+N(H.id)+") ",1)):$("",!0),H.nodeName===f(D)("workflow.node.condition.conditionNodes.otherNodeName")?(c(),R(E,{key:1},{trigger:l(()=>[n(V,{class:"ml-3px text-16px"})]),default:l(()=>[x(" "+N(f(D)("workflow.node.condition.conditionNodes.otherTip")),1)]),_:1})):$("",!0)]),_("span",gl,N(f(D)("workflow.node.condition.conditionNodes.priority"))+N(H.priorityLevel),1),h.disabled?$("",!0):(c(),R(P,{key:0,class:"close",onClick:re(M=>r(q),["stop"])},null,8,["onClick"]))]),_("div",yl,[d(t.value,q)?(c(),B("span",{key:0,innerHTML:d(t.value,q)},null,8,wl)):(c(),B("span",kl,N(f(D)("workflow.node.condition.conditionNodes.conditionTip")),1))]),q!==t.value.conditionNodes.length-2?(c(),B("div",{key:1,class:"sort-right",onClick:re(M=>u(q),["stop"])},[n(ee)],8,Nl)):$("",!0),f(s).type===2&&H.taskBatchStatus?(c(),R(E,{key:2},{trigger:l(()=>[_("div",{class:"error-tip text-24px",style:pe({color:f(G)[H.taskBatchStatus].color})},[n(de,{icon:f(G)[H.taskBatchStatus].icon},null,8,["icon"])],4)]),default:l(()=>[x(" "+N(f(G)[H.taskBatchStatus].title),1)]),_:2},1024)):$("",!0)],10,fl),n(ve,{modelValue:H.childNode,"onUpdate:modelValue":M=>H.childNode=M,disabled:h.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),H.childNode?ge(h.$slots,"default",{key:0,node:H},void 0,!0):$("",!0),q==0?(c(),B("div",xl)):$("",!0),q==0?(c(),B("div",$l)):$("",!0),q==t.value.conditionNodes.length-1?(c(),B("div",Sl)):$("",!0),q==t.value.conditionNodes.length-1?(c(),B("div",Vl)):$("",!0),n(dl,{open:w.value[q],"onUpdate:open":M=>w.value[q]=M,modelValue:t.value.conditionNodes[q],"onUpdate:modelValue":M=>t.value.conditionNodes[q]=M},null,8,["open","onUpdate:open","modelValue","onUpdate:modelValue"]),n(Pe,{id:U.value,show:g.value[q],"onUpdate:show":M=>g.value[q]=M,ids:I.value},{default:l(()=>[L[4]||(L[4]=_("div",{class:"header-border"},[_("span",{class:"pl-12px"},"决策节点详情")],-1)),n(_t,{"model-value":t.value.conditionNodes[q]},null,8,["model-value"])]),_:2,__:[4]},1032,["id","show","onUpdate:show","ids"])]))),128))]),n(ve,{modelValue:t.value.childNode,"onUpdate:modelValue":L[0]||(L[0]=H=>t.value.childNode=H),disabled:h.disabled},null,8,["modelValue","disabled"])]),n(il,{open:k.value,"onUpdate:open":L[1]||(L[1]=H=>k.value=H),modelValue:v.value,"onUpdate:modelValue":L[2]||(L[2]=H=>v.value=H),len:t.value.conditionNodes.length,"onUpdate:len":L[3]||(L[3]=H=>t.value.conditionNodes.length=H),onSave:T},null,8,["open","modelValue","len"])])}}}),Tl=me(Bl,[["__scopeId","data-v-6a4f17b4"]]),Cl={class:"inline-block",viewBox:"0 0 1024 1024",width:"1em",height:"1em"};function Dl(e,a){return c(),B("svg",Cl,[...a[0]||(a[0]=[_("path",{fill:"currentColor",d:"M112 476h160v72H112zm320 0h160v72H432zm320 0h160v72H752z"},null,-1)])])}const Ll=ae({name:"ant-design-dash-outlined",render:Dl}),Ul={class:"w-460px flex items-center"},Rl=F({name:"CallbackDrawer",__name:"callback-drawer",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open","save"],setup(e,{emit:a}){const i=e,p=a,s=y(!1),t=y({});W(()=>i.open,d=>{s.value=d},{immediate:!0}),W(()=>i.modelValue,d=>{t.value=d},{immediate:!0});const o=y(),b=()=>{p("update:open",!1),s.value=!1},r=()=>{o.value?.validate(d=>{d||(b(),p("save",t.value))}).catch(()=>window.$message?.warning("请检查表单信息"))},u={workflowNodeStatus:[{required:!0,message:"请选择工作流状态",trigger:"change"}],callback:{webhook:[{required:!0,message:"请输入 webhook",trigger:"change"}],contentType:[{required:!0,message:"请选择请求类型",trigger:"change",type:"number"}],secret:[{required:!0,message:"请输入秘钥",trigger:"change"}]}};return(d,m)=>{const k=Ye,w=Le,v=Ue,T=je,S=Re,g=Me,U=De,I=ie,C=Ce,X=Te;return c(),R(X,{show:s.value,"onUpdate:show":m[5]||(m[5]=h=>s.value=h),"display-directive":"if",width:500,onAfterLeave:b},{default:l(()=>[n(C,null,{header:l(()=>[_("div",Ul,[n(Ee,{modelValue:t.value.nodeName,"onUpdate:modelValue":m[0]||(m[0]=h=>t.value.nodeName=h),class:"mr-16px max-w-320px min-w-320px"},null,8,["modelValue"])])]),footer:l(()=>[n(I,{type:"primary",onClick:r},{default:l(()=>m[6]||(m[6]=[x("保存")])),_:1,__:[6]}),n(I,{class:"ml-12px",onClick:b},{default:l(()=>m[7]||(m[7]=[x("取消")])),_:1,__:[7]})]),default:l(()=>[n(U,{ref_key:"formRef",ref:o,model:t.value,rules:u,"label-align":"left","label-width":"100px"},{default:l(()=>[n(w,{path:"callback.webhook",label:"webhook"},{default:l(()=>[n(k,{value:t.value.callback.webhook,"onUpdate:value":m[1]||(m[1]=h=>t.value.callback.webhook=h),placeholder:"请输入 webhook"},null,8,["value"])]),_:1}),n(w,{path:"callback.contentType",label:"请求类型"},{default:l(()=>[n(v,{value:t.value.callback.contentType,"onUpdate:value":m[2]||(m[2]=h=>t.value.callback.contentType=h),options:f(Kt),placeholder:"请选择请求类型"},null,8,["value","options"])]),_:1}),n(w,{path:"callback.secret",label:"秘钥"},{default:l(()=>[n(k,{value:t.value.callback.secret,"onUpdate:value":m[3]||(m[3]=h=>t.value.callback.secret=h),placeholder:"请输入秘钥"},null,8,["value"])]),_:1}),n(w,{name:"workflowNodeStatus",label:"回调通知状态",rules:[{required:!0,message:"请选择回调通知状态",trigger:"change"}]},{default:l(()=>[n(g,{value:t.value.workflowNodeStatus,"onUpdate:value":m[4]||(m[4]=h=>t.value.workflowNodeStatus=h)},{default:l(()=>[n(S,null,{default:l(()=>[(c(!0),B(Z,null,ne(f(He),(h,L)=>(c(),R(T,{key:L,label:f(D)(h.label),value:h.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),Il=F({name:"CallbackDetail",__name:"callback-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,p=a,s=y(!1);W(()=>i.open,o=>{s.value=o},{immediate:!0});const t=()=>{p("update:open",!1)};return(o,b)=>{const r=ke,u=we,d=$e;return c(),R(d,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=m=>s.value=m),title:"回调详情",width:["500px","90%"],onAfterLeave:t},{default:l(()=>[n(u,{column:1,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(r,{label:"节点名称"},{default:l(()=>[x(N(o.modelValue.nodeName),1)]),_:1}),n(r,{label:"webhook"},{default:l(()=>[x(N(o.modelValue.callback?.webhook),1)]),_:1}),n(r,{label:"请求类型"},{default:l(()=>[x(N(f(Ae)[o.modelValue.callback?.contentType]),1)]),_:1}),n(r,{label:"密钥"},{default:l(()=>[x(N(o.modelValue.callback?.secret),1)]),_:1}),n(r,{label:"回调通知状态"},{default:l(()=>[x(N(o.$t(f(qe)[o.modelValue.workflowNodeStatus])),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ml={class:"node-wrap"},jl={class:"branch-box"},El={class:"condition-node min-h-230px"},zl={class:"condition-node-box pt-0px"},Al={class:"popover"},Ol={class:"popover-item"},Yl={class:"popover-item"},Hl=["onClick"],ql={class:"title"},Xl={class:"text text-#935af6"},Wl={class:"flex items-center"},Pl={key:0},Fl={class:"content min-h-81px"},Gl={key:0,class:"placeholder"},Jl={class:"flex justify-between"},Zl={class:"content_label"},Kl={key:1,class:"top-left-cover-line"},Ql={key:2,class:"bottom-left-cover-line"},ea={key:3,class:"top-right-cover-line"},ta={key:4,class:"bottom-right-cover-line"},oa=F({name:"CallbackNode",__name:"callback-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,p=a,s=fe(),t=y({});W(()=>i.modelValue,I=>{t.value=I},{immediate:!0});const o=(I,C)=>{I.childNode?o(I.childNode,C):I.childNode=C},b=()=>{t.value.childNode&&(t.value.conditionNodes[0].childNode?o(t.value.conditionNodes[0].childNode,t.value.childNode):t.value.conditionNodes[0].childNode=t.value.childNode),ue(()=>{p("update:modelValue",t.value.conditionNodes[0].childNode)})},r=y(0),u=y(!1),d=y(!1),m=y({}),k=I=>{t.value.conditionNodes[r.value]=I,p("update:modelValue",t.value)},w=I=>{s.type===0?(r.value=I,m.value=JSON.parse(JSON.stringify(t.value.conditionNodes[I])),u.value=!0):d.value=!0},v=y(!1),T=y(""),S=y([]),g=(I,C)=>{if(S.value=[],s.type===2){if(I.jobBatchList?.forEach(X=>{X.id?S.value?.push(X.id):X.jobId&&(T.value=X.jobId?.toString())}),S.value.length===0){d.value=!0;return}v.value=!0}else s.type===1?d.value=!0:w(C)},U=I=>i.disabled?s.type===2?`node-error node-error-${I.taskBatchStatus?G[I.taskBatchStatus].name:"default"}`:"node-error":"auto-judge-def auto-judge-hover";return(I,C)=>{const X=ut,h=ie,L=it,A=Ll,O=Se,Y=ht,V=ye,E=We,P=Be,ee=Ie,de=Xe,H=ke,q=we;return c(),B("div",Ml,[_("div",jl,[(c(!0),B(Z,null,ne(t.value.conditionNodes,(M,j)=>(c(),B("div",{key:j,class:"col-box"},[_("div",El,[_("div",zl,[n(de,{disabled:f(s).type!==2||!0},{trigger:l(()=>[_("div",{class:be(["auto-judge",U(M)]),onClick:ce=>g(M,j)},[_("div",ql,[_("span",Xl,[_("span",Wl,[n(O,{processing:"",dot:"",color:M.workflowNodeStatus===1?"#52c41a":"#ff4d4f"},null,8,["color"]),x("  "+N(M.nodeName)+" ",1),M.id?(c(),B("span",Pl," ("+N(M.id)+")",1)):$("",!0),n(V,null,{trigger:l(()=>[n(Y,{class:"ml-3px text-16px"})]),default:l(()=>[C[7]||(C[7]=x(" 此节点后续将废弃，请使用定时任务中的 HTTP 内置执行器进行替换。 "))]),_:1,__:[7]})])]),I.disabled?$("",!0):(c(),R(E,{key:0,class:"close",onClick:re(b,["stop"])}))]),_("div",Fl,[M.callback?.webhook?$("",!0):(c(),B("div",Gl,N(f(D)("workflow.node.callback.conditionNodes.webhookTip")),1)),M.callback?.webhook?(c(),B(Z,{key:1},[_("div",Jl,[C[8]||(C[8]=_("span",{class:"content_label"},"Webhook:",-1)),n(P,{class:"w-116px"},{default:l(()=>[x(N(M.callback.webhook),1)]),_:2},1024)]),_("div",null,[_("span",Zl,N(f(D)("workflow.node.callback.conditionNodes.contentType"))+": ",1),x(" "+N(f(Ae)[M.callback.contentType]),1)]),C[9]||(C[9]=_("div",null,".........",-1))],64)):$("",!0)]),f(s).type===2&&M.taskBatchStatus?(c(),R(V,{key:0},{trigger:l(()=>[_("div",{class:"error-tip text-24px",style:pe({color:f(G)[M.taskBatchStatus].color})},[n(ee,{icon:f(G)[M.taskBatchStatus].icon},null,8,["icon"])],4)]),default:l(()=>[x(" "+N(f(G)[M.taskBatchStatus].title),1)]),_:2},1024)):$("",!0)],10,Hl)]),default:l(()=>[_("div",Al,[n(h,{text:""},{default:l(()=>[_("span",Ol,[n(X,{class:"mb-3px text-24px font-bold"}),x(" "+N(f(D)("common.retry")),1)])]),_:1}),n(L,{vertical:""}),n(h,{text:""},{default:l(()=>[_("span",Yl,[n(A,{class:"mb-3px text-24px font-bold"}),C[6]||(C[6]=_("span",null,"忽略",-1))])]),_:1})])]),_:2},1032,["disabled"]),n(ve,{modelValue:M.childNode,"onUpdate:modelValue":ce=>M.childNode=ce,disabled:I.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),M.childNode?ge(I.$slots,"default",{key:0,node:M},void 0,!0):$("",!0),j==0?(c(),B("div",Kl)):$("",!0),j==0?(c(),B("div",Ql)):$("",!0),j==t.value.conditionNodes.length-1?(c(),B("div",ea)):$("",!0),j==t.value.conditionNodes.length-1?(c(),B("div",ta)):$("",!0)]))),128))]),t.value.conditionNodes.length>1?(c(),R(ve,{key:0,modelValue:t.value.childNode,"onUpdate:modelValue":C[0]||(C[0]=M=>t.value.childNode=M),disabled:I.disabled},null,8,["modelValue","disabled"])):$("",!0),f(s).type!==0?(c(),R(Il,{key:1,open:d.value,"onUpdate:open":C[1]||(C[1]=M=>d.value=M),modelValue:t.value.conditionNodes[0],"onUpdate:modelValue":C[2]||(C[2]=M=>t.value.conditionNodes[0]=M)},null,8,["open","modelValue"])):$("",!0),n(Rl,{open:u.value,"onUpdate:open":C[3]||(C[3]=M=>u.value=M),modelValue:m.value,"onUpdate:modelValue":C[4]||(C[4]=M=>m.value=M),onSave:k},null,8,["open","modelValue"]),f(s).type!==0?(c(),R(Pe,{key:2,id:T.value,show:v.value,"onUpdate:show":C[5]||(C[5]=M=>v.value=M),ids:S.value},{default:l(()=>[C[10]||(C[10]=_("div",{class:"header-border"},[_("span",{class:"pl-18px"},"回调节点详情")],-1)),n(q,{column:1,bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(H,{label:"节点名称"},{default:l(()=>[x(N(t.value.conditionNodes[0].nodeName),1)]),_:1}),n(H,{label:"webhook"},{default:l(()=>[x(N(t.value.conditionNodes[0].callback?.webhook),1)]),_:1}),n(H,{label:"请求类型"},{default:l(()=>[x(N(f(Ae)[t.value.conditionNodes[0].callback?.contentType]),1)]),_:1}),n(H,{label:"密钥"},{default:l(()=>[x(N(t.value.conditionNodes[0].callback?.secret),1)]),_:1})]),_:1})]),_:1,__:[10]},8,["id","show","ids"])):$("",!0)])}}}),na=me(oa,[["__scopeId","data-v-a664a95e"]]),la=F({name:"NodeWrap",__name:"node-wrap",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["refresh","update:modelValue"],setup(e,{emit:a}){const i=e,p=a,s=y({});return W(()=>i.modelValue,t=>{s.value=t},{immediate:!0}),W(()=>s.value,t=>{p("update:modelValue",t)}),(t,o)=>{const b=Qt("NodeWrap",!0);return c(),B(Z,null,[s.value.nodeType==1?(c(),R(ol,{key:0,modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=r=>s.value=r),disabled:t.disabled,onRefresh:o[1]||(o[1]=()=>p("refresh"))},{default:l(({node:r})=>[r?(c(),R(b,{key:0,modelValue:r.childNode,"onUpdate:modelValue":u=>r.childNode=u,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])):$("",!0)]),_:1},8,["modelValue","disabled"])):$("",!0),s.value.nodeType==2?(c(),R(Tl,{key:1,modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=r=>s.value=r),disabled:t.disabled},{default:l(({node:r})=>[r?(c(),R(b,{key:0,modelValue:r.childNode,"onUpdate:modelValue":u=>r.childNode=u,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])):$("",!0)]),_:1},8,["modelValue","disabled"])):$("",!0),s.value.nodeType==3?(c(),R(na,{key:2,modelValue:s.value,"onUpdate:modelValue":o[3]||(o[3]=r=>s.value=r),disabled:t.disabled},{default:l(({node:r})=>[r?(c(),R(b,{key:0,modelValue:r.childNode,"onUpdate:modelValue":u=>r.childNode=u,disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])):$("",!0)]),_:1},8,["modelValue","disabled"])):$("",!0),s.value.childNode?(c(),R(b,{key:3,modelValue:s.value.childNode,"onUpdate:modelValue":o[4]||(o[4]=r=>s.value.childNode=r),disabled:t.disabled},null,8,["modelValue","disabled"])):$("",!0)],64)}}}),aa=F({name:"StartDetail",__name:"start-detail",props:{modelValue:{default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open"],setup(e,{emit:a}){const i=e,p=a,s=y(!1);W(()=>i.open,o=>{s.value=o},{immediate:!0});const t=()=>{p("update:open",!1)};return(o,b)=>{const r=ke,u=we,d=$e;return c(),R(d,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=m=>s.value=m),title:"工作流详情",width:["500px","90%"],onAfterLeave:t},{default:l(()=>[n(u,{column:1,"label-placement":"left",bordered:"","label-style":{width:"120px"}},{default:l(()=>[n(r,{label:"工作流名称"},{default:l(()=>[x(N(o.modelValue.workflowName),1)]),_:1}),n(r,{label:"组名称"},{default:l(()=>[x(N(o.modelValue.groupName),1)]),_:1}),n(r,{label:"触发类型"},{default:l(()=>[x(N(f(D)(f(eo)[o.modelValue.triggerType])),1)]),_:1}),n(r,{label:"触发间隔"},{default:l(()=>[x(N(o.modelValue.triggerInterval)+" "+N(o.modelValue.triggerType===2?"秒":null),1)]),_:1}),n(r,{label:"执行超时时间"},{default:l(()=>[x(N(o.modelValue.executorTimeout)+" 秒",1)]),_:1}),n(r,{label:"阻塞策略"},{default:l(()=>[x(N(f(D)(f(rt)[o.modelValue.blockStrategy])),1)]),_:1}),n(r,{label:"工作流上下文"},{default:l(()=>[x(N(o.modelValue.wfContext),1)]),_:1}),n(r,{label:"工作流状态"},{default:l(()=>[x(N(f(D)(f(qe)[o.modelValue.workflowStatus])),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),sa=F({name:"StartDrawer",__name:"start-drawer",props:{modelValue:{default:()=>({wfContexts:[]})},open:{type:Boolean,default:!1}},emits:["update:open","save"],setup(e,{emit:a}){const i=y([]),p=e;xe(()=>{ue(()=>{s()})});async function s(){const g=await Bo(4);i.value=g.data}const t=a,o=fe();let b="";const r=y(!1),u=y({wfContexts:[],notifyIds:[]}),d=y([]);W(()=>p.open,g=>{r.value=g},{immediate:!0}),W(()=>p.modelValue,g=>{u.value=g,g.triggerInterval||(u.value.triggerType=2,u.value.triggerInterval="60"),g.triggerType===2&&(u.value.triggerInterval=g.triggerInterval),g.workflowName?b=g.workflowName:g.groupName?b=g.groupName:b="请选择组",g.wfContext&&(u.value.wfContext=JSON.parse(g.wfContext),u.value.wfContexts=to(g.wfContext))},{immediate:!0});const m=y(),k=()=>{t("update:open",!1),r.value=!1},w=()=>{m.value?.validate(g=>{g||(u.value.wfContext=JSON.stringify(ao(u.value.wfContexts)||{}),k(),t("save",u.value))}).catch(()=>window.$message?.warning("请检查表单信息"))};(async()=>{const{data:g,error:U}=await To();U||(d.value=g)})();const T=g=>{g===3?u.value.triggerInterval="* * * * * ?":g===2&&(u.value.triggerInterval="60")},S={groupName:{required:!0,message:"请选择组"},triggerType:{required:!0,message:"请选择触发类型"},triggerInterval:{required:!0,message:"请输入触发间隔"},executorTimeout:{required:!0,message:"请输入执行超时时间"},blockStrategy:{required:!0,message:"请选择阻塞策略"},workflowStatus:{required:!0,message:"请选择工作流状态"}};return(g,U)=>{const I=Ue,C=Le,X=yo,h=Vo,L=go,A=no,O=je,Y=Re,V=Me,E=ct,P=So,ee=Ye,de=De,H=ie,q=Ce,M=Te;return c(),R(M,{show:r.value,"onUpdate:show":U[11]||(U[11]=j=>r.value=j),"display-directive":"if",width:610,onAfterLeave:k},{default:l(()=>[n(q,{title:f(b)},{header:l(()=>[n(Ee,{modelValue:u.value.workflowName,"onUpdate:modelValue":U[0]||(U[0]=j=>u.value.workflowName=j),class:"max-w-570px min-w-570px"},null,8,["modelValue"])]),footer:l(()=>[n(H,{type:"primary",onClick:w},{default:l(()=>U[13]||(U[13]=[x("保存")])),_:1,__:[13]}),n(H,{class:"ml-12px",onClick:k},{default:l(()=>U[14]||(U[14]=[x("取消")])),_:1,__:[14]})]),default:l(()=>[n(de,{ref_key:"formRef",ref:m,model:u.value,rules:S,"label-align":"left","label-width":"100px"},{default:l(()=>[n(C,{path:"groupName",label:"组名称"},{default:l(()=>[n(I,{value:u.value.groupName,"onUpdate:value":U[1]||(U[1]=j=>u.value.groupName=j),placeholder:"请选择组",disabled:f(o).type===0&&f(Ne)(f(o).id),options:d.value.map(j=>({label:j,value:j}))},null,8,["value","disabled","options"])]),_:1}),n(L,{cols:u.value.triggerType===5?"1":"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[n(X,null,{default:l(()=>[n(C,{path:"triggerType",label:"触发类型"},{default:l(()=>[n(I,{value:u.value.triggerType,"onUpdate:value":[U[2]||(U[2]=j=>u.value.triggerType=j),T],placeholder:"请选择触发类型",options:f(oo).map(j=>({label:f(D)(j.label),value:j.value}))},null,8,["value","options"])]),_:1})]),_:1}),n(X,null,{default:l(()=>[n(C,{label:f(D)("page.jobTask.triggerInterval"),path:"triggerInterval"},{default:l(()=>[n(h,{modelValue:u.value.triggerInterval,"onUpdate:modelValue":U[3]||(U[3]=j=>u.value.triggerInterval=j),"trigger-type":u.value.triggerType??2},null,8,["modelValue","trigger-type"])]),_:1},8,["label"])]),_:1})]),_:1},8,["cols"]),n(L,{cols:24,"x-gap":"20"},{default:l(()=>[n(X,{span:8},{default:l(()=>[n(C,{path:"executorTimeout",label:"执行超时时间"},{default:l(()=>[n(A,{value:u.value.executorTimeout,"onUpdate:value":U[4]||(U[4]=j=>u.value.executorTimeout=j),placeholder:"请输入超时时间",min:1},{suffix:l(()=>U[12]||(U[12]=[x("秒")])),_:1},8,["value"])]),_:1})]),_:1}),n(X,{span:16},{default:l(()=>[n(C,{path:"blockStrategy",label:"阻塞策略"},{default:l(()=>[n(V,{value:u.value.blockStrategy,"onUpdate:value":U[5]||(U[5]=j=>u.value.blockStrategy=j)},{default:l(()=>[n(Y,null,{default:l(()=>[(c(!0),B(Z,null,ne(f(lo),(j,ce)=>(c(),R(O,{key:ce,label:f(D)(j.label),value:j.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),n(C,{path:"wfContext",label:"工作流上下文","show-feedback":!u.value.wfContexts?.length},{default:l(()=>[n(E,{value:u.value.wfContexts,"onUpdate:value":U[6]||(U[6]=j=>u.value.wfContexts=j),path:"wfContexts"},null,8,["value"])]),_:1},8,["show-feedback"]),n(C,{path:"workflowStatus",label:"节点状态"},{default:l(()=>[n(V,{value:u.value.workflowStatus,"onUpdate:value":U[7]||(U[7]=j=>u.value.workflowStatus=j)},{default:l(()=>[n(Y,null,{default:l(()=>[(c(!0),B(Z,null,ne(f(He),(j,ce)=>(c(),R(O,{key:ce,label:f(D)(j.label),value:j.value},null,8,["label","value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),n(C,{path:"ownerId",label:"负责人"},{default:l(()=>[n(P,{value:u.value.ownerId,"onUpdate:value":U[8]||(U[8]=j=>u.value.ownerId=j),clearable:!0},null,8,["value"])]),_:1}),n(C,{path:"notifyIds",label:"告警通知"},{default:l(()=>[n(I,{value:u.value.notifyIds,"onUpdate:value":U[9]||(U[9]=j=>u.value.notifyIds=j),"value-field":"id","label-field":"notifyName",placeholder:"请选择告警通知名称",options:i.value,clearable:"",multiple:""},null,8,["value","options"])]),_:1}),n(C,{path:"description",label:"描述"},{default:l(()=>[n(ee,{value:u.value.description,"onUpdate:value":U[10]||(U[10]=j=>u.value.description=j),type:"textarea",autosize:{minRows:5},placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ia={class:"node-wrap"},da={class:"title"},ra={class:"text"},ua={class:"text-#ff943e"},ca={key:0,class:"content"},pa={key:1,class:"content min-h-85px"},ma=F({name:"StartNode",__name:"start-node",props:{modelValue:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,p=a,s=fe(),t=y({}),o=y({});W(()=>i.modelValue,m=>{o.value=m},{immediate:!0}),W(()=>o.value,m=>{p("update:modelValue",m)}),W(()=>o.value?.groupName,m=>{m&&s.setJobList(m)},{immediate:!0});const b=y(!1),r=y(!1),u=m=>{o.value=m},d=()=>{s.type===0?(t.value=JSON.parse(JSON.stringify(o.value)),b.value=!0):r.value=!0};return(m,k)=>{const w=Se,v=Be,T=Ie,S=ye;return c(),B("div",ia,[_("div",{class:be([`${m.disabled?"start-node-disabled":"node-wrap-box-hover"} ${f(s).type===2?"node-error-success":""}`,"node-wrap-box start-node"]),onClick:d},[_("div",da,[_("span",ra,[n(w,{dot:"",color:o.value.workflowStatus===1?"#52c41a":"#ff000d"},null,8,["color"]),_("span",ua,"  "+N(o.value.workflowName?`${o.value.workflowName} ${o.value.id?` (${o.value.id})`:""}`:"请选择组"),1)])]),o.value.groupName?(c(),B("div",ca,[_("div",null,[n(v,{class:"max-w-132px"},{default:l(()=>[k[5]||(k[5]=_("span",{class:"content_label"},"组名称: ",-1)),x(" "+N(o.value.groupName),1)]),_:1,__:[5]})]),_("div",null,[k[6]||(k[6]=_("span",{class:"content_label"},"阻塞策略: ",-1)),x(" "+N(f(D)(f(rt)[o.value.blockStrategy])),1)]),k[7]||(k[7]=_("div",null,".........",-1))])):(c(),B("div",pa,k[8]||(k[8]=[_("span",{class:"placeholder"},"请配置工作流",-1)]))),f(s).type===2?(c(),R(S,{key:2},{trigger:l(()=>[_("div",{class:"error-tip text-24px",style:pe({color:f(G)[3].color})},[n(T,{icon:f(G)[3].icon},null,8,["icon"])],4)]),default:l(()=>[x(" "+N(f(G)[3].title),1)]),_:1})):$("",!0)],2),n(ve,{modelValue:o.value.nodeConfig,"onUpdate:modelValue":k[0]||(k[0]=g=>o.value.nodeConfig=g),disabled:m.disabled},null,8,["modelValue","disabled"]),f(s).type!==0?(c(),R(aa,{key:0,open:r.value,"onUpdate:open":k[1]||(k[1]=g=>r.value=g),modelValue:o.value,"onUpdate:modelValue":k[2]||(k[2]=g=>o.value=g)},null,8,["open","modelValue"])):$("",!0),n(sa,{open:b.value,"onUpdate:open":k[3]||(k[3]=g=>b.value=g),modelValue:t.value,"onUpdate:modelValue":k[4]||(k[4]=g=>t.value=g),onSave:u},null,8,["open","modelValue"])])}}}),fa=me(ma,[["__scopeId","data-v-dd1877a2"]]),va={class:"workflow"},ha={class:"workflow-affix"},_a={class:"header"},ba={class:"ml-8px mr-8px text-18px text-#333639 dark:text-#d6d6d6"},ga={key:0,class:"buttons flex-y-center"},ya={key:0,class:"flex-y-center gap-6px"},wa={key:1,class:"buttons"},ka={class:"workflow-body"},Na={class:"box-scale"},xa={class:"end-node"},$a={class:"end-node-text"},Oa=F({name:"SnailWorkflow",__name:"workflow",props:{modelValue:{default:()=>({})},spinning:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},updated:{type:Boolean,default:!1}},emits:["update:modelValue","save","cancel","refresh"],setup(e,{emit:a}){const i=e,p=a,s=at(),t=y(100),o=y({}),b=async()=>{p("save")},r=()=>{p("cancel")};W(()=>i.modelValue,w=>{o.value=w},{immediate:!0}),W(()=>o.value,w=>{p("update:modelValue",w)});const u=w=>{if(t.value+=10*w,w>0){const v=document.querySelector(".workflow-body");v&&(t.value<=160&&v.scrollTo({left:280*t.value/100,behavior:"smooth"}),t.value>160&&v.scrollTo({left:420*t.value/100,behavior:"smooth"}),t.value>200&&v.scrollTo({left:520*t.value/100,behavior:"smooth"}))}t.value<=10?t.value=10:t.value>=300&&(t.value=300)},d=w=>{w.preventDefault(),w.wheelDelta<0?u(-1):u(1)};xe(()=>{const w=document.querySelector(".workflow");w&&(w.onwheel=v=>d(v))});const m=()=>{const w=document.querySelector(".workflow-design");w&&w.setAttribute("style",`cursor: grabbing; transform: scale(${t.value/100})`)},k=()=>{const w=document.querySelector(".workflow-design");w&&w.setAttribute("style",`cursor: grab; transform: scale(${t.value/100})`)};return(w,v)=>{const T=Po,S=ie,g=ye,U=pt,I=Se,C=Io,X=st;return c(),B("div",va,[_("div",ha,[n(C,{"trigger-top":0,class:"position-sticky z-2"},{default:l(()=>[_("div",_a,[_("div",null,[n(g,null,{trigger:l(()=>[n(S,{size:"small",strong:"",circle:"",onClick:v[0]||(v[0]=h=>u(-1))},{default:l(()=>[n(T)]),_:1})]),default:l(()=>[v[5]||(v[5]=x(" 缩小 "))]),_:1,__:[5]}),_("span",ba,N(t.value)+"%",1),n(g,null,{trigger:l(()=>[n(S,{size:"small",strong:"",circle:"",onClick:v[1]||(v[1]=h=>u(1))},{default:l(()=>[n(U)]),_:1})]),default:l(()=>[v[6]||(v[6]=x(" 放大 "))]),_:1,__:[6]})]),w.disabled?$("",!0):(c(),B("div",ga,[w.updated?(c(),B("div",ya,[n(I,{dot:"",processing:""}),v[7]||(v[7]=_("span",{class:"mr-16px text-12px text-error"},"修改未保存",-1))])):$("",!0),n(S,{type:"info",onClick:b},{default:l(()=>v[8]||(v[8]=[x("保存")])),_:1,__:[8]}),n(S,{class:"ml-16px",onClick:r},{default:l(()=>v[9]||(v[9]=[x("取消")])),_:1,__:[9]})])),w.disabled&&f(s).buttons?(c(),B("div",wa,[ge(w.$slots,"buttons")])):$("",!0)])]),_:3}),n(X,{show:w.spinning},{default:l(()=>[_("div",ka,[n(f(mt),{class:"vue-drag","is-draggable":!0,"is-resizable":!1,z:1,onDragging:m,onDragstop:k},{default:l(()=>[_("div",{class:"workflow-design",style:pe(`transform: scale(${t.value/100})`)},[_("div",Na,[n(fa,{modelValue:o.value,"onUpdate:modelValue":v[2]||(v[2]=h=>o.value=h),disabled:w.disabled},null,8,["modelValue","disabled"]),o.value.nodeConfig?(c(),R(la,{key:0,modelValue:o.value.nodeConfig,"onUpdate:modelValue":v[3]||(v[3]=h=>o.value.nodeConfig=h),disabled:w.disabled,onRefresh:v[4]||(v[4]=()=>p("refresh"))},null,8,["modelValue","disabled"])):$("",!0),_("div",xa,[v[10]||(v[10]=_("div",{class:"end-node-circle"},null,-1)),_("div",$a,N(f(D)("workflow.node.endNode")),1)])])],4)]),_:1})])]),_:1},8,["show"])])])}}});export{Oa as _,fe as u};
