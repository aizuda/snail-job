import{c as Ye,a as ca,b as ga,N as Ke}from"./search-form-2lTL1-HK.js";import{_ as fa,a as ba,d as va}from"./download-BcoCzhuV.js";import{_ as ya}from"./delete-alert-B5eu0EWD.js";import{d as re,r as E,c as O,o as j,ad as Ne,h as a,ae as Ce,aC as _a,$ as o,aD as Ta,aE as ka,a0 as Se,a1 as Me,n as le,z as ha,A as We,a as Qe,q as ce,w as l,f as e,H as Ze,Q as Pe,C as Xe,D as Ee,E as ea,b as je,a3 as De,a4 as Ae,aF as aa,e as ge,g as h,aG as wa,aH as de,F as Le,B as te,a6 as ta,x as la,aI as me,G as Re,s as $e,t as N,a9 as ja,aB as Fe,l as oa,aJ as Sa,Z as we,aa as ke,aA as ra,aK as Na,aL as xa,ay as Ia,aM as sa,aN as na,K as Da,u as Ua,af as Ge,ag as he,N as Oa,ah as ze,aO as Ja,ai as Va}from"./index-C0p55rrf.js";import{c as Ra,d as $a,e as Ca,g as Ma,h as qe,i as Pa,j as Aa}from"./job-BTjPiUsA.js";import{b as ua,_ as Ea,u as La,a as Ha}from"./table-B8N7pgiA.js";import{_ as Ba}from"./status-switch.vue_vue_type_script_setup_true_lang-DbErHz8C.js";import{u as Ka}from"./auth-RLtNqCUd.js";import{L as Fa}from"./label-list-Clk3Q1a1.js";import{_ as Ga}from"./labels-input.vue_vue_type_script_setup_true_lang-B_oS-ADO.js";import{_ as pa}from"./system-user.vue_vue_type_script_setup_true_lang-Bf0IYB9E.js";import{f as za}from"./notify-BCrZajLG.js";import{_ as qa,a as Ya}from"./block-strategy.vue_vue_type_script_setup_true_lang-CkjCP0ms.js";import{_ as oe}from"./code-mirror-D-y4YCVa.js";import{_ as Wa}from"./job-trigger-interval.vue_vue_type_script_setup_true_lang-Omhcuv5e.js";import{_ as ia}from"./select-group.vue_vue_type_script_setup_true_lang-BHwrakTI.js";import{_ as Qa,a as Za,c as Xa,d as et,b as at}from"./Grid-DvIYbIW9.js";import{_ as da}from"./DynamicInput-IPp7NvjD.js";import{_ as ma}from"./cron-input.vue_vue_type_style_index_0_lang-C2pNQ4BC.js";import{_ as tt}from"./detail-drawer-DhJfUjjQ.js";import{_ as lt,a as ot}from"./DescriptionsItem-DYBNfpdM.js";import"./CollapseItem-BWVJFROc.js";import"./Progress-BaJYJ3dh.js";import"./dashboard-CJiJ5IBm.js";import"./DynamicTags-CJUeOSLO.js";import"./DatePicker--2_VzZ6E.js";import"./group-Bzk_FTzz.js";const rt=re({name:"TriggerType",__name:"trigger-type",emits:["update:value"],setup($,{emit:C}){const i=C,y=E(),b=g=>{i("update:value",g)};return(g,x)=>{const k=Ne;return j(),O(k,{value:y.value,"onUpdate:value":[x[0]||(x[0]=n=>y.value=n),b],placeholder:a(o)("common.triggerType.form"),options:a(Ce)(a(_a))},null,8,["value","placeholder","options"])}}}),st=re({name:"TriggerStrategy",__name:"executor-type",emits:["update:value"],setup($,{emit:C}){const i=E(),y=C,b=g=>{y("update:value",g)};return(g,x)=>{const k=Ne;return j(),O(k,{value:i.value,"onUpdate:value":[x[0]||(x[0]=n=>i.value=n),b],placeholder:a(o)("common.executorType.form"),options:a(Ce)(a(Ta))},null,8,["value","placeholder","options"])}}}),nt=re({name:"TaskType",__name:"task-type",emits:["update:value"],setup($,{emit:C}){const i=C,y=E(),b=g=>{i("update:value",g)};return(g,x)=>{const k=Ne;return j(),O(k,{value:y.value,"onUpdate:value":[x[0]||(x[0]=n=>y.value=n),b],placeholder:a(o)("common.routeKey.routeForm"),options:a(Ce)(a(ka))},null,8,["value","placeholder","options"])}}}),ut={class:"w-full w-full flex-col items-start gap-12px pt-5px"},pt={class:"flex"},it=re({name:"JobTaskOperateDrawer",__name:"job-task-operate-drawer",props:Se({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Se(["submitted"],["update:visible"]),setup($,{emit:C}){const i=E([]),y=$,b=C,g=E(0),x=Me($,"visible"),k=le({args:[{arg:""}]}),n=E(0),f=E(null),{formRef:G,validate:V,restoreValidation:S}=ha(),{defaultRequiredRule:_}=We(),se=u=>{if(!me(u))return{isValid:!1,message:"触发间隔不能为空"};try{const t=JSON.parse(u);if(!Array.isArray(t))return{isValid:!1,message:"指定时间点必须是有效的时间数组格式"};if(t.length===0)return{isValid:!1,message:"请至少添加一个指定时间点"};if(t.filter(p=>!me(p)).length>0)return{isValid:!1,message:"存在无效的时间点"};const c=t.filter(p=>me(p));if(c.length===0)return{isValid:!1,message:"请至少设置一个有效的时间点"};const D=Fe();let P=!1;for(const p of c){if(typeof p!="string")return{isValid:!1,message:"时间点格式不正确，必须是字符串格式"};const T=Fe(p,"YYYY-MM-DD HH:mm:ss",!0);if(!T.isValid())return{isValid:!1,message:`时间格式不正确: ${p}，请使用 YYYY-MM-DD HH:mm:ss 格式`};T.isAfter(D)&&(P=!0)}return P?{isValid:!0}:{isValid:!1,message:"请至少设置一个未来的时间点"}}catch{return{isValid:!1,message:"指定时间点数据格式错误，请检查JSON格式"}}},A=Qe(()=>({add:o("page.jobTask.addJobTask"),edit:o("page.jobTask.editJobTask")})[y.operateType]);async function L(){const u=await za(3);i.value=u.data}const r=le(q());function q(){return{groupName:void 0,ownerId:void 0,notifyIds:[],jobName:"",argsStr:"",argsType:1,jobStatus:1,routeKey:4,executorType:1,triggerType:2,executorInfo:void 0,triggerInterval:"60",blockStrategy:1,executorTimeout:60,maxRetryTimes:3,retryInterval:1,taskType:1,parallelNum:1,description:"",labels:"{}",labelMap:[]}}const xe={groupName:_,jobName:_,argsType:_,jobStatus:_,routeKey:_,executorType:_,executorInfo:_,triggerType:_,triggerInterval:_,blockStrategy:_,executorTimeout:_,maxRetryTimes:_,retryInterval:_,taskType:_,parallelNum:_},M=E([]),J=le(fe());function fe(){return{method:"POST",url:"",headers:{},body:"",mediaType:"application/json",timeout:60}}const be=[{label:"Http 执行器",value:"snailJobHttpExecutor"},{label:"CMD 执行器",value:"snailJobCMDJobExecutor"},{label:"PowerShell 执行器",value:"snailJobPowerShellJobExecutor"},{label:"Shell 执行器",value:"snailJobShellJobExecutor"}],I=le(ve());function ve(){return{method:"LOCAL_SCRIPT",scriptParams:"",charset:""}}function v(){if(Object.assign(r,q()),g.value=0,M.value=[],r.labelMap=[],Object.assign(J,fe()),Object.assign(I,ve()),!(y.operateType==="add"&&!y.rowData)&&y.rowData){if(Object.assign(r,y.rowData),r.labels&&(r.labelMap=Object.entries(JSON.parse(r.labels)).map(([u,t])=>({key:u,value:t}))),r.taskType===3&&r.argsStr&&Object.assign(k,{args:JSON.parse(r.argsStr).map(u=>({arg:u}))}),r.taskType===5&&r.argsStr){const u=JSON.parse(r.argsStr);n.value=u.shardNum,r.argsStr=u.argsStr}be.map(u=>u.value).includes(r.executorInfo)&&(g.value=1,r.executorInfo==="snailJobHttpExecutor"?(Object.assign(J,JSON.parse(r.argsStr)),J.headers&&(M.value=Object.keys(J.headers).map(u=>({key:u,value:J.headers[u]})))):Object.assign(I,JSON.parse(r.argsStr)))}}function d(){x.value=!1}async function U(){var s,H,Ie,He,Be;if(await V(),r.triggerType===5){const B=se(r.triggerInterval);if(!B.isValid){(s=window.$message)==null||s.error(B.message||"指定时间点校验失败");return}}const{id:u,groupName:t,ownerId:w,ownerName:c,notifyIds:D,jobName:P,argsType:p,jobStatus:T,routeKey:z,executorType:X,executorInfo:Ue,triggerType:ne,triggerInterval:Oe,blockStrategy:Je,executorTimeout:ue,maxRetryTimes:Ve,retryInterval:_e,taskType:pe,parallelNum:F,description:ie}=r;let Te=pe===5?JSON.stringify({shardNum:n.value,argsStr:r.argsStr}):r.argsStr;g.value===1&&(await((H=f.value)==null?void 0:H.validate()),r.executorInfo==="snailJobHttpExecutor"?(M.value.forEach(B=>{J.headers[B.key]=B.value}),Te=JSON.stringify(J)):Te=JSON.stringify(I));const ee={};if((Ie=r.labelMap)==null||Ie.forEach(B=>{ee[B.key]=B.value}),y.operateType==="add"){const{error:B}=await Ra({groupName:t,ownerId:w,ownerName:c,notifyIds:D,jobName:P,argsStr:Te,argsType:p,jobStatus:T,routeKey:z,executorType:X,executorInfo:Ue,triggerType:ne,triggerInterval:Oe,blockStrategy:Je,executorTimeout:ue,maxRetryTimes:Ve,retryInterval:_e,taskType:pe,parallelNum:F,description:ie,labels:JSON.stringify(ee)});if(B)return;(He=window.$message)==null||He.success(o("common.addSuccess"))}if(y.operateType==="edit"){const{error:B}=await $a({id:u,groupName:t,ownerId:w,ownerName:c,notifyIds:D,jobName:P,argsStr:Te,argsType:p,jobStatus:T,routeKey:z,executorType:X,executorInfo:Ue,triggerType:ne,triggerInterval:Oe,blockStrategy:Je,executorTimeout:ue,maxRetryTimes:Ve,retryInterval:_e,taskType:pe,parallelNum:F,description:ie,labels:JSON.stringify(ee)});if(B)return;(Be=window.$message)==null||Be.success(o("common.updateSuccess"))}d(),b("submitted")}function K(){if(r.taskType===3&&k.args){const u=k.args.map(t=>t.arg.trim()).filter(t=>!!t);r.argsStr=u.length>0?JSON.stringify(u):""}return r.argsStr}const R=u=>{k.args.splice(u,1)},Y=E([]),Z=async u=>{const{error:t,data:w}=await Ca({groupName:u});t||(Y.value=w||[])},W=()=>{k.args.push({arg:""})};ce(x,()=>{var u;x.value&&(v(),S(),L(),(u=f.value)==null||u.restoreValidation())}),ce(k,()=>{x.value&&r.taskType===3&&K()}),ce(()=>r.taskType,u=>{y.operateType==="add"&&x.value&&(u!==3&&(k.args=[]),u!==5&&(n.value=1),r.argsStr="")}),ce(()=>r.groupName,u=>{Z(u)});function Q(){if(g.value===0){r.executorInfo="";return}r.executorInfo="snailJobHttpExecutor"}const ye=[{label:"GET",value:"get"},{label:"POST",value:"post"},{label:"PUT",value:"put"},{label:"DELETE",value:"delete"}],m=[{label:"需下载脚本",value:"DOWNLOAD"},{label:"脚本代码",value:"SCRIPT_CODE"},{label:"使用本地脚本",value:"LOCAL_SCRIPT"}];return(u,t)=>{const w=Ee,c=Xe,D=pa,P=Ga,p=Za,T=ea,z=Qa,X=Ne,Ue=Ye,ne=te,Oe=ua,Je=Le,ue=ta,Ve=da,_e=ma,pe=Ze,F=et,ie=Xa,Te=rt;return j(),O(ja,{modelValue:x.value,"onUpdate:modelValue":t[33]||(t[33]=ee=>x.value=ee),title:A.value,"min-size":480,onHandleSubmit:U},{footer:l(()=>[e(T,{size:16},{default:l(()=>[e(ne,{onClick:d},{default:l(()=>[h(N(a(o)("common.cancel")),1)]),_:1}),e(ne,{type:"primary",onClick:U},{default:l(()=>[h(N(a(o)("common.save")),1)]),_:1})]),_:1})]),default:l(()=>[e(pe,{ref_key:"formRef",ref:G,model:r,rules:xe},{default:l(()=>{var ee;return[e(c,{label:a(o)("page.jobTask.jobName"),path:"jobName"},{default:l(()=>[e(w,{value:r.jobName,"onUpdate:value":t[0]||(t[0]=s=>r.jobName=s),maxlength:64,"show-count":"",placeholder:a(o)("page.jobTask.form.jobName")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(c,{label:a(o)("page.jobTask.groupName"),path:"groupName"},{default:l(()=>[e(ia,{value:r.groupName,"onUpdate:value":t[1]||(t[1]=s=>r.groupName=s),disabled:y.operateType==="edit"},null,8,["value","disabled"])]),_:1},8,["label"]),e(c,{label:a(o)("page.jobTask.ownerName"),path:"ownerId"},{default:l(()=>[e(D,{value:r.ownerId,"onUpdate:value":t[2]||(t[2]=s=>r.ownerId=s),clearable:!0},null,8,["value"])]),_:1},8,["label"]),e(c,{label:a(o)("page.jobTask.labels"),path:"labelMap","show-feedback":!((ee=r.labelMap)!=null&&ee.length)},{default:l(()=>[e(P,{value:r.labelMap,"onUpdate:value":t[3]||(t[3]=s=>r.labelMap=s),path:"labelMap"},null,8,["value"])]),_:1},8,["label","show-feedback"]),e(c,{label:a(o)("page.jobTask.jobStatus"),path:"jobStatus"},{default:l(()=>[e(z,{value:r.jobStatus,"onUpdate:value":t[4]||(t[4]=s=>r.jobStatus=s),name:"jobStatus"},{default:l(()=>[e(T,null,{default:l(()=>[(j(!0),je(De,null,Ae(a(aa),s=>(j(),O(p,{key:s.value,value:s.value,label:a(o)(s.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),e(c,{label:a(o)("page.jobTask.taskType"),path:"taskType"},{default:l(()=>[e(nt,{value:r.taskType,"onUpdate:value":t[5]||(t[5]=s=>r.taskType=s),placeholder:a(o)("page.jobTask.form.taskType")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(c,{label:a(o)("page.jobTask.executorType"),path:"executorType"},{default:l(()=>[e(st,{value:r.executorType,"onUpdate:value":t[6]||(t[6]=s=>r.executorType=s)},null,8,["value"])]),_:1},8,["label"]),e(c,{label:a(o)("page.jobTask.executorInfo"),path:"executorInfo"},{default:l(()=>[ge("div",ut,[e(z,{value:g.value,"onUpdate:value":t[7]||(t[7]=s=>g.value=s),onChange:Q},{default:l(()=>[e(p,{value:0},{default:l(()=>t[34]||(t[34]=[h("自定义执行器")])),_:1}),e(p,{value:1},{default:l(()=>t[35]||(t[35]=[h("内置执行器")])),_:1})]),_:1},8,["value"]),g.value===0?(j(),O(X,{key:0,value:r.executorInfo,"onUpdate:value":t[8]||(t[8]=s=>r.executorInfo=s),filterable:"",tag:"",options:a(wa)(Y.value),placeholder:a(o)("page.jobTask.form.executorInfo")},null,8,["value","options","placeholder"])):(j(),O(X,{key:1,value:r.executorInfo,"onUpdate:value":t[9]||(t[9]=s=>r.executorInfo=s),options:be,placeholder:"请选择内置执行器"},null,8,["value"]))])]),_:1},8,["label"]),r.taskType===5?(j(),O(c,{key:0,label:a(o)("page.jobTask.shardNum")},{default:l(()=>[e(a(de),{value:n.value,"onUpdate:value":t[10]||(t[10]=s=>n.value=s),min:1,placeholder:a(o)("page.jobTask.form.shardNum")},null,8,["value","placeholder"])]),_:1},8,["label"])):Pe("",!0),e(c,{label:a(o)("page.jobTask.argsStr"),path:"argsStr","show-label":g.value===0,"show-feedback":g.value===0,rule:r.taskType===3?a(_):void 0},{default:l(()=>[g.value===0?(j(),je(De,{key:0},[r.taskType===3?(j(),O(Je,{key:0,class:"flex-col"},{default:l(()=>[(j(!0),je(De,null,Ae(k.args,(s,H)=>(j(),O(c,{key:H,label:`分片参数 ${H+1}`,path:`args[${H}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${a(o)("page.jobTask.form.argsStr")} ${H+1}`,trigger:["input","blur"],validator(){return!!s.arg}}},{default:l(()=>[e(oe,{modelValue:s.arg,"onUpdate:modelValue":Ie=>s.arg=Ie,lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),e(ne,{class:"ml-12px",type:"error",dashed:"",onClick:Ie=>R(H)},{default:l(()=>[e(Ue,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),e(ne,{block:"",dashed:"","attr-type":"button",onClick:W},{default:l(()=>[e(Oe,{class:"text-icon"})]),_:1})]),_:1})):(j(),O(oe,{key:1,modelValue:r.argsStr,"onUpdate:modelValue":t[11]||(t[11]=s=>r.argsStr=s),lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))],64)):r.executorInfo==="snailJobHttpExecutor"?(j(),O(pe,{key:1,ref_key:"customformRef",ref:f,class:"w-full",model:J},{default:l(()=>[e(c,{label:"请求参数",rule:a(_),path:"url"},{default:l(()=>[e(ue,null,{default:l(()=>[e(X,{value:J.method,"onUpdate:value":t[12]||(t[12]=s=>J.method=s),class:"http-method",options:ye},null,8,["value"]),e(w,{value:J.url,"onUpdate:value":t[13]||(t[13]=s=>J.url=s),placeholder:"请输入请求地址",class:"w-full"},null,8,["value"])]),_:1})]),_:1},8,["rule"]),e(c,{label:"Media Type"},{default:l(()=>[e(w,{value:J.mediaType,"onUpdate:value":t[14]||(t[14]=s=>J.mediaType=s),placeholder:"请输入 Media Type"},null,8,["value"])]),_:1}),t[37]||(t[37]=ge("div",{class:"n-form-item-label"},"Header 参数",-1)),e(Ve,{value:M.value,"onUpdate:value":t[17]||(t[17]=s=>M.value=s),class:la(M.value.length?void 0:"mb-24px"),"item-style":"margin-bottom: 0;","on-create":()=>({key:"",value:""})},{default:l(({index:s})=>[ge("div",pt,[e(c,{"ignore-path-change":"","show-label":!1,path:`headers[${s}].key`,rule:{required:!0,message:"请输入键",trigger:["input","blur"],validator:()=>a(me)(M.value[s].key)}},{default:l(()=>[e(w,{value:M.value[s].key,"onUpdate:value":H=>M.value[s].key=H,placeholder:"Key",onKeydown:t[15]||(t[15]=Re($e(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"]),t[36]||(t[36]=ge("div",{class:"mx-8px h-34px text-center line-height-34px"},"=",-1)),e(c,{"ignore-path-change":"","show-label":!1,path:`headers[${s}].value`,rule:{required:!0,message:"请输入值",trigger:["input","blur"],validator:()=>a(me)(M.value[s].value)}},{default:l(()=>[e(w,{value:M.value[s].value,"onUpdate:value":H=>M.value[s].value=H,placeholder:"Value",onKeydown:t[16]||(t[16]=Re($e(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"])])]),_:1},8,["value","class"]),e(c,{label:"Body 参数"},{default:l(()=>[e(oe,{modelValue:J.body,"onUpdate:modelValue":t[18]||(t[18]=s=>J.body=s),lang:"json",placeholder:"请输入 Body 参数"},null,8,["modelValue"])]),_:1}),e(c,{label:"接口超时时间"},{default:l(()=>[e(ue,null,{default:l(()=>[e(a(de),{value:J.timeout,"onUpdate:value":t[19]||(t[19]=s=>J.timeout=s),class:"w-full",min:1,max:99999999,placeholder:a(o)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(_e,null,{default:l(()=>[h(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):(j(),O(pe,{key:2,ref_key:"customformRef",ref:f,class:"w-full",model:I},{default:l(()=>[e(c,{label:"脚本类型"},{default:l(()=>[e(X,{value:I.method,"onUpdate:value":t[20]||(t[20]=s=>I.method=s),options:m},null,8,["value"])]),_:1}),e(c,{label:"脚本参数"},{default:l(()=>[e(oe,{modelValue:I.scriptParams,"onUpdate:modelValue":t[21]||(t[21]=s=>I.scriptParams=s),lang:"json",placeholder:"请输入脚本参数"},null,8,["modelValue"])]),_:1}),e(c,{label:"编码格式"},{default:l(()=>[e(w,{value:I.charset,"onUpdate:value":t[22]||(t[22]=s=>I.charset=s),placeholder:"请输入编码格式"},null,8,["value"])]),_:1})]),_:1},8,["model"]))]),_:1},8,["label","show-label","show-feedback","rule"]),e(ie,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{label:a(o)("page.jobTask.routeKey"),path:"routeKey"},{default:l(()=>[e(qa,{value:r.routeKey,"onUpdate:value":t[23]||(t[23]=s=>r.routeKey=s),"task-type":r.taskType},null,8,["value","task-type"])]),_:1},8,["label"])]),_:1}),e(F,null,{default:l(()=>[e(c,{label:a(o)("page.jobTask.blockStrategy"),path:"blockStrategy"},{default:l(()=>[e(Ya,{value:r.blockStrategy,"onUpdate:value":t[24]||(t[24]=s=>r.blockStrategy=s)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(ie,{cols:r.triggerType===5?"1":"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{label:a(o)("page.jobTask.triggerType"),path:"triggerType"},{default:l(()=>[e(Te,{value:r.triggerType,"onUpdate:value":t[25]||(t[25]=s=>r.triggerType=s),placeholder:a(o)("page.jobTask.form.triggerType")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e(F,null,{default:l(()=>[e(c,{label:a(o)("page.jobTask.triggerInterval"),path:"triggerInterval"},{default:l(()=>[e(Wa,{modelValue:r.triggerInterval,"onUpdate:modelValue":t[26]||(t[26]=s=>r.triggerInterval=s),"trigger-type":r.triggerType},null,8,["modelValue","trigger-type"])]),_:1},8,["label"])]),_:1})]),_:1},8,["cols"]),e(ie,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{label:a(o)("page.jobTask.executorTimeout"),path:"executorTimeout"},{default:l(()=>[e(ue,null,{default:l(()=>[e(a(de),{value:r.executorTimeout,"onUpdate:value":t[27]||(t[27]=s=>r.executorTimeout=s),min:1,max:99999999,placeholder:a(o)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(_e,null,{default:l(()=>[h(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),e(F,null,{default:l(()=>[e(c,{label:a(o)("page.jobTask.maxRetryTimes"),path:"maxRetryTimes"},{default:l(()=>[e(a(de),{value:r.maxRetryTimes,"onUpdate:value":t[28]||(t[28]=s=>r.maxRetryTimes=s),min:0,max:999,placeholder:a(o)("page.jobTask.form.maxRetryTimes"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),e(ie,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:l(()=>[e(F,null,{default:l(()=>[e(c,{label:a(o)("page.jobTask.retryInterval"),path:"retryInterval"},{default:l(()=>[e(ue,null,{default:l(()=>[e(a(de),{value:r.retryInterval,"onUpdate:value":t[29]||(t[29]=s=>r.retryInterval=s),min:1,max:99999999,placeholder:a(o)("page.jobTask.form.retryInterval"),clearable:""},null,8,["value","placeholder"]),e(_e,null,{default:l(()=>[h(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),e(F,null,{default:l(()=>[r.taskType!==1&&r.taskType!==2?(j(),O(c,{key:0,label:a(o)("page.jobTask.parallelNum"),path:"parallelNum"},{default:l(()=>[e(a(de),{value:r.parallelNum,"onUpdate:value":t[30]||(t[30]=s=>r.parallelNum=s),min:1,max:999,placeholder:a(o)("page.jobTask.form.parallelNum"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):Pe("",!0)]),_:1})]),_:1}),e(c,{label:a(o)("page.jobTask.notifyId"),path:"notifyIds"},{default:l(()=>[e(X,{value:r.notifyIds,"onUpdate:value":t[31]||(t[31]=s=>r.notifyIds=s),"value-field":"id","label-field":"notifyName",placeholder:a(o)("page.jobTask.form.notifyId"),options:i.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(c,{label:a(o)("page.jobTask.description"),path:"description"},{default:l(()=>[e(w,{value:r.description,"onUpdate:value":t[32]||(t[32]=s=>r.description=s),type:"textarea",placeholder:a(o)("page.jobTask.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]}),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),dt=oa(it,[["__scopeId","data-v-f5367c0f"]]),mt={class:"flex"},ct=re({name:"JobTaskTriggerModal",__name:"job-task-trigger-modal",props:Se({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Se(["submitted"],["update:visible"]),setup($,{emit:C}){const i=$,y=C,b=Me($,"visible"),g=le({args:[{arg:""}]}),x=E(0),k=E(null),{defaultRequiredRule:n}=We(),f=le(G());function G(){var v;return{jobId:(v=i.rowData)==null?void 0:v.id,tmpArgsStr:""}}const V=E([]),S=le(_());function _(){return{method:"POST",url:"",headers:{},body:"",mediaType:"application/json",timeout:60}}const se=[{label:"Http 执行器",value:"snailJobHttpExecutor"},{label:"CMD 执行器",value:"snailJobCMDJobExecutor"},{label:"PowerShell 执行器",value:"snailJobPowerShellJobExecutor"},{label:"Shell 执行器",value:"snailJobShellJobExecutor"}],A=le(L());function L(){return{method:"LOCAL_SCRIPT",scriptParams:"",charset:""}}function r(){if(V.value=[],Object.assign(S,_()),Object.assign(A,L()),Object.assign(f,G()),!i.rowData)return;Object.assign(f,i.rowData);const v=i.rowData.taskType,d=i.rowData.argsStr;if(d){if(f.tmpArgsStr=d,v===3&&Object.assign(g,{args:JSON.parse(d).map(U=>({arg:U}))}),v===5){const U=JSON.parse(d);x.value=U.shardNum,f.tmpArgsStr=U.argsStr}se.map(U=>U.value).includes(i.rowData.executorInfo)&&(i.rowData.executorInfo==="snailJobHttpExecutor"?(Object.assign(S,JSON.parse(d)),S.headers&&(V.value=Object.keys(S.headers).map(U=>({key:U,value:S.headers[U]})))):Object.assign(A,JSON.parse(d)))}}function q(){b.value=!1}function xe(){var v;if(((v=i.rowData)==null?void 0:v.taskType)===3&&g.args){const d=g.args.map(U=>U.arg.trim()).filter(U=>!!U);f.tmpArgsStr=d.length>0?JSON.stringify(d):""}return f.tmpArgsStr}const M=v=>{g.args.splice(v,1)},J=()=>{g.args.push({arg:""})};ce(b,()=>{var v;b.value&&(r(),(v=k.value)==null||v.restoreValidation())}),ce(g,()=>{var v;b.value&&((v=i.rowData)==null?void 0:v.taskType)===3&&xe()}),ce(()=>{var v;return(v=i.rowData)==null?void 0:v.taskType},v=>{b.value&&(v!==3&&(g.args=[]),v!==5&&(x.value=1),f.tmpArgsStr="")});const fe=[{label:"GET",value:"get"},{label:"POST",value:"post"},{label:"PUT",value:"put"},{label:"DELETE",value:"delete"}],be=[{label:"需下载脚本",value:"DOWNLOAD"},{label:"脚本代码",value:"SCRIPT_CODE"},{label:"使用本地脚本",value:"LOCAL_SCRIPT"}],I=Qe(()=>se.map(v=>v.value).includes(i.rowData.executorInfo)?1:0);async function ve(){var U,K,R,Y,Z;let v=((U=i.rowData)==null?void 0:U.taskType)===5?JSON.stringify({shardNum:x.value,argsStr:f.tmpArgsStr}):f.tmpArgsStr;I.value===1&&(await((K=k.value)==null?void 0:K.validate()),((R=i.rowData)==null?void 0:R.executorInfo)==="snailJobHttpExecutor"?(V.value.forEach(W=>{S.headers[W.key]=W.value}),v=JSON.stringify(S)):v=JSON.stringify(A));const{error:d}=await Ma({jobId:(Y=i.rowData)==null?void 0:Y.id,tmpArgsStr:v});d||((Z=window.$message)==null||Z.success(o("common.executeSuccess")),q(),y("submitted"))}return(v,d)=>{const U=Ye,K=te,R=Xe,Y=ua,Z=Le,W=Ne,Q=Ee,ye=ta,m=da,u=ma,t=Ze,w=ea,c=Sa;return j(),O(c,{show:b.value,"onUpdate:show":d[12]||(d[12]=D=>b.value=D),class:"max-w-90% w-600px",preset:"card",title:"执行任务",bordered:!1},{footer:l(()=>[e(w,{justify:"end",size:16},{default:l(()=>[e(K,{onClick:q},{default:l(()=>[h(N(a(o)("common.cancel")),1)]),_:1}),e(K,{type:"primary",onClick:ve},{default:l(()=>d[15]||(d[15]=[h("执行")])),_:1})]),_:1})]),default:l(()=>[e(t,{model:f},{default:l(()=>{var D;return[v.rowData?(j(),O(R,{key:0,label:a(o)("page.jobTask.argsStr"),path:"argsStr","show-label":I.value===0,"show-feedback":I.value===0,rule:((D=v.rowData)==null?void 0:D.taskType)===3?a(n):void 0},{default:l(()=>{var P;return[I.value===0?(j(),je(De,{key:0},[((P=v.rowData)==null?void 0:P.taskType)===3?(j(),O(Z,{key:0,class:"flex-col"},{default:l(()=>[(j(!0),je(De,null,Ae(g.args,(p,T)=>(j(),O(R,{key:T,label:`分片参数 ${T+1}`,path:`args[${T}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${a(o)("page.jobTask.form.argsStr")} ${T+1}`,trigger:["input","blur"],validator(){return!!p.arg}}},{default:l(()=>[e(oe,{modelValue:p.arg,"onUpdate:modelValue":z=>p.arg=z,lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),e(K,{class:"ml-12px",type:"error",dashed:"",onClick:z=>M(T)},{default:l(()=>[e(U,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),e(K,{block:"",dashed:"","attr-type":"button",onClick:J},{default:l(()=>[e(Y,{class:"text-icon"})]),_:1})]),_:1})):(j(),O(oe,{key:1,modelValue:f.tmpArgsStr,"onUpdate:modelValue":d[0]||(d[0]=p=>f.tmpArgsStr=p),lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))],64)):v.rowData.executorInfo==="snailJobHttpExecutor"?(j(),O(t,{key:1,ref_key:"customformRef",ref:k,class:"w-full",model:S},{default:l(()=>[e(R,{label:"请求参数",rule:a(n),path:"url"},{default:l(()=>[e(ye,null,{default:l(()=>[e(W,{value:S.method,"onUpdate:value":d[1]||(d[1]=p=>S.method=p),class:"http-method",options:fe},null,8,["value"]),e(Q,{value:S.url,"onUpdate:value":d[2]||(d[2]=p=>S.url=p),placeholder:"请输入请求地址",class:"w-full"},null,8,["value"])]),_:1})]),_:1},8,["rule"]),e(R,{label:"Media Type"},{default:l(()=>[e(Q,{value:S.mediaType,"onUpdate:value":d[3]||(d[3]=p=>S.mediaType=p),placeholder:"请输入 Media Type"},null,8,["value"])]),_:1}),d[14]||(d[14]=ge("div",{class:"n-form-item-label"},"Header 参数",-1)),e(m,{value:V.value,"onUpdate:value":d[6]||(d[6]=p=>V.value=p),class:la(V.value.length?void 0:"mb-24px"),"item-style":"margin-bottom: 0;","on-create":()=>({key:"",value:""})},{default:l(({index:p})=>[ge("div",mt,[e(R,{"ignore-path-change":"","show-label":!1,path:`headers[${p}].key`,rule:{required:!0,message:"请输入键",trigger:["input","blur"],validator:()=>a(me)(V.value[p].key)}},{default:l(()=>[e(Q,{value:V.value[p].key,"onUpdate:value":T=>V.value[p].key=T,placeholder:"Key",onKeydown:d[4]||(d[4]=Re($e(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"]),d[13]||(d[13]=ge("div",{class:"mx-8px h-34px text-center line-height-34px"},"=",-1)),e(R,{"ignore-path-change":"","show-label":!1,path:`headers[${p}].value`,rule:{required:!0,message:"请输入值",trigger:["input","blur"],validator:()=>a(me)(V.value[p].value)}},{default:l(()=>[e(Q,{value:V.value[p].value,"onUpdate:value":T=>V.value[p].value=T,placeholder:"Value",onKeydown:d[5]||(d[5]=Re($e(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"])])]),_:1},8,["value","class"]),e(R,{label:"Body 参数"},{default:l(()=>[e(oe,{modelValue:S.body,"onUpdate:modelValue":d[7]||(d[7]=p=>S.body=p),lang:"json",placeholder:"请输入 Body 参数"},null,8,["modelValue"])]),_:1}),e(R,{label:"接口超时时间"},{default:l(()=>[e(ye,null,{default:l(()=>[e(a(de),{value:S.timeout,"onUpdate:value":d[8]||(d[8]=p=>S.timeout=p),class:"w-full",min:1,max:99999999,placeholder:a(o)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(u,null,{default:l(()=>[h(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):(j(),O(t,{key:2,ref_key:"customformRef",ref:k,class:"w-full",model:A},{default:l(()=>[e(R,{label:"脚本类型"},{default:l(()=>[e(W,{value:A.method,"onUpdate:value":d[9]||(d[9]=p=>A.method=p),options:be},null,8,["value"])]),_:1}),e(R,{label:"脚本参数"},{default:l(()=>[e(oe,{modelValue:A.scriptParams,"onUpdate:modelValue":d[10]||(d[10]=p=>A.scriptParams=p),lang:"json",placeholder:"请输入脚本参数"},null,8,["modelValue"])]),_:1}),e(R,{label:"编码格式"},{default:l(()=>[e(Q,{value:A.charset,"onUpdate:value":d[11]||(d[11]=p=>A.charset=p),placeholder:"请输入编码格式"},null,8,["value"])]),_:1})]),_:1},8,["model"]))]}),_:1},8,["label","show-label","show-feedback","rule"])):Pe("",!0)]}),_:1},8,["model"])]),_:1},8,["show"])}}}),gt=oa(ct,[["__scopeId","data-v-37473d17"]]),ft=re({name:"JobTaskSearch",__name:"job-task-search",props:{model:{required:!0},modelModifiers:{}},emits:Se(["reset","search"],["update:model"]),setup($,{emit:C}){const i=C,y=Me($,"model");function b(){i("reset")}function g(){i("search")}return(x,k)=>{const n=Ea,f=Ee,G=Ne,V=pa,S=ca;return j(),O(S,{"btn-span":"24 s:12 m:18 l:18 xl:18",model:y.value,onSearch:g,onReset:b},{default:l(()=>[e(n,{span:"24 s:12 m:6",label:a(o)("page.jobTask.groupName"),path:"groupName",class:"pr-24px"},{default:l(()=>[e(ia,{value:y.value.groupName,"onUpdate:value":k[0]||(k[0]=_=>y.value.groupName=_),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(n,{span:"24 s:12 m:6",label:a(o)("page.jobTask.jobName"),path:"jobName",class:"pr-24px"},{default:l(()=>[e(f,{value:y.value.jobName,"onUpdate:value":k[1]||(k[1]=_=>y.value.jobName=_),placeholder:a(o)("page.jobTask.form.jobName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(n,{span:"24 s:12 m:6",label:a(o)("page.jobTask.executorInfo"),path:"executorInfo",class:"pr-24px","label-width":100},{default:l(()=>[e(f,{value:y.value.executorInfo,"onUpdate:value":k[2]||(k[2]=_=>y.value.executorInfo=_),placeholder:a(o)("page.jobTask.form.executorInfo"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(n,{span:"24 s:12 m:6",label:a(o)("page.jobTask.jobStatus"),path:"jobStatus",class:"pr-24px"},{default:l(()=>[e(G,{value:y.value.jobStatus,"onUpdate:value":k[3]||(k[3]=_=>y.value.jobStatus=_),placeholder:a(o)("page.jobTask.form.jobStatus"),options:a(Ce)(a(aa)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(n,{span:"24 s:12 m:6",label:a(o)("page.jobTask.ownerName"),path:"ownerId",class:"pr-24px"},{default:l(()=>[e(V,{value:y.value.ownerId,"onUpdate:value":k[4]||(k[4]=_=>y.value.ownerId=_),clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),bt=re({name:"JobTaskDetailDrawer",__name:"job-task-detail-drawer",props:Se({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup($){const C=Me($,"visible");return(i,y)=>{const b=ot,g=we,x=lt,k=tt;return j(),O(k,{modelValue:C.value,"onUpdate:modelValue":y[0]||(y[0]=n=>C.value=n),title:a(o)("page.jobTask.detail"),width:["50%","90%"]},{default:l(()=>[e(x,{"label-placement":"top",bordered:"",column:2},{default:l(()=>[e(b,{label:a(o)("page.jobTask.groupName")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.groupName),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.jobName")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.jobName),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.taskType")},{default:l(()=>{var n;return[e(g,{type:a(ke)((n=i.rowData)==null?void 0:n.taskType)},{default:l(()=>{var f;return[h(N(a(o)(a(ra)[(f=i.rowData)==null?void 0:f.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.argsStr")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.argsStr),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.nextTriggerAt")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.nextTriggerAt),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.jobStatus")},{default:l(()=>{var n;return[e(g,{type:a(ke)((n=i.rowData)==null?void 0:n.jobStatus)},{default:l(()=>{var f;return[h(N(a(o)(a(Na)[(f=i.rowData)==null?void 0:f.jobStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.routeKey")},{default:l(()=>{var n;return[e(g,{type:a(ke)((n=i.rowData)==null?void 0:n.routeKey)},{default:l(()=>{var f;return[h(N(a(o)(a(xa)[(f=i.rowData)==null?void 0:f.routeKey])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.executorType")},{default:l(()=>{var n;return[e(g,{type:a(ke)((n=i.rowData)==null?void 0:n.executorType)},{default:l(()=>{var f;return[h(N(a(o)(a(Ia)[(f=i.rowData)==null?void 0:f.executorType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.executorInfo")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.executorInfo),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.triggerType")},{default:l(()=>{var n;return[e(g,{type:a(ke)((n=i.rowData)==null?void 0:n.triggerType)},{default:l(()=>{var f;return[h(N(a(o)(a(sa)[(f=i.rowData)==null?void 0:f.triggerType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.triggerInterval")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.triggerInterval),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.blockStrategy")},{default:l(()=>{var n;return[e(g,{type:a(ke)((n=i.rowData)==null?void 0:n.blockStrategy)},{default:l(()=>{var f;return[h(N(a(o)(a(na)[(f=i.rowData)==null?void 0:f.blockStrategy])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.executorTimeout")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.executorTimeout),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.maxRetryTimes")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.maxRetryTimes),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.retryInterval")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.retryInterval),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.parallelNum")},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.parallelNum),1)]}),_:1},8,["label"]),e(b,{label:a(o)("page.jobTask.description"),span:2},{default:l(()=>{var n;return[h(N((n=i.rowData)==null?void 0:n.description),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),vt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ae($){return typeof $=="function"||Object.prototype.toString.call($)==="[object Object]"&&!Va($)}const Ft=re({name:"job_task",__name:"index",setup($){const{hasAuth:C}=Ka(),i=Da(),{routerPushByKey:y}=Ua(),b=E(),{bool:g,setTrue:x}=Ge(!1),k=E(),{bool:n,setTrue:f}=Ge(!1),{columnChecks:G,columns:V,data:S,getData:_,loading:se,mobilePagination:A,searchParams:L,resetSearchParams:r}=La({apiFn:Pa,apiParams:{page:1,size:10,groupName:null,jobName:null,jobStatus:null,ownerId:null,executorInfo:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:o("common.index"),align:"center",width:48},{key:"jobName",title:o("page.jobTask.jobName"),align:"center",width:140,fixed:"left",render:m=>{async function u(){b.value=m,x()}return e(te,{text:!0,tag:"a",type:"primary",onClick:u,class:"ws-normal"},{default:()=>[`${m.jobName}`]})}},{key:"groupName",title:o("page.jobTask.groupName"),align:"left",width:150},{key:"executorInfo",title:o("page.jobTask.executorInfo"),align:"left",width:120},{key:"ownerName",title:o("page.jobTask.ownerName"),align:"left",width:120},{key:"labels",title:o("page.pods.labels"),align:"center",width:120,render:m=>e(Fa,{labels:m.labels},null)},{key:"nextTriggerAt",title:o("page.jobTask.nextTriggerAt"),align:"center",width:120},{key:"jobStatus",title:o("page.jobTask.jobStatus"),align:"center",width:60,render:m=>{const u=async(t,w)=>{var D;const{error:c}=await Aa({id:m.id,status:t});c||(m.jobStatus=t,(D=window.$message)==null||D.success(o("common.updateSuccess"))),w(!c)};return e(Ba,{value:m.jobStatus,"onUpdate:value":t=>m.jobStatus=t,onSubmitted:u},null)}},{key:"taskType",title:o("page.jobTask.taskType"),align:"center",width:120,render:m=>{if(m.taskType===null)return null;const u={1:"info",2:"success",3:"error",4:"primary",5:"warning"},t=o(ra[m.taskType]);return e(we,{type:u[m.taskType]},ae(t)?t:{default:()=>[t]})}},{key:"triggerType",title:o("page.jobTask.triggerType"),align:"center",width:120,render:m=>{if(m.triggerType===null)return null;const u={2:"info",3:"success",5:"warning",99:"error"},t=o(sa[m.triggerType]);return e(we,{type:u[m.triggerType]},ae(t)?t:{default:()=>[t]})}},{key:"triggerInterval",title:o("page.jobTask.triggerInterval"),align:"center",width:130,render:m=>{const t=(p=>{try{const T=JSON.parse(p);return Array.isArray(T)&&T.every(z=>typeof z=="string")?T:null}catch{return null}})(m.triggerInterval);if(!t||t.length===0)return m.triggerInterval;const w=p=>e(we,{class:"cursor-pointer",type:"default"},ae(p)?p:{default:()=>[p]});if(t.length===1)return w(t[0]);const[c,D]=t,P=t[t.length-1];return t.length===2?e("div",{class:"flex flex-wrap gap-4px"},[w(c),w(D)]):e(Oa,{trigger:"hover",class:"cursor-pointer"},{trigger:()=>e("div",{class:"flex flex-center flex-wrap gap-4px"},[w(c),w("..."),w(P)]),default:()=>e("div",{class:"w-310px flex flex-wrap gap-4px"},[t.map(p=>e(we,{class:"cursor-pointer",key:p,type:"default"},ae(p)?p:{default:()=>[p]}))])})}},{key:"blockStrategy",title:o("page.jobTask.blockStrategy"),align:"center",width:80,render:m=>{if(m.blockStrategy===null)return null;const u={1:"info",2:"success",3:"error",4:"warning"},t=o(na[m.blockStrategy]);return e(we,{type:u[m.blockStrategy]},ae(t)?t:{default:()=>[t]})}},{key:"executorTimeout",title:o("page.jobTask.executorTimeout"),align:"center",width:80},{key:"updateDt",title:o("page.jobTask.updateDt"),align:"center",width:120},{key:"operate",title:o("common.operate"),align:"center",width:150,fixed:"right",render:m=>{let u,t;const w=[{label:o("common.copy"),key:"copy",click:()=>Y(m.id)},{type:"divider",key:"d2"},{label:o("common.batchList"),key:"batchList",click:()=>W(m.id)},{type:"divider",key:"d2"},{type:"render",key:"delete",render:()=>e("div",{class:"flex-center"},[e(Ke,{onPositiveClick:()=>d(m.id)},{default:()=>o("common.confirmDelete"),trigger:()=>{let D;return e(te,{quaternary:!0,size:"small"},ae(D=o("common.delete"))?D:{default:()=>[D]})}})])}],c=D=>{const P=w.filter(p=>p.key===D)[0].click;P&&P()};return e("div",{class:"flex-center gap-8px"},[e(te,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>R(m.id)},ae(u=o("common.edit"))?u:{default:()=>[u]}),e(ze,{vertical:!0},null),e(te,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>Z(m)},ae(t=o("common.execute"))?t:{default:()=>[t]}),e(ze,{vertical:!0},null),e(Ja,{trigger:"click","show-arrow":!1,options:w,size:"small","on-select":c},{default:()=>e(te,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[h("更多")]})})])}}]}),{drawerVisible:q,operateType:xe,editingData:M,handleAdd:J,handleEdit:fe,handleCopy:be,checkedRowKeys:I,onDeleted:ve,onBatchDeleted:v}=Ha(S,_);async function d(m){const{error:u}=await qe([m]);u||ve()}async function U(){const{error:m}=await qe(I.value);m||v()}function K(){M.value=null,J()}function R(m){fe(m)}function Y(m){be(m)}async function Z(m){k.value=m,f()}function W(m){const u=S.value.find(t=>t.id===m);y("job_batch",{state:{jobId:m,jobName:u.jobName}})}function Q(){return{jobIds:I.value,groupName:L.groupName,jobName:L.jobName,jobStatus:L.jobStatus,ownerId:L.ownerId}}function ye(){va("/job/export",Q(),o("page.jobTask.title"))}return(m,u)=>{const t=ya,w=fa,c=ba,D=ga,P=at,p=Le;return j(),je("div",vt,[e(ft,{model:a(L),"onUpdate:model":u[0]||(u[0]=T=>he(L)?L.value=T:null),onReset:a(r),onSearch:a(_)},null,8,["model","onReset","onSearch"]),e(t),e(p,{title:a(o)("page.jobTask.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":l(()=>[e(D,{columns:a(G),"onUpdate:columns":u[1]||(u[1]=T=>he(G)?G.value=T:null),loading:a(se),"disabled-delete":a(I).length===0,"show-delete":a(C)("R_ADMIN"),onAdd:K,onDelete:U,onRefresh:a(_)},{addAfter:l(()=>[e(w,{action:"/job/import",accept:"application/json",onRefresh:a(_)},null,8,["onRefresh"]),e(a(Ke),{onPositiveClick:ye},{trigger:l(()=>[e(a(te),{size:"small",ghost:"",type:"primary",disabled:a(I).length===0&&a(C)("R_USER")},{icon:l(()=>[e(c,{class:"text-icon"})]),default:l(()=>[h(" "+N(a(o)("common.export")),1)]),_:1},8,["disabled"])]),default:l(()=>[h(N(a(I).length===0?a(o)("common.exportAll"):a(o)("common.exportPar",{num:a(I).length})),1)]),_:1})]),_:1},8,["columns","loading","disabled-delete","show-delete","onRefresh"])]),default:l(()=>[e(P,{"checked-row-keys":a(I),"onUpdate:checkedRowKeys":u[2]||(u[2]=T=>he(I)?I.value=T:null),columns:a(V),data:a(S),"flex-height":!a(i).isMobile,"scroll-x":2e3,loading:a(se),remote:"","row-key":T=>T.id,pagination:a(A),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(dt,{visible:a(q),"onUpdate:visible":u[3]||(u[3]=T=>he(q)?q.value=T:null),"operate-type":a(xe),"row-data":a(M),onSubmitted:a(_)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(bt,{visible:a(g),"onUpdate:visible":u[4]||(u[4]=T=>he(g)?g.value=T:null),"row-data":b.value},null,8,["visible","row-data"]),e(gt,{visible:a(n),"onUpdate:visible":u[5]||(u[5]=T=>he(n)?n.value=T:null),"row-data":k.value},null,8,["visible","row-data"])])}}});export{Ft as default};
