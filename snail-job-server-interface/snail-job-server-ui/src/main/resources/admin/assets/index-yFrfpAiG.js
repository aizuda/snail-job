import{c as Fe,a as pa,b as ia,N as Ee}from"./search-form-CSouas8Y.js";import{_ as da,a as ma,d as ca}from"./download-C7ANTmFB.js";import{_ as ga}from"./delete-alert-CMbkkQNx.js";import{d as X,r as L,c as O,o as k,ac as we,h as a,ad as Ve,aB as fa,$ as o,aC as ba,aD as va,Z as he,a0 as Re,m as Z,y as ya,z as Ge,a as ze,p as ue,w as t,f as e,G as qe,P as $e,A as Ye,C as Me,D as We,b as ke,a2 as Ne,a3 as Ce,aE as Ze,e as pe,g as _,aF as _a,aG as se,E as Pe,B as W,a5 as Qe,v as Xe,aH as ne,F as Oe,q as Je,t as N,a8 as Ta,aA as Le,j as ea,aI as ka,Y as Te,a9 as ye,az as aa,aJ as ha,aK as wa,ax as ja,aL as la,aM as ta,J as Sa,u as Na,ae as Be,af as _e,N as xa,ag as He,aN as Da,aO as Ia,ah as Ua}from"./index-DsXulf34.js";import{c as Oa,d as Ja,e as Va,g as Ra,h as Ke,i as $a,j as Ca}from"./job-DnRsninN.js";import{b as oa,_ as Ma,u as Pa,a as Aa}from"./table-C5lzqi4D.js";import{u as Ea}from"./auth-CUdKODNA.js";import{_ as La}from"./status-switch.vue_vue_type_script_setup_true_lang-m8qEijEY.js";import{L as Ba}from"./label-list-CM9sEsZ3.js";import{_ as Ha}from"./labels-input.vue_vue_type_script_setup_true_lang-D8rx2BaW.js";import{_ as ra}from"./system-user.vue_vue_type_script_setup_true_lang-BeDWgk3F.js";import{f as Ka}from"./notify-CjnxS7b5.js";import{_ as Fa,a as Ga}from"./block-strategy.vue_vue_type_script_setup_true_lang-D6DwmrIW.js";import{_ as Q}from"./code-mirror-5CHqaaLi.js";import{_ as za}from"./job-trigger-interval.vue_vue_type_script_setup_true_lang-3GUKqu-u.js";import{_ as sa}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{_ as qa,a as Ya,c as Wa,d as Za,b as Qa}from"./Grid-DdJm4X1d.js";import{_ as na}from"./DynamicInput-C24Xro_e.js";import{_ as ua}from"./cron-input.vue_vue_type_style_index_0_lang-BFaeFXfx.js";import{_ as Xa}from"./detail-drawer-BuPycGzQ.js";import{_ as el,a as al}from"./DescriptionsItem-BEs7Hiy4.js";import"./CollapseItem-4hJT8hQy.js";import"./Progress-B1GWDnDE.js";import"./dashboard-D6r2Q2oa.js";import"./DynamicTags-CEJ2tmOq.js";import"./DatePicker-B2fzTH2d.js";import"./group-DephWMPB.js";const ll=X({name:"TriggerType",__name:"trigger-type",emits:["update:value"],setup(C,{emit:M}){const u=M,f=L(),g=c=>{u("update:value",c)};return(c,x)=>{const b=we;return k(),O(b,{value:f.value,"onUpdate:value":[x[0]||(x[0]=h=>f.value=h),g],placeholder:a(o)("common.triggerType.form"),options:a(Ve)(a(fa))},null,8,["value","placeholder","options"])}}}),tl=X({name:"TriggerStrategy",__name:"executor-type",emits:["update:value"],setup(C,{emit:M}){const u=L(),f=M,g=c=>{f("update:value",c)};return(c,x)=>{const b=we;return k(),O(b,{value:u.value,"onUpdate:value":[x[0]||(x[0]=h=>u.value=h),g],placeholder:a(o)("common.executorType.form"),options:a(Ve)(a(ba))},null,8,["value","placeholder","options"])}}}),ol=X({name:"TaskType",__name:"task-type",emits:["update:value"],setup(C,{emit:M}){const u=M,f=L(),g=c=>{u("update:value",c)};return(c,x)=>{const b=we;return k(),O(b,{value:f.value,"onUpdate:value":[x[0]||(x[0]=h=>f.value=h),g],placeholder:a(o)("common.routeKey.routeForm"),options:a(Ve)(a(va))},null,8,["value","placeholder","options"])}}}),rl={class:"w-full w-full flex-col items-start gap-12px pt-5px"},sl={class:"flex"},nl=X({name:"JobTaskOperateDrawer",__name:"job-task-operate-drawer",props:he({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:he(["submitted"],["update:visible"]),setup(C,{emit:M}){const u=L([]),f=C,g=M,c=L(0),x=Re(C,"visible"),b=Z({args:[{arg:""}]}),h=L(0),w=L(null),{formRef:K,validate:$,restoreValidation:j}=ya(),{defaultRequiredRule:v}=Ge(),ee=n=>{if(!ne(n))return{isValid:!1,message:"触发间隔不能为空"};try{const l=JSON.parse(n);if(!Array.isArray(l))return{isValid:!1,message:"指定时间点必须是有效的时间数组格式"};if(l.length===0)return{isValid:!1,message:"请至少添加一个指定时间点"};if(l.filter(y=>!ne(y)).length>0)return{isValid:!1,message:"存在无效的时间点"};const m=l.filter(y=>ne(y));if(m.length===0)return{isValid:!1,message:"请至少设置一个有效的时间点"};const p=Le();let U=!1;for(const y of m){if(typeof y!="string")return{isValid:!1,message:"时间点格式不正确，必须是字符串格式"};const S=Le(y,"YYYY-MM-DD HH:mm:ss",!0);if(!S.isValid())return{isValid:!1,message:`时间格式不正确: ${y}，请使用 YYYY-MM-DD HH:mm:ss 格式`};S.isAfter(p)&&(U=!0)}return U?{isValid:!0}:{isValid:!1,message:"请至少设置一个未来的时间点"}}catch{return{isValid:!1,message:"指定时间点数据格式错误，请检查JSON格式"}}},E=ze(()=>({add:o("page.jobTask.addJobTask"),edit:o("page.jobTask.editJobTask")})[f.operateType]);async function B(){const n=await Ka(3);u.value=n.data}const r=Z(F());function F(){return{groupName:void 0,ownerId:void 0,notifyIds:[],jobName:"",argsStr:"",argsType:1,jobStatus:1,routeKey:4,executorType:1,triggerType:2,executorInfo:void 0,triggerInterval:"60",blockStrategy:1,executorTimeout:60,maxRetryTimes:3,retryInterval:1,taskType:1,parallelNum:1,description:"",labels:"{}",labelMap:[]}}const je={groupName:v,jobName:v,argsType:v,jobStatus:v,routeKey:v,executorType:v,executorInfo:v,triggerType:v,triggerInterval:v,blockStrategy:v,executorTimeout:v,maxRetryTimes:v,retryInterval:v,taskType:v,parallelNum:v},P=L([]),J=Z(ie());function ie(){return{method:"POST",url:"",headers:{},body:"",mediaType:"application/json",timeout:60}}const de=[{label:"Http 执行器",value:"snailJobHttpExecutor"},{label:"CMD 执行器",value:"snailJobCMDJobExecutor"},{label:"PowerShell 执行器",value:"snailJobPowerShellJobExecutor"},{label:"Shell 执行器",value:"snailJobShellJobExecutor"}],D=Z(me());function me(){return{method:"LOCAL_SCRIPT",scriptParams:"",charset:""}}function I(){if(Object.assign(r,F()),c.value=0,P.value=[],r.labelMap=[],Object.assign(J,ie()),Object.assign(D,me()),!(f.operateType==="add"&&!f.rowData)&&f.rowData){if(Object.assign(r,f.rowData),r.labels&&(r.labelMap=Object.entries(JSON.parse(r.labels)).map(([n,l])=>({key:n,value:l}))),r.taskType===3&&r.argsStr&&Object.assign(b,{args:JSON.parse(r.argsStr).map(n=>({arg:n}))}),r.taskType===5&&r.argsStr){const n=JSON.parse(r.argsStr);h.value=n.shardNum,r.argsStr=n.argsStr}de.map(n=>n.value).includes(r.executorInfo)&&(c.value=1,r.executorInfo==="snailJobHttpExecutor"?(Object.assign(J,JSON.parse(r.argsStr)),J.headers&&(P.value=Object.keys(J.headers).map(n=>({key:n,value:J.headers[n]})))):Object.assign(D,JSON.parse(r.argsStr)))}}function i(){x.value=!1}async function R(){if(await $(),r.triggerType===5){const V=ee(r.triggerInterval);if(!V.isValid){window.$message?.error(V.message||"指定时间点校验失败");return}}const{id:n,groupName:l,ownerId:T,ownerName:m,notifyIds:p,jobName:U,argsType:y,jobStatus:S,routeKey:ae,executorType:q,executorInfo:xe,triggerType:le,triggerInterval:De,blockStrategy:Ie,executorTimeout:te,maxRetryTimes:Ue,retryInterval:be,taskType:oe,parallelNum:H,description:re}=r;let ve=oe===5?JSON.stringify({shardNum:h.value,argsStr:r.argsStr}):r.argsStr;c.value===1&&(await w.value?.validate(),r.executorInfo==="snailJobHttpExecutor"?(P.value.forEach(V=>{J.headers[V.key]=V.value}),ve=JSON.stringify(J)):ve=JSON.stringify(D));const s={};if(r.labelMap?.forEach(V=>{s[V.key]=V.value}),f.operateType==="add"){const{error:V}=await Oa({groupName:l,ownerId:T,ownerName:m,notifyIds:p,jobName:U,argsStr:ve,argsType:y,jobStatus:S,routeKey:ae,executorType:q,executorInfo:xe,triggerType:le,triggerInterval:De,blockStrategy:Ie,executorTimeout:te,maxRetryTimes:Ue,retryInterval:be,taskType:oe,parallelNum:H,description:re,labels:JSON.stringify(s)});if(V)return;window.$message?.success(o("common.addSuccess"))}if(f.operateType==="edit"){const{error:V}=await Ja({id:n,groupName:l,ownerId:T,ownerName:m,notifyIds:p,jobName:U,argsStr:ve,argsType:y,jobStatus:S,routeKey:ae,executorType:q,executorInfo:xe,triggerType:le,triggerInterval:De,blockStrategy:Ie,executorTimeout:te,maxRetryTimes:Ue,retryInterval:be,taskType:oe,parallelNum:H,description:re,labels:JSON.stringify(s)});if(V)return;window.$message?.success(o("common.updateSuccess"))}i(),g("submitted")}function z(){if(r.taskType===3&&b.args){const n=b.args.map(l=>l.arg.trim()).filter(l=>!!l);r.argsStr=n.length>0?JSON.stringify(n):""}return r.argsStr}const A=n=>{b.args.splice(n,1)},ce=L([]),Se=async n=>{const{error:l,data:T}=await Va({groupName:n});l||(ce.value=T||[])},ge=()=>{b.args.push({arg:""})};ue(x,()=>{x.value&&(I(),j(),B(),w.value?.restoreValidation())}),ue(b,()=>{x.value&&r.taskType===3&&z()}),ue(()=>r.taskType,n=>{f.operateType==="add"&&x.value&&(n!==3&&(b.args=[]),n!==5&&(h.value=1),r.argsStr="")}),ue(()=>r.groupName,n=>{Se(n)});function G(){if(c.value===0){r.executorInfo="";return}r.executorInfo="snailJobHttpExecutor"}const fe=[{label:"GET",value:"get"},{label:"POST",value:"post"},{label:"PUT",value:"put"},{label:"DELETE",value:"delete"}],d=[{label:"需下载脚本",value:"DOWNLOAD"},{label:"脚本代码",value:"SCRIPT_CODE"},{label:"使用本地脚本",value:"LOCAL_SCRIPT"}];return(n,l)=>{const T=Me,m=Ye,p=ra,U=Ha,y=Ya,S=We,ae=qa,q=we,xe=Fe,le=W,De=oa,Ie=Pe,te=Qe,Ue=na,be=ua,oe=qe,H=Za,re=Wa,ve=ll;return k(),O(Ta,{modelValue:x.value,"onUpdate:modelValue":l[33]||(l[33]=s=>x.value=s),title:E.value,"min-size":480,onHandleSubmit:R},{footer:t(()=>[e(S,{size:16},{default:t(()=>[e(le,{onClick:i},{default:t(()=>[_(N(a(o)("common.cancel")),1)]),_:1}),e(le,{type:"primary",onClick:R},{default:t(()=>[_(N(a(o)("common.save")),1)]),_:1})]),_:1})]),default:t(()=>[e(oe,{ref_key:"formRef",ref:K,model:r,rules:je},{default:t(()=>[e(m,{label:a(o)("page.jobTask.jobName"),path:"jobName"},{default:t(()=>[e(T,{value:r.jobName,"onUpdate:value":l[0]||(l[0]=s=>r.jobName=s),maxlength:64,"show-count":"",placeholder:a(o)("page.jobTask.form.jobName")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(m,{label:a(o)("page.jobTask.groupName"),path:"groupName"},{default:t(()=>[e(sa,{value:r.groupName,"onUpdate:value":l[1]||(l[1]=s=>r.groupName=s),disabled:f.operateType==="edit"},null,8,["value","disabled"])]),_:1},8,["label"]),e(m,{label:a(o)("page.jobTask.ownerName"),path:"ownerId"},{default:t(()=>[e(p,{value:r.ownerId,"onUpdate:value":l[2]||(l[2]=s=>r.ownerId=s),clearable:!0},null,8,["value"])]),_:1},8,["label"]),e(m,{label:a(o)("page.jobTask.labels"),path:"labelMap","show-feedback":!r.labelMap?.length},{default:t(()=>[e(U,{value:r.labelMap,"onUpdate:value":l[3]||(l[3]=s=>r.labelMap=s),path:"labelMap"},null,8,["value"])]),_:1},8,["label","show-feedback"]),e(m,{label:a(o)("page.jobTask.jobStatus"),path:"jobStatus"},{default:t(()=>[e(ae,{value:r.jobStatus,"onUpdate:value":l[4]||(l[4]=s=>r.jobStatus=s),name:"jobStatus"},{default:t(()=>[e(S,null,{default:t(()=>[(k(!0),ke(Ne,null,Ce(a(Ze),s=>(k(),O(y,{key:s.value,value:s.value,label:a(o)(s.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),e(m,{label:a(o)("page.jobTask.taskType"),path:"taskType"},{default:t(()=>[e(ol,{value:r.taskType,"onUpdate:value":l[5]||(l[5]=s=>r.taskType=s),placeholder:a(o)("page.jobTask.form.taskType")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(m,{label:a(o)("page.jobTask.executorType"),path:"executorType"},{default:t(()=>[e(tl,{value:r.executorType,"onUpdate:value":l[6]||(l[6]=s=>r.executorType=s)},null,8,["value"])]),_:1},8,["label"]),e(m,{label:a(o)("page.jobTask.executorInfo"),path:"executorInfo"},{default:t(()=>[pe("div",rl,[e(ae,{value:c.value,"onUpdate:value":l[7]||(l[7]=s=>c.value=s),onChange:G},{default:t(()=>[e(y,{value:0},{default:t(()=>l[34]||(l[34]=[_("自定义执行器")])),_:1,__:[34]}),e(y,{value:1},{default:t(()=>l[35]||(l[35]=[_("内置执行器")])),_:1,__:[35]})]),_:1},8,["value"]),c.value===0?(k(),O(q,{key:0,value:r.executorInfo,"onUpdate:value":l[8]||(l[8]=s=>r.executorInfo=s),filterable:"",tag:"",options:a(_a)(ce.value),placeholder:a(o)("page.jobTask.form.executorInfo")},null,8,["value","options","placeholder"])):(k(),O(q,{key:1,value:r.executorInfo,"onUpdate:value":l[9]||(l[9]=s=>r.executorInfo=s),options:de,placeholder:"请选择内置执行器"},null,8,["value"]))])]),_:1},8,["label"]),r.taskType===5?(k(),O(m,{key:0,label:a(o)("page.jobTask.shardNum")},{default:t(()=>[e(a(se),{value:h.value,"onUpdate:value":l[10]||(l[10]=s=>h.value=s),min:1,placeholder:a(o)("page.jobTask.form.shardNum")},null,8,["value","placeholder"])]),_:1},8,["label"])):$e("",!0),e(m,{label:a(o)("page.jobTask.argsStr"),path:"argsStr","show-label":c.value===0,"show-feedback":c.value===0,rule:r.taskType===3?a(v):void 0},{default:t(()=>[c.value===0?(k(),ke(Ne,{key:0},[r.taskType===3?(k(),O(Ie,{key:0,class:"flex-col"},{default:t(()=>[(k(!0),ke(Ne,null,Ce(b.args,(s,V)=>(k(),O(m,{key:V,label:`分片参数 ${V+1}`,path:`args[${V}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${a(o)("page.jobTask.form.argsStr")} ${V+1}`,trigger:["input","blur"],validator(){return!!s.arg}}},{default:t(()=>[e(Q,{modelValue:s.arg,"onUpdate:modelValue":Ae=>s.arg=Ae,lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),e(le,{class:"ml-12px",type:"error",dashed:"",onClick:Ae=>A(V)},{default:t(()=>[e(xe,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),e(le,{block:"",dashed:"","attr-type":"button",onClick:ge},{default:t(()=>[e(De,{class:"text-icon"})]),_:1})]),_:1})):(k(),O(Q,{key:1,modelValue:r.argsStr,"onUpdate:modelValue":l[11]||(l[11]=s=>r.argsStr=s),lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))],64)):r.executorInfo==="snailJobHttpExecutor"?(k(),O(oe,{key:1,ref_key:"customformRef",ref:w,class:"w-full",model:J},{default:t(()=>[e(m,{label:"请求参数",rule:a(v),path:"url"},{default:t(()=>[e(te,null,{default:t(()=>[e(q,{value:J.method,"onUpdate:value":l[12]||(l[12]=s=>J.method=s),class:"http-method",options:fe},null,8,["value"]),e(T,{value:J.url,"onUpdate:value":l[13]||(l[13]=s=>J.url=s),placeholder:"请输入请求地址",class:"w-full"},null,8,["value"])]),_:1})]),_:1},8,["rule"]),e(m,{label:"Media Type"},{default:t(()=>[e(T,{value:J.mediaType,"onUpdate:value":l[14]||(l[14]=s=>J.mediaType=s),placeholder:"请输入 Media Type"},null,8,["value"])]),_:1}),l[37]||(l[37]=pe("div",{class:"n-form-item-label"},"Header 参数",-1)),e(Ue,{value:P.value,"onUpdate:value":l[17]||(l[17]=s=>P.value=s),class:Xe(P.value.length?void 0:"mb-24px"),"item-style":"margin-bottom: 0;","on-create":()=>({key:"",value:""})},{default:t(({index:s})=>[pe("div",sl,[e(m,{"ignore-path-change":"","show-label":!1,path:`headers[${s}].key`,rule:{required:!0,message:"请输入键",trigger:["input","blur"],validator:()=>a(ne)(P.value[s].key)}},{default:t(()=>[e(T,{value:P.value[s].key,"onUpdate:value":V=>P.value[s].key=V,placeholder:"Key",onKeydown:l[15]||(l[15]=Oe(Je(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"]),l[36]||(l[36]=pe("div",{class:"mx-8px h-34px text-center line-height-34px"},"=",-1)),e(m,{"ignore-path-change":"","show-label":!1,path:`headers[${s}].value`,rule:{required:!0,message:"请输入值",trigger:["input","blur"],validator:()=>a(ne)(P.value[s].value)}},{default:t(()=>[e(T,{value:P.value[s].value,"onUpdate:value":V=>P.value[s].value=V,placeholder:"Value",onKeydown:l[16]||(l[16]=Oe(Je(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"])])]),_:1},8,["value","class"]),e(m,{label:"Body 参数"},{default:t(()=>[e(Q,{modelValue:J.body,"onUpdate:modelValue":l[18]||(l[18]=s=>J.body=s),lang:"json",placeholder:"请输入 Body 参数"},null,8,["modelValue"])]),_:1}),e(m,{label:"接口超时时间"},{default:t(()=>[e(te,null,{default:t(()=>[e(a(se),{value:J.timeout,"onUpdate:value":l[19]||(l[19]=s=>J.timeout=s),class:"w-full",min:1,max:99999999,placeholder:a(o)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(be,null,{default:t(()=>[_(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1})]),_:1,__:[37]},8,["model"])):(k(),O(oe,{key:2,ref_key:"customformRef",ref:w,class:"w-full",model:D},{default:t(()=>[e(m,{label:"脚本类型"},{default:t(()=>[e(q,{value:D.method,"onUpdate:value":l[20]||(l[20]=s=>D.method=s),options:d},null,8,["value"])]),_:1}),e(m,{label:"脚本参数"},{default:t(()=>[e(Q,{modelValue:D.scriptParams,"onUpdate:modelValue":l[21]||(l[21]=s=>D.scriptParams=s),lang:"json",placeholder:"请输入脚本参数"},null,8,["modelValue"])]),_:1}),e(m,{label:"编码格式"},{default:t(()=>[e(T,{value:D.charset,"onUpdate:value":l[22]||(l[22]=s=>D.charset=s),placeholder:"请输入编码格式"},null,8,["value"])]),_:1})]),_:1},8,["model"]))]),_:1},8,["label","show-label","show-feedback","rule"]),e(re,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:t(()=>[e(H,null,{default:t(()=>[e(m,{label:a(o)("page.jobTask.routeKey"),path:"routeKey"},{default:t(()=>[e(Fa,{value:r.routeKey,"onUpdate:value":l[23]||(l[23]=s=>r.routeKey=s),"task-type":r.taskType},null,8,["value","task-type"])]),_:1},8,["label"])]),_:1}),e(H,null,{default:t(()=>[e(m,{label:a(o)("page.jobTask.blockStrategy"),path:"blockStrategy"},{default:t(()=>[e(Ga,{value:r.blockStrategy,"onUpdate:value":l[24]||(l[24]=s=>r.blockStrategy=s)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),e(re,{cols:r.triggerType===5?"1":"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:t(()=>[e(H,null,{default:t(()=>[e(m,{label:a(o)("page.jobTask.triggerType"),path:"triggerType"},{default:t(()=>[e(ve,{value:r.triggerType,"onUpdate:value":l[25]||(l[25]=s=>r.triggerType=s),placeholder:a(o)("page.jobTask.form.triggerType")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e(H,null,{default:t(()=>[e(m,{label:a(o)("page.jobTask.triggerInterval"),path:"triggerInterval"},{default:t(()=>[e(za,{modelValue:r.triggerInterval,"onUpdate:modelValue":l[26]||(l[26]=s=>r.triggerInterval=s),"trigger-type":r.triggerType},null,8,["modelValue","trigger-type"])]),_:1},8,["label"])]),_:1})]),_:1},8,["cols"]),e(re,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:t(()=>[e(H,null,{default:t(()=>[e(m,{label:a(o)("page.jobTask.executorTimeout"),path:"executorTimeout"},{default:t(()=>[e(te,null,{default:t(()=>[e(a(se),{value:r.executorTimeout,"onUpdate:value":l[27]||(l[27]=s=>r.executorTimeout=s),min:1,max:99999999,placeholder:a(o)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(be,null,{default:t(()=>[_(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),e(H,null,{default:t(()=>[e(m,{label:a(o)("page.jobTask.maxRetryTimes"),path:"maxRetryTimes"},{default:t(()=>[e(a(se),{value:r.maxRetryTimes,"onUpdate:value":l[28]||(l[28]=s=>r.maxRetryTimes=s),min:0,max:999,placeholder:a(o)("page.jobTask.form.maxRetryTimes"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),e(re,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:t(()=>[e(H,null,{default:t(()=>[e(m,{label:a(o)("page.jobTask.retryInterval"),path:"retryInterval"},{default:t(()=>[e(te,null,{default:t(()=>[e(a(se),{value:r.retryInterval,"onUpdate:value":l[29]||(l[29]=s=>r.retryInterval=s),min:1,max:99999999,placeholder:a(o)("page.jobTask.form.retryInterval"),clearable:""},null,8,["value","placeholder"]),e(be,null,{default:t(()=>[_(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),e(H,null,{default:t(()=>[r.taskType!==1&&r.taskType!==2?(k(),O(m,{key:0,label:a(o)("page.jobTask.parallelNum"),path:"parallelNum"},{default:t(()=>[e(a(se),{value:r.parallelNum,"onUpdate:value":l[30]||(l[30]=s=>r.parallelNum=s),min:1,max:999,placeholder:a(o)("page.jobTask.form.parallelNum"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):$e("",!0)]),_:1})]),_:1}),e(m,{label:a(o)("page.jobTask.notifyId"),path:"notifyIds"},{default:t(()=>[e(q,{value:r.notifyIds,"onUpdate:value":l[31]||(l[31]=s=>r.notifyIds=s),"value-field":"id","label-field":"notifyName",placeholder:a(o)("page.jobTask.form.notifyId"),options:u.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(m,{label:a(o)("page.jobTask.description"),path:"description"},{default:t(()=>[e(T,{value:r.description,"onUpdate:value":l[32]||(l[32]=s=>r.description=s),type:"textarea",placeholder:a(o)("page.jobTask.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ul=ea(nl,[["__scopeId","data-v-ab6bec3c"]]),pl={class:"flex"},il=X({name:"JobTaskTriggerModal",__name:"job-task-trigger-modal",props:he({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:he(["submitted"],["update:visible"]),setup(C,{emit:M}){const u=C,f=M,g=Re(C,"visible"),c=Z({args:[{arg:""}]}),x=L(0),b=L(null),{defaultRequiredRule:h}=Ge(),w=Z(K());function K(){return{jobId:u.rowData?.id,tmpArgsStr:u.rowData?.argsStr}}const $=L([]),j=Z(v());function v(){return{method:"POST",url:"",headers:{},body:"",mediaType:"application/json",timeout:60}}const ee=[{label:"Http 执行器",value:"snailJobHttpExecutor"},{label:"CMD 执行器",value:"snailJobCMDJobExecutor"},{label:"PowerShell 执行器",value:"snailJobPowerShellJobExecutor"},{label:"Shell 执行器",value:"snailJobShellJobExecutor"}],E=Z(B());function B(){return{method:"LOCAL_SCRIPT",scriptParams:"",charset:""}}function r(){if(console.log("112: props.rowData:",u.rowData),console.log("113: model:",w),$.value=[],Object.assign(j,v()),Object.assign(E,B()),Object.assign(w,K()),console.log("120: model:",w),!u.rowData)return;w.jobId=u.rowData?.id,w.tmpArgsStr=u.rowData?.argsStr,console.log("127: model:",w);const I=u.rowData.taskType,i=u.rowData.argsStr;if(i){if(I===3&&Object.assign(c,{args:JSON.parse(i).map(R=>({arg:R}))}),I===5){const R=JSON.parse(i);x.value=R.shardNum,w.tmpArgsStr=R.argsStr}ee.map(R=>R.value).includes(u.rowData.executorInfo)&&(u.rowData.executorInfo==="snailJobHttpExecutor"?(Object.assign(j,JSON.parse(i)),j.headers&&($.value=Object.keys(j.headers).map(R=>({key:R,value:j.headers[R]})))):Object.assign(E,JSON.parse(i))),console.log("163: model:",w)}}function F(){g.value=!1}function je(){if(u.rowData?.taskType===3&&c.args){const I=c.args.map(i=>i.arg.trim()).filter(i=>!!i);w.tmpArgsStr=I.length>0?JSON.stringify(I):""}return w.tmpArgsStr}const P=I=>{c.args.splice(I,1)},J=()=>{c.args.push({arg:""})};ue(g,()=>{g.value&&(r(),b.value?.restoreValidation())}),ue(c,()=>{g.value&&u.rowData?.taskType===3&&je()}),ue(()=>u.rowData?.taskType,I=>{g.value||(I!==3&&(c.args=[]),I!==5&&(x.value=1),w.tmpArgsStr="")});const ie=[{label:"GET",value:"get"},{label:"POST",value:"post"},{label:"PUT",value:"put"},{label:"DELETE",value:"delete"}],de=[{label:"需下载脚本",value:"DOWNLOAD"},{label:"脚本代码",value:"SCRIPT_CODE"},{label:"使用本地脚本",value:"LOCAL_SCRIPT"}],D=ze(()=>ee.map(I=>I.value).includes(u.rowData.executorInfo)?1:0);async function me(){let I=u.rowData?.taskType===5?JSON.stringify({shardNum:x.value,argsStr:w.tmpArgsStr}):w.tmpArgsStr;D.value===1&&(await b.value?.validate(),u.rowData?.executorInfo==="snailJobHttpExecutor"?($.value.forEach(R=>{j.headers[R.key]=R.value}),I=JSON.stringify(j)):I=JSON.stringify(E));const{error:i}=await Ra({jobId:u.rowData?.id,tmpArgsStr:I});i||(window.$message?.success(o("common.executeSuccess")),F(),f("submitted"))}return(I,i)=>{const R=Fe,z=W,A=Ye,ce=oa,Se=Pe,ge=we,G=Me,fe=Qe,d=na,n=ua,l=qe,T=We,m=ka;return k(),O(m,{show:g.value,"onUpdate:show":i[12]||(i[12]=p=>g.value=p),class:"max-w-90% w-600px",preset:"card",title:"执行任务",bordered:!1},{footer:t(()=>[e(T,{justify:"end",size:16},{default:t(()=>[e(z,{onClick:F},{default:t(()=>[_(N(a(o)("common.cancel")),1)]),_:1}),e(z,{type:"primary",onClick:me},{default:t(()=>i[15]||(i[15]=[_("执行")])),_:1,__:[15]})]),_:1})]),default:t(()=>[e(l,{model:w},{default:t(()=>[I.rowData?(k(),O(A,{key:0,label:a(o)("page.jobTask.argsStr"),path:"argsStr","show-label":D.value===0,"show-feedback":D.value===0,rule:I.rowData?.taskType===3?a(h):void 0},{default:t(()=>[D.value===0?(k(),ke(Ne,{key:0},[I.rowData?.taskType===3?(k(),O(Se,{key:0,class:"flex-col"},{default:t(()=>[(k(!0),ke(Ne,null,Ce(c.args,(p,U)=>(k(),O(A,{key:U,label:`分片参数 ${U+1}`,path:`args[${U}].arg`,"show-feedback":!1,class:"m-b-12px",rule:{required:!0,message:`${a(o)("page.jobTask.form.argsStr")} ${U+1}`,trigger:["input","blur"],validator(){return!!p.arg}}},{default:t(()=>[e(Q,{modelValue:p.arg,"onUpdate:modelValue":y=>p.arg=y,lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),e(z,{class:"ml-12px",type:"error",dashed:"",onClick:y=>P(U)},{default:t(()=>[e(R,{class:"text-icon"})]),_:2},1032,["onClick"])]),_:2},1032,["label","path","rule"]))),128)),e(z,{block:"",dashed:"","attr-type":"button",onClick:J},{default:t(()=>[e(ce,{class:"text-icon"})]),_:1})]),_:1})):(k(),O(Q,{key:1,modelValue:w.tmpArgsStr,"onUpdate:modelValue":i[0]||(i[0]=p=>w.tmpArgsStr=p),lang:"json",placeholder:a(o)("page.jobTask.form.argsStr")},null,8,["modelValue","placeholder"]))],64)):I.rowData.executorInfo==="snailJobHttpExecutor"?(k(),O(l,{key:1,ref_key:"customformRef",ref:b,class:"w-full",model:j},{default:t(()=>[e(A,{label:"请求参数",rule:a(h),path:"url"},{default:t(()=>[e(fe,null,{default:t(()=>[e(ge,{value:j.method,"onUpdate:value":i[1]||(i[1]=p=>j.method=p),class:"http-method",options:ie},null,8,["value"]),e(G,{value:j.url,"onUpdate:value":i[2]||(i[2]=p=>j.url=p),placeholder:"请输入请求地址",class:"w-full"},null,8,["value"])]),_:1})]),_:1},8,["rule"]),e(A,{label:"Media Type"},{default:t(()=>[e(G,{value:j.mediaType,"onUpdate:value":i[3]||(i[3]=p=>j.mediaType=p),placeholder:"请输入 Media Type"},null,8,["value"])]),_:1}),i[14]||(i[14]=pe("div",{class:"n-form-item-label"},"Header 参数",-1)),e(d,{value:$.value,"onUpdate:value":i[6]||(i[6]=p=>$.value=p),class:Xe($.value.length?void 0:"mb-24px"),"item-style":"margin-bottom: 0;","on-create":()=>({key:"",value:""})},{default:t(({index:p})=>[pe("div",pl,[e(A,{"ignore-path-change":"","show-label":!1,path:`headers[${p}].key`,rule:{required:!0,message:"请输入键",trigger:["input","blur"],validator:()=>a(ne)($.value[p].key)}},{default:t(()=>[e(G,{value:$.value[p].key,"onUpdate:value":U=>$.value[p].key=U,placeholder:"Key",onKeydown:i[4]||(i[4]=Oe(Je(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"]),i[13]||(i[13]=pe("div",{class:"mx-8px h-34px text-center line-height-34px"},"=",-1)),e(A,{"ignore-path-change":"","show-label":!1,path:`headers[${p}].value`,rule:{required:!0,message:"请输入值",trigger:["input","blur"],validator:()=>a(ne)($.value[p].value)}},{default:t(()=>[e(G,{value:$.value[p].value,"onUpdate:value":U=>$.value[p].value=U,placeholder:"Value",onKeydown:i[5]||(i[5]=Oe(Je(()=>{},["prevent"]),["enter"]))},null,8,["value","onUpdate:value"])]),_:2},1032,["path","rule"])])]),_:1},8,["value","class"]),e(A,{label:"Body 参数"},{default:t(()=>[e(Q,{modelValue:j.body,"onUpdate:modelValue":i[7]||(i[7]=p=>j.body=p),lang:"json",placeholder:"请输入 Body 参数"},null,8,["modelValue"])]),_:1}),e(A,{label:"接口超时时间"},{default:t(()=>[e(fe,null,{default:t(()=>[e(a(se),{value:j.timeout,"onUpdate:value":i[8]||(i[8]=p=>j.timeout=p),class:"w-full",min:1,max:99999999,placeholder:a(o)("page.jobTask.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(n,null,{default:t(()=>[_(N(a(o)("common.second")),1)]),_:1})]),_:1})]),_:1})]),_:1,__:[14]},8,["model"])):(k(),O(l,{key:2,ref_key:"customformRef",ref:b,class:"w-full",model:E},{default:t(()=>[e(A,{label:"脚本类型"},{default:t(()=>[e(ge,{value:E.method,"onUpdate:value":i[9]||(i[9]=p=>E.method=p),options:de},null,8,["value"])]),_:1}),e(A,{label:"脚本参数"},{default:t(()=>[e(Q,{modelValue:E.scriptParams,"onUpdate:modelValue":i[10]||(i[10]=p=>E.scriptParams=p),lang:"json",placeholder:"请输入脚本参数"},null,8,["modelValue"])]),_:1}),e(A,{label:"编码格式"},{default:t(()=>[e(G,{value:E.charset,"onUpdate:value":i[11]||(i[11]=p=>E.charset=p),placeholder:"请输入编码格式"},null,8,["value"])]),_:1})]),_:1},8,["model"]))]),_:1},8,["label","show-label","show-feedback","rule"])):$e("",!0)]),_:1},8,["model"])]),_:1},8,["show"])}}}),dl=ea(il,[["__scopeId","data-v-eb573f02"]]),ml=X({name:"JobTaskSearch",__name:"job-task-search",props:{model:{required:!0},modelModifiers:{}},emits:he(["reset","search"],["update:model"]),setup(C,{emit:M}){const u=M,f=Re(C,"model");function g(){u("reset")}function c(){u("search")}return(x,b)=>{const h=Ma,w=Me,K=we,$=ra,j=pa;return k(),O(j,{"btn-span":"24 s:12 m:18 l:18 xl:18",model:f.value,onSearch:c,onReset:g},{default:t(()=>[e(h,{span:"24 s:12 m:6",label:a(o)("page.jobTask.groupName"),path:"groupName",class:"pr-24px"},{default:t(()=>[e(sa,{value:f.value.groupName,"onUpdate:value":b[0]||(b[0]=v=>f.value.groupName=v),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:a(o)("page.jobTask.jobName"),path:"jobName",class:"pr-24px"},{default:t(()=>[e(w,{value:f.value.jobName,"onUpdate:value":b[1]||(b[1]=v=>f.value.jobName=v),placeholder:a(o)("page.jobTask.form.jobName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:a(o)("page.jobTask.executorInfo"),path:"executorInfo",class:"pr-24px","label-width":100},{default:t(()=>[e(w,{value:f.value.executorInfo,"onUpdate:value":b[2]||(b[2]=v=>f.value.executorInfo=v),placeholder:a(o)("page.jobTask.form.executorInfo"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:a(o)("page.jobTask.jobStatus"),path:"jobStatus",class:"pr-24px"},{default:t(()=>[e(K,{value:f.value.jobStatus,"onUpdate:value":b[3]||(b[3]=v=>f.value.jobStatus=v),placeholder:a(o)("page.jobTask.form.jobStatus"),options:a(Ve)(a(Ze)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(h,{span:"24 s:12 m:6",label:a(o)("page.jobTask.ownerName"),path:"ownerId",class:"pr-24px"},{default:t(()=>[e($,{value:f.value.ownerId,"onUpdate:value":b[4]||(b[4]=v=>f.value.ownerId=v),clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),cl=X({name:"JobTaskDetailDrawer",__name:"job-task-detail-drawer",props:he({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(C){const M=Re(C,"visible");return(u,f)=>{const g=al,c=Te,x=el,b=Xa;return k(),O(b,{modelValue:M.value,"onUpdate:modelValue":f[0]||(f[0]=h=>M.value=h),title:a(o)("page.jobTask.detail"),width:["50%","90%"]},{default:t(()=>[e(x,{"label-placement":"top",bordered:"",column:2},{default:t(()=>[e(g,{label:a(o)("page.jobTask.groupName")},{default:t(()=>[_(N(u.rowData?.groupName),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.jobName")},{default:t(()=>[_(N(u.rowData?.jobName),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.taskType")},{default:t(()=>[e(c,{type:a(ye)(u.rowData?.taskType)},{default:t(()=>[_(N(a(o)(a(aa)[u.rowData?.taskType])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.argsStr")},{default:t(()=>[_(N(u.rowData?.argsStr),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.nextTriggerAt")},{default:t(()=>[_(N(u.rowData?.nextTriggerAt),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.jobStatus")},{default:t(()=>[e(c,{type:a(ye)(u.rowData?.jobStatus)},{default:t(()=>[_(N(a(o)(a(ha)[u.rowData?.jobStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.routeKey")},{default:t(()=>[e(c,{type:a(ye)(u.rowData?.routeKey)},{default:t(()=>[_(N(a(o)(a(wa)[u.rowData?.routeKey])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.executorType")},{default:t(()=>[e(c,{type:a(ye)(u.rowData?.executorType)},{default:t(()=>[_(N(a(o)(a(ja)[u.rowData?.executorType])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.executorInfo")},{default:t(()=>[_(N(u.rowData?.executorInfo),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.triggerType")},{default:t(()=>[e(c,{type:a(ye)(u.rowData?.triggerType)},{default:t(()=>[_(N(a(o)(a(la)[u.rowData?.triggerType])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.triggerInterval")},{default:t(()=>[_(N(u.rowData?.triggerInterval),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.blockStrategy")},{default:t(()=>[e(c,{type:a(ye)(u.rowData?.blockStrategy)},{default:t(()=>[_(N(a(o)(a(ta)[u.rowData?.blockStrategy])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.executorTimeout")},{default:t(()=>[_(N(u.rowData?.executorTimeout),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.maxRetryTimes")},{default:t(()=>[_(N(u.rowData?.maxRetryTimes),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.retryInterval")},{default:t(()=>[_(N(u.rowData?.retryInterval),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.parallelNum")},{default:t(()=>[_(N(u.rowData?.parallelNum),1)]),_:1},8,["label"]),e(g,{label:a(o)("page.jobTask.description"),span:2},{default:t(()=>[_(N(u.rowData?.description),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),gl={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Y(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Ua(C)}const Bl=X({name:"job_task",__name:"index",setup(C){const{hasAuth:M}=Ea(),u=Sa(),{routerPushByKey:f}=Na(),g=L(),{bool:c,setTrue:x}=Be(!1),b=L(),{bool:h,setTrue:w}=Be(!1),{columnChecks:K,columns:$,data:j,getData:v,loading:ee,mobilePagination:E,searchParams:B,resetSearchParams:r}=Pa({apiFn:$a,apiParams:{page:1,size:10,groupName:null,jobName:null,jobStatus:null,ownerId:null,executorInfo:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:o("common.index"),align:"center",width:48},{key:"jobName",title:o("page.jobTask.jobName"),align:"center",width:140,fixed:"left",render:d=>{async function n(){g.value=d,x()}return e(W,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[`${d.jobName}`]})}},{key:"groupName",title:o("page.jobTask.groupName"),align:"left",width:150},{key:"executorInfo",title:o("page.jobTask.executorInfo"),align:"left",width:120},{key:"ownerName",title:o("page.jobTask.ownerName"),align:"left",width:120},{key:"labels",title:o("page.pods.labels"),align:"center",width:120,render:d=>e(Ba,{labels:d.labels},null)},{key:"nextTriggerAt",title:o("page.jobTask.nextTriggerAt"),align:"center",width:120},{key:"jobStatus",title:o("page.jobTask.jobStatus"),align:"center",width:60,render:d=>{const n=async(l,T)=>{const{error:m}=await Ca({id:d.id,status:l});m||(d.jobStatus=l,window.$message?.success(o("common.updateSuccess"))),T(!m)};return e(La,{value:d.jobStatus,"onUpdate:value":l=>d.jobStatus=l,onSubmitted:n},null)}},{key:"taskType",title:o("page.jobTask.taskType"),align:"center",width:120,render:d=>{if(d.taskType===null)return null;const n={1:"info",2:"success",3:"error",4:"primary",5:"warning"},l=o(aa[d.taskType]);return e(Te,{type:n[d.taskType]},Y(l)?l:{default:()=>[l]})}},{key:"triggerType",title:o("page.jobTask.triggerType"),align:"center",width:120,render:d=>{if(d.triggerType===null)return null;const n={2:"info",3:"success",5:"warning",99:"error"},l=o(la[d.triggerType]);return e(Te,{type:n[d.triggerType]},Y(l)?l:{default:()=>[l]})}},{key:"triggerInterval",title:o("page.jobTask.triggerInterval"),align:"center",width:130,render:d=>{const l=(y=>{try{const S=JSON.parse(y);return Array.isArray(S)&&S.every(ae=>typeof ae=="string")?S:null}catch{return null}})(d.triggerInterval);if(!l||l.length===0)return d.triggerInterval;const T=y=>e(Te,{class:"cursor-pointer",type:"default"},Y(y)?y:{default:()=>[y]});if(l.length===1)return T(l[0]);const[m,p]=l,U=l[l.length-1];return l.length===2?e("div",{class:"flex flex-wrap gap-4px"},[T(m),T(p)]):e(xa,{trigger:"hover",class:"cursor-pointer"},{trigger:()=>e("div",{class:"flex flex-center flex-wrap gap-4px"},[T(m),T("..."),T(U)]),default:()=>e("div",{class:"w-310px flex flex-wrap gap-4px"},[l.map(y=>e(Te,{class:"cursor-pointer",key:y,type:"default"},Y(y)?y:{default:()=>[y]}))])})}},{key:"blockStrategy",title:o("page.jobTask.blockStrategy"),align:"center",width:80,render:d=>{if(d.blockStrategy===null)return null;const n={1:"info",2:"success",3:"error",4:"warning"},l=o(ta[d.blockStrategy]);return e(Te,{type:n[d.blockStrategy]},Y(l)?l:{default:()=>[l]})}},{key:"executorTimeout",title:o("page.jobTask.executorTimeout"),align:"center",width:80},{key:"updateDt",title:o("page.jobTask.updateDt"),align:"center",width:120},{key:"operate",title:o("common.operate"),align:"center",width:150,fixed:"right",render:d=>{let n,l;const T=[{label:o("common.copy"),key:"copy",click:()=>ce(d.id)},{type:"divider",key:"d2"},{label:o("common.batchList"),key:"batchList",click:()=>ge(d.id)},{type:"divider",key:"d2"},{type:"render",key:"delete",render:()=>e("div",{class:"flex-center"},[e(Ee,{onPositiveClick:()=>i(d.id)},{default:()=>o("common.confirmDelete"),trigger:()=>{let p;return e(W,{quaternary:!0,size:"small"},Y(p=o("common.delete"))?p:{default:()=>[p]})}})])}],m=p=>{const U=T.filter(y=>y.key===p)[0].click;U&&U()};return e("div",{class:"flex-center gap-8px"},[e(W,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>A(d.id)},Y(n=o("common.edit"))?n:{default:()=>[n]}),e(He,{vertical:!0},null),e(W,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>Se(d)},Y(l=o("common.execute"))?l:{default:()=>[l]}),e(He,{vertical:!0},null),e(Da,{trigger:"click","show-arrow":!1,options:T,size:"small","on-select":m},{default:()=>e(W,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[_("更多")]})})])}}]}),{drawerVisible:F,operateType:je,editingData:P,handleAdd:J,handleEdit:ie,handleCopy:de,checkedRowKeys:D,onDeleted:me,onBatchDeleted:I}=Aa(j,v);async function i(d){const{error:n}=await Ke([d]);n||me()}async function R(){const{error:d}=await Ke(D.value);d||I()}function z(){P.value=null,J()}function A(d){ie(d)}function ce(d){de(d)}async function Se(d){b.value=Ia(d),console.log("triggerData:",b.value),w()}function ge(d){const n=j.value.find(l=>l.id===d);f("job_batch",{state:{jobId:d,jobName:n.jobName}})}function G(){return{jobIds:D.value,groupName:B.groupName,jobName:B.jobName,jobStatus:B.jobStatus,ownerId:B.ownerId}}function fe(){ca("/job/export",G(),o("page.jobTask.title"))}return(d,n)=>{const l=ga,T=da,m=ma,p=ia,U=Qa,y=Pe;return k(),ke("div",gl,[e(ml,{model:a(B),"onUpdate:model":n[0]||(n[0]=S=>_e(B)?B.value=S:null),onReset:a(r),onSearch:a(v)},null,8,["model","onReset","onSearch"]),e(l),e(y,{title:a(o)("page.jobTask.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":t(()=>[e(p,{columns:a(K),"onUpdate:columns":n[1]||(n[1]=S=>_e(K)?K.value=S:null),loading:a(ee),"disabled-delete":a(D).length===0,"show-delete":a(M)("R_ADMIN"),onAdd:z,onDelete:R,onRefresh:a(v)},{addAfter:t(()=>[e(T,{action:"/job/import",accept:"application/json",onRefresh:a(v)},null,8,["onRefresh"]),e(a(Ee),{onPositiveClick:fe},{trigger:t(()=>[e(a(W),{size:"small",ghost:"",type:"primary",disabled:a(D).length===0&&a(M)("R_USER")},{icon:t(()=>[e(m,{class:"text-icon"})]),default:t(()=>[_(" "+N(a(o)("common.export")),1)]),_:1},8,["disabled"])]),default:t(()=>[_(N(a(D).length===0?a(o)("common.exportAll"):a(o)("common.exportPar",{num:a(D).length})),1)]),_:1})]),_:1},8,["columns","loading","disabled-delete","show-delete","onRefresh"])]),default:t(()=>[e(U,{"checked-row-keys":a(D),"onUpdate:checkedRowKeys":n[2]||(n[2]=S=>_e(D)?D.value=S:null),columns:a($),data:a(j),"flex-height":!a(u).isMobile,"scroll-x":2e3,loading:a(ee),remote:"","row-key":S=>S.id,pagination:a(E),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(ul,{visible:a(F),"onUpdate:visible":n[3]||(n[3]=S=>_e(F)?F.value=S:null),"operate-type":a(je),"row-data":a(P),onSubmitted:a(v)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(cl,{visible:a(c),"onUpdate:visible":n[4]||(n[4]=S=>_e(c)?c.value=S:null),"row-data":g.value},null,8,["visible","row-data"]),e(dl,{visible:a(h),"onUpdate:visible":n[5]||(n[5]=S=>_e(h)?h.value=S:null),"row-data":b.value},null,8,["visible","row-data"])])}}});export{Bl as default};
