import{a as j,b as G,N as P}from"./search-form-CSouas8Y.js";import{d as $,Z as M,a0 as V,c as z,o as U,ac as q,h as o,ad as E,au as K,$ as t,r as W,p as H,w as h,f as a,b_ as J,J as Y,b4 as Z,b as Q,af as C,E as X,B as x,av as ee,Y as T,aw as ae,a9 as te,ag as I,a2 as oe,ah as le}from"./index-DsXulf34.js";import{f as ne,a as se,b as re,c as ce,d as ue}from"./workflow-BRHQyGIj.js";import{_ as ie,u as me,a as pe}from"./table-C5lzqi4D.js";import{_ as de}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{_ as fe}from"./datetime-range.vue_vue_type_script_setup_true_lang-BX2GIQW5.js";import{_ as he}from"./AutoComplete-BGx6szdi.js";import{b as we}from"./Grid-DdJm4X1d.js";import"./CollapseItem-4hJT8hQy.js";import"./group-DephWMPB.js";import"./DatePicker-B2fzTH2d.js";const ke=$({name:"TaskBatchStatus",__name:"task-batch-status",props:M({disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const w=u,p=V(u,"modelValue");return(_,d)=>{const s=q;return U(),z(s,{value:p.value,"onUpdate:value":d[0]||(d[0]=i=>p.value=i),placeholder:o(t)("common.taskBatchStatus.form"),options:o(E)(o(K)),disabled:w.disabled,clearable:w.clearable},null,8,["value","placeholder","options","disabled","clearable"])}}}),ge=$({name:"WorkflowBatchSearch",__name:"workflow-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:M(["reset","search"],["update:model"]),setup(u,{emit:w}){const p=W(!1),_=w,d=W([]),s=V(u,"model"),i=W(s.value.workflowName);function v(){i.value="",_("reset")}function y(){_("search")}async function k(){const r=await ne({keywords:i.value,groupName:s.value.groupName});d.value=r.data}function S(r){s.value.workflowId=r}H(()=>i.value,r=>{r.length!==0?k():p.value=!1});function N(r){return r.map(n=>({value:n.id,label:n.workflowName}))}function b(r){return[r.label,`(${r.value})`]}return(r,n)=>{const g=ie,R=he,D=j;return U(),z(D,{"btn-span":"12 s:24 m:10 l:12 xl:16",model:s.value,onSearch:y,onReset:v},{default:h(()=>[a(g,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.groupName"),path:"groupName",class:"pr-24px"},{default:h(()=>[a(de,{value:s.value.groupName,"onUpdate:value":n[0]||(n[0]=m=>s.value.groupName=m),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(g,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.workflowName"),"label-width":100,path:"workflowName",class:"pr-24px"},{default:h(()=>[a(R,{value:i.value,"onUpdate:value":n[1]||(n[1]=m=>i.value=m),placeholder:o(t)("page.workflowBatch.form.workflowName"),options:N(d.value),"empty-visible":p.value,clearable:"",filterable:"","render-label":b,onSelect:S},null,8,["value","placeholder","options","empty-visible"])]),_:1},8,["label"]),a(g,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:h(()=>[a(ke,{value:s.value.taskBatchStatus,"onUpdate:value":n[2]||(n[2]=m=>s.value.taskBatchStatus=m),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(g,{span:"24 s:24 m:14 l:12 xl:8",label:o(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:h(()=>[a(fe,{value:s.value.datetimeRange,"onUpdate:value":n[3]||(n[3]=m=>s.value.datetimeRange=m)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),_e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!le(u)}const $e=$({name:"workflow_batch",__name:"index",setup(u){const w=J(),p=Y(),_=history.state.workflowId,d=history.state.workflowName,s=history.state.taskBatchStatus,{columns:i,columnChecks:v,data:y,getData:k,loading:S,mobilePagination:N,searchParams:b,resetSearchParams:r}=me({apiFn:re,apiParams:{page:1,size:10,workflowId:null,workflowName:null,groupName:null,taskBatchStatus:null,datetimeRange:Z()},searchParams:{workflowId:_,workflowName:d,taskBatchStatus:s},columns:()=>[{type:"selection"},{key:"id",title:t("common.index"),align:"center",width:120,render:e=>a(x,{text:!0,tag:"a",type:"primary",onClick:()=>O(e.id),class:"ws-normal"},{default:()=>[e.id]})},{key:"workflowName",title:t("page.workflowBatch.workflowName"),align:"center",minWidth:120},{key:"groupName",title:t("page.workflowBatch.groupName"),align:"center",minWidth:120},{key:"executionAt",title:t("page.workflowBatch.executionAt"),align:"center",minWidth:120},{key:"taskBatchStatus",title:t("page.workflowBatch.taskBatchStatus"),align:"center",minWidth:120,render:e=>{if(!e.taskBatchStatus)return null;const l={1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"},c=t(ee[e.taskBatchStatus]);return a(T,{type:l[e.taskBatchStatus]},B(c)?c:{default:()=>[c]})}},{key:"operationReason",title:t("page.workflowBatch.operationReason"),align:"center",minWidth:120,render:e=>{if(e.operationReason===null)return null;const l=t(ae[e.operationReason]);return a(T,{type:te(e.operationReason)},B(l)?l:{default:()=>[l]})}},{key:"createDt",title:t("page.workflowBatch.createDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",minWidth:130,render:e=>{let l;return a("div",{class:"flex-center gap-8px"},[a(x,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>O(e.id)},B(l=t("common.log"))?l:{default:()=>[l]}),a(I,{vertical:!0},null),e?.taskBatchStatus===1||e?.taskBatchStatus===2?a(oe,null,[a(P,{onPositiveClick:()=>F(e.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let c;return a(x,{type:"error",text:!0,ghost:!0,size:"small"},B(c=t("common.stop"))?c:{default:()=>[c]})}}),a(I,{vertical:!0},null)]):null,a(P,{onPositiveClick:()=>D(e.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let c;return a(x,{type:"error",text:!0,ghost:!0,size:"small"},B(c=t("common.delete"))?c:{default:()=>[c]})}})])}}]}),{checkedRowKeys:n,onDeleted:g,onBatchDeleted:R}=pe(y,k);async function D(e){const{error:l}=await ce(e);l||g()}async function m(){const{error:e}=await se(n.value);e||R()}async function F(e){const{error:l}=await ue(e);l||(window.$message?.success(t("common.executeSuccess")),k())}function O(e){w.push({path:"/workflow/form/batch",query:{id:e}})}return(e,l)=>{const c=G,A=we,L=X;return U(),Q("div",_e,[a(ge,{model:o(b),"onUpdate:model":l[0]||(l[0]=f=>C(b)?b.value=f:null),onReset:o(r),onSearch:o(k)},null,8,["model","onReset","onSearch"]),a(L,{title:o(t)("page.workflowBatch.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":h(()=>[a(c,{columns:o(v),"onUpdate:columns":l[1]||(l[1]=f=>C(v)?v.value=f:null),"disabled-delete":o(n).length===0,loading:o(S),"show-add":!1,onDelete:m,onRefresh:o(k)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:h(()=>[a(A,{"checked-row-keys":o(n),"onUpdate:checkedRowKeys":l[2]||(l[2]=f=>C(n)?n.value=f:null),columns:o(i),data:o(y),"flex-height":!o(p).isMobile,"scroll-x":962,loading:o(S),remote:"","row-key":f=>f.id,pagination:o(N),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{$e as default};
