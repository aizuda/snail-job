import{d as M,r as E,a as y,p as q,am as D,b as m,o as u,c as f,P as w,a2 as B,f as p,h as l,Y as g,w as r,g as c,t as d,e as Y,a3 as G,N as V,C as $,F as x,q as N,B as H,$ as Q,c_ as R,j as W}from"./index-DsXulf34.js";import{d as X}from"./dashboard-D6r2Q2oa.js";import{_ as L}from"./DynamicTags-CEJ2tmOq.js";const Z={class:"flex items-center justify-center"},ee={class:"flex flex-wrap justify-center gap-2"},te=M({__name:"label-list",props:{id:{default:void 0},labels:{default:"{}"},editable:{type:Boolean,default:!1}},emits:["submitted"],setup(S,{emit:z}){const b=S,T=z,o=E(null),_=E(),U=y(()=>{try{return JSON.parse(b.labels||"{}")}catch{return{}}}),k=y(()=>Object.entries(U.value).filter(([e])=>e!=="state")),s=y(()=>k.value[0]),i=y(()=>k.value.slice(1)),I=y(()=>i.value.map(([e,t])=>`${e}:${t}`)),j=(e,t)=>e==="env"?t==="prod"?"error":"info":e==="name"?"success":"info",C=async e=>{if(!b.id)return;const{error:t}=await X({id:String(b.id),labels:JSON.stringify(e)});if(t){window.$message?.error(t.message);return}o.value=null,T("submitted")},O=e=>{const[t,a]=e.split(":").map(n=>n.trim());return t&&a?[t,a]:null},h=e=>{if(!Array.isArray(e)||e.length!==2||R(e[0])||R(e[1]))return window.$message?.error('请输入有效的标签，格式如 "key:value"'),e;const[t,a]=e,n={...U.value,[t]:a};return C(n),o.value=null,e},P=()=>{const e={};i.value.forEach(([t,a])=>{e[t]=a}),C(e)},K=e=>{const t={};if(s.value){const[a,n]=s.value;t[a]=n}e.forEach(a=>{const n=O(a);if(n){const[F,J]=n;t[F]=J}}),C(t)},A=()=>{o.value?.length===2&&h(o.value)},v=e=>{e?.(),A()};return q(_,e=>{e&&D(()=>e.focus())}),(e,t)=>(u(),m("div",Z,[k.value.length?(u(),m(B,{key:0},[e.editable?(u(),m(B,{key:1},[p(l(L),{class:"mr-2 flex justify-center",value:[`${s.value[0]}:${s.value[1]}`],type:j(s.value[0],s.value[1]),onCreate:h,"onUpdate:value":P},{trigger:r(({activate:a})=>[s.value&&!i.value.length?(u(),f(l(H),{key:0,size:"small",dashed:"",onClick:a},{default:r(()=>t[3]||(t[3]=[c("+")])),_:2,__:[3]},1032,["onClick"])):w("",!0)]),input:r(({deactivate:a})=>[p(l($),{ref_key:"inputRef",ref:_,value:o.value,"onUpdate:value":t[0]||(t[0]=n=>o.value=n),size:"small",pair:"",separator:":",placeholder:["key","value"],onBlur:()=>v(a),onKeydown:x(N(n=>v(a),["prevent"]),["enter"])},null,8,["value","onBlur","onKeydown"])]),_:1},8,["value","type"]),i.value.length?(u(),f(l(V),{key:0,trigger:"click"},{trigger:r(()=>[p(l(g),null,{default:r(()=>[c("+"+d(i.value.length),1)]),_:1})]),default:r(()=>[p(l(L),{class:"flex justify-center",value:I.value,type:"info",onCreate:h,"onUpdate:value":K},{input:r(({deactivate:a})=>[p(l($),{ref_key:"inputRef",ref:_,value:o.value,"onUpdate:value":t[1]||(t[1]=n=>o.value=n),size:"small",pair:"",separator:":",placeholder:["key","value"],onBlur:()=>v(a),onKeydown:x(N(n=>v(a),["prevent"]),["enter"])},null,8,["value","onBlur","onKeydown"])]),_:1},8,["value"])]),_:1})):w("",!0)],64)):(u(),m(B,{key:0},[p(l(g),{class:"mr-2",type:j(s.value[0],s.value[1])},{default:r(()=>[c(d(s.value[0])+":"+d(s.value[1]),1)]),_:1},8,["type"]),i.value.length?(u(),f(l(V),{key:0,trigger:"click"},{trigger:r(()=>[p(l(g),null,{default:r(()=>[c("+"+d(i.value.length),1)]),_:1})]),default:r(()=>[Y("div",ee,[(u(!0),m(B,null,G(i.value,([a,n])=>(u(),f(l(g),{key:a,type:"info"},{default:r(()=>[c(d(a)+":"+d(n),1)]),_:2},1024))),128))])]),_:1})):w("",!0)],64))],64)):e.editable?(u(),f(l(L),{key:1,type:"info",class:"flex justify-center",onCreate:h,"onUpdate:value":K},{input:r(({deactivate:a})=>[p(l($),{ref_key:"inputRef",ref:_,value:o.value,"onUpdate:value":t[2]||(t[2]=n=>o.value=n),size:"small",pair:"",separator:":",placeholder:["key","value"],onBlur:()=>v(a),onKeydown:x(N(n=>v(a),["prevent"]),["enter"])},null,8,["value","onBlur","onKeydown"])]),_:1})):k.value.length?w("",!0):(u(),f(l(g),{key:2,type:"info"},{default:r(()=>[c(d(l(Q)("common.none")),1)]),_:1}))]))}}),re=W(te,[["__scopeId","data-v-a5b3a957"]]);export{re as L};
