import{_ as Y,a as ee,b as te,N as ne}from"./search-form-2lTL1-HK.js";import{_ as ae}from"./delete-alert-B5eu0EWD.js";import{aP as z,d as H,a0 as K,a2 as Q,y as W,a1 as Z,z as oe,A as se,a as le,$ as a,n as ie,q as re,c as P,o as D,w as s,f as t,H as ue,C as ce,h as n,a6 as de,D as X,a7 as pe,g as C,B as $,t as j,E as me,a9 as _e,aQ as fe,K as ge,r as he,J as ye,b as we,ag as F,F as ve,_ as J,N as be,a3 as ke,ah as L,ai as Ie}from"./index-C0p55rrf.js";import{_ as xe,u as Ne,a as qe}from"./table-B8N7pgiA.js";import{_ as Se}from"./round-content-copy-rW4wwl4M.js";import{b as Ce}from"./Grid-DvIYbIW9.js";import"./CollapseItem-BWVJFROc.js";function $e(i){return z({url:"/namespace/list",method:"get",params:i})}function De(i){return z({url:"/namespace",method:"post",data:i})}function Re(i){return z({url:"/namespace",method:"put",data:i})}function Te(i){return z({url:`/namespace/${i}`,method:"delete"})}const Ae=H({name:"NamespaceOperateDrawer",__name:"namespace-operate-drawer",props:K({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(i,{emit:I}){const r=i,h=I,{copy:x,isSupported:N}=Q(),R=W(),_=Z(i,"visible"),{formRef:q,validate:w,restoreValidation:v}=oe(),{defaultRequiredRule:y}=se(),T=le(()=>({add:a("page.namespace.addNamespace"),edit:a("page.namespace.editNamespace")})[r.operateType]),u=ie(b());function b(){return{name:"",uniqueId:""}}const V={name:y,uniqueId:{required:!1,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:a("page.namespace.form.uniqueIdRule")}};function S(){u.uniqueId=fe(32)}function E(){if(r.operateType==="add"){Object.assign(u,b());return}r.operateType==="edit"&&r.rowData&&Object.assign(u,r.rowData)}function A(){_.value=!1}async function U(){var c,l;if(await w(),r.operateType==="add"){const{name:p,uniqueId:f}=u,{error:e}=await De({name:p,uniqueId:f});if(e)return;(c=window.$message)==null||c.success(a("common.addSuccess"))}if(r.operateType==="edit"){const{id:p,name:f,uniqueId:e}=u,{error:o}=await Re({id:p,name:f,uniqueId:e});if(o)return;(l=window.$message)==null||l.success(a("common.updateSuccess"))}await R.getUserInfo(),A(),h("submitted")}re(_,()=>{_.value&&(E(),v())});async function M(c){var l,p;if(!N){(l=window.$message)==null||l.error("您的浏览器不支持 Clipboard API");return}if(c){if(navigator.clipboard&&window.isSecureContext)await x(c);else{const f=document.createRange();f.selectNode(document.getElementById("uniqueIdInput"));const e=window.getSelection();e!=null&&e.rangeCount&&e.removeAllRanges(),e==null||e.addRange(f),document.execCommand("copy")}(p=window.$message)==null||p.success("复制成功")}}return(c,l)=>{const p=X,f=Se,e=$,o=pe,g=Y,d=de,B=ce,O=ue,m=me;return D(),P(_e,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=k=>_.value=k),title:T.value,onSubmitted:U},{footer:s(()=>[t(m,{size:16},{default:s(()=>[t(e,{onClick:A},{default:s(()=>[C(j(n(a)("common.cancel")),1)]),_:1}),t(e,{type:"primary",onClick:U},{default:s(()=>[C(j(n(a)("common.save")),1)]),_:1})]),_:1})]),default:s(()=>[t(O,{ref_key:"formRef",ref:q,model:u,rules:V},{default:s(()=>[t(B,{label:n(a)("page.namespace.uniqueId"),path:"uniqueId"},{default:s(()=>[t(d,null,{default:s(()=>[t(p,{id:"uniqueIdInput",value:u.uniqueId,"onUpdate:value":l[0]||(l[0]=k=>u.uniqueId=k),disabled:r.operateType==="edit",placeholder:n(a)("page.namespace.form.uniqueId")},null,8,["value","disabled","placeholder"]),r.operateType==="edit"?(D(),P(o,{key:0,trigger:"hover"},{trigger:s(()=>[t(e,{type:"default",ghost:"",onClick:l[1]||(l[1]=k=>M(u.uniqueId))},{default:s(()=>[t(f,{class:"text-icon"})]),_:1})]),default:s(()=>[l[4]||(l[4]=C(" 复制 "))]),_:1})):(D(),P(o,{key:1,trigger:"hover"},{trigger:s(()=>[t(e,{type:"default",ghost:"",onClick:S},{default:s(()=>[t(g,{class:"text-icon"})]),_:1})]),default:s(()=>[C(" "+j(n(a)("common.generateRandomly")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),t(B,{label:n(a)("page.namespace.name"),path:"name"},{default:s(()=>[t(p,{value:u.name,"onUpdate:value":l[2]||(l[2]=k=>u.name=k),placeholder:n(a)("page.namespace.form.name")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Ue=H({name:"NamespaceSearch",__name:"namespace-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(i,{emit:I}){const r=I,h=Z(i,"model");function x(){r("reset")}function N(){r("search")}return(R,_)=>{const q=X,w=xe,v=ee;return D(),P(v,{model:h.value,onSearch:N,onReset:x},{default:s(()=>[t(w,{span:"24 s:12 m:6",label:n(a)("page.namespace.keyword"),path:"keyword",class:"pr-24px"},{default:s(()=>[t(q,{value:h.value.keyword,"onUpdate:value":_[0]||(_[0]=y=>h.value.keyword=y),placeholder:n(a)("page.namespace.form.keyword"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function G(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Ie(i)}const je=H({name:"namespace",__name:"index",setup(i){const I=ge(),r=W(),h=he(ye.get("namespaceId")),{copy:x,isSupported:N}=Q(),R=e=>{h.value=e,r.setNamespaceId(e)};async function _(e){var o,g;if(!N){(o=window.$message)==null||o.error("您的浏览器不支持 Clipboard API");return}if(e){if(navigator.clipboard&&window.isSecureContext)await x(e);else{const d=document.createElement("input");d.value=e,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d)}(g=window.$message)==null||g.success("复制成功")}}const{columns:q,columnChecks:w,data:v,getData:y,loading:T,mobilePagination:u,searchParams:b,resetSearchParams:V}=Ne({apiFn:$e,apiParams:{page:1,size:10,keyword:null},columns:()=>[{key:"id",title:a("common.index"),align:"center",width:64},{key:"name",title:a("page.namespace.name"),align:"left",width:120},{key:"status",title:a("common.active"),align:"center",width:40,render:e=>t("div",{class:"flex justify-center"},[h.value===e.uniqueId?t(J,{icon:"material-symbols:check-circle",class:"text-20px color-success"},null):t(J,{icon:"material-symbols:cancel",class:"text-20px color-gray400"},null)])},{key:"uniqueId",title:a("page.namespace.uniqueId"),align:"left",width:180,render:e=>t(be,null,{trigger:()=>t($,{text:!0,type:"primary",onClick:()=>_(e.uniqueId)},{default:()=>[e.uniqueId]}),default:()=>t("span",null,[C("点击复制")])})},{key:"createDt",title:a("page.common.createTime"),align:"left",width:130},{key:"updateDt",title:a("page.common.upadteTime"),align:"left",width:130},{key:"operate",title:a("common.operate"),align:"center",width:80,render:e=>{let o,g;return t("div",{class:"flex-center gap-8px"},[t($,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>p(e.id)},G(o=a("common.edit"))?o:{default:()=>[o]}),h.value!==e.uniqueId?t(ke,null,[t(L,{vertical:!0},null),t($,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>R(e.uniqueId)},G(g=a("common.switch"))?g:{default:()=>[g]}),t(L,{vertical:!0},null),t(ne,{onPositiveClick:()=>f(e.uniqueId)},{default:()=>a("common.confirmDelete"),trigger:()=>{let d;return t($,{type:"error",text:!0,ghost:!0,size:"small"},G(d=a("common.delete"))?d:{default:()=>[d]})}})]):""])}}]}),{drawerVisible:S,operateType:E,editingData:A,handleAdd:U,handleEdit:M,checkedRowKeys:c,onDeleted:l}=qe(v,y);function p(e){M(e)}async function f(e){const{error:o}=await Te(e);o||l()}return(e,o)=>{const g=ae,d=te,B=Ce,O=ve;return D(),we("div",Be,[t(Ue,{model:n(b),"onUpdate:model":o[0]||(o[0]=m=>F(b)?b.value=m:null),onReset:n(V),onSearch:n(y)},null,8,["model","onReset","onSearch"]),t(g),t(O,{title:n(a)("page.namespace.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":s(()=>[t(d,{columns:n(w),"onUpdate:columns":o[1]||(o[1]=m=>F(w)?w.value=m:null),"disabled-delete":n(c).length===0,loading:n(T),"show-delete":!1,onAdd:n(U),onRefresh:n(y)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:s(()=>[t(B,{"checked-row-keys":n(c),"onUpdate:checkedRowKeys":o[2]||(o[2]=m=>F(c)?c.value=m:null),columns:n(q),data:n(v),"flex-height":!n(I).isMobile,"scroll-x":962,loading:n(T),remote:"","row-key":m=>m.id,pagination:n(u),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(Ae,{visible:n(S),"onUpdate:visible":o[3]||(o[3]=m=>F(S)?S.value=m:null),"operate-type":n(E),"row-data":n(A),onSubmitted:n(y)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{je as default};
