import{a as C,b as z,N as F}from"./search-form-CSouas8Y.js";import{d as B,Z as $,a0 as R,c as E,o as D,w as d,f as e,h as r,$ as s,y as J,m as A,p as L,G as W,A as G,C as K,ac as q,ad as H,b2 as Y,D as Z,B as U,g as x,t as V,a8 as Q,J as X,b as ee,af as I,E as te,a6 as ae,b3 as ne,Y as m,a2 as P,N as le,ax as oe,ag as se,ah as re}from"./index-DsXulf34.js";import{d as ie,e as ue,g as pe}from"./dashboard-D6r2Q2oa.js";import{_ as de,u as ce,a as me}from"./table-C5lzqi4D.js";import{L as fe}from"./label-list-CM9sEsZ3.js";import{_ as ge}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{_ as _e}from"./labels-input.vue_vue_type_script_setup_true_lang-D8rx2BaW.js";import{b as be}from"./Grid-DdJm4X1d.js";import"./CollapseItem-4hJT8hQy.js";import"./DynamicTags-CEJ2tmOq.js";import"./group-DephWMPB.js";import"./DynamicInput-C24Xro_e.js";const ye=B({name:"PodsSearch",__name:"pods-search",props:{model:{required:!0},modelModifiers:{}},emits:$(["reset","search"],["update:model"]),setup(_,{emit:w}){const v=w,b=R(_,"model");function g(){v("reset")}function y(){v("search")}return(S,k)=>{const n=de,T=C;return D(),E(T,{model:b.value,onSearch:y,onReset:g},{default:d(()=>[e(n,{span:"24 s:12 m:6",label:r(s)("page.pods.groupName"),path:"groupName",class:"pr-24px"},{default:d(()=>[e(ge,{value:b.value.groupName,"onUpdate:value":k[0]||(k[0]=O=>b.value.groupName=O),placeholder:r(s)("page.pods.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),he=B({name:"PodsOperateDrawer",__name:"pods-operate-drawer",props:$({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:$(["submitted"],["update:visible"]),setup(_,{emit:w}){const v=_,b=w,g=R(_,"visible"),{formRef:y,validate:S,restoreValidation:k}=J(),n=A(T());function T(){return{id:"",labels:"{}",labelMap:[],nodeType:1,groupName:"",hostIp:"",hostPort:""}}function O(){n.labelMap=[],Object.assign(n,v.rowData),n.labels&&(n.labelMap=Object.entries(JSON.parse(n.labels)).filter(([f,i])=>f!=="state").map(([f,i])=>({key:f,value:i})))}async function N(){await S();const f={};n.labelMap?.forEach(h=>{f[h.key]=h.value});const{error:i}=await ie({id:n.id,labels:JSON.stringify(f)});i||(window.$message?.success(s("common.updateSuccess")),M(),b("submitted"))}function M(){g.value=!1}return L(g,()=>{g.value&&(O(),k())}),(f,i)=>{const h=K,t=G,a=q,l=_e,p=W,u=U,o=Z;return D(),E(Q,{modelValue:g.value,"onUpdate:modelValue":i[6]||(i[6]=c=>g.value=c),"min-size":480,title:"编辑在线机器"},{footer:d(()=>[e(o,{size:16},{default:d(()=>[e(u,{onClick:M},{default:d(()=>[x(V(r(s)("common.cancel")),1)]),_:1}),e(u,{type:"primary",onClick:N},{default:d(()=>[x(V(r(s)("common.save")),1)]),_:1})]),_:1})]),default:d(()=>[e(p,{ref_key:"formRef",ref:y,model:n},{default:d(()=>[e(t,{label:"ID",path:"id"},{default:d(()=>[e(h,{value:n.id,"onUpdate:value":i[0]||(i[0]=c=>n.id=c),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"类型",path:"nodeType"},{default:d(()=>[e(a,{value:n.nodeType,"onUpdate:value":i[1]||(i[1]=c=>n.nodeType=c),options:r(H)(r(Y)),disabled:""},null,8,["value","options"])]),_:1}),e(t,{label:"组名称",path:"groupName"},{default:d(()=>[e(h,{value:n.groupName,"onUpdate:value":i[2]||(i[2]=c=>n.groupName=c),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"IP",path:"hostIp"},{default:d(()=>[e(h,{value:n.hostIp,"onUpdate:value":i[3]||(i[3]=c=>n.hostIp=c),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"端口",path:"hostPort"},{default:d(()=>[e(h,{value:n.hostPort,"onUpdate:value":i[4]||(i[4]=c=>n.hostPort=c),disabled:""},null,8,["value"])]),_:1}),e(t,{label:"标签",path:"labelMap","show-feedback":!n.labelMap?.length},{default:d(()=>[e(l,{value:n.labelMap,"onUpdate:value":i[5]||(i[5]=c=>n.labelMap=c),path:"labelMap"},null,8,["value"])]),_:1},8,["show-feedback"])]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function j(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!re(_)}const Ue=B({name:"pods",__name:"index",setup(_){const w=X(),{columns:v,columnChecks:b,data:g,getData:y,loading:S,mobilePagination:k,searchParams:n,resetSearchParams:T}=ce({apiFn:ue,apiParams:{page:1,size:10,groupName:null},columns:()=>[{key:"hostId",title:s("page.pods.hostId"),align:"center",width:80,render:t=>{function a(p,u=4,o=4){if(!p)return"";const c=u+o+3;return p.length<=c?p:`${p.slice(0,u)}...${p.slice(-o)}`}const l=a(t.hostId,4,4);return e(ae,null,{trigger:()=>e("span",{style:"max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: inline-block; vertical-align: middle;"},[l]),default:()=>t.hostId})}},{key:"nodeType",title:s("page.pods.nodeType"),align:"center",width:80,render:t=>{if(t.nodeType===null)return null;const a={1:"info",2:"primary"},l=s(ne[t.nodeType]);return e(m,{type:a[t.nodeType]},j(l)?l:{default:()=>[l]})}},{key:"groupName",title:s("page.pods.groupName"),align:"center",width:120,resizable:!0,minWidth:120,maxWidth:200},{key:"labels",title:s("page.pods.labels"),align:"center",width:140,render:t=>e(fe,{id:t.id,labels:t.labels},null)},{key:"hostIp",title:s("page.pods.hostIp"),align:"center",width:120,render:t=>`${t.hostIp}:${t.hostPort}`},{key:"nodeStatus",title:"状态",align:"center",width:60,render:t=>{if(!t.labels||t.nodeType===2)return e(m,{type:"success"},{default:()=>[x("up")]});const l=JSON.parse(t.labels||"{}").state||"",u={up:"success",down:"error"}[l]||"default";return e(m,{type:u},j(l)?l:{default:()=>[l]})}},{key:"consumerBuckets",title:s("page.pods.consumerBuckets"),align:"center",width:100,render:t=>{if(t.nodeType===null)return null;const a=t.consumerBuckets||[];return t.nodeType===1?e(P,null,[x("Path: "),e(m,{type:"info"},{default:()=>[t.contextPath??"/"]})]):a.length===0?null:a.length===1?e(P,null,[e("span",null,[x("Bucket: ")]),e(m,{type:"info",class:"m-1 justify-center"},{default:()=>[a[0]]})]):a.length===2?e(P,null,[e(m,{type:"info",class:"m-1 justify-center"},{default:()=>[a[0]]}),e(m,{type:"info",class:"m-1 justify-center"},{default:()=>[a[1]]})]):e(P,null,[e(m,{type:"info",class:"m-1 justify-center"},{default:()=>[a[0]]}),e(le,{trigger:"hover",placement:"top"},{trigger:()=>e(m,{type:"info",class:"m-1 justify-center"},{default:()=>[x("...")]}),default:()=>e("div",{class:"grid grid-cols-16"},[a.map(l=>e(m,{type:"info",key:l,class:"m-1 justify-center"},j(l)?l:{default:()=>[l]}))])}),e(m,{type:"info",class:"m-1 justify-center"},{default:()=>[a[a.length-1]]})])}},{key:"executorType",title:s("page.pods.executorType"),align:"center",width:80,render:t=>{const a=JSON.parse(t.extAttrs||"{}");if((o=>Object.keys(o).length===0&&o.constructor===Object)(a)||a===null)return null;const p=a?.executorType,u=p?s(oe[p]):s("common.none");return e(m,{type:"info"},j(u)?u:{default:()=>[u]})}},{key:"systemVersion",title:s("page.pods.systemVersion"),align:"center",width:80,render:t=>{const a=JSON.parse(t.extAttrs||"{}");return(p=>Object.keys(p).length===0&&p.constructor===Object)(a)||a===null?null:e(m,{type:"info"},{default:()=>[a?.systemVersion||s("common.none")]})}},{key:"updateDt",title:s("page.pods.updateDt"),align:"center",width:100},{key:"operate",title:s("common.operate"),align:"center",width:80,render:t=>{const a=()=>{let u;return t.nodeType===2?null:e(U,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>h(t.id)},j(u=s("common.edit"))?u:{default:()=>[u]})},l=()=>{if(!t.labels||t.nodeType===2)return null;const u=JSON.parse(t.labels||"{}");let o;return u.state==="up"?o=2:o=1,e(F,{onPositiveClick:()=>O(t.id,o)},{default:()=>o===1?s("page.pods.online"):s("page.pods.offline"),trigger:()=>e(U,{type:"error",text:!0,ghost:!0,size:"small"},{default:()=>[o===1?s("page.pods.online"):s("page.pods.offline")]})})},p=[a(),l()];return e("div",{class:"flex-center gap-8px"},[p.filter(Boolean).map((u,o)=>e(P,null,[o!==0&&e(se,{vertical:!0},null),u]))])}}]});async function O(t,a){const{error:l}=await pe({id:t,serverNodeStatus:a});l||y()}const{checkedRowKeys:N,handleEdit:M,drawerVisible:f,editingData:i}=me(g,y);function h(t){M(t)}return(t,a)=>{const l=z,p=be,u=te;return D(),ee("div",ve,[e(ye,{model:r(n),"onUpdate:model":a[0]||(a[0]=o=>I(n)?n.value=o:null),onReset:r(T),onSearch:r(y)},null,8,["model","onReset","onSearch"]),e(u,{title:r(s)("page.pods.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"card-wrapper sm:flex-1-hidden"},{"header-extra":d(()=>[e(l,{columns:r(b),"onUpdate:columns":a[1]||(a[1]=o=>I(b)?b.value=o:null),"disabled-delete":r(N).length===0,loading:r(S),"show-add":!1,"show-delete":!1,onRefresh:r(y)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:d(()=>[e(p,{"checked-row-keys":r(N),"onUpdate:checkedRowKeys":a[2]||(a[2]=o=>I(N)?N.value=o:null),columns:r(v),data:r(g),"flex-height":!r(w).isMobile,"scroll-x":962,loading:r(S),remote:"","row-key":o=>o.hostId,pagination:r(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(he,{visible:r(f),"onUpdate:visible":a[3]||(a[3]=o=>I(f)?f.value=o:null),"row-data":r(i),onSubmitted:r(y)},null,8,["visible","row-data","onSubmitted"])])}}});export{Ue as default};
