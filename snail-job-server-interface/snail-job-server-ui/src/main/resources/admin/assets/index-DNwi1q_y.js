import{a as ae,b as ne,N as j}from"./search-form-CSouas8Y.js";import{_ as le,a as re,d as se}from"./download-C7ANTmFB.js";import{_ as ie}from"./delete-alert-CMbkkQNx.js";import{d as z,Z as M,a0 as L,c as V,o as F,w as r,f as e,h as o,$ as a,C as ue,ac as ce,ad as pe,aE as de,m as me,p as fe,G as we,A as ge,D as _e,B as C,g as R,t as O,aI as ke,cM as he,cO as ye,j as ve,b_ as xe,J as be,u as Ne,r as Se,ae as Ce,b as De,af as A,E as Te,aL as Ie,a9 as We,Y as B,N as $e,ag as E,aN as Re,ah as Ue}from"./index-DsXulf34.js";import{n as Ae,o as q,p as Pe,q as Be}from"./workflow-BRHQyGIj.js";import{_ as Me,u as Oe,a as ze}from"./table-C5lzqi4D.js";import{u as Fe}from"./auth-CUdKODNA.js";import{_ as je}from"./status-switch.vue_vue_type_script_setup_true_lang-m8qEijEY.js";import{_ as Ee}from"./system-user.vue_vue_type_script_setup_true_lang-BeDWgk3F.js";import{_ as qe}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{_ as Le}from"./dynamic-input.vue_vue_type_script_setup_true_lang-CFAMlseU.js";import{b as Ve}from"./Grid-DdJm4X1d.js";import"./CollapseItem-4hJT8hQy.js";import"./Progress-B1GWDnDE.js";import"./group-DephWMPB.js";import"./DynamicInput-C24Xro_e.js";const Ge=z({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:M(["reset","search"],["update:model"]),setup(k,{emit:D}){const w=D,u=L(k,"model");function h(){w("reset")}function d(){w("search")}return(N,m)=>{const y=Me,S=ue,f=ce,s=Ee,T=ae;return F(),V(T,{model:u.value,onSearch:d,onReset:h},{default:r(()=>[e(y,{span:"24 s:12 m:6",label:o(a)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[e(qe,{value:u.value.groupName,"onUpdate:value":m[0]||(m[0]=g=>u.value.groupName=g),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(y,{span:"24 s:12 m:6",label:o(a)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:r(()=>[e(S,{value:u.value.workflowName,"onUpdate:value":m[1]||(m[1]=g=>u.value.workflowName=g),placeholder:o(a)("page.workflow.form.workflowName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(y,{span:"24 s:12 m:6",label:o(a)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:r(()=>[e(f,{value:u.value.workflowStatus,"onUpdate:value":m[2]||(m[2]=g=>u.value.workflowStatus=g),placeholder:o(a)("page.workflow.form.workflowStatus"),options:o(pe)(o(de)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(y,{span:"24 s:12 m:6",label:o(a)("page.workflow.ownerName"),path:"ownerId",class:"pr-24px"},{default:r(()=>[e(s,{value:u.value.ownerId,"onUpdate:value":m[3]||(m[3]=g=>u.value.ownerId=g),clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Je=z({name:"WorkflowTriggerModal",__name:"workflow-trigger-modal",props:M({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:M(["submitted"],["update:visible"]),setup(k,{emit:D}){const w=k,u=D,h=L(k,"visible"),d=me(N());function N(){return{workflowId:w.rowData?.id,tmpWfContext:"",wfContexts:[]}}function m(){const f=w.rowData;if(!f){Object.assign(d,N());return}f?.wfContext&&(d.wfContexts=he(f?.wfContext)||[])}function y(){h.value=!1}fe(h,()=>{h.value&&m()});async function S(){const f=JSON.stringify(ye(d.wfContexts)||{}),{error:s}=await Ae({workflowId:w.rowData?.id,tmpWfContext:f});s||(window.$message?.success(a("common.executeSuccess")),y(),u("submitted"))}return(f,s)=>{const T=Le,g=ge,v=we,U=C,_=_e,P=ke;return F(),V(P,{show:h.value,"onUpdate:show":s[1]||(s[1]=$=>h.value=$),class:"max-w-90% w-600px",preset:"card",title:"执行工作流",bordered:!1},{footer:r(()=>[e(_,{justify:"end",size:16},{default:r(()=>[e(U,{onClick:y},{default:r(()=>[R(O(o(a)("common.cancel")),1)]),_:1}),e(U,{type:"primary",onClick:S},{default:r(()=>s[2]||(s[2]=[R("执行")])),_:1,__:[2]})]),_:1})]),default:r(()=>[e(v,{model:d},{default:r(()=>[e(g,{path:"wfContexts",label:"工作流上下文","show-feedback":!d.wfContexts?.length},{default:r(()=>[e(T,{value:d.wfContexts,"onUpdate:value":s[0]||(s[0]=$=>d.wfContexts=$),path:"wfContexts"},null,8,["value"])]),_:1},8,["show-feedback"])]),_:1},8,["model"])]),_:1},8,["show"])}}}),Ke=ve(Je,[["__scopeId","data-v-d61daa99"]]),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function W(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!Ue(k)}const dt=z({name:"workflow_task",__name:"index",setup(k){const{hasAuth:D}=Fe(),w=xe(),u=be(),{routerPushByKey:h}=Ne(),d=Se(),{bool:N,setTrue:m}=Ce(!1),{columns:y,columnChecks:S,data:f,getData:s,loading:T,mobilePagination:g,searchParams:v,resetSearchParams:U}=Oe({apiFn:Pe,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null,ownerId:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:a("common.index"),align:"center",width:120},{key:"workflowName",title:a("page.workflow.workflowName"),align:"center",minWidth:120,render:t=>{function n(){Y(t.id)}return e(C,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[t.workflowName]})}},{key:"groupName",title:a("page.workflow.groupName"),align:"center",minWidth:120},{key:"ownerName",title:a("page.workflow.ownerName"),align:"center",width:180},{key:"nextTriggerAt",title:a("page.workflow.nextTriggerAt"),align:"center",minWidth:120},{key:"workflowStatus",title:a("page.workflow.workflowStatus"),align:"center",minWidth:120,render:t=>{const n=async(l,c)=>{const{error:x}=await Be({id:t.id,status:l});x||(t.workflowStatus=l,window.$message?.success(a("common.updateSuccess"))),c(!x)};return e(je,{value:t.workflowStatus,"onUpdate:value":l=>t.workflowStatus=l,onSubmitted:n},null)}},{key:"triggerType",title:a("page.workflow.triggerType"),align:"center",width:140,render:t=>{if(!t.triggerType)return null;const n=a(Ie[t.triggerType]);return e(B,{type:We(t.triggerType)},W(n)?n:{default:()=>[n]})}},{key:"triggerInterval",title:a("page.workflow.triggerInterval"),align:"center",minWidth:140,render:t=>{const l=(i=>{try{const p=JSON.parse(i);return Array.isArray(p)&&p.every(oe=>typeof oe=="string")?p:null}catch{return null}})(t.triggerInterval);if(!l||l.length===0)return t.triggerInterval;const c=i=>e(B,{class:"cursor-pointer",type:"default"},W(i)?i:{default:()=>[i]});if(l.length===1)return c(l[0]);const[x,b]=l,I=l[l.length-1];return l.length===2?e("div",{class:"flex flex-wrap gap-4px"},[c(x),c(b)]):e($e,{trigger:"hover",class:"cursor-pointer"},{trigger:()=>e("div",{class:"flex flex-center flex-wrap gap-4px"},[c(x),c("..."),c(I)]),default:()=>e("div",{class:"w-310px flex flex-wrap gap-4px"},[l.map(i=>e(B,{class:"cursor-pointer",key:i,type:"default"},W(i)?i:{default:()=>[i]}))])})}},{key:"executorTimeout",title:a("page.workflow.executorTimeout"),align:"center",minWidth:120},{key:"updateDt",title:a("page.workflow.updateDt"),align:"center",minWidth:120},{key:"operate",title:a("common.operate"),align:"center",fixed:"right",width:200,render:t=>{let n,l;const c=[{label:a("common.copy"),key:"copy",click:()=>Z(t.id)},{type:"divider",key:"d2"},{label:a("common.batchList"),key:"batchList",click:()=>te(t.id)},{type:"divider",key:"d2"},{type:"render",key:"delete",render:()=>e("div",{class:"flex-center"},[e(j,{onPositiveClick:()=>J(t.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let b;return e(C,{quaternary:!0,size:"small"},W(b=a("common.delete"))?b:{default:()=>[b]})}})])}],x=b=>{const I=c.filter(i=>i.key===b)[0].click;I&&I()};return e("div",{class:"flex-center gap-8px"},[e(C,{text:!0,type:"warning",ghost:!0,size:"small",onClick:()=>K(t.id)},W(n=a("common.edit"))?n:{default:()=>[n]}),e(E,{vertical:!0},null),e(C,{type:"error",text:!0,ghost:!0,size:"small",onClick:()=>Q(t)},W(l=a("common.execute"))?l:{default:()=>[l]}),e(E,{vertical:!0},null),e(Re,{trigger:"click","show-arrow":!1,options:c,size:"small","on-select":x},{default:()=>e(C,{text:!0,type:"primary",ghost:!0,size:"small"},{default:()=>[R("更多")]})})])}}]}),{checkedRowKeys:_,onBatchDeleted:P,onDeleted:$}=ze(f,s);async function G(){const{error:t}=await q(_.value);t||P()}async function J(t){const{error:n}=await q([t]);n||$()}function K(t){w.push({path:"/workflow/form/edit",query:{id:t}})}function H(){w.push({path:"/workflow/form/add"})}function Y(t){w.push({path:"/workflow/form/detail",query:{id:t}})}function Z(t){w.push({path:"/workflow/form/copy",query:{id:t}})}async function Q(t){d.value=t,m()}function X(){return{workflowIds:_.value,groupName:v.groupName,workflowName:v.workflowName,workflowStatus:v.workflowStatus,ownerId:v.ownerId}}function ee(){se("/workflow/export",X(),a("page.workflow.title"))}function te(t){const n=f.value.find(l=>l.id===t);h("workflow_batch",{state:{workflowId:t,workflowName:n.workflowName}})}return(t,n)=>{const l=ie,c=le,x=re,b=ne,I=Ve,i=Te;return F(),De("div",He,[e(Ge,{model:o(v),"onUpdate:model":n[0]||(n[0]=p=>A(v)?v.value=p:null),onReset:o(U),onSearch:o(s)},null,8,["model","onReset","onSearch"]),e(l),e(i,{title:o(a)("page.workflow.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":r(()=>[e(b,{columns:o(S),"onUpdate:columns":n[1]||(n[1]=p=>A(S)?S.value=p:null),"disabled-delete":o(_).length===0,loading:o(T),"show-delete":o(D)("R_ADMIN"),onAdd:H,onDelete:G,onRefresh:o(s)},{addAfter:r(()=>[e(c,{action:"/workflow/import",accept:"application/json",onRefresh:o(s)},null,8,["onRefresh"]),e(o(j),{onPositiveClick:ee},{trigger:r(()=>[e(o(C),{size:"small",ghost:"",type:"primary",disabled:o(_).length===0&&o(D)("R_USER")},{icon:r(()=>[e(x,{class:"text-icon"})]),default:r(()=>[R(" "+O(o(a)("common.export")),1)]),_:1},8,["disabled"])]),default:r(()=>[R(O(o(_).length===0?o(a)("common.exportAll"):o(a)("common.exportPar",{num:o(_).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-delete","onRefresh"])]),default:r(()=>[e(I,{"checked-row-keys":o(_),"onUpdate:checkedRowKeys":n[2]||(n[2]=p=>A(_)?_.value=p:null),columns:o(y),data:o(f),"flex-height":!o(u).isMobile,"scroll-x":1300,loading:o(T),remote:"","row-key":p=>p.id,pagination:o(g),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(Ke,{visible:o(N),"onUpdate:visible":n[3]||(n[3]=p=>A(N)?N.value=p:null),"row-data":d.value},null,8,["visible","row-data"])])}}});export{dt as default};
