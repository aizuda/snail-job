import{a as H,b as J,N as V}from"./search-form-CSouas8Y.js";import{aP as w,d as I,Z as C,a0 as P,c as U,o as O,w as l,f as e,h as a,$ as t,C as Y,ac as Z,ad as Q,bl as X,as as ee,at as ae,g as c,t as f,Y as x,a9 as S,bm as z,b8 as W,b7 as te,j as re,J as le,r as ne,ae as se,b4 as oe,b as ue,af as R,E as ie,B as $,a6 as pe,_ as de,bn as me,ag as B,a2 as ce,ah as fe}from"./index-DsXulf34.js";import{_ as _e,u as ge,a as ye}from"./table-C5lzqi4D.js";import{_ as be}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{_ as ke}from"./select-scene.vue_vue_type_script_setup_true_lang-C3ZddlqK.js";import{_ as he}from"./datetime-range.vue_vue_type_script_setup_true_lang-BX2GIQW5.js";import{_ as ve}from"./detail-drawer-BuPycGzQ.js";import{_ as De}from"./log-drawer-C3TDW99Z.js";import{_ as Te,a as Se}from"./DescriptionsItem-BEs7Hiy4.js";import{b as we}from"./Grid-DdJm4X1d.js";import"./CollapseItem-4hJT8hQy.js";import"./group-DephWMPB.js";import"./retry-scene-xT7KfxDz.js";import"./DatePicker-B2fzTH2d.js";function Ne(u){return w({url:"/retry-task/list",method:"get",params:u})}function Re(u){return w({url:`/retry-task/${u}`,method:"get"})}function xe(u){return w({url:`/retry-task/${u}`,method:"delete"})}function $e(u){return w({url:"/retry-task/ids",method:"delete",data:u})}function Ie(u){return w({url:`/retry-task/stop/${u}`,method:"post"})}const Oe=I({name:"RetryLogSearch",__name:"retry-task-search",props:{model:{required:!0},modelModifiers:{}},emits:C(["reset","search"],["update:model"]),setup(u,{emit:k}){const s=k,o=P(u,"model");function i(){s("reset")}function b(){s("search")}return(N,p)=>{const _=_e,y=Y,h=Z,v=H;return O(),U(v,{"btn-span":"24 s:12 m:9 l:12 xl:18",model:o.value,onSearch:b,onReset:i},{default:l(()=>[e(_,{span:"24 s:12 m:6",label:a(t)("page.retryTask.groupName"),path:"groupName",class:"pr-24px"},{default:l(()=>[e(be,{value:o.value.groupName,"onUpdate:value":p[0]||(p[0]=d=>o.value.groupName=d),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(_,{span:"24 s:12 m:6",label:a(t)("page.retryTask.sceneName"),path:"sceneName",class:"pr-24px"},{default:l(()=>[e(ke,{value:o.value.sceneName,"onUpdate:value":p[1]||(p[1]=d=>o.value.sceneName=d),"group-name":o.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),e(_,{span:"24 s:12 m:6",label:a(t)("page.retryTask.retryId"),path:"bizNo",class:"pr-24px"},{default:l(()=>[e(y,{value:o.value.retryId,"onUpdate:value":p[2]||(p[2]=d=>o.value.retryId=d),placeholder:a(t)("page.retryTask.form.retryId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(_,{span:"24 s:12 m:6",label:a(t)("page.retry.retryStatus"),path:"retryStatus",class:"pr-24px"},{default:l(()=>[e(h,{value:o.value.taskStatus,"onUpdate:value":p[3]||(p[3]=d=>o.value.taskStatus=d),placeholder:a(t)("page.retry.form.retryStatus"),options:a(Q)(a(X)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(_,{span:"24 s:24 m:14 l:12 xl:6",label:a(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:l(()=>[e(he,{value:o.value.datetimeRange,"onUpdate:value":p[4]||(p[4]=d=>o.value.datetimeRange=d)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Ve=I({name:"SceneDetailDrawer",__name:"retry-task-detail-drawer",props:C({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(u){const k=P(u,"visible");return(s,o)=>{const i=Se,b=x,N=Te,p=ae,_=De,y=ee,h=ve;return O(),U(h,{modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=v=>k.value=v),title:a(t)("page.retryTask.detail"),width:["50%","90%"]},{default:l(()=>[e(y,{type:"segment",animated:""},{default:l(()=>[e(p,{name:0,tab:a(t)("page.log.info")},{default:l(()=>[e(N,{"label-placement":"top",bordered:"",column:2},{default:l(()=>[e(i,{label:a(t)("page.retryTask.groupName"),span:2},{default:l(()=>[c(f(s.rowData?.groupName),1)]),_:1},8,["label"]),e(i,{label:a(t)("page.retryTask.sceneName"),span:2},{default:l(()=>[c(f(s.rowData?.sceneName),1)]),_:1},8,["label"]),e(i,{label:a(t)("page.retryTask.taskStatus"),span:1},{default:l(()=>[e(b,{type:a(S)(s.rowData?.taskStatus)},{default:l(()=>[c(f(a(t)(a(z)[s.rowData?.taskStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(i,{label:a(t)("page.retryTask.taskType"),span:1},{default:l(()=>[e(b,{type:a(S)(s.rowData?.taskType)},{default:l(()=>[c(f(a(t)(a(W)[s.rowData?.taskType])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(i,{label:a(t)("page.retry.retryCount"),span:1},{default:l(()=>[c(f(s.rowData?.responseVO?.retryCount),1)]),_:1},8,["label"]),e(i,{label:a(t)("page.retry.retryStatus"),span:1},{default:l(()=>[e(b,{type:a(S)(s.rowData?.responseVO?.retryStatus)},{default:l(()=>[c(f(a(t)(a(te)[s.rowData?.responseVO?.retryStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(i,{label:a(t)("page.retry.bizNo"),span:2},{default:l(()=>[c(f(s.rowData?.responseVO?.bizNo),1)]),_:1},8,["label"]),e(i,{label:a(t)("page.retry.idempotentId"),span:2},{default:l(()=>[c(f(s.rowData?.responseVO?.idempotentId),1)]),_:1},8,["label"]),e(i,{label:a(t)("page.retry.executorName"),span:2},{default:l(()=>[c(f(s.rowData?.responseVO?.executorName),1)]),_:1},8,["label"]),e(i,{label:a(t)("page.retry.argsStr"),span:2},{default:l(()=>[c(f(s.rowData?.responseVO?.argsStr),1)]),_:1},8,["label"]),e(i,{label:a(t)("page.retry.serializerName"),span:2},{default:l(()=>[c(f(s.rowData?.responseVO?.serializerName),1)]),_:1},8,["label"]),e(i,{label:a(t)("common.createDt")},{default:l(()=>[c(f(s.rowData?.createDt),1)]),_:1},8,["label"]),e(i,{label:a(t)("common.updateDt")},{default:l(()=>[c(f(s.rowData?.updateDt),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),e(p,{name:1,tab:a(t)("page.log.title"),"display-directive":"if"},{default:l(()=>[e(_,{drawer:!1,type:"retry","task-data":s.rowData},null,8,["task-data"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Be=re(Ve,[["__scopeId","data-v-6de74eb0"]]),Ce={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function T(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!fe(u)}const Je=I({name:"retry_task",__name:"index",setup(u){const k=le(),s=ne(),{bool:o,setTrue:i}=se(!1),b=history.state.retryId,{columns:N,columnChecks:p,data:_,getData:y,loading:h,mobilePagination:v,searchParams:d,resetSearchParams:j}=ge({apiFn:Ne,apiParams:{page:1,size:10,groupName:null,sceneName:null,taskStatus:null,datetimeRange:oe()},searchParams:{retryId:b},columns:()=>[{type:"selection",align:"center",width:48,disabled:r=>r.taskStatus===1},{key:"id",align:"center",width:120,fixed:"left",title:()=>e("div",{class:"flex-center"},[e("span",null,[t("page.jobBatch.jobTask.id")]),e(pe,{trigger:"hover"},{trigger:()=>e("span",{class:"mb-2px ml-5px text-16px"},[e(de,{icon:"ant-design:info-circle-outlined"},null)]),default:()=>e("span",null,[t("common.idDetailTip")])})]),render:r=>{async function n(){await E(r),i()}return e($,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[r.id]})}},{key:"groupName",title:t("page.retryTask.groupName"),align:"center",minWidth:120},{key:"sceneName",title:t("page.retryTask.sceneName"),align:"center",minWidth:120},{key:"retryId",title:t("page.retryTask.retryId"),align:"center",minWidth:120},{key:"taskType",title:t("page.retryTask.taskType"),align:"center",minWidth:80,render:r=>{if(r.taskType===null)return null;const n=t(W[r.taskType]);return e(x,{type:S(r.taskType)},T(n)?n:{default:()=>[n]})}},{key:"taskStatus",title:t("page.retryTask.taskStatus"),align:"center",minWidth:80,render:r=>{if(r.taskStatus===null)return null;const n={1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"},m=t(z[r.taskStatus]);return e(x,{type:n[r.taskStatus]},T(m)?m:{default:()=>[m]})}},{key:"operationReason",title:t("page.retryTask.operationReason"),align:"center",width:240,render:r=>{if(r.operationReason===null)return null;const n=t(me[r.operationReason]);return e(x,{type:S(r.operationReason)},T(n)?n:{default:()=>[n]})}},{key:"createDt",title:t("page.retryTask.createDt"),align:"center",minWidth:120},{key:"updateDt",title:t("page.retryTask.updateDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:80,render:r=>e("div",{class:"flex-center gap-8px"},[r.taskStatus===1||r.taskStatus===2?e(ce,null,[e(B,{vertical:!0},null),e(V,{onPositiveClick:()=>K(r.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let m;return e($,{type:"error",text:!0,ghost:!0,size:"small"},T(m=t("common.stop"))?m:{default:()=>[m]})}}),e(B,{vertical:!0},null)]):null,r.taskStatus!==1&&r.taskStatus!==2?e(V,{onPositiveClick:()=>q(r.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let m;return e($,{type:"error",text:!0,ghost:!0,size:"small"},T(m=t("common.delete"))?m:{default:()=>[m]})}}):""])}]}),{checkedRowKeys:D,onDeleted:M,onBatchDeleted:F}=ye(_,y);async function L(){const{error:r}=await $e(D.value);r||F()}async function q(r){const{error:n}=await xe(r);n||M()}async function E(r){const n=await Re(r.id);s.value=n.data||null}async function K(r){const{error:n}=await Ie(r);n||(window.$message?.success(t("common.operateSuccess")),y())}return(r,n)=>{const m=J,A=we,G=ie;return O(),ue("div",Ce,[e(Oe,{model:a(d),"onUpdate:model":n[0]||(n[0]=g=>R(d)?d.value=g:null),onReset:a(j),onSearch:a(y)},null,8,["model","onReset","onSearch"]),e(G,{title:a(t)("page.retryTask.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":l(()=>[e(m,{columns:a(p),"onUpdate:columns":n[1]||(n[1]=g=>R(p)?p.value=g:null),"disabled-delete":a(D).length===0,loading:a(h),"show-add":!1,onDelete:L,onRefresh:a(y)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:l(()=>[e(A,{"checked-row-keys":a(D),"onUpdate:checkedRowKeys":n[2]||(n[2]=g=>R(D)?D.value=g:null),columns:a(N),data:a(_),"flex-height":!a(k).isMobile,"scroll-x":962,loading:a(h),remote:"","row-key":g=>g.id,pagination:a(v),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),e(Be,{visible:a(o),"onUpdate:visible":n[3]||(n[3]=g=>R(o)?o.value=g:null),"row-data":s.value},null,8,["visible","row-data"])])}}});export{Je as default};
