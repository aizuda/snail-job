import{a as Pe,b as qe,N as be}from"./search-form-CSouas8Y.js";import{_ as Ae,a as Ge,d as Fe}from"./download-C7ANTmFB.js";import{_ as Ee}from"./delete-alert-CMbkkQNx.js";import{d as F,ai as we,b9 as ne,ba as _e,bb as ye,bc as He,bd as Te,be as Je,a as Re,bf as Qe,Z as X,a0 as re,J as Ce,r as A,p as G,c as I,P as ce,o as w,h as t,a5 as Ie,w as a,f as e,aG as Oe,$ as l,g as p,t as x,y as Ye,z as Ze,l as We,am as Xe,m as et,aH as ve,bg as oe,G as tt,A as at,C as lt,D as nt,b as pe,a2 as Se,a3 as he,aE as De,ac as Ue,ad as de,bh as ke,e as le,a6 as ot,B as Z,_ as rt,a7 as st,a8 as $e,Y as W,a9 as ie,aJ as ut,aK as Me,bi as Ve,ae as it,af as Y,E as ct,aa as pt,aM as dt,ag as mt,ah as ft}from"./index-DsXulf34.js";import{a as gt,b as bt,c as _t,d as yt,e as vt,g as St}from"./retry-scene-xT7KfxDz.js";import{_ as ht,u as kt,a as xt}from"./table-C5lzqi4D.js";import{u as Nt}from"./auth-CUdKODNA.js";import{_ as wt}from"./status-switch.vue_vue_type_script_setup_true_lang-m8qEijEY.js";import{L as Tt}from"./label-list-CM9sEsZ3.js";import{a as Rt,_ as Le}from"./cron-input.vue_vue_type_style_index_0_lang-BFaeFXfx.js";import{_ as Ct}from"./labels-input.vue_vue_type_script_setup_true_lang-D8rx2BaW.js";import{_ as ze}from"./system-user.vue_vue_type_script_setup_true_lang-BeDWgk3F.js";import{_ as Ke}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{f as It}from"./notify-CjnxS7b5.js";import{_ as Ot,a as Dt}from"./block-strategy.vue_vue_type_script_setup_true_lang-D6DwmrIW.js";import{_ as Ut}from"./text-Dgjc_w_8.js";import{_ as $t,a as Mt}from"./CollapseItem-4hJT8hQy.js";import{_ as Vt,c as Lt,d as zt,a as Kt,b as jt}from"./Grid-DdJm4X1d.js";import{_ as Bt}from"./select-scene.vue_vue_type_script_setup_true_lang-C3ZddlqK.js";import{_ as Pt,a as qt}from"./DescriptionsItem-BEs7Hiy4.js";import"./Progress-B1GWDnDE.js";import"./dashboard-D6r2Q2oa.js";import"./DynamicTags-CEJ2tmOq.js";import"./DynamicInput-C24Xro_e.js";import"./group-DephWMPB.js";const At=F({name:"Li",render(){return we("li",null,this.$slots)}}),xe=ne("li",{transition:"color .3s var(--n-bezier)",lineHeight:"var(--n-line-height)",margin:"var(--n-li-margin)",marginBottom:0,color:"var(--n-text-color)"}),Ne=[ne("&:first-child",`
 margin-top: 0;
 `),ne("&:last-child",`
 margin-bottom: 0;
 `)],Gt=ne([_e("ol",{fontSize:"var(--n-font-size)",padding:"var(--n-ol-padding)"},[ye("align-text",{paddingLeft:0}),xe,Ne]),_e("ul",{fontSize:"var(--n-font-size)",padding:"var(--n-ul-padding)"},[ye("align-text",{paddingLeft:0}),xe,Ne])]),Ft=Object.assign(Object.assign({},Te.props),{alignText:Boolean}),Et=F({name:"Ul",props:Ft,setup(_){const{mergedClsPrefixRef:v,inlineThemeDisabled:S}=He(_),y=Te("Typography","-xl",Gt,Je,_,v),c=Re(()=>{const{common:{cubicBezierEaseInOut:i},self:{olPadding:f,ulPadding:k,liMargin:T,liTextColor:O,liLineHeight:$,liFontSize:d}}=y.value;return{"--n-bezier":i,"--n-font-size":d,"--n-line-height":$,"--n-text-color":O,"--n-li-margin":T,"--n-ol-padding":f,"--n-ul-padding":k}}),m=S?Qe("ul",void 0,c,_):void 0;return{mergedClsPrefix:v,cssVars:S?void 0:c,themeClass:m?.themeClass,onRender:m?.onRender}},render(){var _;const{mergedClsPrefix:v}=this;return(_=this.onRender)===null||_===void 0||_.call(this),we("ul",{class:[`${v}-ul`,this.themeClass,this.alignText&&`${v}-ul--align-text`],style:this.cssVars},this.$slots)}}),Ht=F({name:"SceneTriggerInterval",__name:"scene-trigger-interval",props:X({backOff:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const v=re(_,"modelValue"),S=_,y=Ce(),c=A(S.backOff===2||S.backOff===4?Number(v.value):60),m=A(S.backOff===3?v.value:"* * * * * ?");return G(c,i=>{(S.backOff===2||S.backOff===4)&&(v.value=`${i}`)},{immediate:!0}),G(m,i=>{S.backOff===3&&(v.value=i)},{immediate:!0}),G(()=>S.backOff,i=>{i===2||i===4?v.value=`${c.value}`:i===3?v.value=m.value:v.value="*"},{immediate:!0}),(i,f)=>{const k=Oe,T=Le,O=Ie;return i.backOff===3?(w(),I(t(Rt),{key:0,modelValue:m.value,"onUpdate:modelValue":f[0]||(f[0]=$=>m.value=$),lang:t(y).locale},null,8,["modelValue","lang"])):i.backOff===2||i.backOff===4?(w(),I(O,{key:1},{default:a(()=>[e(k,{value:c.value,"onUpdate:value":f[1]||(f[1]=$=>c.value=$),min:10,placeholder:t(l)("page.retryScene.form.triggerInterval"),clearable:""},null,8,["value","placeholder"]),e(T,null,{default:a(()=>[p(x(t(l)("common.second")),1)]),_:1})]),_:1})):ce("",!0)}}}),Jt={class:"flex-center"},Qt={class:"flex-center"},Yt=F({name:"SceneOperateDrawer",__name:"scene-operate-drawer",props:X({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(_,{emit:v}){const S=A([4]),y=A("10s"),c=A("10s"),m=A([]),i=_,f=v,k=re(_,"visible"),{formRef:T,validate:O,restoreValidation:$}=Ye(),{defaultRequiredRule:d}=Ze(),M=Re(()=>({add:l("page.retryScene.addScene"),edit:l("page.retryScene.editScene")})[i.operateType]);We(()=>{Xe(()=>{Q()})});async function Q(){const R=await It(1);m.value=R.data}const o=et(ee());function ee(){return{groupName:void 0,sceneName:"",notifyIds:[],sceneStatus:1,ownerId:void 0,ownerName:"",backOff:2,maxRetryCount:1,triggerInterval:"60",deadlineRequest:6e4,executorTimeout:60,description:"",routeKey:4,blockStrategy:1,cbStatus:0,cbTriggerType:1,cbTriggerInterval:"",cbMaxCount:16,labelMap:[],labels:""}}const se={groupName:[d],sceneName:[d,{required:!0,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:l("page.retryScene.form.sceneName2")}],sceneStatus:[d],backOff:[d],maxRetryCount:[d],triggerInterval:[{...d,validator:()=>ve(o.triggerInterval)||o.backOff===1}],deadlineRequest:[d],executorTimeout:[d],routeKey:[d],blockStrategy:[d],cbStatus:[d],cbTriggerType:[d],cbMaxCount:[d],cbTriggerInterval:[{...d,validator:()=>ve(o.cbTriggerInterval)||o.cbTriggerType===1}]};function ue(){if(o.labelMap=[],i.operateType==="add"){Object.assign(o,ee());return}i.operateType==="edit"&&i.rowData&&(Object.assign(o,i.rowData),o.labels&&(o.labelMap=Object.entries(JSON.parse(o.labels)).map(([R,n])=>({key:R,value:n}))))}function D(){k.value=!1}async function te(){await O();const R={};if(o.labelMap?.forEach(n=>{R[n.key]=n.value}),i.operateType==="add"){const{groupName:n,sceneName:V,notifyIds:b,sceneStatus:B,ownerId:P,ownerName:q,backOff:s,maxRetryCount:u,triggerInterval:g,deadlineRequest:h,executorTimeout:C,routeKey:z,blockStrategy:L,description:K,cbStatus:N,cbTriggerType:j,cbTriggerInterval:E,cbMaxCount:U}=o,{error:H}=await gt({groupName:n,sceneName:V,notifyIds:b,sceneStatus:B,ownerId:P,ownerName:q,backOff:s,maxRetryCount:u,triggerInterval:g,deadlineRequest:h,executorTimeout:C,routeKey:z,blockStrategy:L,description:K,cbStatus:N,cbTriggerType:j,cbTriggerInterval:E,cbMaxCount:U,labels:JSON.stringify(R)});if(H)return;window.$message?.success(l("common.addSuccess"))}if(i.operateType==="edit"){const{id:n,groupName:V,sceneName:b,notifyIds:B,sceneStatus:P,ownerId:q,ownerName:s,backOff:u,maxRetryCount:g,triggerInterval:h,deadlineRequest:C,executorTimeout:z,routeKey:L,blockStrategy:K,description:N,cbStatus:j,cbTriggerType:E,cbTriggerInterval:U,cbMaxCount:H}=o,{error:ae}=await bt({id:n,groupName:V,sceneName:b,notifyIds:B,sceneStatus:P,ownerId:q,ownerName:s,backOff:u,maxRetryCount:g,triggerInterval:h,deadlineRequest:C,executorTimeout:z,routeKey:L,blockStrategy:K,description:N,cbStatus:j,cbTriggerType:E,cbTriggerInterval:U,cbMaxCount:H,labels:JSON.stringify(R)});if(ae)return;window.$message?.success(l("common.updateSuccess"))}D(),f("submitted")}return G(k,()=>{k.value&&(ue(),$())}),G(()=>o.backOff,R=>{R===1&&o.maxRetryCount>26&&(o.maxRetryCount=1)}),G(()=>o.maxRetryCount,()=>{y.value=Object.values(oe).slice(0,o.maxRetryCount).join(",")},{immediate:!0}),G(()=>o.cbMaxCount,()=>{c.value=Object.values(oe).slice(0,o.cbMaxCount).join(",")},{immediate:!0}),(R,n)=>{const V=lt,b=at,B=Ke,P=ze,q=Ct,s=Kt,u=nt,g=Vt,h=zt,C=Lt,z=Ue,L=Oe,K=Ht,N=rt,j=Z,E=Ut,U=At,H=Et,ae=ot,me=Le,fe=Ie,ge=Mt,je=$t,Be=tt;return w(),I($e,{modelValue:k.value,"onUpdate:modelValue":n[20]||(n[20]=r=>k.value=r),title:M.value,"min-size":480,onHandleSubmit:te},{footer:a(()=>[e(u,{size:16},{default:a(()=>[e(j,{onClick:D},{default:a(()=>[p(x(t(l)("common.cancel")),1)]),_:1}),e(j,{type:"primary",onClick:te},{default:a(()=>[p(x(t(l)("common.save")),1)]),_:1})]),_:1})]),default:a(()=>[e(Be,{ref_key:"formRef",ref:T,model:o,rules:se},{default:a(()=>[e(je,{"default-expanded-names":["1","2"]},{default:a(()=>[e(ge,{title:t(l)("page.retryScene.baseConfig"),name:"1"},{default:a(()=>[e(b,{label:t(l)("page.retryScene.sceneName"),path:"sceneName"},{default:a(()=>[e(V,{value:o.sceneName,"onUpdate:value":n[0]||(n[0]=r=>o.sceneName=r),disabled:i.operateType==="edit",maxlength:64,"show-count":"",placeholder:t(l)("page.retryScene.form.sceneName")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),e(b,{label:t(l)("page.retryScene.groupName"),path:"groupName"},{default:a(()=>[e(B,{value:o.groupName,"onUpdate:value":n[1]||(n[1]=r=>o.groupName=r),disabled:i.operateType==="edit"},null,8,["value","disabled"])]),_:1},8,["label"]),e(b,{label:t(l)("page.retryScene.ownerName"),path:"ownerId"},{default:a(()=>[e(P,{value:o.ownerId,"onUpdate:value":n[2]||(n[2]=r=>o.ownerId=r),clearable:!0},null,8,["value"])]),_:1},8,["label"]),e(b,{label:t(l)("page.jobTask.labels"),path:"labelMap","show-feedback":!o.labelMap?.length},{default:a(()=>[e(q,{value:o.labelMap,"onUpdate:value":n[3]||(n[3]=r=>o.labelMap=r),path:"labelMap"},null,8,["value"])]),_:1},8,["label","show-feedback"]),e(b,{label:t(l)("page.retryScene.sceneStatus"),path:"sceneStatus"},{default:a(()=>[e(g,{value:o.sceneStatus,"onUpdate:value":n[4]||(n[4]=r=>o.sceneStatus=r),name:"sceneStatus"},{default:a(()=>[e(u,null,{default:a(()=>[(w(!0),pe(Se,null,he(t(De),r=>(w(),I(s,{key:r.value,value:r.value,label:t(l)(r.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),e(C,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:a(()=>[e(h,null,{default:a(()=>[e(b,{label:t(l)("common.routeKey.routeLabel"),path:"routeKey"},{default:a(()=>[e(Ot,{value:o.routeKey,"onUpdate:value":n[5]||(n[5]=r=>o.routeKey=r)},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(h,null,{default:a(()=>[e(b,{label:t(l)("page.retryScene.blockStrategy"),path:"blockStrategy"},{default:a(()=>[e(Dt,{value:o.blockStrategy,"onUpdate:value":n[6]||(n[6]=r=>o.blockStrategy=r),ignore:S.value},null,8,["value","ignore"])]),_:1},8,["label"])]),_:1})]),_:1}),e(C,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:a(()=>[e(h,null,{default:a(()=>[e(b,{label:t(l)("page.retryScene.backOff"),path:"backOff"},{default:a(()=>[e(z,{value:o.backOff,"onUpdate:value":n[7]||(n[7]=r=>o.backOff=r),placeholder:t(l)("page.retryScene.form.backOff"),options:t(de)(t(ke)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1}),e(h,null,{default:a(()=>[e(b,{label:t(l)("page.retryScene.maxRetryCount"),path:"maxRetryCount"},{default:a(()=>[e(L,{value:o.maxRetryCount,"onUpdate:value":n[8]||(n[8]=r=>o.maxRetryCount=r),min:1,max:o.backOff===1?26:9999999,placeholder:t(l)("page.retryScene.form.maxRetryCount"),clearable:""},null,8,["value","max","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),e(b,{path:"triggerInterval"},{label:a(()=>[le("div",Jt,[p(x(t(l)("page.retryScene.triggerInterval"))+" ",1),o.backOff===1?(w(),I(ae,{key:0,trigger:"hover"},{trigger:a(()=>[e(j,{text:"",class:"ml-6px"},{default:a(()=>[e(N,{icon:"ant-design:info-circle-outlined",class:"mb-1px text-16px"})]),_:1})]),default:a(()=>[n[26]||(n[26]=p(" 延迟等级是参考RocketMQ的messageDelayLevel设计实现，具体延迟时间如下: 【10s,15s,30s,35s,40s,50s,1m,2m,4m,6m,8m,10m,20m,40m,1h,2h,3h,4h,5h,6h,7h,8h,9h,10h,11h,12h】 ")),n[27]||(n[27]=le("br",null,null,-1)),e(E,{strong:""},{default:a(()=>n[21]||(n[21]=[p("执行逻辑:")])),_:1,__:[21]}),e(H,{"align-text":""},{default:a(()=>[e(U,null,{default:a(()=>n[22]||(n[22]=[p("第一次执行间隔10s")])),_:1,__:[22]}),e(U,null,{default:a(()=>n[23]||(n[23]=[p("第二次执行间隔15s")])),_:1,__:[23]}),e(U,null,{default:a(()=>n[24]||(n[24]=[p("l第二次执行间隔30s")])),_:1,__:[24]}),e(U,null,{default:a(()=>n[25]||(n[25]=[p("........... 依次类推")])),_:1,__:[25]})]),_:1})]),_:1,__:[26,27]})):ce("",!0)])]),default:a(()=>[o.backOff!==1?(w(),I(K,{key:0,modelValue:o.triggerInterval,"onUpdate:modelValue":n[9]||(n[9]=r=>o.triggerInterval=r),"back-off":o.backOff},null,8,["modelValue","back-off"])):(w(),I(V,{key:1,value:y.value,"onUpdate:value":n[10]||(n[10]=r=>y.value=r),type:"textarea",autosize:{minRows:1,maxRows:3},readonly:""},null,8,["value"]))]),_:1}),e(C,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:a(()=>[e(h,null,{default:a(()=>[e(b,{label:t(l)("page.retryScene.executorTimeout"),path:"executorTimeout"},{default:a(()=>[e(fe,null,{default:a(()=>[e(L,{value:o.executorTimeout,"onUpdate:value":n[11]||(n[11]=r=>o.executorTimeout=r),min:1,max:60,placeholder:t(l)("page.retryScene.form.executorTimeout"),clearable:""},null,8,["value","placeholder"]),e(me,null,{default:a(()=>[p(x(t(l)("common.second")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1}),e(h,null,{default:a(()=>[e(b,{label:t(l)("page.retryScene.deadlineRequest"),path:"deadlineRequest"},{default:a(()=>[e(fe,null,{default:a(()=>[e(L,{value:o.deadlineRequest,"onUpdate:value":n[12]||(n[12]=r=>o.deadlineRequest=r),min:100,max:6e4,placeholder:t(l)("page.retryScene.form.deadlineRequest"),clearable:""},null,8,["value","placeholder"]),e(me,null,{default:a(()=>[p(x(t(l)("common.millisecond")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),_:1}),e(b,{label:t(l)("page.retryScene.notifyName"),path:"notifyIds"},{default:a(()=>[e(z,{value:o.notifyIds,"onUpdate:value":n[13]||(n[13]=r=>o.notifyIds=r),"value-field":"id","label-field":"notifyName",placeholder:t(l)("page.retryScene.form.notifyName"),options:m.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(b,{label:t(l)("page.retryScene.description"),path:"description"},{default:a(()=>[e(V,{value:o.description,"onUpdate:value":n[14]||(n[14]=r=>o.description=r),type:"textarea",maxlength:256,placeholder:t(l)("page.retryScene.form.description"),"show-count":"",clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),e(ge,{title:t(l)("page.retryScene.cbConfig"),name:"2"},{default:a(()=>[e(b,{label:t(l)("page.retryScene.cbStatus"),path:"cbStatus"},{default:a(()=>[e(g,{value:o.cbStatus,"onUpdate:value":n[15]||(n[15]=r=>o.cbStatus=r),name:"cbStatus"},{default:a(()=>[e(u,null,{default:a(()=>[(w(!0),pe(Se,null,he(t(st),r=>(w(),I(s,{key:r.value,value:r.value,label:t(l)(r.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),e(C,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:a(()=>[e(h,null,{default:a(()=>[e(b,{label:t(l)("page.retryScene.cbTriggerType"),path:"cbTriggerType"},{default:a(()=>[e(z,{value:o.cbTriggerType,"onUpdate:value":n[16]||(n[16]=r=>o.cbTriggerType=r),placeholder:t(l)("page.retryScene.form.cbTriggerType"),options:t(de)(t(ke)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1}),e(h,null,{default:a(()=>[e(b,{label:t(l)("page.retryScene.cbMaxCount"),path:"cbMaxCount"},{default:a(()=>[e(L,{value:o.cbMaxCount,"onUpdate:value":n[17]||(n[17]=r=>o.cbMaxCount=r),min:1,max:o.backOff===1?26:9999999,placeholder:t(l)("page.retryScene.form.cbMaxCount"),clearable:""},null,8,["value","max","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),e(b,{path:"cbTriggerInterval"},{label:a(()=>[le("div",Qt,[p(x(t(l)("page.retryScene.cbTriggerInterval"))+" ",1),o.cbTriggerType===1?(w(),I(ae,{key:0,trigger:"hover"},{trigger:a(()=>[e(j,{text:"",class:"ml-6px"},{default:a(()=>[e(N,{icon:"ant-design:info-circle-outlined",class:"mb-1px text-16px"})]),_:1})]),default:a(()=>[n[33]||(n[33]=p(" 延迟等级是参考RocketMQ的messageDelayLevel设计实现，具体延迟时间如下: 【10s,15s,30s,35s,40s,50s,1m,2m,4m,6m,8m,10m,20m,40m,1h,2h,3h,4h,5h,6h,7h,8h,9h,10h,11h,12h】 ")),n[34]||(n[34]=le("br",null,null,-1)),e(E,{strong:""},{default:a(()=>n[28]||(n[28]=[p("执行逻辑:")])),_:1,__:[28]}),e(H,{"align-text":""},{default:a(()=>[e(U,null,{default:a(()=>n[29]||(n[29]=[p("第一次执行间隔10s")])),_:1,__:[29]}),e(U,null,{default:a(()=>n[30]||(n[30]=[p("第二次执行间隔15s")])),_:1,__:[30]}),e(U,null,{default:a(()=>n[31]||(n[31]=[p("l第二次执行间隔30s")])),_:1,__:[31]}),e(U,null,{default:a(()=>n[32]||(n[32]=[p("........... 依次类推")])),_:1,__:[32]})]),_:1})]),_:1,__:[33,34]})):ce("",!0)])]),default:a(()=>[o.cbTriggerType!==1?(w(),I(K,{key:0,modelValue:o.cbTriggerInterval,"onUpdate:modelValue":n[18]||(n[18]=r=>o.cbTriggerInterval=r),"back-off":o.cbTriggerType},null,8,["modelValue","back-off"])):(w(),I(V,{key:1,value:c.value,"onUpdate:value":n[19]||(n[19]=r=>c.value=r),type:"textarea",autosize:{minRows:1,maxRows:3},readonly:""},null,8,["value"]))]),_:1})]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Zt=F({name:"SceneSearch",__name:"scene-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search"],["update:model"]),setup(_,{emit:v}){const S=v,y=re(_,"model");function c(){S("reset")}function m(){S("search")}return(i,f)=>{const k=ht,T=Bt,O=Ue,$=ze,d=Pe;return w(),I(d,{model:y.value,onSearch:m,onReset:c},{default:a(()=>[e(k,{span:"24 s:12 m:6",label:t(l)("page.retryScene.groupName"),path:"groupName",class:"pr-24px"},{default:a(()=>[e(Ke,{value:y.value.groupName,"onUpdate:value":f[0]||(f[0]=M=>y.value.groupName=M),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(k,{span:"24 s:12 m:6",label:t(l)("page.retryScene.sceneName"),path:"sceneName",class:"pr-24px"},{default:a(()=>[e(T,{value:y.value.sceneName,"onUpdate:value":f[1]||(f[1]=M=>y.value.sceneName=M),"group-name":y.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),e(k,{span:"24 s:12 m:6",label:t(l)("page.retryScene.sceneStatus"),path:"sceneStatus",class:"pr-24px"},{default:a(()=>[e(O,{value:y.value.sceneStatus,"onUpdate:value":f[2]||(f[2]=M=>y.value.sceneStatus=M),placeholder:t(l)("page.jobTask.form.jobStatus"),options:t(de)(t(De)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(k,{span:"24 s:12 m:6",label:t(l)("page.retryScene.ownerName"),path:"ownerId",class:"pr-24px"},{default:a(()=>[e($,{value:y.value.ownerId,"onUpdate:value":f[3]||(f[3]=M=>y.value.ownerId=M),clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Wt=F({name:"SceneDetailDrawer",__name:"scene-detail-drawer",props:X({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(_){const v=_,S=re(_,"visible");function y(c){if(v.rowData?.backOff!==1)return"";let m="";for(let i=1;i<=c;i+=1)m+=`,${oe[i]}`;return m.substring(1,m.length)}return(c,m)=>{const i=qt,f=W,k=Pt,T=$e;return w(),I(T,{modelValue:S.value,"onUpdate:modelValue":m[0]||(m[0]=O=>S.value=O),title:t(l)("page.retryScene.detail")},{default:a(()=>[e(k,{"label-placement":"top",bordered:"",column:2},{default:a(()=>[e(i,{label:t(l)("page.retryScene.sceneName"),span:2},{default:a(()=>[p(x(c.rowData?.sceneName),1)]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.groupName"),span:2},{default:a(()=>[p(x(c.rowData?.groupName),1)]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.sceneStatus"),span:1},{default:a(()=>[e(f,{type:t(ie)(c.rowData?.sceneStatus)},{default:a(()=>[p(x(t(l)(t(ut)[c.rowData?.sceneStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(i,{label:t(l)("common.routeKey.routeLabel"),span:1},{default:a(()=>[e(f,{type:t(ie)(c.rowData?.routeKey)},{default:a(()=>[p(x(t(l)(t(Me)[c.rowData?.routeKey])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.maxRetryCount"),span:1},{default:a(()=>[p(x(c.rowData?.maxRetryCount),1)]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.executorTimeout"),span:1},{default:a(()=>[p(x(c.rowData?.executorTimeout),1)]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.deadlineRequest"),span:1},{default:a(()=>[p(x(c.rowData?.deadlineRequest),1)]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.backOff"),span:1},{default:a(()=>[e(f,{type:t(ie)(c.rowData?.backOff)},{default:a(()=>[p(x(t(l)(t(Ve)[c.rowData?.backOff])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.triggerInterval"),span:2},{default:a(()=>[p(x(c.rowData?.backOff===1?y(c.rowData?.maxRetryCount):c.rowData?.triggerInterval),1)]),_:1},8,["label"]),e(i,{label:t(l)("page.retryScene.description"),span:2},{default:a(()=>[p(x(c.rowData?.description),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Xt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function J(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!ft(_)}const wa=F({name:"retry_scene",__name:"index",setup(_){const{hasAuth:v}=Nt(),S=Ce(),y=A(),{bool:c,setTrue:m}=it(!1),{columns:i,columnChecks:f,data:k,getData:T,loading:O,mobilePagination:$,searchParams:d,resetSearchParams:M}=kt({apiFn:yt,apiParams:{page:1,size:10,groupName:null,sceneName:null,sceneStatus:null,ownerId:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"sceneName",align:"center",title:l("page.retryScene.sceneName"),fixed:"left",width:120,render:s=>{function u(){y.value=s||null,m()}return e(Z,{text:!0,tag:"a",type:"primary",onClick:u,class:"ws-normal"},{default:()=>[s.sceneName]})}},{key:"groupName",title:l("page.retryScene.groupName"),align:"center",width:150},{key:"labels",title:l("page.pods.labels"),align:"center",width:120,render:s=>e(Tt,{labels:s.labels},null)},{key:"ownerName",title:l("page.retryScene.ownerName"),align:"center",width:60,render:s=>s.ownerName?s.ownerName:l("common.none")},{key:"sceneStatus",title:l("page.retryScene.sceneStatus"),align:"center",width:50,render:s=>{const u=async(g,h)=>{const{error:C}=await vt(s.id,g);C||(s.sceneStatus=g,window.$message?.success(l("common.updateSuccess"))),h(!C)};return e(wt,{value:s.sceneStatus,"onUpdate:value":g=>s.sceneStatus=g,onSubmitted:u},null)}},{key:"backOff",title:l("page.retryScene.backOff"),align:"center",width:80,render:s=>{const u=l(Ve[s.backOff]);return e(W,{type:"primary"},J(u)?u:{default:()=>[u]})}},{key:"routeKey",title:l("page.retryScene.routeKey"),align:"center",width:80,render:s=>{const u=l(Me[s.routeKey]);return e(W,{type:"primary"},J(u)?u:{default:()=>[u]})}},{key:"cbStatus",title:l("page.retryScene.cbStatus"),align:"center",width:80,render:s=>{const u={0:"error",1:"primary"},g=l(pt[s.cbStatus]);return e(W,{type:u[s.cbStatus]},J(g)?g:{default:()=>[g]})}},{key:"maxRetryCount",title:l("page.retryScene.maxRetryCount"),align:"center",width:80},{key:"triggerInterval",title:l("page.retryScene.triggerInterval"),align:"center",width:130,render:s=>s.backOff===1?B(s.backOff,s.maxRetryCount):s.triggerInterval},{key:"blockStrategy",title:l("page.retryScene.blockStrategy"),align:"center",width:80,render:s=>{const u=l(dt[s.blockStrategy]);return e(W,{type:"primary"},J(u)?u:{default:()=>[u]})}},{key:"executorTimeout",title:l("page.retryScene.executorTimeout"),align:"center",width:80},{key:"updateDt",title:l("page.retryScene.updateDt"),align:"center",width:120},{key:"description",title:l("page.retryScene.description"),align:"center",width:120},{key:"operate",title:l("common.operate"),align:"center",fixed:"right",width:80,render:s=>{let u;return e("div",{class:"flex-center gap-8px"},[e(Z,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>n(s.id)},J(u=l("common.edit"))?u:{default:()=>[u]}),e(mt,{vertical:!0},null),e(be,{onPositiveClick:()=>V(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let g;return e(Z,{type:"error",text:!0,ghost:!0,size:"small"},J(g=l("common.delete"))?g:{default:()=>[g]})}})])}}]}),{drawerVisible:Q,operateType:o,editingData:ee,handleAdd:se,handleEdit:ue,checkedRowKeys:D,onDeleted:te,onBatchDeleted:R}=xt(k,T);function n(s){ue(s)}async function V(s){const{error:u}=await St(s);u||te()}async function b(){const{error:s}=await _t(D.value);s||R()}function B(s,u){if(s!==1)return"";let g="";for(let h=1;h<=u;h+=1)g+=`,${oe[h]}`;return g.substring(1,g.length)}function P(){return{sceneIds:D.value,groupName:d.groupName,sceneName:d.sceneName,sceneStatus:d.sceneStatus,ownerId:d.ownerId}}function q(){Fe("/scene-config/export",P(),l("page.retryScene.title"))}return(s,u)=>{const g=Ee,h=Ae,C=Ge,z=qe,L=jt,K=ct;return w(),pe("div",Xt,[e(Zt,{model:t(d),"onUpdate:model":u[0]||(u[0]=N=>Y(d)?d.value=N:null),onReset:t(M),onSearch:t(T)},null,8,["model","onReset","onSearch"]),e(g),e(K,{title:t(l)("page.retryScene.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":a(()=>[e(z,{columns:t(f),"onUpdate:columns":u[1]||(u[1]=N=>Y(f)?f.value=N:null),"disabled-delete":t(D).length===0,loading:t(O),"show-delete":t(v)("R_ADMIN"),onAdd:t(se),onDelete:b,onRefresh:t(T)},{addAfter:a(()=>[e(h,{action:"/scene-config/import",accept:"application/json",onRefresh:t(T)},null,8,["onRefresh"]),e(t(be),{onPositiveClick:q},{trigger:a(()=>[e(t(Z),{size:"small",ghost:"",type:"primary",disabled:t(D).length===0&&t(v)("R_USER")},{icon:a(()=>[e(C,{class:"text-icon"})]),default:a(()=>[p(" "+x(t(l)("common.export")),1)]),_:1},8,["disabled"])]),default:a(()=>[p(x(t(D).length===0?t(l)("common.exportAll"):t(l)("common.exportPar",{num:t(D).length})),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-delete","onAdd","onRefresh"])]),default:a(()=>[e(L,{"checked-row-keys":t(D),"onUpdate:checkedRowKeys":u[2]||(u[2]=N=>Y(D)?D.value=N:null),columns:t(i),data:t(k),"flex-height":!t(S).isMobile,"scroll-x":2e3,loading:t(O),remote:"","row-key":N=>N.id,pagination:t($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Yt,{visible:t(Q),"onUpdate:visible":u[3]||(u[3]=N=>Y(Q)?Q.value=N:null),"operate-type":t(o),"row-data":t(ee),onSubmitted:t(T)},null,8,["visible","operate-type","row-data","onSubmitted"]),e(Wt,{visible:t(c),"onUpdate:visible":u[4]||(u[4]=N=>Y(c)?c.value=N:null),"row-data":y.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{wa as default};
