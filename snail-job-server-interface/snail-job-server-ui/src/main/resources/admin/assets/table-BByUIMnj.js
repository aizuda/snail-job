import{d as L,j as N,k as A}from"./Grid-CbOCmdgq.js";import{d as H,aj as M,d_ as $,C as q,r as C,eb as U,ec as W,ed as Y,af as K,n as R,cf as E,a as B,aR as X,b as J,o as Q,e as Z,ao as ee,K as ae,$ as z,q as te,aq as se}from"./index-CIalkTVx.js";const ne=Object.assign(Object.assign({},A),W),de=H({__GRID_ITEM__:!0,name:"FormItemGridItem",alias:["FormItemGi"],props:ne,setup(){const a=C(null);return{formItemInstRef:a,validate:(...t)=>{const{value:h}=a;if(h)return h.validate(...t)},restoreValidation:()=>{const{value:t}=a;t&&t.restoreValidation()}}},render(){return M(L,$(this.$.vnode.props||{},N),{default:()=>{const a=$(this.$props,U);return M(q,Object.assign({ref:"formItemInstRef"},a),this.$slots)}})}});function oe(a){const{loading:l,startLoading:v,endLoading:t}=Y(),{bool:h,setBool:f}=K(),{apiFn:w,apiParams:p,transformer:S,immediate:b=!0,getColumnChecks:P,getColumns:I}=a,g=R(E({...p})),s=C(a.columns()),_=C([]),i=C(P(a.columns())),m=B(()=>I(s.value,i.value));function D(){s.value=a.columns();const u=new Map(i.value.map(c=>[c.key,c.checked])),k=P(s.value);i.value=k.map(c=>({...c,checked:u.get(c.key)??c.checked}))}async function y(){var e;v();const u=T(g),k=await w(u),c=S(k);_.value=c.data,f(c.data.length===0),await((e=a.onFetched)==null?void 0:e.call(a,c)),t()}function T(u){const k={};return Object.entries(u).forEach(([c,e])=>{e!=null&&(k[c]=e)}),k}function r(u){Object.assign(g,u)}function j(){Object.assign(g,E(p))}return b&&(a.searchParams&&r(a.searchParams),y()),{loading:l,empty:h,data:_,columns:m,columnChecks:i,reloadColumns:D,getData:y,searchParams:g,updateSearchParams:r,resetSearchParams:j}}const re={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function ce(a,l){return Q(),J("svg",re,l[0]||(l[0]=[Z("path",{fill:"currentColor",d:"M18 12.998h-5v5a1 1 0 0 1-2 0v-5H6a1 1 0 0 1 0-2h5v-5a1 1 0 0 1 2 0v5h5a1 1 0 0 1 0 2"},null,-1)]))}const pe=X({name:"ic-round-plus",render:ce});function me(a){const l=ee(),v=ae(),t=B(()=>v.isMobile),{apiFn:h,apiParams:f,immediate:w}=a,p=a.showTotal||!0,S="__selection__",b="__expand__",{loading:P,empty:I,data:g,columns:s,columnChecks:_,reloadColumns:i,getData:m,searchParams:D,updateSearchParams:y,resetSearchParams:T}=oe({apiFn:h,apiParams:f,searchParams:a.searchParams,columns:a.columns,transformer:e=>{const{data:d=[],page:n=1,size:x=10,total:o=0}=e.data||{},O=x<=0?10:x;return{data:d.map((V,G)=>({...V,index:(n-1)*O+G+1})),pageNum:n,pageSize:O,total:o}},getColumnChecks:e=>{const d=[];return e.forEach(n=>{F(n)?d.push({key:n.key,title:n.title,checked:!0}):n.type==="selection"?d.push({key:S,title:z("common.check"),checked:!0}):n.type==="expand"&&d.push({key:b,title:z("common.expandColumn"),checked:!0})}),d},getColumns:(e,d)=>{const n=new Map;return e.forEach(o=>{F(o)?n.set(o.key,o):o.type==="selection"?n.set(S,o):o.type==="expand"&&n.set(b,o),t.value&&o.fixed&&(o.fixed=void 0)}),d.filter(o=>o.checked).map(o=>n.get(o.key))},onFetched:async e=>{const{pageNum:d,pageSize:n,total:x}=e;u({page:d,pageSize:n,itemCount:x})},immediate:w}),r=R({page:1,pageSize:10,showSizePicker:!0,itemCount:0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{r.page=e,y({page:e,size:r.pageSize}),m()},onUpdatePageSize:async e=>{r.pageSize=e,r.page=1,y({page:r.page,size:e}),m()},prefix:e=>z("datatable.itemCount",{total:e.itemCount})}),j=B(()=>({...r,pageSlot:t.value?3:9,prefix:!t.value&&p?r.prefix:void 0}));function u(e){Object.assign(r,e)}async function k(e=1){u({page:e}),y({page:e,size:r.pageSize}),await m()}return l.run(()=>{te(()=>v.locale,()=>{i()})}),se(()=>{l.stop()}),{loading:P,empty:I,data:g,columns:s,columnChecks:_,reloadColumns:i,pagination:r,mobilePagination:j,updatePagination:u,getData:m,getDataByPage:k,searchParams:D,updateSearchParams:y,resetSearchParams:()=>{T(),m()}}}function he(a,l){const{bool:v,setTrue:t,setFalse:h}=K(),f=C("add");function w(){f.value="add",t()}const p=C(null);function S(s){f.value="edit";const _=a.value.find(i=>i.id===s)||null;p.value=E(_),t()}function b(s){var i;f.value="add";const _=a.value.find(m=>m.id===s)||null;p.value=E(_),(i=p.value)==null||delete i.id,t()}const P=C([]);async function I(){var s;(s=window.$message)==null||s.success(z("common.deleteSuccess")),P.value=[],await l()}async function g(){var s;(s=window.$message)==null||s.success(z("common.deleteSuccess")),await l()}return{drawerVisible:v,openDrawer:t,closeDrawer:h,operateType:f,handleAdd:w,editingData:p,handleEdit:S,handleCopy:b,checkedRowKeys:P,onBatchDeleted:I,onDeleted:g}}function F(a){return!!a.key}export{de as _,he as a,pe as b,me as u};
