import{a as he,b as Se,N as Te}from"./search-form-CSouas8Y.js";import{_ as Ne}from"./delete-alert-CMbkkQNx.js";import{d as H,Z as Q,r as B,a0 as q,y as ke,z as we,a as Ce,$ as a,l as De,am as Ue,m as Re,p as xe,c as I,o as C,w as n,f as t,G as Le,A as $e,h as e,ac as re,ad as E,aS as me,C as ye,D as Ie,b as le,a2 as ie,a3 as pe,aE as se,aG as Oe,B as X,g as k,t as w,a8 as ce,aT as Ve,aU as Be,aV as Me,P as fe,Y as W,a9 as x,aW as ge,aJ as Ge,aX as _e,aY as be,J as Ae,ae as Fe,af as J,E as je,aZ as oe,a_ as ze,ag as Ee,ah as Pe}from"./index-DsXulf34.js";import{a as Je,b as We,c as qe,d as de,e as He,g as Ke}from"./notify-CjnxS7b5.js";import{_ as Ye,u as Ze,a as Xe}from"./table-C5lzqi4D.js";import{u as Qe}from"./auth-CUdKODNA.js";import{f as et}from"./retry-scene-xT7KfxDz.js";import{f as tt}from"./workflow-BRHQyGIj.js";import{k as at}from"./job-DnRsninN.js";import{_ as ve}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{c as nt,d as ot,_ as lt,a as it,b as st}from"./Grid-DdJm4X1d.js";import{_ as rt,a as ut}from"./DescriptionsItem-BEs7Hiy4.js";import{_ as pt}from"./status-switch.vue_vue_type_script_setup_true_lang-m8qEijEY.js";import"./CollapseItem-4hJT8hQy.js";import"./group-DephWMPB.js";const ft=H({name:"NotifyConfigOperateDrawer",__name:"notify-config-operate-drawer",props:Q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{},retryNotifyStatusDisable:{type:Boolean,default:!0},retryNotifyStatusDisableModifiers:{},retrySceneDisable:{type:Boolean,default:!0},retrySceneDisableModifiers:{}}),emits:Q(["update:value","submitted"],["update:visible","update:retryNotifyStatusDisable","update:retrySceneDisable"]),setup(_,{emit:N}){const p=B([]),m=B([]),y=B([]),b=B([]),g=_,c=N,v=q(_,"visible"),S=q(_,"retryNotifyStatusDisable"),D=q(_,"retrySceneDisable"),U=B([]),{formRef:O,validate:P,restoreValidation:h}=ke(),{defaultRequiredRule:R}=we(),ee=Ce(()=>({add:a("page.notifyConfig.addNotifyConfig"),edit:a("page.notifyConfig.editNotifyConfig")})[g.operateType]);De(()=>{Ue(()=>{te()})});async function te(){const d=await Je();p.value=d.data}const l=Re(L());function L(){return{groupName:null,recipientIds:[],systemTaskType:null,notifyName:"",notifyStatus:1,notifyScene:null,notifyThreshold:16,rateLimiterStatus:1,rateLimiterThreshold:100,description:""}}const ae={groupName:R,systemTaskType:R,notifyName:R,notifyStatus:R,notifyScene:R,recipientIds:R,rateLimiterStatus:R,notifyThreshold:R};function K(){if(g.operateType==="add"){Object.assign(l,L()),D.value=!0,S.value=!0,U.value=[];return}g.operateType==="edit"&&g.rowData&&(Object.assign(l,g.rowData),i(l.systemTaskType),o(l.notifyScene))}function Y(){v.value=!1}async function Z(){if(await P(),g.operateType==="add"){const{groupName:d,recipientIds:s,systemTaskType:f,notifyName:u,notifyStatus:M,notifyScene:G,notifyThreshold:V,rateLimiterStatus:A,rateLimiterThreshold:$,description:F}=l,{error:j}=await We({groupName:d,recipientIds:s,systemTaskType:f,notifyName:u,notifyStatus:M,notifyScene:G,notifyThreshold:V,rateLimiterStatus:A,rateLimiterThreshold:$,description:F});if(j)return}if(g.operateType==="edit"){const{id:d,groupName:s,recipientIds:f,notifyStatus:u,notifyName:M,systemTaskType:G,notifyScene:V,notifyThreshold:A,rateLimiterStatus:$,rateLimiterThreshold:F,description:j}=l,{error:ne}=await qe({id:d,groupName:s,recipientIds:f,systemTaskType:G,notifyName:M,notifyStatus:u,notifyScene:V,notifyThreshold:A,rateLimiterStatus:$,rateLimiterThreshold:F,description:j});if(ne)return}window.$message?.success(a("common.updateSuccess")),Y(),c("submitted")}async function i(d){if(d===1){const f=await et({groupName:l.groupName});m.value=f.data,U.value=E(Ve)}else if(d===3){const f=await at({groupName:l.groupName});y.value=f.data?.map(u=>(u.id=String(u.id),u)),U.value=E(Be)}else if(d===4){const f=await tt({groupName:l.groupName});b.value=f.data?.map(u=>(u.id=String(u.id),u)),U.value=E(Me)}await o(l.notifyScene);let s=!1;U.value.map(f=>(f.value===l.notifyScene&&(s=!0),String(f.value))),s||(l.notifyScene=null)}async function o(d){D.value=!(l.systemTaskType===1&&(d===1||d===2||d===5||d===6)),d===7&&(l.notifyThreshold=0)}function T(d){K(),l.groupName=d,i(1),o(1)}return xe(v,()=>{v.value&&(K(),h())}),(d,s)=>{const f=$e,u=re,M=ye,G=it,V=Ie,A=lt,$=ot,F=Oe,j=nt,ne=Le,ue=X;return C(),I(ce,{modelValue:v.value,"onUpdate:modelValue":s[10]||(s[10]=r=>v.value=r),title:ee.value,"min-size":480,onHandleSubmit:Z},{footer:n(()=>[t(V,{size:16},{default:n(()=>[t(ue,{onClick:Y},{default:n(()=>[k(w(e(a)("common.cancel")),1)]),_:1}),t(ue,{type:"primary",onClick:Z},{default:n(()=>[k(w(e(a)("common.save")),1)]),_:1})]),_:1})]),default:n(()=>[t(ne,{ref_key:"formRef",ref:O,model:l,rules:ae},{default:n(()=>[t(f,{label:e(a)("page.notifyConfig.groupName"),path:"groupName"},{default:n(()=>[t(ve,{value:l.groupName,"onUpdate:value":s[0]||(s[0]=r=>l.groupName=r),"onUpdate:modelValue":T},null,8,["value"])]),_:1},8,["label"]),t(f,{label:e(a)("page.notifyConfig.systemTaskType"),path:"systemTaskType"},{default:n(()=>[t(u,{value:l.systemTaskType,"onUpdate:value":[s[1]||(s[1]=r=>l.systemTaskType=r),i],placeholder:e(a)("page.notifyConfig.form.systemTaskType"),options:e(E)(e(me))},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(f,{label:e(a)("page.notifyConfig.notifyScene"),path:"notifyScene"},{default:n(()=>[t(u,{value:l.notifyScene,"onUpdate:value":[s[2]||(s[2]=r=>l.notifyScene=r),o],placeholder:e(a)("page.notifyConfig.form.notifyScene"),options:U.value},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(f,{label:e(a)("page.notifyConfig.notifyRecipient"),path:"recipientIds"},{default:n(()=>[t(u,{value:l.recipientIds,"onUpdate:value":s[3]||(s[3]=r=>l.recipientIds=r),placeholder:e(a)("page.notifyConfig.form.notifyRecipient"),options:p.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(f,{label:e(a)("page.notifyConfig.notifyName"),path:"notifyName"},{default:n(()=>[t(M,{value:l.notifyName,"onUpdate:value":s[4]||(s[4]=r=>l.notifyName=r),placeholder:e(a)("page.notifyConfig.form.notifyName"),maxlength:32},null,8,["value","placeholder"])]),_:1},8,["label"]),t(j,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t($,null,{default:n(()=>[t(f,{label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus"},{default:n(()=>[t(A,{value:l.notifyStatus,"onUpdate:value":s[5]||(s[5]=r=>l.notifyStatus=r),name:"notifyStatus"},{default:n(()=>[t(V,null,{default:n(()=>[(C(!0),le(ie,null,pe(e(se),r=>(C(),I(G,{key:r.value,value:r.value,label:e(a)(r.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),t($,null,{default:n(()=>[t(f,{label:e(a)("page.notifyConfig.notifyThreshold"),path:"notifyThreshold"},{default:n(()=>[t(F,{value:l.notifyThreshold,"onUpdate:value":s[6]||(s[6]=r=>l.notifyThreshold=r),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:D.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(j,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t($,null,{default:n(()=>[t(f,{label:e(a)("page.notifyConfig.rateLimiterStatus"),path:"rateLimiterStatus"},{default:n(()=>[t(A,{value:l.rateLimiterStatus,"onUpdate:value":s[7]||(s[7]=r=>l.rateLimiterStatus=r),name:"rateLimiterStatus",disabled:D.value},{default:n(()=>[t(V,null,{default:n(()=>[(C(!0),le(ie,null,pe(e(se),r=>(C(),I(G,{key:r.value,value:r.value,label:e(a)(r.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"])]),_:1}),t($,null,{default:n(()=>[t(f,{label:e(a)("page.notifyConfig.rateLimiterThreshold"),path:"notifyThreshold"},{default:n(()=>[t(F,{value:l.rateLimiterThreshold,"onUpdate:value":s[8]||(s[8]=r=>l.rateLimiterThreshold=r),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:D.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(f,{label:e(a)("page.notifyConfig.description"),path:"description"},{default:n(()=>[t(M,{value:l.description,"onUpdate:value":s[9]||(s[9]=r=>l.description=r),type:"textarea",placeholder:e(a)("page.notifyConfig.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),dt=H({name:"SystemTaskType",__name:"system-task-type",emits:["update:value"],setup(_,{emit:N}){const p=N,m=B(),y=b=>{p("update:value",b)};return(b,g)=>{const c=re;return C(),I(c,{value:m.value,"onUpdate:value":[g[0]||(g[0]=v=>m.value=v),y],placeholder:e(a)("page.notifyConfig.systemTaskType"),options:e(E)(e(me))},null,8,["value","placeholder","options"])}}}),mt=H({name:"NotifyConfigSearch",__name:"notify-config-search",props:{model:{required:!0},modelModifiers:{}},emits:Q(["reset","search"],["update:model"]),setup(_,{emit:N}){const p=N,m=q(_,"model");function y(){p("reset")}function b(){p("search")}return(g,c)=>{const v=ye,S=Ye,D=ve,U=dt,O=re,P=he;return C(),I(P,{"btn-span":"12 s:24 m:24 1:24 xl:24",model:m.value,onSearch:b,onReset:y},{default:n(()=>[t(S,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyName"),path:"notifyName",class:"pr-24px"},{default:n(()=>[t(v,{value:m.value.notifyName,"onUpdate:value":c[0]||(c[0]=h=>m.value.notifyName=h),placeholder:e(a)("page.notifyConfig.form.notifyName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(S,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t(D,{value:m.value.groupName,"onUpdate:value":c[1]||(c[1]=h=>m.value.groupName=h),clearable:""},null,8,["value"])]),_:1},8,["label"]),t(S,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.systemTaskType"),path:"systemTaskType",class:"pr-24px"},{default:n(()=>[t(U,{value:m.value.systemTaskType,"onUpdate:value":c[2]||(c[2]=h=>m.value.systemTaskType=h),clearable:""},null,8,["value"])]),_:1},8,["label"]),t(S,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus",class:"pr-24px"},{default:n(()=>[t(O,{value:m.value.notifyStatus,"onUpdate:value":c[3]||(c[3]=h=>m.value.notifyStatus=h),placeholder:e(a)("page.notifyConfig.notifyStatus"),options:e(E)(e(se)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),yt=H({name:"NotifyConfigDetailDrawer",__name:"notify-config-detail-drawer",props:Q({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(_){const N=q(_,"visible");return(p,m)=>{const y=ut,b=W,g=rt,c=ce;return C(),I(c,{modelValue:N.value,"onUpdate:modelValue":m[0]||(m[0]=v=>N.value=v),title:e(a)("page.groupConfig.detail")},{default:n(()=>[t(g,{"label-placement":"top",bordered:"",column:2},{default:n(()=>[t(y,{label:e(a)("page.notifyConfig.notifyName"),span:2},{default:n(()=>[k(w(p.rowData?.notifyName),1)]),_:1},8,["label"]),t(y,{label:e(a)("page.groupConfig.groupName"),span:2},{default:n(()=>[k(w(p.rowData?.groupName),1)]),_:1},8,["label"]),t(y,{label:e(a)("page.notifyConfig.systemTaskType"),span:1},{default:n(()=>[t(b,{type:e(x)(p.rowData?.systemTaskType)},{default:n(()=>[k(w(e(a)(e(ge)[p.rowData?.systemTaskType])),1)]),_:1},8,["type"])]),_:1},8,["label"]),t(y,{label:e(a)("page.notifyConfig.notifyStatus"),span:1},{default:n(()=>[t(b,{type:e(x)(p.rowData?.notifyStatus)},{default:n(()=>[k(w(e(a)(e(Ge)[p.rowData?.notifyStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),p.rowData?.systemTaskType===1?(C(),I(y,{key:0,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>[t(b,{type:e(x)(p.rowData?.notifyScene)},{default:n(()=>[k(w(e(a)(e(_e)[p.rowData?.notifyScene])),1)]),_:1},8,["type"])]),_:1},8,["label"])):fe("",!0),p.rowData?.systemTaskType===3?(C(),I(y,{key:1,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>[t(b,{type:e(x)(p.rowData?.notifyScene)},{default:n(()=>[k(w(e(a)(e(be)[p.rowData?.notifyScene])),1)]),_:1},8,["type"])]),_:1},8,["label"])):fe("",!0),t(y,{label:e(a)("page.notifyConfig.notifyThreshold"),span:1},{default:n(()=>[t(b,{type:e(x)(p.rowData?.notifyThreshold)},{default:n(()=>[k(w(p.rowData?.notifyThreshold),1)]),_:1},8,["type"])]),_:1},8,["label"]),t(y,{label:e(a)("common.createDt"),span:2},{default:n(()=>[k(w(p.rowData?.createDt),1)]),_:1},8,["label"]),t(y,{label:e(a)("page.notifyConfig.description"),span:2},{default:n(()=>[k(w(p.rowData?.description),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),ct={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function z(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!Pe(_)}const Lt=H({name:"notify_config",__name:"index",setup(_){const{hasAuth:N}=Qe(),p=Ae(),m=B(),{bool:y,setTrue:b}=Fe(!1),{columns:g,columnChecks:c,data:v,getData:S,loading:D,mobilePagination:U,searchParams:O,resetSearchParams:P}=Ze({apiFn:He,apiParams:{page:1,size:10,groupName:null,notifyStatus:null,notifyScene:null,notifyName:null,systemTaskType:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:a("common.index"),align:"center",width:64},{key:"notifyName",title:a("page.notifyConfig.notifyName"),align:"center",width:120,render:i=>{function o(){m.value=i||null,b()}return t(X,{text:!0,tag:"a",type:"primary",onClick:o,class:"ws-normal"},{default:()=>[i.notifyName]})}},{key:"groupName",title:a("page.notifyConfig.groupName"),align:"center",width:120},{key:"systemTaskType",title:a("page.notifyConfig.systemTaskType"),align:"center",width:120,render:i=>{if(i.systemTaskType===null)return null;const o=a(ge[i.systemTaskType]);return t(W,{type:x(i.systemTaskType)},z(o)?o:{default:()=>[o]})}},{key:"notifyStatus",title:a("page.notifyConfig.notifyStatus"),align:"center",width:120,render:i=>{const o=async(T,d)=>{const{error:s}=await Ke(i.id,T);s||(i.notifyStatus=T,window.$message?.success(a("common.updateSuccess"))),d(!s)};return t(pt,{value:i.notifyStatus,"onUpdate:value":T=>i.notifyStatus=T,onSubmitted:o},null)}},{key:"notifyName",title:a("page.notifyConfig.notifyName"),align:"center",width:120},{key:"notifyScene",title:a("page.notifyConfig.notifyScene"),align:"center",width:180,render:i=>{if(i.notifyScene===null)return null;if(i.systemTaskType===1){const o=a(_e[i.notifyScene]);return t(W,{type:x(i.notifyScene)},{default:()=>[t(oe,{class:"max-w-136px"},z(o)?o:{default:()=>[o]})]})}if(i.systemTaskType===3){const o=a(be[i.notifyScene]);return t(W,{type:x(i.notifyScene)},{default:()=>[t(oe,{class:"max-w-136px"},z(o)?o:{default:()=>[o]})]})}if(i.systemTaskType===4){const o=a(ze[i.notifyScene]);return t(W,{type:x(i.notifyScene)},{default:()=>[t(oe,{class:"max-w-136px"},z(o)?o:{default:()=>[o]})]})}return null}},{key:"notifyThreshold",title:a("page.notifyConfig.notifyThreshold"),align:"center",width:120},{key:"createDt",title:a("common.createDt"),align:"center",width:120},{key:"description",title:a("page.notifyConfig.description"),align:"center",width:120},{key:"operate",title:a("common.operate"),align:"center",width:130,fixed:"right",render:i=>{let o;return t("div",{class:"flex-center gap-8px"},[t(X,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>Z(i.id)},z(o=a("common.edit"))?o:{default:()=>[o]}),N("R_ADMIN")?t(ie,null,[t(Ee,{vertical:!0},null),t(Te,{onPositiveClick:()=>Y(i.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let T;return t("span",null,[t(X,{type:"error",text:!0,ghost:!0,size:"small"},z(T=a("common.delete"))?T:{default:()=>[T]})])}})]):""])}}]}),{drawerVisible:h,operateType:R,editingData:ee,handleAdd:te,handleEdit:l,checkedRowKeys:L,onBatchDeleted:ae}=Xe(v,S);async function K(){const{error:i}=await de(L.value);i||ae()}async function Y(i){const{error:o}=await de([i]);o||(window.$message?.success(a("common.deleteSuccess")),S())}function Z(i){l(i)}return(i,o)=>{const T=Ne,d=Se,s=st,f=je;return C(),le("div",ct,[t(mt,{model:e(O),"onUpdate:model":o[0]||(o[0]=u=>J(O)?O.value=u:null),onReset:e(P),onSearch:e(S)},null,8,["model","onReset","onSearch"]),t(T),t(f,{title:e(a)("page.notifyConfig.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":n(()=>[t(d,{columns:e(c),"onUpdate:columns":o[1]||(o[1]=u=>J(c)?c.value=u:null),"disabled-delete":e(L).length===0,loading:e(D),"show-delete":e(N)("R_ADMIN"),onAdd:e(te),onDelete:K,onRefresh:e(S)},null,8,["columns","disabled-delete","loading","show-delete","onAdd","onRefresh"])]),default:n(()=>[t(s,{"checked-row-keys":e(L),"onUpdate:checkedRowKeys":o[2]||(o[2]=u=>J(L)?L.value=u:null),columns:e(g),data:e(v),"flex-height":!e(p).isMobile,"scroll-x":962,loading:e(D),remote:"","row-key":u=>u.id,pagination:e(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(ft,{visible:e(h),"onUpdate:visible":o[3]||(o[3]=u=>J(h)?h.value=u:null),"operate-type":e(R),"row-data":e(ee),onSubmitted:e(S)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(yt,{visible:e(y),"onUpdate:visible":o[4]||(o[4]=u=>J(y)?y.value=u:null),"row-data":m.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Lt as default};
