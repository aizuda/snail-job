import{a as K,b as J,N as x}from"./search-form-CSouas8Y.js";import{aP as w,aR as Z,b as S,o as k,e as Q,d as L,Z as B,a0 as C,c as P,w as o,f as a,h as e,$ as t,C as X,g,t as f,a8 as Y,J as ee,r as ae,ae as te,b4 as le,l as oe,af as N,B as D,E as ne,ag as re,ah as se}from"./index-DsXulf34.js";import{e as ie}from"./group-DephWMPB.js";import{_ as de,u as ue,a as me}from"./table-C5lzqi4D.js";import{_ as ce}from"./select-group.vue_vue_type_script_setup_true_lang-KMOD_UM1.js";import{_ as pe}from"./select-scene.vue_vue_type_script_setup_true_lang-C3ZddlqK.js";import{_ as ge}from"./datetime-range.vue_vue_type_script_setup_true_lang-BX2GIQW5.js";import{_ as fe,a as _e}from"./DescriptionsItem-BEs7Hiy4.js";import{b as be}from"./Grid-DdJm4X1d.js";import"./CollapseItem-4hJT8hQy.js";import"./retry-scene-xT7KfxDz.js";import"./DatePicker-B2fzTH2d.js";function he(s){return w({url:"/retry-dead-letter/list",method:"get",params:s})}function ye(s,p){return w({url:`/retry-dead-letter/${s}?groupName=${p}`,method:"get"})}function z(s){return w({url:"/retry-dead-letter/batch/rollback",method:"post",data:s})}function $(s){return w({url:"/retry-dead-letter/batch",method:"delete",data:s})}const ve={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ne(s,p){return k(),S("svg",ve,[...p[0]||(p[0]=[Q("path",{fill:"currentColor",d:"M20.93 14A7 7 0 0 1 14 20H5.5v-2H14a5 5 0 1 0 0-10H6.914l2.5 2.5L8 11.914L3.086 7L8 2.086L9.414 3.5L6.914 6H14a7 7 0 0 1 7 7v1z"},null,-1)])])}const De=Z({name:"tdesign-rollback",render:Ne}),we=L({name:"RetryDeadLetterSearch",__name:"dead-letter-search",props:{model:{required:!0},modelModifiers:{}},emits:B(["reset","search"],["update:model"]),setup(s,{emit:p}){const d=p,r=C(s,"model");function m(){d("reset")}function y(){d("search")}return(h,i)=>{const c=de,v=X,R=K;return k(),P(R,{"btn-span":"24 s:12 m:9 l:12 xl:15",model:r.value,onSearch:y,onReset:m},{default:o(()=>[a(c,{span:"24 s:12 m:6",label:e(t)("page.retryTask.groupName"),path:"groupName",class:"pr-24px"},{default:o(()=>[a(ce,{value:r.value.groupName,"onUpdate:value":i[0]||(i[0]=u=>r.value.groupName=u),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryTask.sceneName"),path:"sceneName",class:"pr-24px"},{default:o(()=>[a(pe,{value:r.value.sceneName,"onUpdate:value":i[1]||(i[1]=u=>r.value.sceneName=u),"group-name":r.value.groupName,clearable:""},null,8,["value","group-name"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retry.bizNo"),path:"bizNo",class:"pr-24px"},{default:o(()=>[a(v,{value:r.value.bizNo,"onUpdate:value":i[2]||(i[2]=u=>r.value.bizNo=u),placeholder:e(t)("page.retry.form.bizNo"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retry.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:o(()=>[a(v,{value:r.value.idempotentId,"onUpdate:value":i[3]||(i[3]=u=>r.value.idempotentId=u),placeholder:e(t)("page.retry.form.idempotentId"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:15 l:12 xl:9",label:e(t)("page.common.createTime"),path:"datetimeRange"},{default:o(()=>[a(ge,{value:r.value.datetimeRange,"onUpdate:value":i[4]||(i[4]=u=>r.value.datetimeRange=u)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ke=L({name:"RetryDeadLetterDetailDrawer",__name:"retry-letter-detail-drawer",props:B({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(s){const p=C(s,"visible");return(d,r)=>{const m=_e,y=fe,h=Y;return k(),P(h,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=i=>p.value=i),title:e(t)("page.retryDeadLetter.detail")},{default:o(()=>[a(y,{"label-placement":"top",bordered:"",column:3},{default:o(()=>[a(m,{label:e(t)("page.retry.groupName"),span:3},{default:o(()=>[g(f(d.rowData?.groupName),1)]),_:1},8,["label"]),a(m,{label:e(t)("page.retry.sceneName"),span:3},{default:o(()=>[g(f(d.rowData?.sceneName),1)]),_:1},8,["label"]),a(m,{label:e(t)("page.retry.bizNo"),span:3},{default:o(()=>[g(f(d.rowData?.bizNo),1)]),_:1},8,["label"]),a(m,{label:e(t)("page.retry.idempotentId"),span:3},{default:o(()=>[g(f(d.rowData?.idempotentId),1)]),_:1},8,["label"]),a(m,{label:e(t)("page.retry.executorName"),span:3},{default:o(()=>[g(f(d.rowData?.executorName),1)]),_:1},8,["label"]),a(m,{label:e(t)("page.retry.argsStr"),span:3},{default:o(()=>[g(f(d.rowData?.argsStr),1)]),_:1},8,["label"]),a(m,{label:e(t)("page.retry.serializerName"),span:2},{default:o(()=>[g(f(d.rowData?.serializerName),1)]),_:1},8,["label"]),a(m,{label:e(t)("common.createDt"),span:3},{default:o(()=>[g(f(d.rowData?.createDt),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Re={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function I(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!se(s)}const Ae=L({name:"retry_dead-letter",__name:"index",setup(s){const p=ee(),d=ae(),{bool:r,setTrue:m}=te(!1),{columns:y,columnChecks:h,data:i,getData:c,loading:v,mobilePagination:R,searchParams:u,resetSearchParams:T}=ue({apiFn:he,apiParams:{page:1,size:10,groupName:null,sceneName:null,datetimeRange:le()},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:t("common.index"),align:"center",width:120,render:n=>{async function l(){await H(n),m()}return a(D,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[n.id]})}},{key:"groupName",title:t("page.retryDeadLetter.groupName"),align:"center",minWidth:120},{key:"sceneName",title:t("page.retryDeadLetter.sceneName"),align:"center",minWidth:120},{key:"idempotentId",title:t("page.retryDeadLetter.idempotentId"),align:"center",minWidth:120},{key:"bizNo",title:t("page.retryDeadLetter.bizNo"),align:"center",minWidth:120},{key:"createDt",title:t("page.retryDeadLetter.createDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:n=>a("div",{class:"flex-center gap-8px"},[a(x,{onPositiveClick:()=>W(n)},{default:()=>t("common.confirmRollback"),trigger:()=>{let l;return a(D,{type:"info",text:!0,ghost:!0,size:"small"},I(l=t("common.rollback"))?l:{default:()=>[l]})}}),a(re,{vertical:!0},null),a(x,{onPositiveClick:()=>G(n)},{default:()=>t("common.confirmDelete"),trigger:()=>{let l;return a(D,{type:"error",text:!0,ghost:!0,size:"small"},I(l=t("common.delete"))?l:{default:()=>[l]})}})])}]}),{handleAdd:U,checkedRowKeys:b,onDeleted:V,onBatchDeleted:A}=me(i,c);async function M(){const{error:n}=await $({ids:b.value,groupName:u.groupName});n||n||A()}async function O(){const{error:n}=await z({ids:b.value});n||(window.$message?.success(t("common.rollbackSuccess")),c())}async function G(n){const{error:l}=await $({ids:[n.id],groupName:n.groupName});l||V()}async function H(n){const l=await ye(n.id,n.groupName);d.value=l.data||null}async function W(n){const{error:l}=await z({ids:[n.id],groupName:n.groupName});l||(window.$message?.success(t("common.rollbackSuccess")),c())}return oe(async()=>{const{error:n,data:l}=await ie();!n&&l.length>0&&c()}),(n,l)=>{const j=De,F=J,q=be,E=ne;return k(),S("div",Re,[a(we,{model:e(u),"onUpdate:model":l[0]||(l[0]=_=>N(u)?u.value=_:null),onReset:e(T),onSearch:e(c)},null,8,["model","onReset","onSearch"]),a(E,{title:e(t)("page.retryDeadLetter.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":o(()=>[a(F,{columns:e(h),"onUpdate:columns":l[1]||(l[1]=_=>N(h)?h.value=_:null),"disabled-delete":e(b).length===0,loading:e(v),"show-add":!1,onAdd:e(U),onDelete:M,onRefresh:e(c)},{addAfter:o(()=>[a(e(x),{onPositiveClick:O},{trigger:o(()=>[a(e(D),{size:"small",ghost:"",type:"primary",disabled:e(b).length===0},{icon:o(()=>[a(j,{class:"text-icon"})]),default:o(()=>[g(" "+f(e(t)("common.batchRollback")),1)]),_:1},8,["disabled"])]),default:o(()=>[g(" "+f(e(t)("common.confirmRollback")),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:o(()=>[a(q,{"checked-row-keys":e(b),"onUpdate:checkedRowKeys":l[2]||(l[2]=_=>N(b)?b.value=_:null),columns:e(y),data:e(i),"flex-height":!e(p).isMobile,"scroll-x":962,loading:e(v),remote:"","row-key":_=>_.id,pagination:e(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(ke,{visible:e(r),"onUpdate:visible":l[3]||(l[3]=_=>N(r)?r.value=_:null),"row-data":d.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Ae as default};
