import{d as G,j as L,k as N}from"./Grid-DdJm4X1d.js";import{d as H,ai as M,d_ as $,A as U,r as C,eb as W,ec as Y,ed as J,ae as K,m as R,aO as E,a as B,aR as X,b as q,o as Q,e as Z,an as ee,J as ae,$ as z,p as te,ap as se}from"./index-DsXulf34.js";const ne=Object.assign(Object.assign({},N),Y),de=H({__GRID_ITEM__:!0,name:"FormItemGridItem",alias:["FormItemGi"],props:ne,setup(){const a=C(null);return{formItemInstRef:a,validate:(...t)=>{const{value:m}=a;if(m)return m.validate(...t)},restoreValidation:()=>{const{value:t}=a;t&&t.restoreValidation()}}},render(){return M(G,$(this.$.vnode.props||{},L),{default:()=>{const a=$(this.$props,W);return M(U,Object.assign({ref:"formItemInstRef"},a),this.$slots)}})}});function oe(a){const{loading:c,startLoading:k,endLoading:t}=J(),{bool:m,setBool:h}=K(),{apiFn:w,apiParams:d,transformer:S,immediate:b=!0,getColumnChecks:v,getColumns:I}=a,f=R(E({...d})),p=C(a.columns()),g=C([]),i=C(v(a.columns())),P=B(()=>I(p.value,i.value));function D(){p.value=a.columns();const l=new Map(i.value.map(r=>[r.key,r.checked])),_=v(p.value);i.value=_.map(r=>({...r,checked:l.get(r.key)??r.checked}))}async function y(){k();const l=O(f),_=await w(l),r=S(_);g.value=r.data,h(r.data.length===0),await a.onFetched?.(r),t()}function O(l){const _={};return Object.entries(l).forEach(([r,e])=>{e!=null&&(_[r]=e)}),_}function o(l){Object.assign(f,l)}function T(){Object.assign(f,E(d))}return b&&(a.searchParams&&o(a.searchParams),y()),{loading:c,empty:m,data:g,columns:P,columnChecks:i,reloadColumns:D,getData:y,searchParams:f,updateSearchParams:o,resetSearchParams:T}}const re={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function ce(a,c){return Q(),q("svg",re,[...c[0]||(c[0]=[Z("path",{fill:"currentColor",d:"M18 12.998h-5v5a1 1 0 0 1-2 0v-5H6a1 1 0 0 1 0-2h5v-5a1 1 0 0 1 2 0v5h5a1 1 0 0 1 0 2"},null,-1)])])}const pe=X({name:"ic-round-plus",render:ce});function me(a){const c=ee(),k=ae(),t=B(()=>k.isMobile),{apiFn:m,apiParams:h,immediate:w}=a,d=a.showTotal||!0,S="__selection__",b="__expand__",{loading:v,empty:I,data:f,columns:p,columnChecks:g,reloadColumns:i,getData:P,searchParams:D,updateSearchParams:y,resetSearchParams:O}=oe({apiFn:m,apiParams:h,searchParams:a.searchParams,columns:a.columns,transformer:e=>{const{data:u=[],page:s=1,size:x=10,total:n=0}=e.data||{},j=x<=0?10:x;return{data:u.map((V,A)=>({...V,index:(s-1)*j+A+1})),pageNum:s,pageSize:j,total:n}},getColumnChecks:e=>{const u=[];return e.forEach(s=>{F(s)?u.push({key:s.key,title:s.title,checked:!0}):s.type==="selection"?u.push({key:S,title:z("common.check"),checked:!0}):s.type==="expand"&&u.push({key:b,title:z("common.expandColumn"),checked:!0})}),u},getColumns:(e,u)=>{const s=new Map;return e.forEach(n=>{F(n)?s.set(n.key,n):n.type==="selection"?s.set(S,n):n.type==="expand"&&s.set(b,n),t.value&&n.fixed&&(n.fixed=void 0)}),u.filter(n=>n.checked).map(n=>s.get(n.key))},onFetched:async e=>{const{pageNum:u,pageSize:s,total:x}=e;l({page:u,pageSize:s,itemCount:x})},immediate:w}),o=R({page:1,pageSize:10,showSizePicker:!0,itemCount:0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{o.page=e,y({page:e,size:o.pageSize}),P()},onUpdatePageSize:async e=>{o.pageSize=e,o.page=1,y({page:o.page,size:e}),P()},prefix:e=>z("datatable.itemCount",{total:e.itemCount})}),T=B(()=>({...o,pageSlot:t.value?3:9,prefix:!t.value&&d?o.prefix:void 0}));function l(e){Object.assign(o,e)}async function _(e=1){l({page:e}),y({page:e,size:o.pageSize}),await P()}return c.run(()=>{te(()=>k.locale,()=>{i()})}),se(()=>{c.stop()}),{loading:v,empty:I,data:f,columns:p,columnChecks:g,reloadColumns:i,pagination:o,mobilePagination:T,updatePagination:l,getData:P,getDataByPage:_,searchParams:D,updateSearchParams:y,resetSearchParams:()=>{O(),P()}}}function he(a,c){const{bool:k,setTrue:t,setFalse:m}=K(),h=C("add");function w(){h.value="add",t()}const d=C(null);function S(p){h.value="edit";const g=a.value.find(i=>i.id===p)||null;d.value=E(g),t()}function b(p){h.value="add";const g=a.value.find(i=>i.id===p)||null;d.value=E(g),delete d.value?.id,t()}const v=C([]);async function I(){window.$message?.success(z("common.deleteSuccess")),v.value=[],await c()}async function f(){window.$message?.success(z("common.deleteSuccess")),await c()}return{drawerVisible:k,openDrawer:t,closeDrawer:m,operateType:h,handleAdd:w,editingData:d,handleEdit:S,handleCopy:b,checkedRowKeys:v,onBatchDeleted:I,onDeleted:f}}function F(a){return!!a.key}export{de as _,he as a,pe as b,me as u};
