import{_ as Y,a as ee,b as te,N as ne}from"./search-form-CSouas8Y.js";import{_ as ae}from"./delete-alert-CMbkkQNx.js";import{aP as z,d as Z,Z as K,a1 as L,x as Q,a0 as W,y as oe,z as se,a as le,$ as a,m as ie,p as re,c as F,o as D,w as l,f as e,G as ue,A as ce,h as t,a5 as de,C as X,a6 as pe,g as C,B as $,t as j,D as me,a8 as _e,aQ as fe,J as ge,r as he,I as ye,b as we,af as P,E as ve,_ as H,N as be,a2 as ke,ag as J,ah as Ie}from"./index-DsXulf34.js";import{_ as xe,u as Ne,a as Se}from"./table-C5lzqi4D.js";import{_ as qe}from"./round-content-copy-ByyAesUF.js";import{b as Ce}from"./Grid-DdJm4X1d.js";import"./CollapseItem-4hJT8hQy.js";function $e(i){return z({url:"/namespace/list",method:"get",params:i})}function De(i){return z({url:"/namespace",method:"post",data:i})}function Re(i){return z({url:"/namespace",method:"put",data:i})}function Te(i){return z({url:`/namespace/${i}`,method:"delete"})}const Ae=Z({name:"NamespaceOperateDrawer",__name:"namespace-operate-drawer",props:K({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:K(["submitted"],["update:visible"]),setup(i,{emit:k}){const r=i,_=k,{copy:I,isSupported:x}=L(),R=Q(),m=W(i,"visible"),{formRef:N,validate:g,restoreValidation:w}=oe(),{defaultRequiredRule:f}=se(),T=le(()=>({add:a("page.namespace.addNamespace"),edit:a("page.namespace.editNamespace")})[r.operateType]),u=ie(v());function v(){return{name:"",uniqueId:""}}const V={name:f,uniqueId:{required:!1,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:a("page.namespace.form.uniqueIdRule")}};function S(){u.uniqueId=fe(32)}function E(){if(r.operateType==="add"){Object.assign(u,v());return}r.operateType==="edit"&&r.rowData&&Object.assign(u,r.rowData)}function A(){m.value=!1}async function U(){if(await g(),r.operateType==="add"){const{name:c,uniqueId:s}=u,{error:d}=await De({name:c,uniqueId:s});if(d)return;window.$message?.success(a("common.addSuccess"))}if(r.operateType==="edit"){const{id:c,name:s,uniqueId:d}=u,{error:q}=await Re({id:c,name:s,uniqueId:d});if(q)return;window.$message?.success(a("common.updateSuccess"))}await R.getUserInfo(),A(),_("submitted")}re(m,()=>{m.value&&(E(),w())});async function M(c){if(!x){window.$message?.error("您的浏览器不支持 Clipboard API");return}if(c){if(navigator.clipboard&&window.isSecureContext)await I(c);else{const s=document.createRange();s.selectNode(document.getElementById("uniqueIdInput"));const d=window.getSelection();d?.rangeCount&&d.removeAllRanges(),d?.addRange(s),document.execCommand("copy")}window.$message?.success("复制成功")}}return(c,s)=>{const d=X,q=qe,n=$,o=pe,h=Y,y=de,B=ce,O=ue,p=me;return D(),F(_e,{modelValue:m.value,"onUpdate:modelValue":s[3]||(s[3]=b=>m.value=b),title:T.value,onSubmitted:U},{footer:l(()=>[e(p,{size:16},{default:l(()=>[e(n,{onClick:A},{default:l(()=>[C(j(t(a)("common.cancel")),1)]),_:1}),e(n,{type:"primary",onClick:U},{default:l(()=>[C(j(t(a)("common.save")),1)]),_:1})]),_:1})]),default:l(()=>[e(O,{ref_key:"formRef",ref:N,model:u,rules:V},{default:l(()=>[e(B,{label:t(a)("page.namespace.uniqueId"),path:"uniqueId"},{default:l(()=>[e(y,null,{default:l(()=>[e(d,{id:"uniqueIdInput",value:u.uniqueId,"onUpdate:value":s[0]||(s[0]=b=>u.uniqueId=b),disabled:r.operateType==="edit",placeholder:t(a)("page.namespace.form.uniqueId")},null,8,["value","disabled","placeholder"]),r.operateType==="edit"?(D(),F(o,{key:0,trigger:"hover"},{trigger:l(()=>[e(n,{type:"default",ghost:"",onClick:s[1]||(s[1]=b=>M(u.uniqueId))},{default:l(()=>[e(q,{class:"text-icon"})]),_:1})]),default:l(()=>[s[4]||(s[4]=C(" 复制 "))]),_:1,__:[4]})):(D(),F(o,{key:1,trigger:"hover"},{trigger:l(()=>[e(n,{type:"default",ghost:"",onClick:S},{default:l(()=>[e(h,{class:"text-icon"})]),_:1})]),default:l(()=>[C(" "+j(t(a)("common.generateRandomly")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),e(B,{label:t(a)("page.namespace.name"),path:"name"},{default:l(()=>[e(d,{value:u.name,"onUpdate:value":s[2]||(s[2]=b=>u.name=b),placeholder:t(a)("page.namespace.form.name")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Ue=Z({name:"NamespaceSearch",__name:"namespace-search",props:{model:{required:!0},modelModifiers:{}},emits:K(["reset","search"],["update:model"]),setup(i,{emit:k}){const r=k,_=W(i,"model");function I(){r("reset")}function x(){r("search")}return(R,m)=>{const N=X,g=xe,w=ee;return D(),F(w,{model:_.value,onSearch:x,onReset:I},{default:l(()=>[e(g,{span:"24 s:12 m:6",label:t(a)("page.namespace.keyword"),path:"keyword",class:"pr-24px"},{default:l(()=>[e(N,{value:_.value.keyword,"onUpdate:value":m[0]||(m[0]=f=>_.value.keyword=f),placeholder:t(a)("page.namespace.form.keyword"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function G(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Ie(i)}const je=Z({name:"namespace",__name:"index",setup(i){const k=ge(),r=Q(),_=he(ye.get("namespaceId")),{copy:I,isSupported:x}=L(),R=n=>{_.value=n,r.setNamespaceId(n)};async function m(n){if(!x){window.$message?.error("您的浏览器不支持 Clipboard API");return}if(n){if(navigator.clipboard&&window.isSecureContext)await I(n);else{const o=document.createElement("input");o.value=n,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)}window.$message?.success("复制成功")}}const{columns:N,columnChecks:g,data:w,getData:f,loading:T,mobilePagination:u,searchParams:v,resetSearchParams:V}=Ne({apiFn:$e,apiParams:{page:1,size:10,keyword:null},columns:()=>[{key:"id",title:a("common.index"),align:"center",width:64},{key:"name",title:a("page.namespace.name"),align:"left",width:120},{key:"status",title:a("common.active"),align:"center",width:40,render:n=>e("div",{class:"flex justify-center"},[_.value===n.uniqueId?e(H,{icon:"material-symbols:check-circle",class:"text-20px color-success"},null):e(H,{icon:"material-symbols:cancel",class:"text-20px color-gray400"},null)])},{key:"uniqueId",title:a("page.namespace.uniqueId"),align:"left",width:180,render:n=>e(be,null,{trigger:()=>e($,{text:!0,type:"primary",onClick:()=>m(n.uniqueId)},{default:()=>[n.uniqueId]}),default:()=>e("span",null,[C("点击复制")])})},{key:"createDt",title:a("page.common.createTime"),align:"left",width:130},{key:"updateDt",title:a("page.common.upadteTime"),align:"left",width:130},{key:"operate",title:a("common.operate"),align:"center",width:80,render:n=>{let o,h;return e("div",{class:"flex-center gap-8px"},[e($,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>d(n.id)},G(o=a("common.edit"))?o:{default:()=>[o]}),_.value!==n.uniqueId?e(ke,null,[e(J,{vertical:!0},null),e($,{type:"warning",text:!0,ghost:!0,size:"small",onClick:()=>R(n.uniqueId)},G(h=a("common.switch"))?h:{default:()=>[h]}),e(J,{vertical:!0},null),e(ne,{onPositiveClick:()=>q(n.uniqueId)},{default:()=>a("common.confirmDelete"),trigger:()=>{let y;return e($,{type:"error",text:!0,ghost:!0,size:"small"},G(y=a("common.delete"))?y:{default:()=>[y]})}})]):""])}}]}),{drawerVisible:S,operateType:E,editingData:A,handleAdd:U,handleEdit:M,checkedRowKeys:c,onDeleted:s}=Se(w,f);function d(n){M(n)}async function q(n){const{error:o}=await Te(n);o||s()}return(n,o)=>{const h=ae,y=te,B=Ce,O=ve;return D(),we("div",Be,[e(Ue,{model:t(v),"onUpdate:model":o[0]||(o[0]=p=>P(v)?v.value=p:null),onReset:t(V),onSearch:t(f)},null,8,["model","onReset","onSearch"]),e(h),e(O,{title:t(a)("page.namespace.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":l(()=>[e(y,{columns:t(g),"onUpdate:columns":o[1]||(o[1]=p=>P(g)?g.value=p:null),"disabled-delete":t(c).length===0,loading:t(T),"show-delete":!1,onAdd:t(U),onRefresh:t(f)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:l(()=>[e(B,{"checked-row-keys":t(c),"onUpdate:checkedRowKeys":o[2]||(o[2]=p=>P(c)?c.value=p:null),columns:t(N),data:t(w),"flex-height":!t(k).isMobile,"scroll-x":962,loading:t(T),remote:"","row-key":p=>p.id,pagination:t(u),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ae,{visible:t(S),"onUpdate:visible":o[3]||(o[3]=p=>P(S)?S.value=p:null),"operate-type":t(E),"row-data":t(A),onSubmitted:t(f)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{je as default};
