import{_ as de,a as ce,b as ge,N as X}from"./search-form-CSouas8Y.js";import{_ as me,a as _e,d as fe}from"./download-C7ANTmFB.js";import{_ as be}from"./delete-alert-CMbkkQNx.js";import{d as F,Z as E,a0 as Q,a1 as te,y as ve,z as Se,a as he,$ as o,m as ye,p as we,c as U,o as N,w as n,f as t,G as Ce,h as e,A as Ne,C as oe,D as ke,b as Y,a2 as Z,a3 as ee,a4 as ne,a5 as De,a6 as xe,g as D,B as O,t as k,a7 as Re,a8 as ae,e as K,Y as le,a9 as H,aa as $e,ab as re,ac as Te,ad as Ue,J as Ge,r as Ie,ae as Ae,af as P,P as Oe,E as Me,ag as Pe,ah as Be}from"./index-DsXulf34.js";import{f as Ve,a as Ee,b as Fe,c as je,d as ze}from"./group-DephWMPB.js";import{_ as We,u as qe,a as Je}from"./table-C5lzqi4D.js";import{u as Ke}from"./auth-CUdKODNA.js";import{_ as Le}from"./status-switch.vue_vue_type_script_setup_true_lang-m8qEijEY.js";import{_ as ue}from"./round-content-copy-ByyAesUF.js";import{_ as Ye,a as Ze,b as He}from"./Grid-DdJm4X1d.js";import{_ as Qe,a as Xe}from"./CollapseItem-4hJT8hQy.js";import{_ as et,a as tt}from"./DescriptionsItem-BEs7Hiy4.js";import"./Progress-B1GWDnDE.js";const ot=F({name:"GroupOperateDrawer",__name:"group-operate-drawer",props:E({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:E(["submitted"],["update:visible"]),setup(C,{emit:v}){const d=C,S=v,f=Q(C,"visible"),{copy:p,isSupported:h}=te(),{formRef:s,validate:$,restoreValidation:y}=ve(),{defaultRequiredRule:b}=Se(),G=he(()=>({add:o("page.groupConfig.addGroupConfig"),edit:o("page.groupConfig.editGroupConfig")})[d.operateType]),r=ye(I());function I(){return{groupName:"",token:"SJ_Wyz3dmsdbDOkDujOTSSoBjGQP1BMsVnj",groupStatus:1,description:"",idGeneratorMode:2,initScene:1,groupPartition:0}}const M={groupName:[{required:!0,pattern:/^[A-Za-z0-9_-]{1,64}$/,trigger:"change",message:o("page.groupConfig.form.groupNameRule")}],token:[b],groupStatus:[b],idGeneratorMode:[b],initScene:[b],groupPartition:[b]};function j(){if(d.operateType==="add"){Object.assign(r,I());return}d.operateType==="edit"&&d.rowData&&Object.assign(r,d.rowData)}function B(){f.value=!1}async function V(){if(await $(),d.operateType==="add"){const{groupName:w,token:u,groupStatus:c,description:m,idGeneratorMode:l,initScene:a,groupPartition:g}=r,{error:R}=await Ve({groupName:w,token:u,groupStatus:c,description:m,idGeneratorMode:l,initScene:a,groupPartition:g});if(R)return;window.$message?.success(o("common.addSuccess"))}else{const{groupName:w,token:u,groupStatus:c,description:m,idGeneratorMode:l,initScene:a,groupPartition:g}=r,{error:R}=await Ee({groupName:w,token:u,groupStatus:c,description:m,idGeneratorMode:l,initScene:a,groupPartition:g});if(R)return;window.$message?.success(o("common.updateSuccess"))}B(),S("submitted")}function z(){r.token=x(32)}function x(w){const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let c="SJ_";for(let m=0;m<w;m+=1){const l=Math.floor(Math.random()*u.length);c+=u.substring(l,l+1)}return c}we(f,()=>{f.value&&(j(),y())});async function W(w){if(!h){window.$message?.error("您的浏览器不支持 Clipboard API");return}if(w){if(navigator.clipboard&&window.isSecureContext)await p(w);else{const u=document.createRange();u.selectNode(document.getElementById("tokenOperateInput"));const c=window.getSelection();c?.rangeCount&&c.removeAllRanges(),c?.addRange(u),document.execCommand("copy")}window.$message?.success("复制成功")}}return(w,u)=>{const c=oe,m=Ne,l=Ze,a=ke,g=Ye,R=ue,T=O,A=xe,q=de,J=De,_=Xe,se=Qe,ie=Ce,pe=ae;return N(),U(pe,{modelValue:f.value,"onUpdate:modelValue":u[6]||(u[6]=i=>f.value=i),title:G.value,onSubmitted:V},{footer:n(()=>[t(a,{size:16},{default:n(()=>[t(T,{onClick:B},{default:n(()=>[D(k(e(o)("common.cancel")),1)]),_:1}),t(T,{type:"primary",onClick:V},{default:n(()=>[D(k(e(o)("common.save")),1)]),_:1})]),_:1})]),default:n(()=>[t(ie,{ref_key:"formRef",ref:s,model:r,rules:M},{default:n(()=>[t(se,{"default-expanded-names":["1","2"]},{default:n(()=>[t(_,{title:e(o)("page.groupConfig.commonConfig"),name:"1"},{default:n(()=>[t(m,{label:e(o)("page.groupConfig.groupName"),path:"groupName"},{default:n(()=>[t(c,{value:r.groupName,"onUpdate:value":u[0]||(u[0]=i=>r.groupName=i),maxlength:64,"show-count":"",placeholder:e(o)("page.groupConfig.form.groupName"),disabled:d.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),t(m,{label:e(o)("page.groupConfig.groupStatus"),path:"groupStatus"},{default:n(()=>[t(g,{value:r.groupStatus,"onUpdate:value":u[1]||(u[1]=i=>r.groupStatus=i),name:"groupStatus"},{default:n(()=>[t(a,null,{default:n(()=>[(N(!0),Y(Z,null,ee(e(ne),i=>(N(),U(l,{key:i.value,value:i.value,label:e(o)(i.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),t(m,{label:e(o)("page.groupConfig.token"),path:"token"},{default:n(()=>[t(J,null,{default:n(()=>[t(c,{id:"tokenOperateInput",value:r.token,"onUpdate:value":u[2]||(u[2]=i=>r.token=i),maxlength:64,placeholder:e(o)("page.groupConfig.form.token"),disabled:d.operateType==="edit"},null,8,["value","placeholder","disabled"]),d.operateType==="edit"?(N(),U(A,{key:0,trigger:"hover"},{trigger:n(()=>[t(T,{type:"default",ghost:"",onClick:u[3]||(u[3]=i=>W(r.token))},{default:n(()=>[t(R,{class:"text-icon"})]),_:1})]),default:n(()=>[u[7]||(u[7]=D(" 复制 "))]),_:1,__:[7]})):(N(),U(A,{key:1,trigger:"hover"},{trigger:n(()=>[t(T,{type:"default",ghost:"",onClick:z},{default:n(()=>[t(q,{class:"text-icon"})]),_:1})]),default:n(()=>[D(" "+k(e(o)("page.groupConfig.generateToken")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),t(m,{label:e(o)("page.groupConfig.description"),path:"description"},{default:n(()=>[t(c,{value:r.description,"onUpdate:value":u[4]||(u[4]=i=>r.description=i),type:"textarea",maxlength:256,"show-count":"",placeholder:e(o)("page.groupConfig.form.description"),clearable:"",round:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["title"]),t(_,{title:e(o)("page.groupConfig.retryConfig"),name:"2"},{default:n(()=>[t(m,{label:e(o)("page.groupConfig.initScene"),path:"initScene"},{default:n(()=>[t(g,{value:r.initScene,"onUpdate:value":u[5]||(u[5]=i=>r.initScene=i),name:"initScene"},{default:n(()=>[t(a,null,{default:n(()=>[(N(!0),Y(Z,null,ee(e(Re),i=>(N(),U(l,{key:i.value,value:i.value,label:e(o)(i.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["title"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),nt={class:"flex items-center gap-2"},at={id:"tokenDetailInput"},lt=F({name:"GroupDetailDrawer",__name:"group-detail-drawer",props:E({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(C){const v=Q(C,"visible"),{copy:d,isSupported:S}=te();async function f(p){if(!S){window.$message?.error("您的浏览器不支持 Clipboard API");return}if(p){if(navigator.clipboard&&window.isSecureContext)await d(p);else{const h=document.createRange();h.selectNode(document.getElementById("tokenDetailInput"));const s=window.getSelection();s?.rangeCount&&s.removeAllRanges(),s?.addRange(h),document.execCommand("copy")}window.$message?.success("复制成功")}}return(p,h)=>{const s=tt,$=ue,y=O,b=le,G=et,r=ae;return N(),U(r,{modelValue:v.value,"onUpdate:modelValue":h[1]||(h[1]=I=>v.value=I),title:e(o)("page.groupConfig.detail")},{default:n(()=>[t(G,{"label-placement":"top",bordered:"",column:1},{default:n(()=>[t(s,{label:e(o)("page.groupConfig.groupName"),span:1},{default:n(()=>[D(k(p.rowData?.groupName),1)]),_:1},8,["label"]),t(s,{span:1},{label:n(()=>[K("div",nt,[K("span",null,k(e(o)("page.groupConfig.token")),1),t(y,{type:"default",text:"",onClick:h[0]||(h[0]=I=>f(p.rowData?.token))},{default:n(()=>[t($,{class:"text-icon"})]),_:1})])]),default:n(()=>[K("span",at,k(p.rowData?.token),1)]),_:1}),t(s,{label:e(o)("page.groupConfig.groupStatus"),span:1},{default:n(()=>[t(b,{type:e(H)(p.rowData?.groupStatus)},{default:n(()=>[D(k(e(o)(e($e)[p.rowData?.groupStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),t(s,{label:e(o)("page.groupConfig.initScene"),span:1},{default:n(()=>[t(b,{type:e(H)(p.rowData?.initScene)},{default:n(()=>[D(k(e(o)(e(re)[p.rowData?.initScene])),1)]),_:1},8,["type"])]),_:1},8,["label"]),t(s,{label:e(o)("page.groupConfig.description"),span:1},{default:n(()=>[D(k(p.rowData?.description),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])}}}),rt=F({name:"GroupSearch",__name:"group-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(C,{emit:v}){const d=v,S=Q(C,"model");function f(){d("reset")}function p(){d("search")}return(h,s)=>{const $=oe,y=We,b=Te,G=ce;return N(),U(G,{model:S.value,onSearch:p,onReset:f},{default:n(()=>[t(y,{span:"24 s:12 m:6",label:e(o)("page.groupConfig.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t($,{value:S.value.groupName,"onUpdate:value":s[0]||(s[0]=r=>S.value.groupName=r),placeholder:e(o)("page.groupConfig.form.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(y,{span:"24 s:12 m:6",label:e(o)("page.groupConfig.groupStatus"),path:"groupStatus",class:"pr-24px"},{default:n(()=>[t(b,{value:S.value.groupStatus,"onUpdate:value":s[1]||(s[1]=r=>S.value.groupStatus=r),placeholder:e(o)("page.groupConfig.form.groupStatus"),options:e(Ue)(e(ne)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ut={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function L(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Be(C)}const yt=F({name:"group",__name:"index",setup(C){const{hasAuth:v}=Ke(),d=Ge(),S=Ie(),{bool:f,setTrue:p}=Ae(!1),{columns:h,columnChecks:s,data:$,getData:y,loading:b,mobilePagination:G,searchParams:r,resetSearchParams:I}=qe({apiFn:Fe,apiParams:{page:1,size:10,groupName:null,groupStatus:null},columns:()=>[{key:"id",title:o("common.index"),align:"center",width:64},{key:"groupName",title:o("page.groupConfig.groupName"),align:"center",minWidth:100,render:l=>{function a(){S.value=l||null,p()}return t(O,{text:!0,tag:"a",type:"primary",onClick:a,class:"ws-normal"},{default:()=>[l.groupName]})}},{key:"groupStatus",title:o("page.groupConfig.groupStatus"),align:"center",width:120,render:l=>{const a=async(g,R)=>{const T=l.groupStatus===1?0:1,{error:A}=await je({groupName:l.groupName,groupStatus:T});A||(l.groupStatus=g,window.$message?.success(o("common.updateSuccess"))),R(!A)};return t(Le,{value:l.groupStatus,"onUpdate:value":g=>l.groupStatus=g,onSubmitted:a,disabled:v("R_USER")},null)}},{key:"initScene",title:o("page.groupConfig.initScene"),align:"center",minWidth:120,render:l=>{if(l.groupStatus===null)return null;const a=o(re[l.initScene]);return t(le,{type:H(l.initScene)},L(a)?a:{default:()=>[a]})}},{key:"updateDt",title:o("page.groupConfig.updateDt"),align:"center",width:120},{key:"description",title:o("page.groupConfig.description"),align:"center",width:250},{key:"operate",title:o("common.operate"),align:"center",width:120,render:l=>{let a;return v("R_USER")?t(Z,null,null):t("div",{class:"flex-center gap-8px"},[t(O,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>w(l.id)},L(a=o("common.edit"))?a:{default:()=>[a]}),t(Pe,{vertical:!0},null),t(X,{onPositiveClick:()=>u(l.groupName)},{default:()=>o("common.confirmDelete"),trigger:()=>{let g;return t(O,{type:"error",text:!0,ghost:!0,size:"small"},L(g=o("common.delete"))?g:{default:()=>[g]})}})])}}]}),{drawerVisible:M,operateType:j,editingData:B,handleAdd:V,handleEdit:z,checkedRowKeys:x,onDeleted:W}=Je($,y);function w(l){z(l)}async function u(l){const{error:a}=await ze(l);a||W()}function c(){return{groupName:r.groupName,groupStatus:r.groupStatus,groupIds:x.value}}function m(){fe("/group/export",c(),o("page.groupConfig.title"))}return(l,a)=>{const g=be,R=me,T=_e,A=ge,q=He,J=Me;return N(),Y("div",ut,[t(rt,{model:e(r),"onUpdate:model":a[0]||(a[0]=_=>P(r)?r.value=_:null),onReset:e(I),onSearch:e(y)},null,8,["model","onReset","onSearch"]),t(g),t(J,{title:e(o)("page.groupConfig.title"),bordered:!1,size:"small","header-class":"view-card-header",class:"card-wrapper sm:flex-1-hidden"},{"header-extra":n(()=>[t(A,{columns:e(s),"onUpdate:columns":a[1]||(a[1]=_=>P(s)?s.value=_:null),loading:e(b),"show-add":e(v)("R_ADMIN"),"show-delete":!1,onAdd:e(V),onRefresh:e(y)},{addAfter:n(()=>[e(v)("R_ADMIN")?(N(),U(R,{key:0,action:"/group/import",accept:"application/json",onRefresh:e(y)},null,8,["onRefresh"])):Oe("",!0),t(e(X),{onPositiveClick:m},{trigger:n(()=>[t(e(O),{size:"small",ghost:"",type:"primary",disabled:e(x).length===0&&e(v)("R_USER")},{icon:n(()=>[t(T,{class:"text-icon"})]),default:n(()=>[D(" "+k(e(o)("common.export")),1)]),_:1},8,["disabled"])]),default:n(()=>[D(k(e(x).length===0?e(o)("common.exportAll"):e(o)("common.exportPar",{num:e(x).length})),1)]),_:1})]),_:1},8,["columns","loading","show-add","onAdd","onRefresh"])]),default:n(()=>[t(q,{"checked-row-keys":e(x),"onUpdate:checkedRowKeys":a[2]||(a[2]=_=>P(x)?x.value=_:null),columns:e(h),data:e($),"flex-height":!e(d).isMobile,"scroll-x":962,loading:e(b),remote:"","row-key":_=>_.id,pagination:e(G),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(ot,{visible:e(M),"onUpdate:visible":a[3]||(a[3]=_=>P(M)?M.value=_:null),"operate-type":e(j),"row-data":e(B),onSubmitted:e(y)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(lt,{visible:e(f),"onUpdate:visible":a[4]||(a[4]=_=>P(f)?f.value=_:null),"row-data":S.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{yt as default};
